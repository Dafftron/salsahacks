const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/tag-CccaPfO5.js","assets/index-CqYG162O.js","assets/index-D5-qQo4z.css","assets/jszip.min-oOtCOh2c.js"])))=>i.map(i=>d[i]);
var xa=Object.defineProperty;var Cs=s=>{throw TypeError(s)};var ga=(s,a,t)=>a in s?xa(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t;var Oe=(s,a,t)=>ga(s,typeof a!="symbol"?a+"":a,t),$s=(s,a,t)=>a.has(s)||Cs("Cannot "+t);var ee=(s,a,t)=>($s(s,a,"read from private field"),t?t.call(s):a.get(s)),xt=(s,a,t)=>a.has(s)?Cs("Cannot add the same private member more than once"):a instanceof WeakSet?a.add(s):a.set(s,t),$t=(s,a,t,n)=>($s(s,a,"write to private field"),n?n.call(s,t):a.set(s,t),t);import{m as ds,n as ct,s as dt,o as St,p as Wt,q as qs,t as pa,a as ge,r as l,j as e,u as Jt,v as fa,w as ba,x as _t,_ as pt,y as ya,z as _s,A as es,C as wa,D as va,E as ja,F as Hs,G as us,I as Na,J as ka,K as Sa,N as Ws,M as Ht,H as Tt,O as ms,P as bs,Q as Ea,b as Ts,T as Ca,V as $a,W as Ta,X as La,Y as Ls,Z as Ra,$ as Da,a0 as Ma,a1 as Aa}from"./index-CqYG162O.js";import{X as ot,P as Gt}from"./x-DEuKXdch.js";import{C as Kt,A as Rt}from"./check-circle-BqkNlI9z.js";import{U as hs}from"./upload-Csq6z8eF.js";import{T as vt}from"./trash-2-BtzbORkQ.js";import{C as Xt}from"./chevron-down-BSZVzvCv.js";import{T as Rs}from"./tag-CccaPfO5.js";import{V as Pa}from"./video-N-rLIbE8.js";import{P as Zt,S as Ds}from"./star-CPUxK7M5.js";import{S as Fa}from"./save-BhqO_Yfk.js";import{U as Ms}from"./users-Cj6tx7UD.js";import{Z as Ia}from"./zap-B0WMon9V.js";import{E as Ua}from"./eye-off-DS-_bp6u.js";import{E as za}from"./eye-CG3WpIkz.js";const Oa=async s=>{try{const a=URL.createObjectURL(s),t=document.createElement("video");t.crossOrigin="anonymous",t.muted=!0,t.playsInline=!0;const n=document.createElement("canvas"),o=n.getContext("2d");return new Promise((c,h)=>{t.onloadedmetadata=()=>{const m=t.videoWidth/t.videoHeight;let y,p;m>1?(y=1280,p=1280/m):(p=720,y=720*m),n.width=y,n.height=p;const T=t.duration;t.currentTime=Math.min(T*.5,1),t.onseeked=()=>{try{o.drawImage(t,0,0,n.width,n.height),n.toBlob(j=>{if(j){const f=URL.createObjectURL(j);URL.revokeObjectURL(a),t.remove(),n.remove(),c({success:!0,thumbnailURL:f,blob:j,error:null})}else h(new Error("No se pudo generar el thumbnail"))},"image/jpeg",.95)}catch(j){h(new Error(`Error al capturar frame: ${j.message}`))}},t.onerror=()=>{h(new Error("Error al cargar el video para thumbnail"))}},t.onerror=()=>{URL.revokeObjectURL(a),t.remove(),n.remove(),h(new Error("Error al cargar el video"))},t.src=a})}catch(a){return{success:!1,thumbnailURL:"https://via.placeholder.com/300x200/1a1a1a/ffffff?text=VIDEO",blob:null,error:a.message}}},kt=async(s,a,t)=>{try{const n=ct(dt,a),o={contentType:s.type,customMetadata:{uploadedAt:new Date().toISOString(),originalName:s.name,fileSize:s.size.toString()}},c=await qs(n,s,o);return{success:!0,url:await Wt(c.ref),path:c.ref.fullPath,error:null}}catch(n){return console.error("Error uploading file:",n),{success:!1,url:null,path:null,error:n.message}}},As=async s=>{try{const a=ct(dt,s);return await St(a),{success:!0,error:null}}catch(a){return{success:!1,error:a.message}}},Va=async(s,a,t)=>{try{if(!s.type.startsWith("video/"))throw new Error("El archivo debe ser un video");const n=100*1024*1024;if(s.size>n)throw new Error("El video es demasiado grande. Máximo 100MB");console.log("Subiendo video a Firebase Storage...");const o={contentType:s.type,customMetadata:{uploadedAt:new Date().toISOString(),originalName:s.name,fileSize:s.size.toString(),fileType:"video"}},c=ct(dt,a);try{const h=await qs(c,s,o),x=await Wt(h.ref);return console.log("Video subido exitosamente a Firebase Storage:",x),{success:!0,url:x,path:h.ref.fullPath,error:null,simulated:!1}}catch(h){console.error("Error con uploadBytes, intentando con uploadBytesResumable:",h);const x=pa(c,s,o);return new Promise((i,m)=>{x.on("state_changed",y=>{const p=y.bytesTransferred/y.totalBytes*100;t&&t(p)},y=>{console.error("Error uploading video:",y);let p="Error al subir el video";y.code==="storage/unauthorized"?p="No tienes permisos para subir videos":y.code==="storage/quota-exceeded"?p="Se ha excedido la cuota de almacenamiento":y.code==="storage/retry-limit-exceeded"?p="Error de conexión. Intenta de nuevo":y.code==="storage/canceled"?p="Upload cancelado":y.message&&(p=y.message),i({success:!1,url:null,path:null,error:p,simulated:!1})},async()=>{try{const y=await Wt(x.snapshot.ref);console.log("Video subido exitosamente a Firebase Storage:",y),i({success:!0,url:y,path:x.snapshot.ref.fullPath,error:null,simulated:!1})}catch{i({success:!1,url:null,path:null,error:"Error al obtener la URL del video",simulated:!1})}})})}}catch(n){console.error("Error uploading video:",n);let o="Error al subir el video";return n.code==="storage/unauthorized"?o="No tienes permisos para subir videos":n.code==="storage/quota-exceeded"?o="Se ha excedido la cuota de almacenamiento":n.code==="storage/retry-limit-exceeded"?o="Error de conexión. Intenta de nuevo":n.message&&(o=n.message),{success:!1,url:null,path:null,error:o,simulated:!1}}},Ps=async(s,a)=>{try{console.log("🗑️ Iniciando eliminación de archivos:"),console.log("📁 Video path:",s),console.log("🖼️ Thumbnail path:",a);const t=[];if(s){console.log("🎬 Eliminando video:",s);const n=ct(dt,s);t.push(St(n))}else console.log("⚠️ No hay ruta de video para eliminar");if(a&&a!==null&&a!==""){console.log("🖼️ Eliminando thumbnail:",a);const n=ct(dt,a);t.push(St(n))}else console.log("⚠️ No hay ruta de thumbnail para eliminar (thumbnailPath:",a,")");return console.log(`📊 Archivos a eliminar: ${t.length}`),t.length===0?(console.log("⚠️ No hay archivos para eliminar"),{success:!0,error:null,deletedCount:0}):(await Promise.all(t),console.log("✅ Archivos eliminados exitosamente"),{success:!0,error:null,deletedCount:t.length})}catch(t){return console.error("❌ Error deleting video:",t),{success:!1,error:t.message,deletedCount:0}}},Ba=async()=>{try{console.log("🗑️ Iniciando eliminación de todos los archivos de videos...");const s=await Fs("videos");console.log(`✅ Archivos de videos eliminados: ${s.deletedCount}`);const a=await Fs("thumbnails");return console.log(`✅ Archivos de thumbnails eliminados: ${a.deletedCount}`),{success:!0,videosDeleted:s.deletedCount,thumbnailsDeleted:a.deletedCount,error:null}}catch(s){return console.error("❌ Error al eliminar archivos de videos:",s),{success:!1,videosDeleted:0,thumbnailsDeleted:0,error:s.message}}},Fs=async s=>{try{console.log(`🗑️ Eliminando archivos en carpeta: ${s}`);const a=ct(dt,s),t=await ds(a);if(t.items.length===0)return console.log(`✅ No hay archivos en ${s}`),{success:!0,deletedCount:0,error:null};console.log(`📊 Archivos a eliminar en ${s}: ${t.items.length}`);const n=t.items.map(async x=>{try{return await St(x),{success:!0,path:x.fullPath}}catch(i){return console.error(`❌ Error eliminando ${x.fullPath}:`,i),{success:!1,path:x.fullPath,error:i.message}}}),o=await Promise.all(n),c=o.filter(x=>x.success).length,h=o.filter(x=>!x.success).length;return console.log(`✅ ${c} archivos eliminados exitosamente en ${s}`),h>0&&console.log(`⚠️ ${h} archivos fallaron al eliminar en ${s}`),{success:!0,deletedCount:c,failedCount:h,error:null}}catch(a){return console.error(`❌ Error al eliminar archivos en ${s}:`,a),{success:!1,deletedCount:0,failedCount:0,error:a.message}}},qa=async s=>{try{console.log("🧹 Iniciando limpieza de archivos huérfanos...");const a=await ds(ct(dt,"videos")),t=await ds(ct(dt,"thumbnails")),n=new Set(s.map(i=>i.videoPath).filter(Boolean)),o=new Set(s.map(i=>i.thumbnailPath).filter(Boolean)),c=a.items.filter(i=>!n.has(i.fullPath)),h=t.items.filter(i=>!o.has(i.fullPath));console.log(`📊 Archivos huérfanos encontrados: ${c.length} videos, ${h.length} thumbnails`);const x=[...c.map(i=>St(i)),...h.map(i=>St(i))];return x.length>0?(await Promise.all(x),console.log(`✅ ${x.length} archivos huérfanos eliminados`)):console.log("✅ No se encontraron archivos huérfanos"),{success:!0,orphanedVideosDeleted:c.length,orphanedThumbnailsDeleted:h.length,error:null}}catch(a){return console.error("❌ Error en limpieza de archivos huérfanos:",a),{success:!1,orphanedVideosDeleted:0,orphanedThumbnailsDeleted:0,error:a.message}}},Is=async s=>{try{const a=ct(dt,s),t=await Wt(a),n=await fetch(t);if(!n.ok)throw new Error(`Error al descargar archivo: ${n.status}`);return await n.blob()}catch(a){throw console.error(`Error descargando archivo ${s}:`,a),a}},Us=(s,a)=>new File([s],a,{type:s.type}),_a=async s=>{try{console.log("🔄 Iniciando migración de videos a estructura organizada...");const a=[];for(const c of s)try{if(c.videoPath&&c.videoPath.includes("/figuras/")||c.videoPath&&c.videoPath.includes("/escuela/")||c.videoPath&&c.videoPath.includes("/eventos/")){console.log(`⏭️ Video ${c.title} ya está en estructura organizada`),a.push({videoId:c.id,title:c.title,status:"already_organized",error:null});continue}const h=c.style||"salsa",x="figuras",i=c.videoPath,m=c.thumbnailPath,y=`videos/${x}/${h}/${i.split("/").pop()}`,p=m?`thumbnails/${x}/${h}/${m.split("/").pop()}`:null;console.log(`🔄 Migrando video: ${c.title}`),console.log(`   De: ${i}`),console.log(`   A: ${y}`);let T=!1,j=!1;try{console.log(`📥 Descargando video: ${i}`);const f=await Is(i),V=Us(f,i.split("/").pop());console.log(`📤 Subiendo video a nueva ubicación: ${y}`),await kt(V,y),T=!0,console.log("✅ Video migrado exitosamente"),console.log(`🗑️ Eliminando archivo original: ${i}`),await As(i)}catch(f){throw console.error(`❌ Error migrando video ${c.title}:`,f),new Error(`Error migrando video: ${f.message}`)}if(m&&p)try{console.log(`📥 Descargando thumbnail: ${m}`);const f=await Is(m),V=Us(f,m.split("/").pop());console.log(`📤 Subiendo thumbnail a nueva ubicación: ${p}`),await kt(V,p),j=!0,console.log("✅ Thumbnail migrado exitosamente"),console.log(`🗑️ Eliminando thumbnail original: ${m}`),await As(m)}catch(f){console.error(`❌ Error migrando thumbnail ${c.title}:`,f)}a.push({videoId:c.id,title:c.title,oldVideoPath:i,newVideoPath:y,oldThumbnailPath:m,newThumbnailPath:p,status:"migrated",videoMigrated:T,thumbnailMigrated:j,error:null})}catch(h){console.error(`❌ Error migrando video ${c.title}:`,h),a.push({videoId:c.id,title:c.title,status:"error",error:h.message})}const t=a.filter(c=>c.status==="migrated").length,n=a.filter(c=>c.status==="already_organized").length,o=a.filter(c=>c.status==="error").length;return console.log(`✅ Migración completada: ${t} migrados, ${n} ya organizados, ${o} fallidos`),{success:!0,totalVideos:s.length,successfulMigrations:t,alreadyOrganized:n,failedMigrations:o,results:a,error:null}}catch(a){return console.error("❌ Error en migración de videos:",a),{success:!1,totalVideos:0,successfulMigrations:0,alreadyOrganized:0,failedMigrations:0,results:[],error:a.message}}};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=ge("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=ge("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=ge("ChevronsDown",[["path",{d:"m7 6 5 5 5-5",key:"1lc07p"}],["path",{d:"m7 13 5 5 5-5",key:"1d48rs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=ge("ChevronsUp",[["path",{d:"m17 11-5-5-5 5",key:"e8nh98"}],["path",{d:"m17 18-5-5-5 5",key:"2avn1x"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=ge("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=ge("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=ge("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=ge("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=ge("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=ge("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=ge("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=ge("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=ge("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=ge("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=ge("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=ge("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ja=ge("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=ge("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=ge("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=ge("Shuffle",[["path",{d:"M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22",key:"1wmou1"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 6h1.9c1.5 0 2.9.9 3.6 2.2",key:"10bdb2"}],["path",{d:"M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8",key:"vgxac0"}],["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=ge("SkipBack",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=ge("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=ge("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=ge("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=ge("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=ge("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),qt={figuras:{name:"FIGURAS",icon:"Music",styles:{salsa:{name:"SALSA",icon:"Music",color:"salsa",categories:{estilo:{name:"ESTILO",color:"pink",tags:["Salsa","Salsa en línea On1","Salsa cubana","Estilo LA","Estilo NY","Estilo show"]},subestilo:{name:"SUBESTILO/TÉCNICA",color:"orange",tags:["Pasitos libres","Parejas","Footwork On1","Footwork On2","Shines","Fusionado con afro","Body movement"]},tipo:{name:"TIPO DE FIGURA",color:"green",tags:["Cross Body Lead","Copa","Sombrero","Dile que no","Setenta","Vacilala","Enchufla"]},manos:{name:"MANOS/TÉCNICA DE AGARRE",color:"blue",tags:["Una mano","Dos manos paralelas","Cruzadas","Entrelazadas","Cambio de manos","Manos abiertas","Sin contacto"]}}},bachata:{name:"BACHATA",icon:"Heart",color:"bachata",categories:{estilo:{name:"ESTILO",color:"red",tags:["Bachata dominicana","Bachata moderna","Bachata sensual","Bachata urbana"]},subestilo:{name:"SUBESTILO/TÉCNICA",color:"orange",tags:["Body rolls","Hip movement","Footwork básico","Turns"]},tipo:{name:"TIPO DE FIGURA",color:"green",tags:["Dile que no","Setenta","Vacilala","Sombrero","Copa"]},manos:{name:"MANOS/TÉCNICA DE AGARRE",color:"blue",tags:["Una mano","Dos manos","Cruzadas","Entrelazadas"]}}},kizomba:{name:"KIZOMBA",icon:"Zap",color:"kizomba",categories:{estilo:{name:"ESTILO",color:"yellow",tags:["Kizomba tradicional","Kizomba urbana","Tarraxinha","Semba"]},subestilo:{name:"SUBESTILO/TÉCNICA",color:"orange",tags:["Body movement","Hip rolls","Footwork","Turns"]},tipo:{name:"TIPO DE FIGURA",color:"green",tags:["Saída","Volta","Tarraxinha","Semba step"]},manos:{name:"MANOS/TÉCNICA DE AGARRE",color:"blue",tags:["Una mano","Dos manos","Cruzadas","Sin contacto"]}}},zouk:{name:"ZOUK",icon:"Star",color:"zouk",categories:{estilo:{name:"ESTILO",color:"purple",tags:["Zouk brasileño","Zouk flow","Zouk neofusion","Zouk tradicional"]},subestilo:{name:"SUBESTILO/TÉCNICA",color:"orange",tags:["Body rolls","Head movement","Footwork","Turns"]},tipo:{name:"TIPO DE FIGURA",color:"green",tags:["Lateral","Tranca","Pião","Balanço"]},manos:{name:"MANOS/TÉCNICA DE AGARRE",color:"blue",tags:["Una mano","Dos manos","Cruzadas","Entrelazadas"]}}},merengue:{name:"MERENGUE",icon:"Sun",color:"merengue",categories:{estilo:{name:"ESTILO",color:"orange",tags:["Merengue dominicano","Merengue tradicional","Merengue moderno"]},subestilo:{name:"SUBESTILO/TÉCNICA",color:"orange",tags:["Hip movement","Footwork básico","Turns simples"]},tipo:{name:"TIPO DE FIGURA",color:"green",tags:["Giros simples","Cambios de dirección","Pasos básicos"]},manos:{name:"MANOS/TÉCNICA DE AGARRE",color:"blue",tags:["Una mano","Dos manos","Sin contacto"]}}}}},escuela:{name:"ESCUELA",icon:"GraduationCap",styles:{salsa:{name:"SALSA",icon:"Music",color:"pink",categories:{nivel:{name:"NIVEL",color:"green",tags:["Principiante","Intermedio","Avanzado","Experto"]},tipo:{name:"TIPO DE CURSO",color:"blue",tags:["Básico","Técnica","Coreografía","Ritmo","Musicalidad"]},duracion:{name:"DURACIÓN",color:"orange",tags:["5-15 min","10-25 min","15-45 min","20-60 min"]},instructor:{name:"INSTRUCTOR",color:"purple",tags:["Carlos Rodríguez","María González","Juan Pérez","Ana López"]}}}}},eventos:{name:"EVENTOS",icon:"Calendar",styles:{salsa:{name:"SALSA",icon:"Music",color:"pink",categories:{tipo:{name:"TIPO DE EVENTO",color:"green",tags:["Competición","Encuentro","Congreso","Workshop","Fiesta"]},ubicacion:{name:"UBICACIÓN",color:"blue",tags:["Madrid","Barcelona","Valencia","Sevilla","Bilbao"]},nivel:{name:"NIVEL",color:"orange",tags:["Todos los niveles","Intermedio-Avanzado","Solo avanzado"]},fecha:{name:"FECHA",color:"purple",tags:["Este mes","Próximo mes","Este trimestre","Este año"]}}}}}},Mt=(s="figuras",a="salsa")=>{const[t,n]=l.useState(s),[o,c]=l.useState(a);l.useEffect(()=>{c(a)},[a]),l.useEffect(()=>{n(s)},[s]);const h=l.useMemo(()=>{const j=qt[t];if(!j)return null;const f=j.styles[o];return f?f.categories:null},[t,o]),x=l.useMemo(()=>{if(!h)return[];const j=[];return Object.entries(h).forEach(([f,V])=>{V.tags.forEach(H=>{j.push({tag:H,category:f,categoryName:V.name,color:V.color})})}),j},[h]),i=l.useMemo(()=>h?Object.entries(h).map(([j,f])=>({key:j,name:f.name,color:f.color,tags:f.tags})):[],[h]),m=l.useMemo(()=>{const j=qt[t];return j?Object.entries(j.styles).map(([f,V])=>({key:f,name:V.name,color:V.color,icon:V.icon})):[]},[t]),y=l.useMemo(()=>Object.entries(qt).map(([j,f])=>({key:j,name:f.name,icon:f.icon})),[]);return{selectedPage:t,selectedStyle:o,setSelectedPage:n,setSelectedStyle:c,currentCategories:h,availableTags:x,categoriesList:i,availableStyles:m,availablePages:y,categoryStructure:qt,getColorClasses:j=>({salsa:"bg-orange-100 text-orange-800 border-orange-200",bachata:"bg-emerald-100 text-emerald-800 border-emerald-200",merengue:"bg-cyan-100 text-cyan-800 border-cyan-200",zouk:"bg-violet-100 text-violet-800 border-violet-200",kizomba:"bg-amber-100 text-amber-800 border-amber-200",pink:"bg-pink-100 text-pink-800 border-pink-200",red:"bg-red-100 text-red-800 border-red-200",orange:"bg-orange-100 text-orange-800 border-orange-200",yellow:"bg-yellow-100 text-yellow-800 border-yellow-200",green:"bg-green-100 text-green-800 border-green-200",blue:"bg-blue-100 text-blue-800 border-blue-200",purple:"bg-purple-100 text-purple-800 border-purple-200"})[j]||"bg-gray-100 text-gray-800 border-gray-200",getGradientClasses:j=>({salsa:"from-orange-400 to-pink-500",bachata:"from-emerald-400 to-teal-600",merengue:"from-cyan-400 to-blue-600",zouk:"from-violet-400 to-indigo-600",kizomba:"from-amber-400 to-orange-600",pink:"from-pink-500 to-rose-500",red:"from-red-500 to-pink-500",orange:"from-orange-500 to-red-500",yellow:"from-yellow-500 to-orange-500",green:"from-green-500 to-emerald-500",blue:"from-blue-500 to-cyan-500",purple:"from-purple-500 to-pink-500"})[j]||"from-gray-500 to-gray-600"}},At=({message:s,type:a="success",duration:t=5e3,onClose:n})=>{const[o,c]=l.useState(!0);l.useEffect(()=>{const i=setTimeout(()=>{c(!1),setTimeout(()=>{n==null||n()},300)},t);return()=>clearTimeout(i)},[t,n]);const h=()=>{switch(a){case"success":return e.jsx(Kt,{className:"w-5 h-5"});case"error":return e.jsx(tr,{className:"w-5 h-5"});case"warning":return e.jsx(Rt,{className:"w-5 h-5"});default:return e.jsx(Kt,{className:"w-5 h-5"})}},x=()=>{switch(a){case"success":return"bg-gradient-to-r from-green-500 to-emerald-500 text-white border-green-400";case"error":return"bg-gradient-to-r from-red-500 to-pink-500 text-white border-red-400";case"warning":return"bg-gradient-to-r from-orange-500 to-red-500 text-white border-orange-400";default:return"bg-gradient-to-r from-green-500 to-emerald-500 text-white border-green-400"}};return e.jsx("div",{className:`
        fixed top-4 right-4 z-50 max-w-sm w-full
        transform transition-all duration-300 ease-in-out
        ${o?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
      `,children:e.jsxs("div",{className:`
        flex items-center justify-between p-4 rounded-lg shadow-lg border
        ${x()}
      `,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[h(),e.jsx("span",{className:"font-medium",children:s})]}),e.jsx("button",{onClick:()=>{c(!1),setTimeout(()=>n==null?void 0:n(),300)},className:"ml-4 text-white hover:text-gray-200 transition-colors",children:e.jsx(ot,{className:"w-4 h-4"})})]})})},Dt=({src:s,size:a="medium",loop:t=!1,loopSegment:n=null,showControls:o=!0,autoplay:c=!1,muted:h=!1,onTimeUpdate:x=null,onEnded:i=null,className:m="",resolutions:y=null,currentResolution:p=null,onResolutionChange:T=null,videoTitle:j="video"})=>{const f=l.useRef(null),V=l.useRef(null),[H,w]=l.useState(!1),[L,B]=l.useState(0),[v,z]=l.useState(0),[q,J]=l.useState(1),[re,he]=l.useState(h),[je,ne]=l.useState(!1),[ze,Ne]=l.useState(null),[Re,De]=l.useState(!1),[ve,Fe]=l.useState(!1),[Me,O]=l.useState((n==null?void 0:n.start)||0),[we,pe]=l.useState((n==null?void 0:n.end)||0),[k,F]=l.useState(!!n),[U,G]=l.useState(!1),[W,Z]=l.useState(!1),[ie,d]=l.useState(0),[M,D]=l.useState(0),[_,I]=l.useState(o),[Q,se]=l.useState(null),[xe,A]=l.useState(!1),[te,ce]=l.useState(p||"auto"),[le,Ie]=l.useState(null),[ke,Ae]=l.useState(null),[fe,Se]=l.useState(!1),[Ee,de]=l.useState(1),[$e,Je]=l.useState("horizontal"),Be=[.25,.5,.75,1,1.25,1.5,2];l.useEffect(()=>{if(f.current&&k&&H&&U&&W){const b=f.current,X=()=>{b.currentTime>=we&&(b.currentTime=Me)};return b.addEventListener("timeupdate",X),()=>b.removeEventListener("timeupdate",X)}},[k,Me,we,H,U,W]),l.useEffect(()=>{const b=X=>{if(!f.current)return;const Ce=document.activeElement;if(!(Ce&&(Ce.tagName==="INPUT"||Ce.tagName==="TEXTAREA"||Ce.contentEditable==="true"||Ce.classList.contains("ql-editor"))))switch(X.code){case"Space":X.preventDefault(),C();break;case"ArrowLeft":X.preventDefault(),K(-10);break;case"ArrowRight":X.preventDefault(),K(10);break;case"KeyA":X.preventDefault(),O(L);break;case"KeyB":X.preventDefault(),pe(L);break;case"KeyL":X.preventDefault(),Fe(!ve);break;case"KeyS":X.preventDefault();const st=(Be.indexOf(Ee)+1)%Be.length;jt(Be[st]);break}};return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[L,ve,Ee]),l.useEffect(()=>{if(_&&H){const b=setTimeout(()=>{I(!1)},4e3);return se(b),()=>clearTimeout(b)}},[_,H]),l.useEffect(()=>()=>{Q&&clearTimeout(Q),ze&&clearTimeout(ze)},[]),l.useEffect(()=>{f.current&&(f.current.volume=q,f.current.muted=re,f.current.playbackRate=Ee)},[q,re,Ee]),l.useEffect(()=>{te==="auto"&&le&&Ae(le)},[te,le]),l.useEffect(()=>{const b=X=>{xe&&A(!1),fe&&Se(!1)};return document.addEventListener("click",b),()=>document.removeEventListener("click",b)},[xe,fe]);const S=()=>{I(!0),Q&&clearTimeout(Q)},We=()=>{S()},[Ge,ue]=l.useState(0),[Ke,et]=l.useState(0),mt=b=>{const X=Date.now();if(X-Ge<300){const Te=b.currentTarget.getBoundingClientRect(),st=b.clientX-Te.left,at=Te.width;st<at/2?K(-10):K(10),et(0),ue(0)}else et(1),ue(X)},C=()=>{f.current&&(H?f.current.pause():f.current.play(),w(!H))},K=b=>{if(f.current){const X=Math.max(0,Math.min(v,L+b));f.current.currentTime=X,B(X)}},Xe=()=>{f.current&&(B(f.current.currentTime),x==null||x(f.current.currentTime))},Pe=()=>{if(f.current){z(f.current.duration);const b=f.current,X=b.videoWidth,Ce=b.videoHeight;if(X&&Ce){const Te=Ce>X;Je(Te?"vertical":"horizontal");const st=Math.max(X,Ce);let at="480p";st>=3840?at="4k":st>=1920?at="1080p":st>=1280?at="720p":st>=854?at="480p":at="360p",Ie(at)}c&&(b.play(),w(!0))}},g=()=>{ve&&!k?f.current&&(f.current.currentTime=0,f.current.play()):k?f.current&&(f.current.currentTime=Me,f.current.play()):w(!1),i==null||i()},$=b=>{if(f.current){const X=b.currentTarget.getBoundingClientRect(),Te=(b.clientX-X.left)/X.width*v;f.current.currentTime=Te,B(Te)}},R=()=>{if(f.current){const b=!re;f.current.muted=b,he(b),b?f.current.volume=0:f.current.volume=q}},N=b=>{const X=parseFloat(b.target.value);f.current&&(f.current.volume=X,J(X),X===0?(f.current.muted=!0,he(!0)):(f.current.muted=!1,he(!1)))},be=()=>{try{document.fullscreenElement?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),De(!1)):(V.current.requestFullscreen?V.current.requestFullscreen():V.current.webkitRequestFullscreen?V.current.webkitRequestFullscreen():V.current.msRequestFullscreen&&V.current.msRequestFullscreen(),De(!0))}catch(b){console.error("Error toggling fullscreen:",b)}},_e=b=>{b==="start"?U?(G(!1),O(0)):(G(!0),O(L),d(L)):W?(Z(!1),pe(0)):(Z(!0),pe(L),D(L))},tt=b=>{const X=Math.floor(b/60),Ce=Math.floor(b%60);return`${X}:${Ce.toString().padStart(2,"0")}`},ft=b=>{ce(b),A(!1),b==="auto"&&le?Ae(le):b!=="auto"&&Ae(null),T==null||T(b)},jt=b=>{f.current&&(f.current.playbackRate=b,de(b)),Se(!1)},Et=b=>b===1?"Normal":`${b}x`,Nt=b=>{switch(b){case"auto":return ke?`Auto (${ke})`:"Auto";case"4k":return"4K";case"1080p":return"1080p";case"720p":return"720p";case"480p":return"480p";case"360p":return"360p";default:return b}},as=b=>{if(!le)return!0;const X=["360p","480p","720p","1080p","4k"],Ce=X.indexOf(le);return X.indexOf(b)<=Ce},Pt=()=>{let b="";switch(a){case"small":b="max-w-xs";break;case"medium":b="max-w-md";break;case"large":b="max-w-2xl";break;case"fullscreen":return"w-full h-full";default:b="max-w-md"}return a==="fullscreen"?b:`${b} ${$e==="vertical"?"aspect-[9/16]":"aspect-video"}`},Ft=async()=>{try{if(s&&(s.includes("firebase")||s.includes("googleapis"))){const b=await fetch(s);if(!b.ok)throw new Error(`HTTP error! status: ${b.status}`);const X=await b.blob(),Ce=URL.createObjectURL(X),Te=document.createElement("a");Te.href=Ce,Te.download=j||"video.mp4",Te.style.display="none",document.body.appendChild(Te),Te.click(),document.body.removeChild(Te),setTimeout(()=>{URL.revokeObjectURL(Ce)},1e3)}else{const b=document.createElement("a");b.href=s,b.download=j||"video.mp4",b.style.display="none",document.body.appendChild(b),b.click(),document.body.removeChild(b)}}catch(b){console.error("Error en descarga:",b),alert(`Error al descargar el video: ${b.message}`)}};return e.jsxs("div",{ref:V,className:`relative bg-black rounded-lg overflow-hidden video-player-container ${Pt()} ${m} ${$e==="vertical"?"video-player-vertical":""}`,onMouseMove:S,onMouseLeave:()=>{if(H){const b=setTimeout(()=>{I(!1)},4e3);se(b)}},onTouchStart:S,onTouchMove:S,onClick:We,onDoubleClick:mt,children:[e.jsx("video",{ref:f,src:s,className:`w-full h-full cursor-pointer ${a==="fullscreen"?"object-contain":"object-cover"}`,muted:re,loop:ve&&!k,onTimeUpdate:Xe,onLoadedMetadata:Pe,onEnded:g,onPlay:()=>w(!0),onPause:()=>w(!1),onClick:We,onDoubleClick:mt,onTouchStart:S,onTouchMove:S}),_&&e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent",onMouseMove:S,onTouchStart:S,onTouchMove:S,children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 flex justify-end items-center",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:be,onTouchStart:S,className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",children:Re?e.jsx(Xs,{className:"w-4 h-4"}):e.jsx(Ks,{className:"w-4 h-4"})})})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>K(-10),onTouchStart:S,className:"p-3 rounded-full bg-black/60 text-white hover:bg-black/80 transition-colors z-10 hidden md:flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center",children:e.jsx(gs,{className:"w-3 h-3"})}),e.jsx("span",{className:"text-sm font-medium",children:"10"})]})}),e.jsx("button",{onClick:C,onTouchStart:S,className:"p-4 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",children:H?e.jsx(Zs,{className:"w-8 h-8"}):e.jsx(Ye,{className:"w-8 h-8"})}),e.jsx("button",{onClick:()=>K(10),onTouchStart:S,className:"p-3 rounded-full bg-black/60 text-white hover:bg-black/80 transition-colors z-10 hidden md:flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"10"}),e.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center",children:e.jsx(ps,{className:"w-3 h-3"})})]})})]})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[e.jsxs("div",{className:"flex justify-end mb-2 space-x-2",children:[e.jsx("button",{onClick:()=>Fe(!ve),onTouchStart:S,className:`p-2 rounded-full transition-colors z-10 ${ve?"bg-blue-500 text-white":"bg-white/20 text-white hover:bg-white/30"}`,title:"Bucle",children:e.jsx(Qs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{const b=!k;F(b),b?(ie>0&&(G(!0),O(ie)),M>0&&(Z(!0),pe(M))):(G(!1),Z(!1),O(0),pe(0))},onTouchStart:S,className:`p-2 rounded-full transition-colors z-10 ${k?"bg-green-500 text-white":"bg-white/20 text-white hover:bg-white/30"}`,title:"Segmento A-B",children:e.jsx("div",{className:"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none",children:"A-B"})}),y&&y.length>0&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>A(!xe),onTouchStart:S,className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",title:"Resolución",children:e.jsx("div",{className:"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none",children:Nt(te)})}),xe&&e.jsx("div",{className:"absolute bottom-full right-0 mb-2 bg-black/90 rounded-lg p-2 z-20 min-w-[80px]",onTouchStart:S,onTouchMove:S,children:y.map(b=>{const X=as(b);return e.jsxs("button",{onClick:()=>X&&ft(b),className:`w-full text-left px-3 py-1 rounded text-xs transition-colors ${X?te===b?"bg-blue-500 text-white":"text-white hover:bg-white/20":"text-gray-500 cursor-not-allowed opacity-50"}`,disabled:!X,children:[Nt(b),!X&&e.jsx("span",{className:"ml-1 text-[10px] opacity-75",children:"(no disponible)"})]},b)})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>Se(!fe),onTouchStart:S,className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",title:"Velocidad de reproducción",children:e.jsx("div",{className:"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none",children:Ee===1?"1x":`${Ee}x`})}),fe&&e.jsx("div",{className:"absolute bottom-full right-0 mb-2 bg-black/90 rounded-lg p-2 z-20 min-w-[80px]",onTouchStart:S,onTouchMove:S,children:Be.map(b=>e.jsx("button",{onClick:()=>jt(b),className:`w-full text-left px-3 py-1 rounded text-xs transition-colors ${Ee===b?"bg-blue-500 text-white":"text-white hover:bg-white/20"}`,children:Et(b)},b))})]}),e.jsx("button",{onClick:Ft,onTouchStart:S,className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",title:"Descargar video",children:e.jsx(ut,{className:"w-4 h-4"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:R,onTouchStart:S,className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",onMouseEnter:()=>ne(!0),onMouseLeave:()=>{const b=setTimeout(()=>ne(!1),1e3);Ne(b)},children:re?e.jsx(Js,{className:"w-4 h-4"}):e.jsx(Ys,{className:"w-4 h-4"})}),je&&e.jsx("div",{className:"absolute bottom-full right-0 mb-2 bg-black/80 rounded-lg p-3 z-20",onMouseEnter:()=>{ze&&(clearTimeout(ze),Ne(null))},onMouseLeave:()=>{const b=setTimeout(()=>ne(!1),1e3);Ne(b)},onTouchStart:S,onTouchMove:S,children:e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:q,onChange:N,onTouchStart:S,onTouchMove:S,className:"w-2 h-20 bg-gray-600 rounded-lg appearance-none cursor-pointer slider-vertical",style:{background:`linear-gradient(to top, #3b82f6 0%, #3b82f6 ${q*100}%, #4b5563 ${q*100}%, #4b5563 100%)`},orient:"vertical"}),e.jsxs("span",{className:"text-white text-xs",children:[Math.round(q*100),"%"]})]})})]})]}),e.jsx("div",{className:"relative mb-4",children:e.jsxs("div",{className:"w-full h-2 bg-white/20 rounded-full cursor-pointer relative",onClick:$,onTouchStart:S,onTouchMove:S,children:[e.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${L/v*100}%`}}),k&&U&&e.jsx("div",{className:"absolute top-0 w-1 h-full bg-green-500 z-10",style:{left:`${Me/v*100}%`}}),k&&W&&e.jsx("div",{className:"absolute top-0 w-1 h-full bg-red-500 z-10",style:{left:`${we/v*100}%`}})]})}),e.jsxs("div",{className:"flex items-center justify-between text-white text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:[tt(L)," / ",tt(v)]}),Ee!==1&&e.jsxs("span",{className:"text-blue-400 font-medium",children:[Ee,"x"]}),k&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>_e("start"),onTouchStart:S,className:`px-2 py-1 rounded text-xs transition-colors ${U?"bg-green-500 text-white":"bg-gray-600 text-gray-300 hover:bg-gray-500"}`,children:["A: ",U?tt(Me):"--:--"]}),e.jsxs("button",{onClick:()=>_e("end"),onTouchStart:S,className:`px-2 py-1 rounded text-xs transition-colors ${W?"bg-red-500 text-white":"bg-gray-600 text-gray-300 hover:bg-gray-500"}`,children:["B: ",W?tt(we):"--:--"]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"text-xs opacity-75",children:ve&&(k&&U&&W?"Bucle A-B":"Bucle completo")})})]})]})]})]})},sr=async s=>{try{console.log("🎵 Iniciando detección de BPM para:",s.name);const a=new(window.AudioContext||window.webkitAudioContext),t=await s.arrayBuffer(),n=await a.decodeAudioData(t);if(!ar(n))return console.log("🎵 Video sin audio significativo, usando BPM por defecto"),{success:!1,bpm:null,originalBPM:null,error:"Video sin audio significativo"};console.log("🎵 Audio decodificado, detectando BPM...");const c=await rr(n),h=Math.round(c);return console.log(`✅ BPM detectado: ${h} para ${s.name}`),{success:!0,bpm:h,originalBPM:c,error:null}}catch(a){return console.error("❌ Error al detectar BPM:",a),{success:!1,bpm:null,originalBPM:null,error:a.message}}},ar=s=>{const a=s.getChannelData(0),t=s.sampleRate,n=Math.min(5*t,a.length),o=a.slice(0,n),c=Math.sqrt(o.reduce((h,x)=>h+x*x,0)/o.length);return console.log(`🎵 Nivel de audio RMS: ${c.toFixed(4)}`),c>.01},rr=async s=>{const a=s.sampleRate,t=s.getChannelData(0),n=Math.min(10*a,t.length),o=t.slice(0,n),c=nr(o,a),h=[];for(let x=1;x<c.length;x++)h.push(c[x]-c[x-1]);if(h.length>0){const x=h.reduce((y,p)=>y+p,0)/h.length,i=60*a/x;if(console.log(`🎵 BPM calculado: ${i}, intervalos: ${h.length}, promedio: ${x}`),i>300)return console.log(`🎵 BPM demasiado alto (${i}), probablemente error de detección`),120;const m=Math.max(80,Math.min(180,i));return i!==m&&console.log(`🎵 BPM ajustado de ${i} a ${m}`),m>=175&&(console.log(`🎵 BPM muy alto (${m}), verificando si es real...`),h.filter(p=>Math.abs(p-x)<x*.3).length<h.length*.7)?(console.log("🎵 BPM alto pero intervalos inconsistentes, usando BPM por defecto"),120):m}return console.log("🎵 No se detectaron intervalos, usando BPM por defecto: 120"),120},nr=(s,a)=>{const t=[],n=s.map(i=>i*i),o=n.reduce((i,m)=>i+m,0)/n.length,c=Math.max(.01,Math.min(.5,o*3)),h=a*.5;console.log(`🎵 Detectando picos con umbral: ${c.toFixed(4)}, energía promedio: ${o.toFixed(4)}`);const x=Math.floor(a*.1);for(let i=x;i<s.length-x;i++){const m=s.slice(i-x,i+x),y=Math.max(...m);s[i]===y&&s[i]>c&&(t.length===0||i-t[t.length-1]>h)&&t.push(i)}if(console.log(`🎵 Picos detectados: ${t.length}`),t.length<3){console.log("🎵 Pocos picos detectados, reduciendo umbral...");const i=c*.5;t.length=0;for(let m=x;m<s.length-x;m++){const y=s.slice(m-x,m+x),p=Math.max(...y);s[m]===p&&s[m]>i&&(t.length===0||m-t[t.length-1]>h)&&t.push(m)}console.log(`🎵 Picos detectados con umbral reducido: ${t.length}`)}return t},or=s=>s<80||s>180?(console.warn(`⚠️ BPM fuera de rango para salsa: ${s} (rango esperado: 80-180)`),!1):!0,lr=({isOpen:s,onClose:a,onVideoUploaded:t,page:n="figuras",style:o="salsa"})=>{const{user:c}=Jt(),{currentCategories:h,categoriesList:x}=Mt(n,o),i=l.useRef(null),[m,y]=l.useState([]),[p,T]=l.useState(!1),[j,f]=l.useState({}),[V,H]=l.useState(1),[w,L]=l.useState({}),[B,v]=l.useState([]),[z,q]=l.useState({}),J=l.useRef({}),[re,he]=l.useState(new Set);l.useEffect(()=>{s?H(1):je()},[s]),l.useEffect(()=>{if(h){const d={};Object.keys(h).forEach(M=>{d[M]=[]}),q(d)}},[h]);const je=()=>{Object.values(w).forEach(d=>{d.videoPreview&&URL.revokeObjectURL(d.videoPreview),d.thumbnailPreview&&URL.revokeObjectURL(d.thumbnailPreview)}),y([]),L({}),he(new Set),f({}),T(!1),H(1),i.current&&(i.current.value="")},ne=(d,M="success")=>{const D=Date.now();v(_=>[..._,{id:D,message:d,type:M}])},ze=d=>{v(M=>M.filter(D=>D.id!==d))},Ne=d=>{he(M=>{const D=new Set(M);return D.has(d)?D.delete(d):D.add(d),D})},Re=d=>{he(d?new Set(m.map(M=>M.name)):new Set)},De=d=>{const D=Array.from(d.target.files).filter(I=>I.type.startsWith("video/"));if(D.length===0){ne("Por favor selecciona archivos de video válidos","error");return}const _=D.filter(I=>!m.some(Q=>Q.name===I.name));if(_.length===0){ne("Algunos archivos ya están seleccionados","warning");return}y(I=>[...I,..._]),_.forEach(async I=>{const Q=URL.createObjectURL(I);try{const se=await O(I),xe=URL.createObjectURL(se);L(A=>({...A,[I.name]:{...A[I.name],videoPreview:Q,thumbnailPreview:xe}}))}catch(se){console.warn("Error generando thumbnail para vista previa:",se),L(xe=>({...xe,[I.name]:{...xe[I.name],videoPreview:Q}}))}}),ne(`${_.length} video(s) agregado(s)`,"success")},ve=d=>{const M=m[d];M&&w[M.name]&&(w[M.name].videoPreview&&URL.revokeObjectURL(w[M.name].videoPreview),w[M.name].thumbnailPreview&&URL.revokeObjectURL(w[M.name].thumbnailPreview)),y(D=>D.filter((_,I)=>I!==d)),L(D=>{const _={...D};return delete _[M.name],_}),he(D=>{const _=new Set(D);return _.delete(M.name),_})},Fe=(d,M)=>{q(D=>{const _=D[d]||[];if(_.includes(M))return{...D,[d]:_.filter(Q=>Q!==M)};{const Q=[...new Set([..._,M])];return{...D,[d]:Q}}})},Me=async d=>{var M;try{if((M=w[d.name])!=null&&M.customThumbnailFile){const D=w[d.name].customThumbnailFile,_=`thumbnails/${n}/${o}/${Date.now()}_${d.name.replace(/\.[^/.]+$/,".jpg")}`,I=await kt(D,_);if(I.success)return{url:I.url,path:I.path}}try{const D=await Promise.race([Oa(d),new Promise((_,I)=>setTimeout(()=>I(new Error("Timeout")),15e3))]);if(D.success&&D.blob){const _=`thumbnails/${n}/${o}/${Date.now()}_${d.name.replace(/\.[^/.]+$/,".jpg")}`,I=await kt(D.blob,_);if(I.success)return D.thumbnailURL&&URL.revokeObjectURL(D.thumbnailURL),{url:I.url,path:I.path}}}catch(D){console.warn("Error generando thumbnail automático:",D)}try{const D=await O(d);if(D){const _=`thumbnails/${n}/${o}/${Date.now()}_${d.name.replace(/\.[^/.]+$/,".jpg")}`,I=await kt(D,_);if(I.success)return{url:I.url,path:I.path}}}catch(D){console.warn("Error generando thumbnail por defecto:",D)}return{url:null,path:null}}catch(D){return console.error("Error en generateThumbnail:",D),{url:null,path:null}}},O=async d=>new Promise((M,D)=>{try{const _=URL.createObjectURL(d),I=document.createElement("video");I.crossOrigin="anonymous",I.muted=!0,I.playsInline=!0;const Q=document.createElement("canvas"),se=Q.getContext("2d");Q.width=1280,Q.height=720,I.onloadedmetadata=()=>{try{I.currentTime=.1,I.onseeked=()=>{try{se.drawImage(I,0,0,Q.width,Q.height),Q.toBlob(xe=>{xe?(URL.revokeObjectURL(_),I.remove(),Q.remove(),M(xe)):D(new Error("No se pudo generar el thumbnail por defecto"))},"image/jpeg",.95)}catch(xe){D(new Error(`Error al capturar frame por defecto: ${xe.message}`))}},I.onerror=()=>{D(new Error("Error al cargar el video para thumbnail por defecto"))}}catch(xe){D(new Error(`Error al procesar metadata por defecto: ${xe.message}`))}},I.onerror=()=>{URL.revokeObjectURL(_),I.remove(),Q.remove(),D(new Error("Error al cargar el video por defecto"))},I.src=_}catch(_){D(new Error(`Error al generar thumbnail por defecto: ${_.message}`))}}),we=async(d,M)=>{var D,_,I,Q;try{if((await fa(d.name)).isDuplicate)return ne(`Video "${d.name}" ya existe en la base de datos`,"warning"),null;const xe=await Me(d),A=`videos/${n}/${o}/${Date.now()}_${d.name}`,te=await Va(d,A,S=>{f(We=>({...We,[M]:S}))});if(!te.success)return ne(`Error al subir ${d.name}: ${te.error}`,"error"),null;const ce={...z,estilo:z.estilo||[]},le=J.current[`${d.name}-title`],Ie=J.current[`${d.name}-description`],ke=((D=le==null?void 0:le.value)==null?void 0:D.trim())||((_=w[d.name])==null?void 0:_.title)||d.name.replace(/\.[^/.]+$/,""),Ae=((I=Ie==null?void 0:Ie.value)==null?void 0:I.trim())||((Q=w[d.name])==null?void 0:Q.description)||"";let fe=null,Se=null,Ee=null;try{const S=document.createElement("video");S.src=URL.createObjectURL(d),await new Promise((We,Ge)=>{S.onloadedmetadata=()=>{Se=S.videoWidth,Ee=S.videoHeight;const ue=Math.max(Se,Ee);ue>=3840?fe="4K":ue>=1920?fe="1080p":ue>=1280?fe="720p":ue>=854?fe="480p":fe="360p",URL.revokeObjectURL(S.src),We()},S.onerror=Ge})}catch(S){console.warn("No se pudo detectar la resolución del video:",S),fe="Unknown"}let de=null,$e=!1;try{const S=await sr(d);S.success&&or(S.bpm)&&(de=S.bpm,$e=!0)}catch(S){console.error("❌ Error al detectar BPM:",S)}const Je={title:ke,originalTitle:d.name,description:Ae,videoUrl:te.url,thumbnailUrl:xe.url||null,videoPath:te.path,thumbnailPath:xe.path||null,fileSize:d.size,fileType:d.type,duration:0,resolution:fe,videoWidth:Se,videoHeight:Ee,style:o,tags:ce,uploadedBy:(c==null?void 0:c.uid)||"anonymous",uploadedAt:new Date().toISOString(),views:0,likes:0,likedBy:[],bpm:de,bpmDetected:$e},Be=await ba(Je);return Be.success?(ne(`${d.name} subido exitosamente`,"success"),{...Je,id:Be.id}):(ne(`Error al guardar metadatos de ${d.name}`,"error"),null)}catch(se){return console.error("Error uploading video:",se),ne(`Error inesperado al subir ${d.name}`,"error"),null}},pe=async()=>{if(m.length===0){ne("Selecciona al menos un video","error");return}T(!0);const d=[];for(let M=0;M<m.length;M++){const D=m[M],_=await we(D,M);_&&d.push(_)}T(!1),d.length>0&&(ne(`${d.length} video(s) subido(s) correctamente`,"success"),d.forEach(M=>t(M)),a())},k=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Seleccionar Videos"}),e.jsx("p",{className:"text-gray-600",children:"Selecciona uno o varios videos para subir"})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 hover:border-pink-400 transition-colors duration-200",children:[e.jsx("input",{ref:i,type:"file",multiple:!0,accept:"video/*",onChange:De,className:"hidden"}),e.jsxs("button",{onClick:()=>{var d;return(d=i.current)==null?void 0:d.click()},className:"w-full flex flex-col items-center justify-center space-y-2 text-gray-600 hover:text-pink-500 transition-colors duration-200",children:[e.jsx(hs,{className:"h-12 w-12"}),e.jsx("span",{className:"font-medium text-center",children:"Haz clic para seleccionar videos"}),e.jsx("span",{className:"text-sm text-center",children:"MP4, AVI, MOV, etc. (máx. 100MB cada uno)"})]})]}),m.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:["Videos seleccionados (",m.length,")"]}),m.map((d,M)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:d.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(d.size/(1024*1024)).toFixed(2)," MB"]})]}),e.jsx("button",{onClick:()=>ve(M),className:"p-1 text-red-500 hover:text-red-700 transition-colors duration-200",children:e.jsx(vt,{className:"h-4 w-4"})})]},M))]})]}),F=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Configurar Videos"}),e.jsx("p",{className:"text-gray-600",children:"Personaliza la información de tus videos antes de subirlos"})]}),m.length>1&&e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsxs("button",{onClick:()=>Re(!0),className:"flex items-center space-x-1 px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors",children:[e.jsx(Ha,{className:"h-4 w-4"}),e.jsx("span",{children:"Plegar Todo"})]}),e.jsxs("button",{onClick:()=>Re(!1),className:"flex items-center space-x-1 px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors",children:[e.jsx(Wa,{className:"h-4 w-4"}),e.jsx("span",{children:"Desplegar Todo"})]})]}),m.map((d,M)=>{var _,I,Q,se,xe;const D=re.has(d.name);return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"w-12 h-9 bg-gray-100 rounded flex items-center justify-center relative overflow-hidden",children:[(_=w[d.name])!=null&&_.thumbnailPreview?e.jsx("img",{src:w[d.name].thumbnailPreview,alt:"Vista previa del video",className:"w-full h-full object-cover",onError:A=>{A.target.style.display="none",A.target.nextSibling.style.display="flex"}}):null,e.jsx("span",{className:"text-xs text-gray-500",style:{display:(I=w[d.name])!=null&&I.thumbnailPreview?"none":"flex"},children:"VIDEO"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:d.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(d.size/(1024*1024)).toFixed(2)," MB"]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:()=>Ne(d.name),className:"p-1 text-gray-500 hover:text-gray-700 transition-colors",title:D?"Desplegar":"Plegar",children:D?e.jsx(Xt,{className:"h-4 w-4"}):e.jsx(Qt,{className:"h-4 w-4"})})})]}),!D&&e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Vista previa del video"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Dt,{src:((Q=w[d.name])==null?void 0:Q.videoPreview)||URL.createObjectURL(d),size:"medium",loop:!0,showControls:!0,autoplay:!1,muted:!1,className:"w-full max-w-2xl",resolutions:["auto","4k","1080p","720p","480p","360p"],currentResolution:"auto",videoTitle:((se=w[d.name])==null?void 0:se.title)||d.name.replace(/\.[^/.]+$/,""),onResolutionChange:A=>{}})}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsx("span",{children:d.name}),e.jsxs("span",{children:[(d.size/(1024*1024)).toFixed(2)," MB"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nombre del video"}),e.jsx("input",{type:"text","data-file":d.name,"data-field":"title",ref:A=>{var te;A&&(J.current[`${d.name}-title`]=A,A.value||(A.value=((te=w[d.name])==null?void 0:te.title)||d.name.replace(/\.[^/.]+$/,"")))},onBlur:A=>{var ce;const te=A.target.value.trim();te!==(((ce=w[d.name])==null?void 0:ce.title)||d.name.replace(/\.[^/.]+$/,""))&&L(le=>({...le,[d.name]:{...le[d.name],title:te}}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Ingresa un nombre para el video"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Descripción (opcional)"}),e.jsx("textarea",{"data-file":d.name,"data-field":"description",ref:A=>{var te;A&&(J.current[`${d.name}-description`]=A,A.value||(A.value=((te=w[d.name])==null?void 0:te.description)||""))},onBlur:A=>{var ce;const te=A.target.value.trim();te!==(((ce=w[d.name])==null?void 0:ce.description)||"")&&L(le=>({...le,[d.name]:{...le[d.name],description:te}}))},rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Describe brevemente el contenido del video..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Thumbnail personalizado (opcional)"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-40 h-24 bg-gray-100 rounded border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden",children:(xe=w[d.name])!=null&&xe.customThumbnail?e.jsx("img",{src:w[d.name].customThumbnail,alt:"Thumbnail personalizado",className:"w-full h-full object-cover rounded"}):e.jsx("span",{className:"text-xs text-gray-500",children:"IMG"})}),e.jsx("input",{type:"file",accept:"image/*",onChange:A=>{const te=A.target.files[0];if(te){const ce=new FileReader;ce.onload=le=>{L(Ie=>({...Ie,[d.name]:{...Ie[d.name],customThumbnail:le.target.result,customThumbnailFile:te}}))},ce.readAsDataURL(te)}},className:"flex-1 text-sm text-gray-500 file:mr-4 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-sm file:font-medium file:bg-pink-50 file:text-pink-700 hover:file:bg-pink-100"})]})]})]})]},M)}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Etiquetas para todos los videos"}),x.map(d=>e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 capitalize",children:d.name}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.tags.map(M=>{var D;return e.jsx("button",{onClick:()=>Fe(d.key,M),className:`px-3 py-1 rounded-full text-sm font-medium transition-all duration-200 ${(D=z[d.key])!=null&&D.includes(M)?"bg-gradient-to-r from-pink-500 to-orange-500 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:M},M)})})]},d.key))]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Rt,{className:"h-5 w-5 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-800 font-medium",children:"Información"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Personaliza cada video individualmente y aplica etiquetas que se usarán para todos los videos seleccionados."})]})]})})]}),U=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Subiendo Videos"}),e.jsxs("p",{className:"text-gray-600",children:["Procesando ",m.length," video(s)..."]})]}),m.map((d,M)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-900",children:d.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:[j[M]||0,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-pink-500 to-orange-500 h-2 rounded-full transition-all duration-300",style:{width:`${j[M]||0}%`}})})]},M))]}),G=()=>{switch(V){case 1:return e.jsx(k,{});case 2:return e.jsx(F,{});case 3:return e.jsx(U,{});default:return e.jsx(k,{})}},W=()=>{switch(V){case 1:return m.length>0;case 2:return!0;case 3:return!1;default:return!1}},Z=()=>{V===2?pe():(H(d=>d+1),V===1&&he(new Set(m.map(d=>d.name))))},ie=()=>{H(d=>Math.max(1,d-1))};return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-pink-500 to-orange-500 rounded-full",children:e.jsx(hs,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Subir Videos"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Paso ",V," de 3"]})]})]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",children:e.jsx(ot,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:G()}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:ie,disabled:V===1||p,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Atrás"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:a,disabled:p,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),V<3&&e.jsx("button",{onClick:Z,disabled:!W()||p,className:"px-6 py-2 bg-gradient-to-r from-pink-500 to-orange-500 text-white rounded-lg font-medium hover:shadow-lg transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:V===2?"Subir Videos":"Siguiente"})]})]})]})}),B.map(d=>e.jsx(At,{message:d.message,type:d.type,onClose:()=>ze(d.id)},d.id))]}):null},ir=({isOpen:s,onClose:a,video:t,onVideoUpdated:n,page:o="figuras",style:c="salsa"})=>{const{user:h}=Jt(),{currentCategories:x,categoriesList:i}=Mt(o,c),[m,y]=l.useState(!1),[p,T]=l.useState([]),[j,f]=l.useState(""),[V,H]=l.useState(""),[w,L]=l.useState(null),[B,v]=l.useState(null),[z,q]=l.useState({}),[J,re]=l.useState({}),[he,je]=l.useState({}),[ne,ze]=l.useState(new Set(["tags-iniciales","tags-finales"]));l.useEffect(()=>{if(!(!s||!t)&&(f(t.title||""),H(t.description||""),L(t.thumbnailUrl||null),v(null),x)){const k={},F={},U={};Object.keys(x).forEach(G=>{var W,Z,ie;k[G]=((W=t.tags)==null?void 0:W[G])||[],F[G]=((Z=t.tagsIniciales)==null?void 0:Z[G])||[],U[G]=((ie=t.tagsFinales)==null?void 0:ie[G])||[]}),q(k),re(F),je(U)}},[s,t,x]),l.useEffect(()=>{s||(f(""),H(""),L(null),v(null),q({}),re({}),je({}))},[s]);const Ne=(k,F="success")=>{const U=Date.now();T(G=>[...G,{id:U,message:k,type:F}])},Re=k=>{T(F=>F.filter(U=>U.id!==k))},De=k=>{ze(F=>{const U=new Set(F);return U.has(k)?U.delete(k):U.add(k),U})},ve=(k,F)=>{q(U=>{const G=U[k]||[];if(G.includes(F))return{...U,[k]:G.filter(Z=>Z!==F)};{const Z=[...new Set([...G,F])];return{...U,[k]:Z}}})},Fe=(k,F)=>{re(U=>{const G=U[k]||[];if(G.includes(F))return{...U,[k]:G.filter(Z=>Z!==F)};{const Z=[...new Set([...G,F])];return{...U,[k]:Z}}})},Me=(k,F)=>{je(U=>{const G=U[k]||[];if(G.includes(F))return{...U,[k]:G.filter(Z=>Z!==F)};{const Z=[...new Set([...G,F])];return{...U,[k]:Z}}})},O=k=>{const F=k.target.files[0];if(F){const U=new FileReader;U.onload=G=>{L(G.target.result),v(F)},U.readAsDataURL(F)}},we=async k=>{try{const F=document.createElement("video");F.src=k,await new Promise((U,G)=>{F.onloadedmetadata=()=>{const W=F.videoWidth,Z=F.videoHeight,ie=Math.max(W,Z);let d="Unknown";ie>=3840?d="4K":ie>=1920?d="1080p":ie>=1280?d="720p":ie>=854?d="480p":d="360p",U({resolution:d,videoWidth:W,videoHeight:Z})},F.onerror=G,setTimeout(()=>G(new Error("Timeout")),1e4)})}catch(F){return console.warn("No se pudo detectar la resolución del video:",F),{resolution:"Unknown",videoWidth:null,videoHeight:null}}},pe=async()=>{if(t){y(!0);try{let k=t.thumbnailUrl,F=t.thumbnailPath;if(B){const M=`thumbnails/${Date.now()}_${t.originalTitle.replace(/\.[^/.]+$/,".jpg")}`,D=await kt(B,M);if(D.success)k=D.url,F=D.path;else{Ne("Error al subir el nuevo thumbnail","error"),y(!1);return}}const U={...z,estilo:z.estilo||[]};let G=t.resolution,W=t.videoWidth,Z=t.videoHeight;if(!G||G==="Unknown")try{const M=await we(t.videoUrl);G=M.resolution,W=M.videoWidth,Z=M.videoHeight}catch(M){console.warn("No se pudo detectar la resolución:",M),G="Unknown"}const ie={title:j.trim(),description:V.trim(),thumbnailUrl:k,thumbnailPath:F,resolution:G,videoWidth:W,videoHeight:Z,tags:U,tagsIniciales:J,tagsFinales:he,updatedBy:(h==null?void 0:h.uid)||"anonymous",updatedAt:new Date().toISOString()},d=await _t(t.id,ie);d.success?(Ne("Video actualizado exitosamente","success"),n({...t,...ie}),a()):Ne(`Error al actualizar video: ${d.error}`,"error")}catch(k){console.error("Error updating video:",k),Ne("Error inesperado al actualizar video","error")}y(!1)}};return!s||!t?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full",children:e.jsx(Gt,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Editar Video"}),e.jsx("p",{className:"text-sm text-gray-500",children:t.title})]})]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",children:e.jsx(ot,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Vista previa del video"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Dt,{src:t.videoUrl,size:"medium",loop:!0,showControls:!0,autoplay:!1,muted:!1,className:"w-full max-w-2xl",resolutions:["auto","4k","1080p","720p","480p","360p"],currentResolution:"auto",videoTitle:t.title||"video",onResolutionChange:k=>{}})}),e.jsx("div",{className:"flex items-center justify-between text-sm text-gray-600",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:t.originalTitle}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("span",{children:[(t.fileSize/(1024*1024)).toFixed(2)," MB"]}),t.resolution&&t.resolution!=="Unknown"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsx("span",{children:t.resolution})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Título del video"}),e.jsx("input",{type:"text",value:j,onChange:k=>f(k.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-500",placeholder:"Ingresa un título para el video"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Descripción"}),e.jsx("textarea",{value:V,onChange:k=>H(k.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-500",placeholder:"Describe brevemente el contenido del video..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Thumbnail personalizado"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-40 h-24 bg-gray-100 rounded border-2 border-dashed border-gray-300 flex items-center justify-center",children:w?e.jsx("img",{src:w,alt:"Thumbnail",className:"w-full h-full object-cover rounded"}):e.jsx("span",{className:"text-xs text-gray-500",children:"IMG"})}),e.jsx("input",{type:"file",accept:"image/*",onChange:O,className:"flex-1 text-sm text-gray-500 file:mr-4 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Tags Normales"}),i.map(k=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-gray-700 capitalize",children:k.name}),e.jsx("div",{className:"flex flex-wrap gap-2",children:k.tags.map(F=>{var U;return e.jsx("button",{onClick:()=>ve(k.key,F),className:`px-3 py-1 rounded-full text-sm font-medium transition-all duration-200 ${(U=z[k.key])!=null&&U.includes(F)?"bg-gradient-to-r from-pink-500 to-orange-500 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:F},F)})})]},k.key))]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("button",{onClick:()=>De("tags-iniciales"),className:"flex items-center justify-between w-full p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg hover:from-blue-100 hover:to-purple-100 transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Rs,{className:"h-5 w-5 text-blue-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Tags Iniciales (cómo empieza la figura)"})]}),ne.has("tags-iniciales")?e.jsx(Xt,{className:"h-5 w-5 text-gray-500"}):e.jsx(Qt,{className:"h-5 w-5 text-gray-500"})]}),e.jsx("div",{className:`mt-4 transition-all duration-300 ease-in-out overflow-hidden ${ne.has("tags-iniciales")?"max-h-0 opacity-0":"max-h-96 opacity-100"}`,children:e.jsx("div",{className:"space-y-4 bg-blue-50 rounded-lg p-4",children:i.map(k=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("h6",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:k.name}),e.jsx("div",{className:"flex flex-wrap gap-2",children:k.tags.map(F=>{var U;return e.jsx("button",{onClick:()=>Fe(k.key,F),className:`px-2 py-1 rounded-full text-xs font-medium transition-all duration-200 ${(U=J[k.key])!=null&&U.includes(F)?"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg":"bg-white text-gray-700 hover:bg-blue-100"}`,children:F},`inicial-${F}`)})})]},`inicial-${k.key}`))})})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("button",{onClick:()=>De("tags-finales"),className:"flex items-center justify-between w-full p-4 bg-gradient-to-r from-green-50 to-teal-50 rounded-lg hover:from-green-100 hover:to-teal-100 transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Rs,{className:"h-5 w-5 text-green-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Tags Finales (cómo termina la figura)"})]}),ne.has("tags-finales")?e.jsx(Xt,{className:"h-5 w-5 text-gray-500"}):e.jsx(Qt,{className:"h-5 w-5 text-gray-500"})]}),e.jsx("div",{className:`mt-4 transition-all duration-300 ease-in-out overflow-hidden ${ne.has("tags-finales")?"max-h-0 opacity-0":"max-h-96 opacity-100"}`,children:e.jsx("div",{className:"space-y-4 bg-green-50 rounded-lg p-4",children:i.map(k=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("h6",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:k.name}),e.jsx("div",{className:"flex flex-wrap gap-2",children:k.tags.map(F=>{var U;return e.jsx("button",{onClick:()=>Me(k.key,F),className:`px-2 py-1 rounded-full text-xs font-medium transition-all duration-200 ${(U=he[k.key])!=null&&U.includes(F)?"bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-lg":"bg-white text-gray-700 hover:bg-green-100"}`,children:F},`final-${F}`)})})]},`final-${k.key}`))})})]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Rt,{className:"h-5 w-5 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-800 font-medium",children:"Información"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Los tags iniciales y finales ayudarán a crear secuencias lógicas conectando figuras."})]})]})})]})}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:a,disabled:m,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),e.jsx("button",{onClick:pe,disabled:m||!j.trim(),className:"px-6 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg font-medium hover:shadow-lg transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:m?"Guardando...":"Guardar Cambios"})]})]})}),p.map(k=>e.jsx(At,{message:k.message,type:k.type,onClose:()=>Re(k.id)},k.id))]})};var oe;(function(s){s.LOAD="LOAD",s.EXEC="EXEC",s.FFPROBE="FFPROBE",s.WRITE_FILE="WRITE_FILE",s.READ_FILE="READ_FILE",s.DELETE_FILE="DELETE_FILE",s.RENAME="RENAME",s.CREATE_DIR="CREATE_DIR",s.LIST_DIR="LIST_DIR",s.DELETE_DIR="DELETE_DIR",s.ERROR="ERROR",s.DOWNLOAD="DOWNLOAD",s.PROGRESS="PROGRESS",s.LOG="LOG",s.MOUNT="MOUNT",s.UNMOUNT="UNMOUNT"})(oe||(oe={}));const cr=(()=>{let s=0;return()=>s++})(),dr=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),ur=new Error("called FFmpeg.terminate()");var He,gt,it,yt,wt,Yt,Ve;class mr{constructor(){xt(this,He,null);xt(this,gt,{});xt(this,it,{});xt(this,yt,[]);xt(this,wt,[]);Oe(this,"loaded",!1);xt(this,Yt,()=>{ee(this,He)&&(ee(this,He).onmessage=({data:{id:a,type:t,data:n}})=>{switch(t){case oe.LOAD:this.loaded=!0,ee(this,gt)[a](n);break;case oe.MOUNT:case oe.UNMOUNT:case oe.EXEC:case oe.FFPROBE:case oe.WRITE_FILE:case oe.READ_FILE:case oe.DELETE_FILE:case oe.RENAME:case oe.CREATE_DIR:case oe.LIST_DIR:case oe.DELETE_DIR:ee(this,gt)[a](n);break;case oe.LOG:ee(this,yt).forEach(o=>o(n));break;case oe.PROGRESS:ee(this,wt).forEach(o=>o(n));break;case oe.ERROR:ee(this,it)[a](n);break}delete ee(this,gt)[a],delete ee(this,it)[a]})});xt(this,Ve,({type:a,data:t},n=[],o)=>ee(this,He)?new Promise((c,h)=>{const x=cr();ee(this,He)&&ee(this,He).postMessage({id:x,type:a,data:t},n),ee(this,gt)[x]=c,ee(this,it)[x]=h,o==null||o.addEventListener("abort",()=>{h(new DOMException(`Message # ${x} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(dr));Oe(this,"load",({classWorkerURL:a,...t}={},{signal:n}={})=>(ee(this,He)||($t(this,He,a?new Worker(new URL(a,import.meta.url),{type:"module"}):new Worker(new URL("/assets/worker-BAOIWoxA.js",import.meta.url),{type:"module"})),ee(this,Yt).call(this)),ee(this,Ve).call(this,{type:oe.LOAD,data:t},void 0,n)));Oe(this,"exec",(a,t=-1,{signal:n}={})=>ee(this,Ve).call(this,{type:oe.EXEC,data:{args:a,timeout:t}},void 0,n));Oe(this,"ffprobe",(a,t=-1,{signal:n}={})=>ee(this,Ve).call(this,{type:oe.FFPROBE,data:{args:a,timeout:t}},void 0,n));Oe(this,"terminate",()=>{const a=Object.keys(ee(this,it));for(const t of a)ee(this,it)[t](ur),delete ee(this,it)[t],delete ee(this,gt)[t];ee(this,He)&&(ee(this,He).terminate(),$t(this,He,null),this.loaded=!1)});Oe(this,"writeFile",(a,t,{signal:n}={})=>{const o=[];return t instanceof Uint8Array&&o.push(t.buffer),ee(this,Ve).call(this,{type:oe.WRITE_FILE,data:{path:a,data:t}},o,n)});Oe(this,"mount",(a,t,n)=>{const o=[];return ee(this,Ve).call(this,{type:oe.MOUNT,data:{fsType:a,options:t,mountPoint:n}},o)});Oe(this,"unmount",a=>{const t=[];return ee(this,Ve).call(this,{type:oe.UNMOUNT,data:{mountPoint:a}},t)});Oe(this,"readFile",(a,t="binary",{signal:n}={})=>ee(this,Ve).call(this,{type:oe.READ_FILE,data:{path:a,encoding:t}},void 0,n));Oe(this,"deleteFile",(a,{signal:t}={})=>ee(this,Ve).call(this,{type:oe.DELETE_FILE,data:{path:a}},void 0,t));Oe(this,"rename",(a,t,{signal:n}={})=>ee(this,Ve).call(this,{type:oe.RENAME,data:{oldPath:a,newPath:t}},void 0,n));Oe(this,"createDir",(a,{signal:t}={})=>ee(this,Ve).call(this,{type:oe.CREATE_DIR,data:{path:a}},void 0,t));Oe(this,"listDir",(a,{signal:t}={})=>ee(this,Ve).call(this,{type:oe.LIST_DIR,data:{path:a}},void 0,t));Oe(this,"deleteDir",(a,{signal:t}={})=>ee(this,Ve).call(this,{type:oe.DELETE_DIR,data:{path:a}},void 0,t))}on(a,t){a==="log"?ee(this,yt).push(t):a==="progress"&&ee(this,wt).push(t)}off(a,t){a==="log"?$t(this,yt,ee(this,yt).filter(n=>n!==t)):a==="progress"&&$t(this,wt,ee(this,wt).filter(n=>n!==t))}}He=new WeakMap,gt=new WeakMap,it=new WeakMap,yt=new WeakMap,wt=new WeakMap,Yt=new WeakMap,Ve=new WeakMap;var Os;(function(s){s.MEMFS="MEMFS",s.NODEFS="NODEFS",s.NODERAWFS="NODERAWFS",s.IDBFS="IDBFS",s.WORKERFS="WORKERFS",s.PROXYFS="PROXYFS"})(Os||(Os={}));const hr=s=>new Promise((a,t)=>{const n=new FileReader;n.onload=()=>{const{result:o}=n;o instanceof ArrayBuffer?a(new Uint8Array(o)):a(new Uint8Array)},n.onerror=o=>{var c,h;t(Error(`File could not be read! Code=${((h=(c=o==null?void 0:o.target)==null?void 0:c.error)==null?void 0:h.code)||-1}`))},n.readAsArrayBuffer(s)}),ys=async s=>{let a;if(typeof s=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(s)?a=atob(s.split(",")[1]).split("").map(t=>t.charCodeAt(0)):a=await(await fetch(s)).arrayBuffer();else if(s instanceof URL)a=await(await fetch(s)).arrayBuffer();else if(s instanceof File||s instanceof Blob)a=await hr(s);else return new Uint8Array;return new Uint8Array(a)};let bt=null;const ts=async()=>{if(bt&&bt.FS)return console.log("✅ FFmpeg ya inicializado, reutilizando instancia"),bt;console.log("🎬 Inicializando FFmpeg..."),bt=new mr;try{return await bt.load(),console.log("✅ FFmpeg inicializado correctamente"),bt}catch(s){throw console.error("❌ Error al inicializar FFmpeg:",s),bt=null,new Error("No se pudo inicializar FFmpeg")}},xr=async(s,a,t="output.mp4")=>{try{console.log(`🎬 Ajustando velocidad del video: factor ${a}`);const n=await ts();if(!n||!n.FS)throw new Error("FFmpeg no está correctamente inicializado");n.FS("writeFile","input.mp4",await ys(s));try{await n.run("-i","input.mp4","-filter:v",`setpts=${1/a}*PTS`,"-filter:a",`atempo=${a}`,"-c:v","libx264","-c:a","aac","-preset","fast",t)}catch(c){console.log("⚠️ Error con audio, procesando solo video:",c.message),await n.run("-i","input.mp4","-filter:v",`setpts=${1/a}*PTS`,"-c:v","libx264","-an","-preset","fast",t)}const o=n.FS("readFile",t);try{n.FS("unlink","input.mp4"),n.FS("unlink",t)}catch{console.warn("⚠️ No se pudieron limpiar archivos temporales")}return console.log("✅ Velocidad ajustada correctamente"),{success:!0,data:o,error:null}}catch(n){return console.error("❌ Error al ajustar velocidad:",n),{success:!1,data:null,error:n.message}}},gr=async(s,a=!1,t=null)=>{try{console.log(`🎬 Creando preview de secuencia con ${s.length} videos...`),console.log(`🎬 Control BPM: ${a?"Activado":"Desactivado"}`),a&&t&&console.log(`🎬 BPM objetivo: ${t}`);const n=await ts(),o=[],c=a&&t;for(let i=0;i<s.length;i++){const m=s[i];let y;if(m.file)y=m.file,console.log(`✅ Video ${i+1}/${s.length}: ${m.title} (archivo local)`);else if(m.videoUrl){console.log(`📥 Descargando video ${i+1}/${s.length} desde URL...`);try{const p=await fetch(m.videoUrl,{mode:"cors",credentials:"omit",headers:{Accept:"video/*,*/*;q=0.9","Cache-Control":"no-cache"}});if(!p.ok)throw new Error(`HTTP ${p.status}: ${p.statusText}`);y=await p.blob(),console.log(`✅ Video ${i+1}/${s.length}: ${m.title} descargado (${y.size} bytes)`)}catch(p){console.warn(`⚠️ Error en fetch directo: ${p.message}`);try{const{getStorage:T,ref:j,getDownloadURL:f}=await pt(async()=>{const{getStorage:v,ref:z,getDownloadURL:q}=await import("./tag-CccaPfO5.js").then(J=>J.i);return{getStorage:v,ref:z,getDownloadURL:q}},__vite__mapDeps([0,1,2])),V=T();let H=m.videoUrl;if(m.videoUrl.includes("firebasestorage.googleapis.com")){const v=m.videoUrl.split("/o/");v.length>1&&(H=decodeURIComponent(v[1].split("?")[0]))}const w=j(V,H),L=await f(w),B=await fetch(L);if(!B.ok)throw new Error(`HTTP ${B.status}: ${B.statusText}`);y=await B.blob(),console.log(`✅ Video ${i+1}/${s.length}: ${m.title} descargado via Firebase (${y.size} bytes)`)}catch(T){throw new Error(`Error descargando video ${i+1} (${m.title}): ${T.message}`)}}}else throw new Error(`Video ${i+1} (${m.title}) no tiene archivo ni URL asociada`);if(c&&m.bpm){const p=t/m.bpm;console.log(`🎬 Procesando video ${i+1}/${s.length}: ${m.title} (BPM: ${m.bpm} → ${t}, factor: ${p.toFixed(2)}x)`);const T=await xr(y,p,`preview${i}.mp4`);if(!T.success)throw new Error(`Error al procesar video ${i+1} (${m.title}): ${T.error}`);o.push(T.data)}else console.log(`🎬 Usando video ${i+1}/${s.length}: ${m.title} (sin procesamiento)`),o.push(y)}console.log("🎬 Concatenando videos para preview...");for(let i=0;i<o.length;i++){const m=o[i],y=m instanceof Blob?await ys(m):m;n.FS("writeFile",`preview${i}.mp4`,y),console.log(`📝 Video ${i+1}/${o.length} escrito al sistema de archivos`)}const h=o.map((i,m)=>`file preview${m}.mp4`).join(`
`);n.FS("writeFile","filelist.txt",h),console.log("📋 Lista de archivos creada"),console.log("🔗 Iniciando concatenación..."),await n.run("-f","concat","-safe","0","-i","filelist.txt","-c","copy","-avoid_negative_ts","make_zero","sequence_preview.mp4"),console.log("✅ Concatenación completada");const x=n.FS("readFile","sequence_preview.mp4");for(let i=0;i<o.length;i++)try{n.FS("unlink",`preview${i}.mp4`)}catch{console.warn(`⚠️ No se pudo limpiar archivo temporal preview${i}.mp4`)}try{n.FS("unlink","filelist.txt"),n.FS("unlink","sequence_preview.mp4")}catch{console.warn("⚠️ No se pudieron limpiar algunos archivos temporales")}return console.log("✅ Preview de secuencia creado correctamente"),{success:!0,data:x,error:null}}catch(n){return console.error("❌ Error al crear preview de secuencia:",n),{success:!1,data:null,error:n.message}}},ea=async(s,a="mp4",t="720p")=>{try{console.log(`🎬 Convirtiendo video a formato ${a} con resolución ${t}...`);const n=await ts();n.FS("writeFile","input.mp4",await ys(s));let o=[],c=[];switch(t){case"360p":o=["-vf","scale=-1:360"],c=["-crf","28","-preset","ultrafast"];break;case"480p":o=["-vf","scale=-1:480"],c=["-crf","25","-preset","fast"];break;case"720p":o=["-vf","scale=-1:720"],c=["-crf","23","-preset","fast"];break;case"1080p":o=["-vf","scale=-1:1080"],c=["-crf","20","-preset","medium"];break;case"4k":o=["-vf","scale=-1:2160"],c=["-crf","18","-preset","medium"];break;default:o=["-vf","scale=-1:720"],c=["-crf","23","-preset","fast"]}await n.run("-i","input.mp4",...o,...c,`output.${a}`);const h=n.FS("readFile",`output.${a}`);return n.FS("unlink","input.mp4"),n.FS("unlink",`output.${a}`),console.log("✅ Video convertido correctamente"),{success:!0,data:h,format:a,error:null}}catch(n){return console.error("❌ Error al convertir video:",n),{success:!1,data:null,format:null,error:n.message}}},Vs=async s=>{try{if(console.log(`📥 Descarga directa de secuencia: ${s.name}`),!s.videos||s.videos.length===0)throw new Error("La secuencia no tiene videos");if(s.videos.length===1){const c=s.videos[0];if(c.file)return{success:!0,data:c.file,format:"mp4",error:null};if(c.videoUrl){const h=await fetch(c.videoUrl);if(!h.ok)throw new Error("Error descargando video");return{success:!0,data:await h.blob(),format:"mp4",error:null}}}const a=await pt(()=>import("./jszip.min-oOtCOh2c.js").then(c=>c.j),__vite__mapDeps([3,1,2])),t=new a.default,n=(s.name||s.title||"secuencia").replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s+/g,"_").toLowerCase();for(let c=0;c<s.videos.length;c++){const h=s.videos[c];let x;if(h.file)x=h.file;else if(h.videoUrl){const m=await fetch(h.videoUrl);if(!m.ok)throw new Error(`Error descargando video ${c+1}`);x=await m.blob()}else throw new Error(`Video ${c+1} no tiene archivo ni URL`);const i=`${n}_${c+1}.mp4`;t.file(i,x),console.log(`📁 Agregando al ZIP: ${i}`)}return{success:!0,data:await t.generateAsync({type:"blob"}),format:"zip",error:null}}catch(a){return console.error("❌ Error en descarga directa:",a),{success:!1,data:null,format:null,error:a.message}}},pr=async(s,a="mp4",t="720p")=>{try{if(console.log(`🎬 Generando video de secuencia: ${s.name}`),console.log(`📹 Formato: ${a}, Resolución: ${t}`),!s.videos||s.videos.length===0)throw new Error("La secuencia no tiene videos");const n=s.useBPMControl||!1,o=s.targetBPM||null;if(console.log(`🎵 Configuración BPM: ${n?"Activado":"Desactivado"}, BPM: ${o}`),!n||!o)return console.log("🚀 Usando descarga directa (sin FFmpeg)"),await Vs(s);console.log("🎬 Intentando inicializar FFmpeg...");const c=ts(),h=new Promise((i,m)=>setTimeout(()=>m(new Error("Timeout inicializando FFmpeg")),1e4));try{await Promise.race([c,h])}catch{return console.warn("⚠️ FFmpeg no pudo inicializarse, usando descarga directa"),await Vs(s)}const x=await gr(s.videos,n,o);if(!x.success)throw new Error(`Error generando video: ${x.error}`);if(a!=="mp4"||t!=="720p"){console.log(`🔄 Convirtiendo a formato ${a} con resolución ${t}...`);const i=await ea(new Blob([x.data],{type:"video/mp4"}),a,t);if(!i.success)throw new Error(`Error convirtiendo formato: ${i.error}`);return{success:!0,data:i.data,format:a,error:null}}return{success:!0,data:x.data,format:"mp4",error:null}}catch(n){return console.error("❌ Error generando video de secuencia:",n),{success:!1,data:null,format:null,error:n.message}}},fr=({isOpen:s,onClose:a,video:t,onDownloadComplete:n})=>{const[o,c]=l.useState("mp4"),[h,x]=l.useState("720p"),[i,m]=l.useState(!1),[y,p]=l.useState(0),T=[{value:"mp4",label:"MP4",description:"Formato estándar, compatible con todo"},{value:"avi",label:"AVI",description:"Formato clásico, buena calidad"},{value:"mov",label:"MOV",description:"Formato Apple, alta calidad"},{value:"webm",label:"WebM",description:"Formato web, archivos pequeños"}],j=[{value:"360p",label:"360p",description:"Calidad baja, archivo pequeño"},{value:"480p",label:"480p",description:"Calidad estándar, balance"},{value:"720p",label:"720p",description:"HD, buena calidad"},{value:"1080p",label:"1080p",description:"Full HD, alta calidad"},{value:"4k",label:"4K",description:"Ultra HD, máxima calidad"}],f=async()=>{if(!t){console.error("No hay video para descargar");return}m(!0),p(0);try{const w=setInterval(()=>{p(B=>B>=90?(clearInterval(w),90):B+10)},500);let L;try{if(t.videos&&Array.isArray(t.videos))L=await pr(t,o,h);else if(t.file)L=await ea(t.file,o,h);else throw new Error("Formato de video no válido");clearInterval(w),p(100),await new Promise(B=>setTimeout(B,200))}catch(B){throw clearInterval(w),B}if(L.success){const B=L.format==="zip"?"application/zip":`video/${L.format||o}`,v=new Blob([L.data],{type:B});try{const z=await V();if(z){const q=L.format==="zip"?"zip":L.format||o,J=`${t.title||t.name}_${h}.${q}`,he=await(await z.getFileHandle(J,{create:!0})).createWritable();await he.write(v),await he.close()}else{const q=URL.createObjectURL(v),J=document.createElement("a");J.href=q;const re=L.format==="zip"?"zip":L.format||o;J.download=`${t.title||t.name}_${h}.${re}`,document.body.appendChild(J),J.click(),document.body.removeChild(J),URL.revokeObjectURL(q)}n&&n(),a()}catch(z){throw console.error("Error al guardar archivo:",z),new Error("Error al guardar el archivo")}}else throw new Error(L.error)}catch(w){console.error("❌ Error al descargar video:",w),alert(`Error al procesar video: ${w.message}`)}finally{m(!1),p(0)}},V=async()=>{try{return"showDirectoryPicker"in window?await window.showDirectoryPicker():null}catch{return null}},H=async()=>{if(!t||!t.file){console.error("No hay video para descargar");return}try{const w=await V();if(w){const L=`${t.title||t.name}.mp4`,v=await(await w.getFileHandle(L,{create:!0})).createWritable();await v.write(t.file),await v.close()}else{const L=URL.createObjectURL(t.file),B=document.createElement("a");B.href=L,B.download=t.title||"video",document.body.appendChild(B),B.click(),document.body.removeChild(B),URL.revokeObjectURL(L)}a()}catch(w){console.error("Error en descarga directa:",w),alert("Error al descargar el archivo")}};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ut,{className:"h-5 w-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:t!=null&&t.videos?"Descargar Secuencia":"Descargar Video"})]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ot,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Pa,{className:"h-8 w-8 text-gray-400"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-gray-800 truncate",children:(t==null?void 0:t.title)||(t==null?void 0:t.name)||"Sin título"}),t!=null&&t.videos?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[t.videos.length," videos • Duración aproximada: ",Math.floor(t.videos.length*30/60),":",(t.videos.length*30%60).toString().padStart(2,"0")]}),t.useBPMControl&&t.targetBPM&&e.jsxs("p",{className:"text-sm text-purple-600",children:["BPM ajustado: ",t.targetBPM]}),t.description&&e.jsx("p",{className:"text-sm text-gray-600",children:t.description})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:t!=null&&t.fileSize?`${(t.fileSize/(1024*1024)).toFixed(2)} MB`:"Tamaño desconocido"}),(t==null?void 0:t.bpm)&&e.jsxs("p",{className:"text-sm text-purple-600",children:["BPM: ",t.bpm]})]})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Formato de salida"}),e.jsx("div",{className:"space-y-2",children:T.map(w=>e.jsxs("label",{className:`flex items-center p-3 border rounded-lg cursor-pointer transition-colors ${o===w.value?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"format",value:w.value,checked:o===w.value,onChange:L=>c(L.target.value),className:"sr-only"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 flex items-center justify-center ${o===w.value?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:o===w.value&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:w.label}),e.jsx("div",{className:"text-sm text-gray-500",children:w.description})]})]})]},w.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Resolución"}),e.jsx("div",{className:"space-y-2",children:j.map(w=>e.jsxs("label",{className:`flex items-center p-3 border rounded-lg cursor-pointer transition-colors ${h===w.value?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"resolution",value:w.value,checked:h===w.value,onChange:L=>x(L.target.value),className:"sr-only"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 flex items-center justify-center ${h===w.value?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:h===w.value&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:w.label}),e.jsx("div",{className:"text-sm text-gray-500",children:w.description})]})]})]},w.value))})]}),i&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"Procesando video..."}),e.jsxs("span",{children:[y,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${y}%`}})})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:H,disabled:i,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:"Descargar original"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:a,disabled:i,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:f,disabled:i,className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${i?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:i?"Procesando...":"Descargar"})]})]})]})}):null},Lt=({isOpen:s,onClose:a,onConfirm:t,title:n="Confirmar acción",message:o="¿Estás seguro de que quieres realizar esta acción?",confirmText:c="Confirmar",cancelText:h="Cancelar",type:x="warning"})=>{if(!s)return null;const i=()=>{switch(x){case"danger":return e.jsx(Bt,{className:"w-8 h-8 text-red-500"});case"warning":return e.jsx(Bt,{className:"w-8 h-8 text-orange-500"});case"info":return e.jsx(Bt,{className:"w-8 h-8 text-blue-500"});default:return e.jsx(Bt,{className:"w-8 h-8 text-orange-500"})}},m=()=>{switch(x){case"danger":return"bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600";case"warning":return"bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600";case"info":return"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600";default:return"bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600"}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:a}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[i(),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:n})]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ot,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"text-gray-600 leading-relaxed whitespace-pre-line",children:o})}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors font-medium",children:h}),e.jsx("button",{onClick:()=>{t(),a()},className:`px-4 py-2 text-white rounded-lg transition-all font-medium ${m()}`,children:c})]})]})]})},ss="sequences",br=async s=>{console.log("🔥 Firebase: Creando secuencia..."),console.log("📦 Datos de secuencia:",s);try{const a={...s,createdAt:us(),updatedAt:us()};console.log("⏰ Secuencia con timestamps:",a);const t=await ka(_s(es,ss),a);console.log("📄 Documento creado con ID:",t.id);const n={id:t.id,...s,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return console.log("✅ Secuencia creada exitosamente:",n),n}catch(a){throw console.error("❌ Error al crear secuencia:",a),new Error("No se pudo crear la secuencia")}},yr=async(s,a)=>{try{const t=Hs(es,ss,s),n={...a,updatedAt:us()};return await Na(t,n),{id:s,...a,updatedAt:new Date().toISOString()}}catch(t){throw console.error("Error al actualizar secuencia:",t),new Error("No se pudo actualizar la secuencia")}},wr=async s=>{try{const a=Hs(es,ss,s);return await Sa(a),{success:!0}}catch(a){throw console.error("Error al eliminar secuencia:",a),new Error("No se pudo eliminar la secuencia")}},vr=(s,a)=>{console.log("🎬 Firebase: Suscribiéndose a secuencias para estilo:",s);try{const t=ya(_s(es,ss),wa("style","==",s),va("createdAt","desc"));return ja(t,n=>{console.log(`🎬 Firebase: Actualización recibida - ${n.size} secuencias para ${s}`);const o=[];n.forEach(c=>{var i,m,y,p,T,j,f;const h=c.data(),x={id:c.id,...h,createdAt:((y=(m=(i=h.createdAt)==null?void 0:i.toDate)==null?void 0:m.call(i))==null?void 0:y.toISOString())||h.createdAt,updatedAt:((j=(T=(p=h.updatedAt)==null?void 0:p.toDate)==null?void 0:T.call(p))==null?void 0:j.toISOString())||h.updatedAt};o.push(x),console.log(`📋 Secuencia cargada: ${x.name} (${((f=x.videos)==null?void 0:f.length)||0} videos)`)}),console.log(`🎉 Total de secuencias cargadas: ${o.length}`),a(o)})}catch(t){throw console.error("❌ Error al suscribirse a secuencias por estilo:",t),new Error("No se pudo suscribir a las secuencias")}},jr=s=>{const[a,t]=l.useState(null),[n,o]=l.useState(null),c=l.useCallback(T=>{t(T)},[]),h=l.useCallback((T,j)=>{T.preventDefault(),o(j)},[]),x=l.useCallback((T,j)=>{T.preventDefault(),o(j)},[]),i=l.useCallback(T=>{T.preventDefault(),o(null)},[]),m=l.useCallback((T,j)=>{T.preventDefault(),a!==null&&a!==j&&s(a,j),t(null),o(null)},[a,s]),y=l.useCallback(()=>{t(null),o(null)},[]),p=l.useCallback(T=>{const j={cursor:"grab",transition:"all 0.2s ease",transform:"scale(1)",opacity:1};return a===T&&(j.cursor="grabbing",j.transform="scale(1.05) rotate(2deg)",j.opacity=.7,j.zIndex=1e3),n===T&&a!==T&&(j.transform="scale(1.02)",j.borderLeft="4px solid #3b82f6",j.backgroundColor="#f0f9ff"),j},[a,n]);return{draggedIndex:a,dragOverIndex:n,handleDragStart:c,handleDragOver:h,handleDragEnter:x,handleDragLeave:i,handleDrop:m,handleDragEnd:y,getDragStyles:p}},fs=({videos:s,currentBPM:a=null,className:t="",showControls:n=!0,autoplay:o=!1,loop:c=!1,muted:h=!1})=>{const[x,i]=l.useState(0),[m,y]=l.useState(!1),[p,T]=l.useState(h),[j,f]=l.useState(!1),[V,H]=l.useState(n),[w,L]=l.useState(0),[B,v]=l.useState(0),[z,q]=l.useState(1),[J,re]=l.useState(1),[he,je]=l.useState(!1),[ne,ze]=l.useState(null),[Ne,Re]=l.useState(!1),[De,ve]=l.useState(0),[Fe,Me]=l.useState(0),[O,we]=l.useState(!1),[pe,k]=l.useState(!1),[F,U]=l.useState(!1),[G,W]=l.useState(0),[Z,ie]=l.useState(0),[d,M]=l.useState(null),[D,_]=l.useState(!1),[I,Q]=l.useState(1),[se,xe]=l.useState(!0),A=l.useRef(null),te=l.useRef(null),ce=s[x],le=[.25,.5,.75,1,1.25,1.5,2];l.useEffect(()=>{q(1),A.current&&(A.current.playbackRate=1)},[x]),l.useEffect(()=>{if(A.current&&O&&m&&pe&&F){const C=A.current,K=()=>{C.currentTime>=Fe&&(C.currentTime=De)};return C.addEventListener("timeupdate",K),()=>C.removeEventListener("timeupdate",K)}},[O,De,Fe,m,pe,F]),l.useEffect(()=>{if(n&&m){d&&clearTimeout(d);const C=setTimeout(()=>{H(!1)},4e3);M(C)}return()=>{d&&clearTimeout(d)}},[m,n]),l.useEffect(()=>()=>{d&&clearTimeout(d),ne&&clearTimeout(ne)},[]),l.useEffect(()=>{const C=K=>{D&&_(!1)};return document.addEventListener("click",C),()=>document.removeEventListener("click",C)},[D]);const Ie=()=>{H(!0),d&&clearTimeout(d)},ke=()=>{Ne&&!O?A.current&&(A.current.currentTime=0,A.current.play()):O&&pe&&F?A.current&&(A.current.currentTime=De,A.current.play()):y(!1)},Ae=()=>{A.current&&L(A.current.currentTime)},fe=()=>{A.current&&(v(A.current.duration),A.current.playbackRate=I,q(I))},Se=()=>{A.current&&(m?A.current.pause():A.current.play(),y(!m))},Ee=()=>{x>0&&(i(C=>C-1),L(0),A.current&&(A.current.currentTime=0))},de=()=>{x<s.length-1&&(i(C=>C+1),L(0),A.current&&(A.current.currentTime=0))},$e=C=>{if(A.current){const K=Math.max(0,Math.min(B,w+C));A.current.currentTime=K,L(K)}},Je=()=>{if(A.current){const C=!p;A.current.muted=C,T(C),C?A.current.volume=0:A.current.volume=J}},Be=C=>{const K=parseFloat(C.target.value);A.current&&(A.current.volume=K,re(K),K===0?(A.current.muted=!0,T(!0)):(A.current.muted=!1,T(!1)))},S=()=>{try{document.fullscreenElement?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),f(!1)):(te.current.requestFullscreen?te.current.requestFullscreen():te.current.webkitRequestFullscreen?te.current.webkitRequestFullscreen():te.current.msRequestFullscreen&&te.current.msRequestFullscreen(),f(!0))}catch(C){console.error("Error toggling fullscreen:",C)}},We=C=>{if(A.current){const K=C.currentTarget.getBoundingClientRect(),g=(C.clientX-K.left)/K.width*B;A.current.currentTime=g,L(g)}},Ge=C=>{C==="start"?pe?(k(!1),ve(0)):(k(!0),ve(w),W(w)):F?(U(!1),Me(0)):(U(!0),Me(w),ie(w))},ue=C=>{const K=Math.floor(C/60),Xe=Math.floor(C%60);return`${K}:${Xe.toString().padStart(2,"0")}`},Ke=C=>{Q(C),A.current&&(A.current.playbackRate=C,q(C)),_(!1)},et=C=>C===1?"Normal":`${C}x`,mt=async()=>{try{if(ce.videoUrl&&(ce.videoUrl.includes("firebase")||ce.videoUrl.includes("googleapis"))){const C=await fetch(ce.videoUrl);if(!C.ok)throw new Error(`HTTP error! status: ${C.status}`);const K=await C.blob(),Xe=URL.createObjectURL(K),Pe=document.createElement("a");Pe.href=Xe,Pe.download=ce.title||"video.mp4",Pe.style.display="none",document.body.appendChild(Pe),Pe.click(),document.body.removeChild(Pe),setTimeout(()=>{URL.revokeObjectURL(Xe)},1e3)}else{const C=document.createElement("a");C.href=ce.videoUrl,C.download=ce.title||"video.mp4",C.style.display="none",document.body.appendChild(C),C.click(),document.body.removeChild(C)}}catch(C){console.error("Error en descarga:",C),alert(`Error al descargar el video: ${C.message}`)}};return l.useEffect(()=>{const C=K=>{if(K.target.tagName!=="INPUT")switch(K.code){case"Space":K.preventDefault(),Se();break;case"KeyF":K.preventDefault(),S();break;case"KeyM":K.preventDefault(),Je();break;case"ArrowLeft":K.preventDefault(),K.ctrlKey||K.metaKey?Ee():$e(-10);break;case"ArrowRight":K.preventDefault(),K.ctrlKey||K.metaKey?de():$e(10);break;case"KeyA":K.preventDefault(),Ge("start");break;case"KeyB":K.preventDefault(),Ge("end");break;case"KeyL":K.preventDefault(),Re(!Ne);break;case"KeyS":K.preventDefault();const Pe=(le.indexOf(I)+1)%le.length;Ke(le[Pe]);break}};return document.addEventListener("keydown",C),()=>document.removeEventListener("keydown",C)},[w,B,x,Ne,I]),ce?e.jsxs("div",{ref:te,className:`relative bg-black rounded-lg overflow-hidden ${t}`,onMouseEnter:Ie,onMouseLeave:()=>{if(m){const C=setTimeout(()=>{H(!1)},4e3);M(C)}},onTouchStart:Ie,onTouchMove:Ie,children:[e.jsx("video",{ref:A,src:ce.videoUrl,className:"w-full h-full object-contain cursor-pointer",onEnded:ke,onTimeUpdate:Ae,onLoadedMetadata:fe,onPlay:()=>y(!0),onPause:()=>y(!1),muted:p,autoPlay:o,loop:!1,onClick:Ie}),e.jsxs("div",{className:"absolute top-2 left-2 bg-black bg-opacity-75 text-white px-3 py-2 rounded-lg text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"font-medium",children:[x+1," / ",s.length]}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsx("span",{className:"max-w-xs truncate",children:ce.title}),z!==1&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsxs("span",{className:"text-blue-400 font-medium",children:[z.toFixed(2),"x"]})]})]}),s.length>1&&e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Usa Ctrl+←/→ para cambiar de video"})]}),V&&e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent flex flex-col justify-end",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 flex justify-end items-center",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:S,className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",children:j?e.jsx(Xs,{className:"w-4 h-4"}):e.jsx(Ks,{className:"w-4 h-4"})})})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:Ee,disabled:x===0,className:`p-2 rounded-full transition-colors z-10 ${x===0?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-black/60 text-white hover:bg-black/80"}`,title:"Video anterior (Ctrl+←)",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-current flex items-center justify-center",children:e.jsx(gs,{className:"w-1.5 h-1.5"})}),e.jsx("span",{className:"text-xs font-medium",children:"Anterior"})]})}),e.jsx("button",{onClick:()=>$e(-10),className:"p-3 rounded-full bg-black/60 text-white hover:bg-black/80 transition-colors z-10 hidden md:flex items-center justify-center",title:"Retroceder 10s (←)",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center",children:e.jsx(gs,{className:"w-3 h-3"})}),e.jsx("span",{className:"text-sm font-medium",children:"10"})]})}),e.jsx("button",{onClick:Se,className:"p-4 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",title:"Play/Pause (Espacio)",children:m?e.jsx(Zs,{className:"w-8 h-8"}):e.jsx(Ye,{className:"w-8 h-8"})}),e.jsx("button",{onClick:()=>$e(10),className:"p-3 rounded-full bg-black/60 text-white hover:bg-black/80 transition-colors z-10 hidden md:flex items-center justify-center",title:"Adelantar 10s (→)",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"10"}),e.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center",children:e.jsx(ps,{className:"w-3 h-3"})})]})}),e.jsx("button",{onClick:de,disabled:x===s.length-1,className:`p-2 rounded-full transition-colors z-10 ${x===s.length-1?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-black/60 text-white hover:bg-black/80"}`,title:"Siguiente video (Ctrl+→)",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Siguiente"}),e.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-current flex items-center justify-center",children:e.jsx(ps,{className:"w-1.5 h-1.5"})})]})})]})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[e.jsxs("div",{className:"flex justify-end mb-2 space-x-2",children:[e.jsx("button",{onClick:()=>Re(!Ne),className:`p-2 rounded-full transition-colors z-10 ${Ne?"bg-blue-500 text-white":"bg-white/20 text-white hover:bg-white/30"}`,title:"Bucle",children:e.jsx(Qs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{const C=!O;we(C),C?(G>0&&(k(!0),ve(G)),Z>0&&(U(!0),Me(Z))):(k(!1),U(!1),ve(0),Me(0))},className:`p-2 rounded-full transition-colors z-10 ${O?"bg-green-500 text-white":"bg-white/20 text-white hover:bg-white/30"}`,title:"Segmento A-B",children:e.jsx("div",{className:"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none",children:"A-B"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>_(!D),className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",title:"Velocidad de reproducción",children:e.jsx("div",{className:"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none",children:I===1?"1x":`${I}x`})}),D&&e.jsx("div",{className:"absolute bottom-full right-0 mb-2 bg-black/90 rounded-lg p-2 z-20 min-w-[80px]",children:le.map(C=>e.jsx("button",{onClick:()=>Ke(C),className:`w-full text-left px-3 py-1 rounded text-xs transition-colors ${I===C?"bg-blue-500 text-white":"text-white hover:bg-white/20"}`,children:et(C)},C))})]}),e.jsx("button",{onClick:mt,className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",title:"Descargar video",children:e.jsx(ut,{className:"w-4 h-4"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:Je,className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",onMouseEnter:()=>je(!0),onMouseLeave:()=>{const C=setTimeout(()=>je(!1),1e3);ze(C)},children:p?e.jsx(Js,{className:"w-4 h-4"}):e.jsx(Ys,{className:"w-4 h-4"})}),he&&e.jsx("div",{className:"absolute bottom-full right-0 mb-2 bg-black/80 rounded-lg p-3 z-20",onMouseEnter:()=>{ne&&(clearTimeout(ne),ze(null))},onMouseLeave:()=>{const C=setTimeout(()=>je(!1),1e3);ze(C)},children:e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:J,onChange:Be,className:"w-2 h-20 bg-gray-600 rounded-lg appearance-none cursor-pointer slider-vertical",style:{background:`linear-gradient(to top, #3b82f6 0%, #3b82f6 ${J*100}%, #4b5563 ${J*100}%, #4b5563 100%)`},orient:"vertical"}),e.jsxs("span",{className:"text-white text-xs",children:[Math.round(J*100),"%"]})]})})]})]}),e.jsx("div",{className:"relative mb-4",children:e.jsxs("div",{className:"w-full h-2 bg-white/20 rounded-full cursor-pointer relative",onClick:We,children:[e.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${w/B*100}%`}}),O&&pe&&e.jsx("div",{className:"absolute top-0 w-1 h-full bg-green-500 z-10",style:{left:`${De/B*100}%`}}),O&&F&&e.jsx("div",{className:"absolute top-0 w-1 h-full bg-red-500 z-10",style:{left:`${Fe/B*100}%`}})]})}),e.jsxs("div",{className:"flex items-center justify-between text-white text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:[ue(w)," / ",ue(B)]}),z!==1&&e.jsxs("span",{className:"text-blue-400 font-medium",children:[z.toFixed(2),"x"]}),O&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>Ge("start"),className:`px-2 py-1 rounded text-xs transition-colors ${pe?"bg-green-500 text-white":"bg-gray-600 text-gray-300 hover:bg-gray-500"}`,children:["A: ",pe?ue(De):"--:--"]}),e.jsxs("button",{onClick:()=>Ge("end"),className:`px-2 py-1 rounded text-xs transition-colors ${F?"bg-red-500 text-white":"bg-gray-600 text-gray-300 hover:bg-gray-500"}`,children:["B: ",F?ue(Fe):"--:--"]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"text-xs opacity-75",children:Ne&&(O&&pe&&F?"Bucle A-B":"Bucle completo")})})]}),s.length>1&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-300 mb-1",children:[e.jsx("span",{children:"Progreso de la secuencia"}),e.jsxs("span",{children:[x+1," de ",s.length]})]}),e.jsx("div",{className:"w-full h-1 bg-gray-600 rounded-full",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-300",style:{width:`${(x+1)/s.length*100}%`}})})]})]})]})]}):e.jsx("div",{className:`bg-black rounded-lg flex items-center justify-center ${t}`,children:e.jsx("div",{className:"text-white text-center",children:e.jsx("p",{children:"No hay videos en la secuencia"})})})};class Nr{constructor(){this.isLoaded=!0}async load(){return Promise.resolve()}async combineVideos(a,t){try{console.log("Iniciando combinación con MediaRecorder optimizado..."),t&&t({stage:"init",current:0,total:100,message:"Iniciando MediaRecorder..."});const n=[];for(let c=0;c<a.length;c++){const h=a[c];console.log(`Descargando video ${c+1}/${a.length}: ${h.title}`),t&&t({stage:"download",current:(c+1)/a.length*50,total:100,message:`Descargando: ${h.title}`});try{const{ref:x,getDownloadURL:i}=await pt(async()=>{const{ref:f,getDownloadURL:V}=await import("./tag-CccaPfO5.js").then(H=>H.i);return{ref:f,getDownloadURL:V}},__vite__mapDeps([0,1,2])),{storage:m}=await pt(async()=>{const{storage:f}=await import("./index-CqYG162O.js").then(V=>V.ae);return{storage:f}},__vite__mapDeps([1,2])),y=x(m,h.videoPath),p=await i(y);console.log(`URL de descarga obtenida para ${h.title}:`,p);const T=await fetch(p);if(!T.ok)throw new Error(`Error descargando video: ${T.statusText}`);const j=await T.blob();n.push(j),console.log(`Video ${c+1} descargado: ${h.title}`)}catch(x){throw console.error(`Error con video ${h.title}:`,x),new Error(`Error procesando video ${h.title}: ${x.message}`)}}t&&t({stage:"combine",current:50,total:100,message:"Combinando videos..."});const o=await this.combineVideoBlobs(n);return t&&t({stage:"complete",current:100,total:100,message:"¡Combinación completada!"}),console.log("Combinación completada, archivo creado"),o}catch(n){throw console.error("Error combinando videos:",n),new Error(`Error combinando videos: ${n.message}`)}}async combineVideoBlobs(a){return new Promise((t,n)=>{try{const o=document.createElement("canvas"),c=o.getContext("2d");o.width=1920,o.height=1080;const h=o.captureStream(60),x=new MediaRecorder(h,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:3e7}),i=[];x.ondataavailable=p=>{p.data.size>0&&i.push(p.data)},x.onstop=()=>{const p=new Blob(i,{type:"video/webm"});t(p)},x.onerror=p=>{n(p)},x.start();let m=0;const y=()=>{if(m>=a.length){x.stop();return}const p=a[m],T=URL.createObjectURL(p),j=document.createElement("video");j.onloadedmetadata=()=>{j.currentTime=0,j.muted=!1,j.volume=1,j.play()},j.ontimeupdate=()=>{c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.clearRect(0,0,o.width,o.height);const f=j.videoWidth/j.videoHeight,V=o.width/o.height;let H,w,L,B;f>V?(H=o.width,w=o.width/f,L=0,B=(o.height-w)/2):(w=o.height,H=o.height*f,L=(o.width-H)/2,B=0),c.drawImage(j,L,B,H,w)},j.onplay=()=>{const f=()=>{if(!j.paused&&!j.ended){c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.clearRect(0,0,o.width,o.height);const V=j.videoWidth/j.videoHeight,H=o.width/o.height;let w,L,B,v;V>H?(w=o.width,L=o.width/V,B=0,v=(o.height-L)/2):(L=o.height,w=o.height*V,B=(o.width-w)/2,v=0),c.drawImage(j,B,v,w,L),requestAnimationFrame(f)}};requestAnimationFrame(f)},j.onended=()=>{URL.revokeObjectURL(T),m++,setTimeout(y,100)},j.src=T};y()}catch(o){n(o)}})}async combineVideosSimple(a,t){return this.combineVideos(a,t)}async cleanup(a){try{console.log("Limpiando archivos temporales...");for(const t of a)await this.ffmpeg.deleteFile(t);await this.ffmpeg.deleteFile("filelist.txt"),await this.ffmpeg.deleteFile("output.mp4"),console.log("Archivos temporales eliminados")}catch(t){console.warn("Error limpiando archivos temporales:",t)}}async getVideoInfo(a){try{const n=await(await fetch(a)).blob();return{size:n.size,type:n.type,duration:null}}catch(t){return console.error("Error obteniendo información del video:",t),null}}}const kr=({isOpen:s,onClose:a,videos:t,sequenceName:n="Secuencia"})=>{const[o,c]=l.useState(null),[h,x]=l.useState(!1),[i,m]=l.useState(null),[y,p]=l.useState(null),[T,j]=l.useState("fast"),f=new Nr;l.useEffect(()=>{s&&(c(null),m(null),p(null),x(!1))},[s]);const V=async()=>{if(!t||t.length===0){m("No hay videos para combinar");return}x(!0),m(null),c({stage:"init",current:0,total:100,message:"Iniciando FFmpeg.wasm..."});try{const z=await f.combineVideos(t,c),q=URL.createObjectURL(z);p(q),c({stage:"complete",current:100,total:100,message:"¡Videos combinados exitosamente!"})}catch(z){console.error("Error en descarga:",z),m(`Error combinando videos: ${z.message}`),c(null)}finally{x(!1)}},H=()=>{if(y){const z=document.createElement("a");z.href=y,z.download=`${n}.webm`,document.body.appendChild(z),z.click(),document.body.removeChild(z)}},w=()=>i?"text-red-500":(o==null?void 0:o.stage)==="complete"?"text-green-500":"text-blue-500",L=()=>i?e.jsx(Rt,{className:"h-5 w-5"}):(o==null?void 0:o.stage)==="complete"?e.jsx(Kt,{className:"h-5 w-5"}):e.jsx(Za,{className:"h-5 w-5 animate-spin"}),B=()=>i?"bg-red-500":(o==null?void 0:o.stage)==="complete"?"bg-green-500":"bg-blue-500",v=()=>{switch(o==null?void 0:o.stage){case"init":return"Inicializando FFmpeg.wasm...";case"download":return"Descargando videos...";case"combine":return"Combinando videos con FFmpeg...";case"finalize":return"Finalizando archivo...";case"complete":return"¡Proceso completado!";default:return"Preparando..."}};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Descargar Secuencia"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:h,children:e.jsx(ot,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsxs("strong",{children:[(t==null?void 0:t.length)||0," videos"]})," serán combinados en uno solo"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Duración total: ",t==null?void 0:t.reduce((z,q)=>z+(q.duration||0),0).toFixed(1),"s",(t==null?void 0:t.some(z=>!z.duration))&&" (calculando...)"]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Formato: WebM (calidad optimizada con MediaRecorder)"})]}),o&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[L(),e.jsx("span",{className:`text-sm font-medium ${w()}`,children:o.message})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${B()}`,style:{width:`${o.current}%`}})}),e.jsx("p",{className:"text-xs text-gray-500",children:v()})]}),i&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Rt,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"text-sm text-red-700",children:i})]})}),y&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Kt,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-sm text-green-700",children:"¡Videos combinados exitosamente!"})]})})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[!h&&!y&&e.jsxs("button",{onClick:V,className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2",children:[e.jsx(ut,{className:"h-4 w-4"}),e.jsx("span",{children:"Combinar Videos"})]}),y&&e.jsxs("button",{onClick:H,className:"flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center space-x-2",children:[e.jsx(ut,{className:"h-4 w-4"}),e.jsx("span",{children:"Descargar WebM"})]}),e.jsx("button",{onClick:a,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",disabled:h,children:y?"Cerrar":"Cancelar"})]})]})}):null},Sr=({isOpen:s,onClose:a,videos:t,onSaveSequence:n,onToggleShowAll:o,showAllVideos:c,style:h="salsa",isIntegrated:x=!1,onToggleBuilder:i})=>{const{categoriesList:m,getColorClasses:y}=Mt("figuras",h),{user:p}=Jt(),[T,j]=l.useState(null),[f,V]=l.useState(!1),[H,w]=l.useState(!1),[L,B]=l.useState(null),[v,z]=l.useState(null),[q,J]=l.useState(null),[re,he]=l.useState({}),[je,ne]=l.useState(!0),[ze,Ne]=l.useState(!1),[Re,De]=l.useState(null),ve=g=>{if(!g.tags||Object.keys(g.tags).length===0)return[];const $=[];return m.forEach(R=>{const N=g.tags[R.key];Array.isArray(N)&&N.forEach(be=>{$.push({tag:be,categoryKey:R.key,color:R.color})})}),$},Fe=g=>{if(!g.tagsIniciales||Object.keys(g.tagsIniciales).length===0)return[];const $=[];return m.forEach(R=>{const N=g.tagsIniciales[R.key];Array.isArray(N)&&N.forEach(be=>{$.push({tag:be,categoryKey:R.key,color:R.color,type:"inicial"})})}),$},Me=g=>{if(!g.tagsFinales||Object.keys(g.tagsFinales).length===0)return[];const $=[];return m.forEach(R=>{const N=g.tagsFinales[R.key];Array.isArray(N)&&N.forEach(be=>{$.push({tag:be,categoryKey:R.key,color:R.color,type:"final"})})}),$},{sequence:O,sequenceName:we,sequenceDescription:pe,editingSequenceId:k,addVideoToSequence:F,removeVideoFromSequence:U,reorderSequence:G,generateRandomSequence:W,clearSequence:Z,setSequenceName:ie,setSequenceDescription:d,isVideoCompatible:M,isVideoInSequence:D,toggleBuilder:_,checkCompatibility:I}=Ws();l.useEffect(()=>{const g=O.filter($=>$.bpm);if(g.length>0){const $=g.map(N=>N.bpm),R=$.reduce((N,be)=>N+be,0)/$.length;De(Math.round(R))}else De(null)},[O]);const{handleDragStart:Q,handleDragOver:se,handleDragEnter:xe,handleDragLeave:A,handleDrop:te,handleDragEnd:ce,getDragStyles:le}=jr(G),[Ie,ke]=l.useState([]),[Ae,fe]=l.useState({isOpen:!1,type:null}),[Se,Ee]=l.useState(5),de=(g,$="success")=>{const R=Date.now();ke(N=>[...N,{id:R,message:g,type:$}])},$e=g=>{ke($=>$.filter(R=>R.id!==g))},Je=async g=>{if(!p){de("Debes iniciar sesión para dar like","error");return}try{const $=await ms(g.id,p.uid);$.success?de(`Has ${$.userLiked?"dado like a":"quitado like de"} "${g.title}"`,"success"):de("Error al actualizar like","error")}catch($){console.error("Error al manejar like:",$),de("Error al actualizar like","error")}},Be=()=>{const g=Se-O.length;if(g<=0){de("La secuencia ya tiene suficientes videos","info");return}if(O.length>0){const $=O[O.length-1],R=t.filter(N=>!O.some(be=>be.id===N.id)&&I($,N));if(R.length===0){de("No hay videos compatibles disponibles para continuar la secuencia","warning");return}if(R.length<g){de(`Solo hay ${R.length} videos compatibles disponibles de los ${g} necesarios`,"info"),W(t,O.length+R.length),de(`Secuencia completada con ${R.length} videos adicionales`);return}}W(t,Se),de(`Secuencia completada hasta ${Se} videos`)},S=async()=>{if(console.log("💾 Intentando guardar secuencia..."),console.log("📝 Nombre:",we),console.log("📋 Videos en secuencia:",O.length),console.log("🎨 Estilo:",h),console.log("🔄 Editando secuencia ID:",k),!we.trim()){de("Por favor, añade un nombre a la secuencia","error");return}if(O.length===0){de("La secuencia debe tener al menos un video","error");return}try{const g=await Pe(),$={name:we,description:pe,videos:O,style:h,tags:re,thumbnailUrl:g,resolution:O.length>0?O[0].resolution:"HD",createdAt:new Date().toISOString()};k&&($.id=k),await n($),de(k?"✅ Secuencia actualizada exitosamente":'✅ Secuencia guardada exitosamente. Ve a "GALERÍA DE SECUENCIAS" para verla.'),Z(),i&&i()}catch(g){console.error("❌ Error al guardar secuencia:",g),de("Error al guardar la secuencia","error")}},We=()=>{O.length>0||we.trim()||pe.trim()?fe({isOpen:!0,type:"cancel"}):i&&i()},Ge=()=>{fe({isOpen:!0,type:"clear"})},ue=()=>{Ae.type==="cancel"?(Z(),i&&i()):Ae.type==="clear"&&Z(),fe({isOpen:!1,type:null})};l.useEffect(()=>{const g=setTimeout(()=>{mt()},500);return()=>clearTimeout(g)},[O]),l.useEffect(()=>()=>{L&&URL.revokeObjectURL(L)},[L]);const Ke=g=>{if(!g||!g.resolution)return["auto","360p","480p","720p","1080p"];const $=g.resolution.toLowerCase(),R=["auto"];return $.includes("4k")||$.includes("2160p")?R.push("360p","480p","720p","1080p","4k"):$.includes("1080p")||$.includes("1920")?R.push("360p","480p","720p","1080p"):$.includes("720p")||$.includes("1280")?R.push("360p","480p","720p"):$.includes("480p")||$.includes("854")?R.push("360p","480p"):R.push("360p"),R},et=g=>{console.log("🎬 Reproduciendo video individual:",g.title),j(g),V(!0),de(`🎬 Reproduciendo: ${g.title}`,"info")},mt=async()=>{if(!O||O.length===0){B(null),z(null);return}const g=JSON.stringify({videos:O.map($=>$.id),sequenceLength:O.length});if(!(q===g&&L)){w(!0),z(null);try{if(console.log("🎬 Generando preview en tiempo real..."),O.filter(R=>R.videoUrl).length===0)throw new Error("No hay videos válidos en la secuencia");B("sequence-timeline"),J(g),console.log("✅ Preview en tiempo real generado (modo timeline)")}catch($){console.error("❌ Error al generar preview en tiempo real:",$),z($.message)}finally{w(!1)}}},C=(g,$)=>{he(R=>{const N=R[g]||[];if(N.includes($)){const _e=N.filter(tt=>tt!==$);if(_e.length===0){const{[g]:tt,...ft}=R;return ft}else return{...R,[g]:_e}}else return{...R,[g]:[...N,$]}})},K=(g,$)=>{var R;return((R=re[g])==null?void 0:R.includes($))||!1},Xe=()=>{const g=[];return m.forEach($=>{const R=re[$.key];Array.isArray(R)&&R.forEach(N=>{g.push({tag:N,categoryKey:$.key,color:$.color})})}),g},Pe=async()=>{if(O.length===0)return null;try{const g=O[0];if(g.thumbnailUrl)return g.thumbnailUrl;const{getStorage:$,ref:R,getDownloadURL:N}=await pt(async()=>{const{getStorage:ft,ref:jt,getDownloadURL:Et}=await import("./tag-CccaPfO5.js").then(Nt=>Nt.i);return{getStorage:ft,ref:jt,getDownloadURL:Et}},__vite__mapDeps([0,1,2])),be=$(),_e=R(be,g.videoUrl);return await N(_e)}catch(g){return console.error("Error al generar thumbnail:",g),null}};return s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Constructor de Secuencias"}),e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:[O.length," videos"]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ot,{className:"w-5 h-5"})})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"md:col-span-2 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("input",{type:"text",placeholder:"Nombre de la secuencia...",value:we,onChange:g=>ie(g.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),!we.trim()&&O.length>0&&e.jsx("p",{className:"text-xs text-orange-600",children:"⚠️ Añade un nombre para poder guardar la secuencia"})]}),e.jsx("textarea",{placeholder:"Descripción (opcional)...",value:pe,onChange:g=>d(g.target.value),rows:"2",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]}),e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-center",children:"Número de videos:"}),e.jsx("input",{type:"number",value:Se,onChange:g=>Ee(Math.max(1,parseInt(g.target.value)||5)),min:"1",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-center text-sm",placeholder:"5"}),O.length>0&&e.jsx("div",{className:"text-xs text-gray-500 text-center",children:(()=>{const g=O[O.length-1],$=t.filter(N=>!O.some(be=>be.id===N.id)&&I(g,N)),R=Se-O.length;return`${$.length} compatibles disponibles (necesitas ${R})`})()})]}),e.jsxs("button",{onClick:Be,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-colors",children:[e.jsx(xs,{className:"w-4 h-4"}),e.jsxs("span",{children:["Completar hasta ",Se]})]}),e.jsxs("button",{onClick:Ge,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors",children:[e.jsx(vt,{className:"w-4 h-4"}),e.jsx("span",{children:"Limpiar"})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center",children:[e.jsx(Ye,{className:"h-5 w-5 text-blue-600 mr-2"}),"Preview en Tiempo Real"]}),H&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"}),e.jsx("span",{className:"text-gray-600",children:"Generando preview..."})]}),v&&e.jsx("div",{className:"flex items-center justify-center py-8 text-red-600",children:e.jsxs("span",{children:["❌ Error: ",v]})}),!H&&!v&&L&&e.jsx("div",{className:"space-y-4",children:L==="sequence-timeline"?e.jsx(fs,{videos:O,currentBPM:Re,className:"w-full h-96",showControls:!0,autoplay:!1,loop:!1,muted:!1}):e.jsx("div",{className:"bg-black rounded-lg overflow-hidden",children:e.jsx(Dt,{src:L,className:"w-full h-96 object-contain",showControls:!0,autoplay:!1,loop:!1,muted:!1,size:"medium",videoTitle:"Preview de Secuencia"})})}),!H&&!v&&O.length===0&&e.jsx("div",{className:"flex items-center justify-center py-8 text-gray-500",children:e.jsx("span",{children:"Añade videos a la secuencia para ver el preview"})})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-700",children:["Secuencia Actual (",O.length," videos)"]})}),O.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 bg-gray-50 rounded-lg",children:[e.jsx(Zt,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No hay videos en la secuencia"}),e.jsx("p",{className:"text-sm",children:"Selecciona videos de la galería para comenzar"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:O.map((g,$)=>e.jsxs("div",{draggable:!0,onDragStart:()=>Q($),onDragOver:R=>se(R,$),onDragEnter:R=>xe(R,$),onDragLeave:A,onDrop:R=>te(R,$),onDragEnd:ce,style:le($),className:"bg-white rounded-lg shadow-md overflow-hidden border border-gray-100 hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02] relative",children:[e.jsxs("div",{className:"absolute top-2 left-2 z-10 flex items-center space-x-2",children:[e.jsxs("div",{className:"bg-purple-500 text-white px-2 py-1 rounded-full text-sm font-bold shadow-lg",children:["#",$+1]}),e.jsx("button",{onClick:()=>U($),className:"bg-red-500 text-white p-1 rounded-full hover:bg-red-600 transition-colors shadow-lg",title:"Eliminar de la secuencia",children:e.jsx(vt,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsx(Ka,{className:"w-5 h-5 text-gray-400 cursor-grab hover:text-gray-600 transition-colors"})}),e.jsx("div",{className:"relative group",children:e.jsxs("div",{className:"w-full aspect-video bg-gradient-to-br from-gray-100 to-gray-200 relative overflow-hidden flex items-center justify-center",children:[g.thumbnailUrl&&g.thumbnailUrl!=="https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO"?e.jsx("img",{src:g.thumbnailUrl,alt:g.title,className:"w-full h-full object-cover",loading:"lazy",onError:R=>{R.target.style.display="none",R.target.nextSibling.style.display="flex"}}):null,e.jsxs("div",{className:`flex flex-col items-center justify-center text-gray-500 ${g.thumbnailUrl&&g.thumbnailUrl!=="https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO"?"hidden":"flex"}`,children:[e.jsx("svg",{className:"w-12 h-12 mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),e.jsx("span",{className:"text-sm font-medium",children:g.title})]}),e.jsx("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-sm font-medium",children:g.resolution&&g.resolution!=="Unknown"?g.resolution:"HD"}),e.jsx("button",{onClick:()=>et(g),className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("svg",{className:"w-12 h-12 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})})]})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-800 text-lg truncate",children:g.title}),e.jsxs("div",{className:"flex items-center space-x-1",children:[[1,2,3,4,5].map(R=>{const N=(g.rating||0)>=R;return e.jsx("svg",{className:`h-4 w-4 ${N?"text-yellow-400 fill-current":"text-gray-300"}`,fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})},R)}),e.jsxs("span",{className:"text-xs font-medium text-gray-500 ml-1",children:["(",g.rating||0,")"]})]})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:g.description||"Sin descripción"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:(()=>{const R=ve(g);return R.length>0?R.map(({tag:N,categoryKey:be,color:_e})=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${y(_e)}`,children:N},`${be}-${N}`)):e.jsx("span",{className:"text-gray-400 text-sm",children:"Sin etiquetas"})})()}),(()=>{const R=Fe(g);return R.length>0?e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-blue-600 uppercase tracking-wide",children:"Iniciales:"})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(({tag:N,categoryKey:be,color:_e})=>e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-sm",children:N},`inicial-${be}-${N}`))})]}):null})(),(()=>{const R=Me(g);return R.length>0?e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-green-600 uppercase tracking-wide",children:"Finales:"})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(({tag:N,categoryKey:be,color:_e})=>e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-sm",children:N},`final-${be}-${N}`))})]}):null})(),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"font-medium",children:[(g.fileSize/(1024*1024)).toFixed(2)," MB"]}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsx("span",{className:"text-gray-600",children:g.resolution&&g.resolution!=="Unknown"?g.resolution:"HD"}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ht,{className:"h-3 w-3 text-purple-500"}),e.jsxs("span",{className:"font-medium text-purple-600",children:[g.bpm||"N/A"," BPM"]})]})]}),e.jsxs("button",{onClick:()=>Je(g),className:`flex items-center space-x-1 transition-colors duration-200 p-1 rounded hover:bg-red-50 ${g.userLiked?"text-red-500":"text-gray-400 hover:text-red-500"}`,title:g.userLiked?"Quitar like":"Dar like",children:[e.jsx(Tt,{className:`h-4 w-4 ${g.userLiked?"fill-current":""}`}),e.jsx("span",{className:"font-medium",children:g.likes||0})]})]})]})]},`${g.id}-${$}`))})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"h-5 w-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Tags de Secuencia"})]}),e.jsx("button",{onClick:()=>ne(!je),className:"p-1 text-gray-500 hover:text-gray-700 transition-colors",title:je?"Expandir tags":"Colapsar tags",children:e.jsx("svg",{className:`w-4 h-4 transform transition-transform ${je?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),(()=>{const g=Xe();return g.length>0?e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(({tag:$,categoryKey:R,color:N})=>e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${y(N)} flex items-center space-x-1`,children:[e.jsx("span",{children:$}),e.jsx("button",{onClick:()=>C(R,$),className:"ml-1 hover:bg-black hover:bg-opacity-20 rounded-full p-0.5",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},`${R}-${$}`))})}):null})(),e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-in-out ${je?"max-h-0 opacity-0":"max-h-96 opacity-100"}`,children:e.jsx("div",{className:"space-y-4",children:m.map(g=>e.jsxs("div",{className:"border-t border-gray-100 pt-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center space-x-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${y(g.color).replace("text-","bg-")}`}),e.jsx("span",{children:g.name})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:g.tags.map($=>e.jsx("button",{onClick:()=>C(g.key,$),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${K(g.key,$)?y(g.color):"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:$},$))})]},g.key))})})]})}),e.jsxs("div",{className:"flex space-x-3 pt-4 border-t",children:[e.jsxs("button",{onClick:S,disabled:O.length===0||!we.trim(),className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:[e.jsx(Fa,{className:"w-4 h-4"}),e.jsx("span",{children:k?"Actualizar Secuencia":"Guardar Secuencia"})]}),e.jsx("button",{onClick:We,className:"px-6 py-2 border border-gray-300 hover:bg-gray-50 rounded-lg transition-colors",children:"Cancelar"})]})]})]}),f&&T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-95 flex items-center justify-center z-50 p-4",onClick:()=>V(!1),children:e.jsxs("div",{className:"bg-black rounded-lg overflow-hidden w-full max-w-6xl max-h-[95vh] flex flex-col",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700 bg-gray-900",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:T.title}),e.jsx("button",{onClick:()=>V(!1),className:"text-gray-400 hover:text-white text-2xl font-bold p-2 hover:bg-gray-800 rounded transition-colors",children:"×"})]}),e.jsx("div",{className:"flex-1 bg-black flex items-center justify-center p-4",children:e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(Dt,{src:T.videoUrl,className:"max-w-full max-h-full object-contain",showControls:!0,autoplay:!1,loop:!1,muted:!1,resolutions:Ke(T),currentResolution:"auto",videoTitle:T.title,size:"fullscreen"})})})]})}),e.jsx(Lt,{isOpen:Ae.isOpen,onClose:()=>fe({isOpen:!1,type:null}),onConfirm:ue,title:Ae.type==="cancel"?"¿Cancelar secuencia?":"¿Limpiar secuencia?",message:Ae.type==="cancel"?"¿Estás seguro de que quieres cancelar? Se perderán todos los cambios.":"¿Estás seguro de que quieres limpiar la secuencia actual?",confirmText:"Confirmar",cancelText:"Cancelar"}),Ie.map(g=>e.jsx(At,{message:g.message,type:g.type,onClose:()=>$e(g.id)},g.id)),e.jsx(kr,{isOpen:ze,onClose:()=>Ne(!1),videos:O,sequenceName:we||"Secuencia"})]}):null},Er=({src:s,alt:a,className:t="",fallbackSrc:n="/placeholder-video.svg",showPlayIcon:o=!1,...c})=>{const[h,x]=l.useState(!1),[i,m]=l.useState(!0),y=()=>{m(!1),x(!1)},p=()=>{m(!1),x(!0)},T=!s||s===null||s===void 0||s==="https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO"||s==="https://via.placeholder.com/300x200/1a1a1a/ffffff?text=EVENTO",j=T||h?n:s;return e.jsxs("div",{className:`relative ${t}`,...c,children:[i&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-200 animate-pulse flex items-center justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-8 h-8 border-3 border-gray-300 border-t-pink-500 rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-0 w-8 h-8 border-3 border-transparent border-t-pink-300 rounded-full animate-spin",style:{animationDelay:"-0.5s"}})]})}),e.jsx("img",{src:j,alt:a,className:`w-full h-full object-cover transition-all duration-300 ${i?"opacity-0 scale-95":"opacity-100 scale-100"}`,onLoad:y,onError:p,loading:"lazy",decoding:"async",fetchPriority:"high"}),o&&!i&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-20 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 bg-white bg-opacity-90 rounded-full flex items-center justify-center",children:e.jsx(Ye,{className:"w-4 h-4 text-gray-800 fill-current"})})}),(h||T)&&!i&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Gs,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"Sin miniatura"}),o&&e.jsx("div",{className:"mt-2 w-6 h-6 bg-white bg-opacity-90 rounded-full flex items-center justify-center mx-auto",children:e.jsx(Ye,{className:"w-3 h-3 text-gray-600 fill-current"})})]})})]})},Cr=({sequences:s,onDeleteSequence:a,onPlaySequence:t,onEditSequence:n,onEditThumbnail:o,onDownloadSequence:c})=>{var B;const[h,x]=l.useState([]),[i,m]=l.useState({isOpen:!1,sequence:null}),{getColorClasses:y}=Mt("figuras","salsa"),{getSequenceConfig:p}=bs(),T=(v,z="success")=>{const q=Date.now();x(J=>[...J,{id:q,message:v,type:z}])},j=v=>{x(z=>z.filter(q=>q.id!==v))},f=v=>{m({isOpen:!0,sequence:v})},V=async()=>{try{await a(i.sequence.id),T("Secuencia eliminada exitosamente")}catch{T("Error al eliminar la secuencia","error")}m({isOpen:!1,sequence:null})},H=v=>{try{t(v),T("Reproduciendo secuencia")}catch{T("Error al reproducir la secuencia","error")}},w=v=>{try{c?(c(v),T("Abriendo opciones de descarga")):T("Funcionalidad de descarga no disponible","warning")}catch{T("Error al abrir descarga","error")}},L=v=>{if(!v.tags||Object.keys(v.tags).length===0)return[];const z=[];return[{key:"dificultad",color:"red"},{key:"estilo",color:"blue"},{key:"nivel",color:"green"},{key:"figura",color:"purple"},{key:"posicion",color:"orange"},{key:"transicion",color:"teal"}].forEach(J=>{const re=v.tags[J.key];Array.isArray(re)&&re.forEach(he=>{z.push({tag:he,categoryKey:J.key,color:J.color})})}),z};return s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ye,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay secuencias guardadas"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Crea tu primera secuencia usando el constructor de secuencias"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"¿Cómo crear una secuencia?"}),e.jsxs("ol",{className:"text-sm text-blue-800 space-y-1 text-left",children:[e.jsx("li",{children:'1. Haz clic en "CREAR SECUENCIA"'}),e.jsx("li",{children:'2. Añade videos con el botón "+" de la galería'}),e.jsx("li",{children:"3. Escribe un nombre para la secuencia"}),e.jsx("li",{children:'4. Haz clic en "Guardar Secuencia"'}),e.jsx("li",{children:"5. ¡Listo! Aparecerá aquí automáticamente"})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:`grid gap-6 ${p().grid}`,children:s.map(v=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden border border-gray-100 hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02]",children:[e.jsx("div",{className:"relative group",children:e.jsxs("div",{className:`w-full ${p().aspect} bg-gradient-to-br from-gray-100 to-gray-200 relative overflow-hidden flex items-center justify-center`,children:[v.thumbnailUrl?e.jsx(Er,{src:v.thumbnailUrl,alt:v.name,className:"w-full h-full object-cover"}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-500",children:[e.jsx(Ye,{className:"w-12 h-12 mb-2 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium",children:v.name})]}),e.jsx("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-sm font-medium",children:v.resolution&&v.resolution!=="Unknown"?v.resolution:"HD"}),e.jsx("button",{onClick:z=>{z.stopPropagation(),o&&o(v)},className:"absolute top-2 right-2 bg-black bg-opacity-75 text-white p-1 rounded hover:bg-opacity-90 transition-colors",title:"Editar thumbnail",children:e.jsx(Gs,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>H(v),className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx(Ye,{className:"w-12 h-12 text-white"})})]})}),e.jsxs("div",{className:`${p().compact?"p-2":"p-4"}`,children:[e.jsxs("div",{className:`flex items-center justify-between ${p().compact?"mb-1":"mb-2"}`,children:[e.jsx("h3",{className:`font-semibold text-gray-800 ${p().titleSize} truncate`,children:v.name}),e.jsx("div",{className:"flex items-center space-x-1",children:e.jsxs("span",{className:`bg-blue-100 text-blue-800 px-2 py-1 rounded-full ${p().compact,"text-xs"} font-medium`,children:[v.videos.length," videos"]})})]}),p().showIcons?e.jsx("div",{className:"flex items-center justify-center text-gray-500 mb-2",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ms,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-xs font-medium",children:[v.videos.length," videos"]})]})}):e.jsx("p",{className:`text-gray-600 text-sm ${p().compact?"mb-2":"mb-3"} ${p().descriptionLines===1?"line-clamp-1":p().descriptionLines===2?"line-clamp-2":p().descriptionLines===3?"line-clamp-3":"line-clamp-4"}`,children:v.description||"Sin descripción"}),p().showTags&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:(()=>{const z=L(v);return z.length>0?z.map(({tag:q,categoryKey:J,color:re})=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${y(re)}`,children:q},`${J}-${q}`)):e.jsx("span",{className:"text-gray-400 text-sm",children:"Sin etiquetas"})})()}),p().showStats&&e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 pt-2 border-t border-gray-100",children:[!p().compact&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ms,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium",children:[v.videos.length," videos"]}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsx("span",{className:"text-gray-600",children:v.resolution&&v.resolution!=="Unknown"?v.resolution:"HD"})]}),e.jsxs("div",{className:`flex items-center space-x-2 ${p().compact?"w-full justify-center":""}`,children:[e.jsx("button",{onClick:()=>w(v),className:"text-gray-400 hover:text-green-500 transition-colors duration-200 p-1 rounded hover:bg-green-50",title:"Descargar secuencia",children:e.jsx(ut,{className:`${p().compact?"h-3 w-3":"h-4 w-4"}`})}),e.jsx("button",{onClick:()=>n(v),className:"text-gray-400 hover:text-blue-500 transition-colors duration-200 p-1 rounded hover:bg-blue-50",title:"Editar secuencia",children:e.jsx(Ja,{className:`${p().compact?"h-3 w-3":"h-4 w-4"}`})}),e.jsx("button",{onClick:()=>f(v),className:"text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 rounded hover:bg-red-50",title:"Eliminar secuencia",children:e.jsx(vt,{className:`${p().compact?"h-3 w-3":"h-4 w-4"}`})})]})]})]})]},v.id))}),e.jsx(Lt,{isOpen:i.isOpen,onClose:()=>m({isOpen:!1,sequence:null}),onConfirm:V,title:"¿Eliminar secuencia?",message:`¿Estás seguro de que quieres eliminar la secuencia "${(B=i.sequence)==null?void 0:B.name}"? Esta acción no se puede deshacer.`,confirmText:"Eliminar",cancelText:"Cancelar",confirmClassName:"bg-red-500 hover:bg-red-600"}),h.map(v=>e.jsx(At,{message:v.message,type:v.type,onClose:()=>j(v.id)},v.id))]})},Bs=({type:s="video"})=>{const{videoCardSize:a,sequenceCardSize:t,setVideoCardSize:n,setSequenceCardSize:o,availableSizes:c,sizeLabels:h}=bs(),x=s==="video"?a:t,i=s==="video"?n:o,m={small:e.jsx(Xa,{className:"h-4 w-4"}),medium:e.jsx(zs,{className:"h-4 w-4"}),large:e.jsx(zs,{className:"h-4 w-4"}),"extra-large":e.jsx(er,{className:"h-4 w-4"})},y={small:"from-gray-400 to-gray-500",medium:"from-blue-400 to-blue-500",large:"from-purple-400 to-purple-500","extra-large":"from-pink-400 to-pink-500"};return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 mr-2",children:"Tamaño:"}),e.jsx("div",{className:"flex bg-gray-100 rounded-lg p-1",children:c.map(p=>e.jsxs("button",{onClick:()=>i(p),className:`flex items-center space-x-1 px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 ${x===p?`bg-gradient-to-r ${y[p]} text-white shadow-lg transform scale-105`:"text-gray-600 hover:text-gray-800 hover:bg-white"}`,title:`${h[p]} - ${p} cards`,children:[m[p],e.jsx("span",{className:"hidden sm:inline",children:h[p]})]},p))})]})},$r=({video:s,onLike:a,onEdit:t,onDelete:n,onAddToSequence:o,onDownload:c,onPlay:h,isVideoInSequence:x,isBuilderOpen:i,isVideoCompatible:m,type:y="video"})=>y==="video"?e.jsxs("div",{className:"flex items-center justify-center space-x-1 mt-2",children:[e.jsx("button",{onClick:h,className:"p-1 text-gray-400 hover:text-blue-500 transition-colors rounded",title:"Reproducir",children:e.jsx(Ye,{className:"h-3 w-3"})}),e.jsx("button",{onClick:a,className:`p-1 transition-colors rounded ${s.userLiked?"text-red-500":"text-gray-400 hover:text-red-500"}`,title:s.userLiked?"Quitar like":"Dar like",children:e.jsx(Tt,{className:`h-3 w-3 ${s.userLiked?"fill-current":""}`})}),e.jsx("button",{onClick:o,disabled:x,className:`p-1 transition-colors rounded ${x?"text-gray-300 cursor-not-allowed":i&&!m?"text-red-400 hover:text-red-500":"text-gray-400 hover:text-purple-500"}`,title:x?"Ya en secuencia":i&&!m?"Añadir forzadamente":"Añadir a secuencia",children:e.jsx(Zt,{className:"h-3 w-3"})}),e.jsx("button",{onClick:c,className:"p-1 text-gray-400 hover:text-green-500 transition-colors rounded",title:"Descargar",children:e.jsx(ut,{className:"h-3 w-3"})}),e.jsx("button",{onClick:t,className:"p-1 text-gray-400 hover:text-blue-500 transition-colors rounded",title:"Editar",children:e.jsx(Gt,{className:"h-3 w-3"})}),e.jsx("button",{onClick:n,className:"p-1 text-gray-400 hover:text-red-500 transition-colors rounded",title:"Eliminar",children:e.jsx(vt,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"flex items-center justify-center space-x-1 mt-2",children:[e.jsx("button",{onClick:h,className:"p-1 text-gray-400 hover:text-blue-500 transition-colors rounded",title:"Reproducir secuencia",children:e.jsx(Ye,{className:"h-3 w-3"})}),e.jsx("button",{onClick:c,className:"p-1 text-gray-400 hover:text-green-500 transition-colors rounded",title:"Descargar secuencia",children:e.jsx(ut,{className:"h-3 w-3"})}),e.jsx("button",{onClick:t,className:"p-1 text-gray-400 hover:text-blue-500 transition-colors rounded",title:"Editar secuencia",children:e.jsx(Gt,{className:"h-3 w-3"})}),e.jsx("button",{onClick:n,className:"p-1 text-gray-400 hover:text-red-500 transition-colors rounded",title:"Eliminar secuencia",children:e.jsx(vt,{className:"h-3 w-3"})})]}),_r=()=>{var ks,Ss;const[s,a]=l.useState(!1),[t,n]=l.useState({isOpen:!1,video:null}),[o,c]=l.useState([]),[h,x]=l.useState(!0),[i,m]=l.useState([]),[y,p]=l.useState({isOpen:!1,video:null}),[T,j]=l.useState([]),[f,V]=l.useState(""),[H,w]=l.useState(!1),[L,B]=l.useState("videos"),[v,z]=l.useState("idle"),[q,J]=l.useState({isOpen:!1,type:null}),[re,he]=l.useState({isOpen:!1,sequence:null}),[je,ne]=l.useState({isOpen:!1,sequence:null}),[ze,Ne]=l.useState({isOpen:!1}),[Re,De]=l.useState(!1),[ve,Fe]=l.useState(null),[Me,O]=l.useState(!1),[we,pe]=l.useState(null),[k,F]=l.useState(!1),[U,G]=l.useState([]),[W,Z]=l.useState("none"),[ie,d]=l.useState(!1),[M,D]=l.useState([]),[_,I]=l.useState(!0),{user:Q}=Jt(),{getVideoConfig:se,getSequenceConfig:xe}=bs(),{addVideoToSequence:A,removeVideoFromSequence:te,sequence:ce,sequenceName:le,clearSequence:Ie,isBuilderOpen:ke,toggleBuilder:Ae,showAllVideos:fe,toggleShowAllVideos:Se,getFilteredVideos:Ee,isVideoInSequence:de,isVideoCompatible:$e,checkCompatibility:Je,loadSequence:Be}=Ws(),[S,We]=l.useState("salsa"),{availableStyles:Ge,getGradientClasses:ue,categoriesList:Ke,getColorClasses:et}=Mt("figuras",S),mt=r=>{G(u=>u.includes(r)?u.filter(E=>E!==r):[...u,r])},C=r=>{A(r),ke||Ae()},K={Music:Ht,Heart:Tt,Star:Ds,Zap:Ia};l.useEffect(()=>{z("syncing");const r=Ea(S,u=>{c(u),x(!1),z("idle")});return()=>{r()}},[S]),l.useEffect(()=>{o.length>0&&Q&&(async()=>{const u=await Promise.all(o.map(async E=>{try{const[P,Y]=await Promise.all([$a(E.id,Q.uid),Ta(E.id,Q.uid)]);return{...E,userLiked:P.userLiked,isFavorite:Y.isFavorite}}catch(P){return console.error("Error al verificar like/favorito para video:",E.id,P),{...E,userLiked:!1,isFavorite:!1}}}));c(u)})()},[o.length,Q]),l.useEffect(()=>{if(S){I(!0);try{const r=vr(S,u=>{D(u),I(!1)});return()=>{r()}}catch(r){console.error("❌ Error al suscribirse a secuencias:",r),I(!1)}}},[S]);const Xe=async r=>{N(`${r.title} subido exitosamente`,"success")},Pe=r=>{n({isOpen:!0,video:r})},g=()=>{n({isOpen:!1,video:null})},$=r=>{c(u=>u.map(E=>E.id===r.id?r:E)),N(`${r.title} actualizado exitosamente`,"success")},R=async r=>{if(!Q){N("Debes iniciar sesión para dar like","error");return}try{const u=await ms(r.id,Q.uid);if(u.success){c(Y=>Y.map(ye=>ye.id===r.id?{...ye,likes:u.likes,likedBy:u.likedBy,userLiked:u.userLiked,isFavorite:u.isFavorite}:ye));const E=u.userLiked?"dado like a":"quitado like de",P=u.isFavorite?"y agregado a favoritos":"y removido de favoritos";N(`Has ${E} "${r.title}" ${P}`,"success")}else N("Error al actualizar like","error")}catch(u){console.error("Error al manejar like:",u),N("Error al actualizar like","error")}},N=(r,u="success")=>{const E=Date.now();m(P=>[...P,{id:E,message:r,type:u}])},be=r=>{m(u=>u.filter(E=>E.id!==r))},_e=async r=>{try{const u={...r,style:S};if(r.id){const E=await yr(r.id,u);N("✅ Secuencia actualizada exitosamente")}else{const E=await br(u);N('✅ Secuencia guardada exitosamente. Ve a "GALERÍA DE SECUENCIAS" para verla.')}}catch(u){throw console.error("❌ Error al guardar secuencia:",u),N("Error al guardar la secuencia","error"),u}},tt=async r=>{try{await wr(r),N("Secuencia eliminada exitosamente")}catch(u){throw console.error("Error al eliminar secuencia:",u),N("Error al eliminar la secuencia","error"),u}},ft=r=>{pe(r),F(!0),N(`🎬 Reproduciendo secuencia: ${r.name}`,"info")},jt=r=>{ce.length>0||le.trim()?he({isOpen:!0,sequence:r}):(Be(r),N(`Secuencia "${r.name}" cargada para edición`))},Et=()=>{const r=re.sequence;r&&(Be(r),N(`Secuencia "${r.name}" cargada para edición`)),he({isOpen:!1,sequence:null})},Nt=()=>{he({isOpen:!1,sequence:null})},as=r=>{ne({isOpen:!0,sequence:r})},Pt=()=>{ne({isOpen:!1,sequence:null})},Ft=r=>{Fe(r),O(!0),N(`🎬 Reproduciendo: ${r.title}`,"info")},b=()=>{O(!1),Fe(null)},X=()=>{F(!1),pe(null)},Ce=async r=>{try{const u=await Ps(r.videoPath,r.thumbnailPath);if(!u.success)if(u.error&&u.error.includes("thumbnails")){if(!(await Ps(r.videoPath,null)).success){N(`Error al eliminar archivos: ${u.error}`,"error");return}}else{N(`Error al eliminar archivos: ${u.error}`,"error");return}const E=await Aa(r.id);if(!E.success){N(`Error al eliminar metadatos: ${E.error}`,"error");return}c(P=>P.filter(ye=>ye.id!==r.id)),N(`${r.title} eliminado correctamente`,"success")}catch(u){console.error("❌ Error deleting video:",u),N("Error inesperado al eliminar video","error")}},Te=r=>{p({isOpen:!0,video:r})},st=()=>{p({isOpen:!1,video:null})},at=async r=>{try{if(z("syncing"),N("Iniciando limpieza de datos...","info"),r==="update"){const u=await Ra();u.success?N(`✅ ${u.updatedCount} videos actualizados`,"success"):N(`❌ Error: ${u.error}`,"error")}else if(r==="cleanup"){const u=await Ls(),E=await qa(u);E.success?N(`🧹 ${E.orphanedVideosDeleted} videos y ${E.orphanedThumbnailsDeleted} thumbnails huérfanos eliminados`,"success"):N(`❌ Error: ${E.error}`,"error")}else if(r==="cleanup-tags"){const u=await Da();u.success?N(`🏷️ ${u.updatedCount} videos actualizados con tags limpios`,"success"):N(`❌ Error: ${u.error}`,"error")}else if(r==="delete-all"){if(!window.confirm("¿Estás seguro de que quieres eliminar TODOS los videos? Esta acción no se puede deshacer.")){z("idle");return}const E=await Ma();if(!E.success){N(`❌ Error eliminando documentos: ${E.error}`,"error"),z("idle");return}const P=await Ba();if(!P.success){N(`❌ Error eliminando archivos: ${P.error}`,"error"),z("idle");return}N(`🗑️ ${E.deletedCount} videos eliminados completamente`,"success")}z("idle"),J({isOpen:!1,type:null})}catch(u){console.error("Error en limpieza:",u),N(`❌ Error inesperado: ${u.message}`,"error"),z("idle")}},It=r=>{J({isOpen:!0,type:r})},ta=()=>{J({isOpen:!1,type:null})},sa=async()=>{try{N("Ejecutando diagnóstico de videos...","info");const r=await La();if(r.success){let u=`Diagnóstico: ${r.totalVideos} videos total, ${r.salsaVideos} de salsa`;r.fig003Found?u+=" ✅ Fig003 encontrado":u+=" ❌ Fig003 NO encontrado",r.videosWithoutResolution>0&&(u+=` ⚠️ ${r.videosWithoutResolution} sin resolución`),N(u,"success")}else N(`Error en diagnóstico: ${r.error}`,"error")}catch(r){console.error("Error ejecutando diagnóstico:",r),N("Error al ejecutar diagnóstico","error")}},aa=async()=>{try{N("🔄 Actualizando resoluciones de videos...","info");const u=(await Ls()).filter(P=>!P.resolution||P.resolution==="Unknown");if(u.length===0){N("✅ Todos los videos ya tienen resolución detectada","success");return}let E=0;for(const P of u)try{const Y=document.createElement("video");Y.crossOrigin="anonymous",await new Promise((ye,me)=>{Y.onloadedmetadata=()=>{const Le=Y.videoWidth,Ze=Y.videoHeight,lt=Math.max(Le,Ze);let rt="Unknown";lt>=3840?rt="4K":lt>=1920?rt="1080p":lt>=1280?rt="720p":lt>=854?rt="480p":rt="360p",_t(P.id,{resolution:rt,videoWidth:Le,videoHeight:Ze}),E++,ye()},Y.onerror=me,Y.src=P.videoUrl}),Y.remove()}catch(Y){console.error(`Error actualizando resolución para video ${P.id}:`,Y)}N(`✅ Resoluciones actualizadas: ${E} videos`,"success")}catch(r){console.error("Error al actualizar resoluciones:",r),N("Error al actualizar resoluciones","error")}},ra=async()=>{try{N("🔄 Iniciando migración REAL de videos a estructura organizada...","info");const r=await _a(o);if(r.success){let u=`✅ Migración REAL completada: ${r.successfulMigrations} videos movidos físicamente`;r.alreadyOrganized>0&&(u+=`, ${r.alreadyOrganized} ya organizados`),r.failedMigrations>0&&(u+=`, ${r.failedMigrations} fallidos`),N(u,"success"),window.location.reload()}else N(`❌ Error en migración: ${r.error}`,"error")}catch(r){console.error("Error ejecutando migración:",r),N("❌ Error al ejecutar migración","error")}},na=r=>{j(u=>u.includes(r)?u.filter(P=>P!==r):[...u,r])},oa=()=>{j([]),V("")},ws=r=>{Z(r)},la=(r,u)=>{if(!r.tags||!Ke.find(Y=>Y.key===u))return!1;const P=r.tags[u];return P&&Array.isArray(P)&&P.length>0},ia=r=>{if(W==="none")return r;const u=[...r];switch(W){case"name":return u.sort((E,P)=>E.title.localeCompare(P.title));case"name-desc":return u.sort((E,P)=>P.title.localeCompare(E.title));case"rating":return u.sort((E,P)=>(P.rating||0)-(E.rating||0));case"rating-desc":return u.sort((E,P)=>(E.rating||0)-(P.rating||0));case"likes":return u.sort((E,P)=>(P.likes||0)-(E.likes||0));case"likes-desc":return u.sort((E,P)=>(E.likes||0)-(P.likes||0));default:return u}},vs=r=>{if(!r.tags||Object.keys(r.tags).length===0)return[];const u=[];return Ke.forEach(E=>{const P=r.tags[E.key];Array.isArray(P)&&P.forEach(Y=>{u.push({tag:Y,categoryKey:E.key,color:E.color})})}),u},js=r=>{if(!r.tagsIniciales||Object.keys(r.tagsIniciales).length===0)return[];const u=[];return Ke.forEach(E=>{const P=r.tagsIniciales[E.key];Array.isArray(P)&&P.forEach(Y=>{u.push({tag:Y,categoryKey:E.key,color:E.color,type:"inicial"})})}),u},Ns=r=>{if(!r.tagsFinales||Object.keys(r.tagsFinales).length===0)return[];const u=[];return Ke.forEach(E=>{const P=r.tagsFinales[E.key];Array.isArray(P)&&P.forEach(Y=>{u.push({tag:Y,categoryKey:E.key,color:E.color,type:"final"})})}),u},Ut=r=>r.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim(),ca=(r,u)=>{if(!u||u.length===0)return!0;const E=Ut(r.title||""),P=Ut(r.description||""),Y=[];return r.tags&&Object.values(r.tags).forEach(ye=>{Array.isArray(ye)&&ye.forEach(me=>{Y.push(Ut(me))})}),u.every(ye=>{const me=Ut(ye);return!!(E.includes(me)||P.includes(me)||Y.some(Le=>Le.includes(me)))})},da=o.filter(r=>{const u=f.split(" ").map(me=>me.trim()).filter(me=>me.length>0),E=ca(r,u),P=T.length===0||T.every(me=>r.tags?Object.values(r.tags).some(Le=>Array.isArray(Le)&&Le.includes(me)):!1),Y=U.length===0||U.some(me=>la(r,me)),ye=!ie||r.isFavorite;return E&&P&&Y&&ye}),ua=Ee(da),zt=ia(ua),rs=async r=>{try{const{ref:u,getDownloadURL:E}=await pt(async()=>{const{ref:Le,getDownloadURL:Ze}=await import("./tag-CccaPfO5.js").then(lt=>lt.i);return{ref:Le,getDownloadURL:Ze}},__vite__mapDeps([0,1,2])),{storage:P}=await pt(async()=>{const{storage:Le}=await import("./index-CqYG162O.js").then(Ze=>Ze.ae);return{storage:Le}},__vite__mapDeps([1,2])),Y=u(P,r.videoPath),ye=await E(Y),me=document.createElement("a");me.href=ye,me.download=r.title||"video",me.target="_blank",me.rel="noopener noreferrer",document.body.appendChild(me),me.click(),document.body.removeChild(me),N("Descarga iniciada","success")}catch(u){console.error("Error en descarga:",u),N("Error al descargar el video","error")}};return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:`${Re?"w-full px-0":"max-w-6xl mx-auto px-6"} py-8`,children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-4xl font-bold mb-2",children:[e.jsx("span",{className:"text-pink-500",children:"FIGURAS"}),e.jsxs("span",{className:`bg-gradient-to-r ${ue(S)} bg-clip-text text-transparent`,children:[" - ",S.toUpperCase()]})]}),e.jsxs("p",{className:"text-gray-600 text-lg",children:["Galería de videos de figuras de ",S.toLowerCase()]})]}),e.jsx("div",{className:"flex flex-wrap justify-center gap-3 mb-8",children:Ge.map(r=>{const u=K[r.icon],E=S===r.key,P=ue(r.color);return e.jsxs("button",{onClick:()=>We(r.key),className:`relative flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${E?`bg-gradient-to-r ${P} text-white shadow-lg transform scale-105`:"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"}`,children:[u&&e.jsx(u,{className:"h-4 w-4"}),e.jsx("span",{children:r.name})]},r.name)})}),e.jsxs("div",{className:"max-w-2xl mx-auto mb-8",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ts,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx("input",{type:"text",placeholder:`Buscar en ${S.toLowerCase()}... (múltiples palabras, sin tildes)`,value:f,onChange:r=>V(r.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200"})]}),f.trim()&&e.jsx("div",{className:"mt-3 text-center",children:e.jsxs("div",{className:"inline-flex items-center space-x-2 px-4 py-2 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(Ts,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{className:"text-sm text-blue-700",children:["Buscando: ",e.jsxs("span",{className:"font-medium",children:['"',f,'"']})]}),e.jsxs("span",{className:"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded",children:[zt.length," resultado",zt.length!==1?"s":""]})]})})]}),Ke.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>w(!H),className:"flex items-center justify-center space-x-2 mx-auto px-6 py-3 bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 rounded-lg font-medium shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105",children:[e.jsx(Ga,{className:"h-5 w-5"}),e.jsxs("span",{children:["Filtros Avanzados por Tags - ",S]}),H?e.jsx(Qt,{className:"h-5 w-5"}):e.jsx(Xt,{className:"h-5 w-5"})]}),e.jsx("div",{className:`mt-4 transition-all duration-300 ease-in-out overflow-hidden ${H?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:e.jsx("div",{className:"space-y-4 bg-gray-50 rounded-lg p-6 border border-gray-200",children:Ke.map(r=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>mt(r.key),className:`w-full text-center font-medium py-2 px-4 rounded-lg transition-all duration-200 transform hover:scale-105 ${U.includes(r.key)?`bg-gradient-to-r ${ue(S)} text-white shadow-lg`:"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("span",{children:r.name}),U.includes(r.key)&&e.jsx("span",{className:"text-xs bg-white bg-opacity-20 px-2 py-1 rounded",children:"ACTIVO"})]})}),e.jsx("div",{className:"flex flex-wrap justify-center gap-2",children:r.tags.map(u=>e.jsx("button",{onClick:()=>na(u),className:`px-3 py-1 rounded-full text-sm font-medium transition-all duration-200 ${T.includes(u)?`bg-gradient-to-r ${ue(S)} text-white shadow-lg`:`${et(r.color)} hover:bg-opacity-80`}`,children:u},u))})]},r.key))})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mb-6",children:[e.jsxs("button",{onClick:()=>a(!0),className:`flex items-center justify-center space-x-2 px-6 py-3 bg-gradient-to-r ${ue(S)} text-white rounded-lg font-medium shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105`,children:[e.jsx(hs,{className:"h-5 w-5"}),e.jsxs("span",{children:["SUBIR VIDEO(S) A ",S.toUpperCase()]})]}),e.jsxs("button",{onClick:Ae,className:`flex items-center justify-center space-x-2 px-6 py-3 rounded-lg font-medium shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 ${ke?"bg-gradient-to-r from-red-500 to-pink-500 text-white":`bg-gradient-to-r ${ue(S)} hover:opacity-90 text-white`}`,children:[e.jsx(xs,{className:"h-5 w-5"}),e.jsx("span",{children:ke?"OCULTAR SECUENCIA":"CREAR SECUENCIA"})]})]}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-3 mb-6",children:[e.jsx("button",{onClick:()=>ws(W==="name"?"name-desc":"name"),className:`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${W==="name"||W==="name-desc"?`bg-gradient-to-r ${ue(S)} text-white shadow-lg`:"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:e.jsx("span",{children:W==="name"?"A-Z":W==="name-desc"?"Z-A":"A-Z"})}),e.jsxs("button",{onClick:()=>ws(W==="rating"?"rating-desc":"rating"),className:`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${W==="rating"||W==="rating-desc"?`bg-gradient-to-r ${ue(S)} text-white shadow-lg`:"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:[e.jsx(Ds,{className:"h-4 w-4"}),e.jsx("span",{children:W==="rating"?"Puntuación ↓":W==="rating-desc"?"Puntuación ↑":"Puntuación"})]}),e.jsxs("button",{onClick:()=>{ie?W==="likes"?Z("likes-desc"):W==="likes-desc"?Z("likes"):(d(!1),Z("none")):(d(!0),Z("likes"))},className:`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${ie?`bg-gradient-to-r ${ue(S)} text-white shadow-lg`:"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:[e.jsx(Tt,{className:"h-4 w-4"}),e.jsx("span",{children:ie?W==="likes"?"Favoritos ↓":W==="likes-desc"?"Favoritos ↑":"Ocultar Favoritos":"Mostrar Favoritos"})]})]}),ke&&e.jsx(Sr,{isOpen:!0,videos:o,onSaveSequence:_e,onToggleShowAll:Se,showAllVideos:fe,style:S,onToggleBuilder:Ae}),e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${v==="idle"?"bg-green-500":v==="syncing"?"bg-yellow-500 animate-pulse":"bg-red-500"}`}),e.jsx("span",{className:"text-sm text-gray-600",children:v==="idle"?"✅ Sincronizado con Firebase":v==="syncing"?"🔄 Sincronizando...":"❌ Error de sincronización"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:sa,disabled:v==="syncing",className:"px-3 py-1 text-xs bg-purple-500 text-white rounded hover:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"🔍 Diagnóstico"}),e.jsx("button",{onClick:aa,disabled:v==="syncing",className:"px-3 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"📐 Actualizar Resoluciones"}),e.jsx("button",{onClick:()=>It("update"),disabled:v==="syncing",className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"🔧 Actualizar Rutas"}),e.jsx("button",{onClick:()=>It("cleanup"),disabled:v==="syncing",className:"px-3 py-1 text-xs bg-yellow-500 text-white rounded hover:bg-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"🧹 Limpiar Huérfanos"}),e.jsx("button",{onClick:()=>It("cleanup-tags"),disabled:v==="syncing",className:"px-3 py-1 text-xs bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"🏷️ Limpiar Tags"}),e.jsx("button",{onClick:ra,disabled:v==="syncing",className:"px-3 py-1 text-xs bg-indigo-500 text-white rounded hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"Mover físicamente videos existentes a estructura organizada (videos/page/style/)",children:"📁 Migrar Videos REAL"}),e.jsx("button",{onClick:()=>It("delete-all"),disabled:v==="syncing",className:"px-3 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"🗑️ Eliminar Todo"})]})]})}),e.jsxs("div",{className:"flex justify-center gap-4 mb-8",children:[e.jsxs("button",{onClick:()=>B("videos"),className:`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${L==="videos"?`bg-gradient-to-r ${ue(S)} text-white shadow-lg transform scale-105`:"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:[e.jsx(Ht,{className:"h-6 w-6"}),e.jsx("span",{children:"GALERÍA DE VIDEOS"})]}),e.jsxs("button",{onClick:()=>B("secuencias"),className:`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${L==="secuencias"?`bg-gradient-to-r ${ue(S)} text-white shadow-lg transform scale-105`:"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:[e.jsx(Zt,{className:"h-6 w-6"}),e.jsxs("span",{children:["GALERÍA DE SECUENCIAS (",M.length,")"]})]})]}),L==="videos"&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-800",children:["Videos de ",S.toLowerCase()," (",zt.length,")"]}),(U.length>0||W!=="none"||ie)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[U.length>0&&`Filtrado por: ${U.join(", ")} `,W!=="none"&&`• Ordenado por: ${W} `,ie&&"• Solo favoritos"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Bs,{type:"video"}),e.jsxs("button",{onClick:()=>De(!Re),className:`flex items-center space-x-2 px-3 py-2 rounded-lg font-medium transition-all duration-200 ${Re?`bg-gradient-to-r ${ue(S)} text-white shadow-lg`:"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"}`,title:Re?"Modo compacto":"Modo ancho completo",children:[Re?e.jsx(Ya,{className:"h-4 w-4"}):e.jsx(Qa,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:Re?"Compacto":"Ancho completo"})]}),ke&&e.jsx("button",{onClick:Se,className:`flex items-center space-x-2 px-3 py-1 rounded-lg text-sm font-medium transition-colors ${fe?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,title:fe?"Mostrar solo videos compatibles":"Mostrar todos los videos",children:fe?e.jsxs(e.Fragment,{children:[e.jsx(Ua,{className:"h-4 w-4"}),e.jsx("span",{children:"Ocultar Incompatibles"})]}):e.jsxs(e.Fragment,{children:[e.jsx(za,{className:"h-4 w-4"}),e.jsx("span",{children:"Mostrar Todos"})]})}),(T.length>0||U.length>0||W!=="none"||ie)&&e.jsxs("button",{onClick:()=>{oa(),G([]),Z("none"),d(!1)},className:"text-sm text-gray-500 hover:text-gray-700 transition-colors duration-200",children:["Limpiar todos los filtros ",e.jsx(ot,{className:"h-4 w-4 ml-1"})]})]})]}),h?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Cargando videos..."})]}):o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("p",{className:"text-gray-500 text-lg",children:["No hay videos de ",S.toLowerCase()," aún"]}),e.jsxs("p",{className:"text-gray-400 text-sm mt-2",children:["Sube tu primer video de ",S.toLowerCase()," usando el botón de arriba"]})]}):e.jsx("div",{className:`grid gap-6 ${se().grid}`,children:zt.map(r=>e.jsxs("div",{className:`bg-white rounded-lg shadow-md overflow-hidden border hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02] ${ke&&!$e(r)?"border-red-200 opacity-75":"border-gray-100"}`,children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:`w-full ${se().aspect} bg-gradient-to-br from-gray-100 to-gray-200 relative overflow-hidden flex items-center justify-center`,children:[r.thumbnailUrl&&r.thumbnailUrl!=="https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO"?e.jsx("img",{src:r.thumbnailUrl,alt:r.title,className:"w-full h-full object-cover",loading:"lazy",onError:u=>{u.target.style.display="none",u.target.nextSibling.style.display="flex"}}):null,e.jsxs("div",{className:`flex flex-col items-center justify-center text-gray-500 ${r.thumbnailUrl&&r.thumbnailUrl!=="https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO"?"hidden":"flex"}`,children:[e.jsx("svg",{className:"w-12 h-12 mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),e.jsx("span",{className:"text-sm font-medium",children:r.title})]}),e.jsx("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-sm font-medium",children:r.resolution&&r.resolution!=="Unknown"?r.resolution:"HD"}),ke&&e.jsx("div",{className:`absolute top-2 right-2 p-1 rounded-full text-xs font-bold ${$e(r)?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:$e(r)?"✅":"❌"})]}),e.jsx("button",{onClick:async()=>{try{const u=document.createElement("div");u.className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50";const E=document.createElement("div");E.className="bg-white rounded-lg p-6 max-w-5xl w-full mx-4 max-h-[95vh] overflow-y-auto",E.onclick=ae=>ae.stopPropagation();const P=document.createElement("div");P.className="flex items-center justify-between mb-4",P.innerHTML=`
                             <h3 class="text-xl font-semibold text-gray-900">${r.title}</h3>
                             <button class="text-gray-400 hover:text-gray-600 transition-colors">
                               <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                               </svg>
                             </button>
                           `;const Y=document.createElement("div");Y.id="video-player-container",Y.className="w-full flex justify-center mb-6";const ye=document.createElement("div");ye.className="w-full max-w-3xl mx-auto";const me=document.createElement("div");me.className="mb-4",me.innerHTML=`
                             <p class="text-gray-600 text-sm">${r.description||"Sin descripción"}</p>
                           `;const Le=document.createElement("div");Le.className="flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg",Le.innerHTML=`
                              <div class="flex items-center space-x-4 text-sm text-gray-600">
                                <span class="font-medium">${(r.fileSize/(1024*1024)).toFixed(2)} MB</span>
                                <span class="text-gray-400">•</span>
                                <span class="font-medium">${r.resolution&&r.resolution!=="Unknown"?r.resolution:"HD"}</span>
                                <span class="text-gray-400">•</span>
                                <span class="font-medium">${r.duration?Math.floor(r.duration/60)+":"+String(Math.floor(r.duration%60)).padStart(2,"0"):"N/A"}</span>
                              </div>
                              <div class="flex items-center space-x-2">
                                <div class="flex items-center space-x-1">
                                  <div class="flex items-center space-x-1" title="Puntuación: ${r.rating||0}/5">
                                    ${[1,2,3,4,5].map(ae=>`<svg class="w-4 h-4 ${(r.rating||0)>=ae?"text-yellow-400 fill-current":"text-gray-300"}" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                      </svg>`).join("")}
                                    <span class="text-sm font-medium text-gray-600">${r.rating||0}</span>
                                  </div>
                                </div>
                                <button class="flex items-center space-x-1 ${r.userLiked?"text-red-500":"text-gray-400 hover:text-red-500"} transition-colors duration-200 p-2 rounded hover:bg-red-50" title="${r.userLiked?"Quitar like":"Dar like"}">
                                  <svg class="w-5 h-5 ${r.userLiked?"fill-current":""}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                  </svg>
                                  <span class="text-sm font-medium">${r.likes||0}</span>
                                </button>
                                <button class="text-gray-400 hover:text-green-500 transition-colors duration-200 p-2 rounded hover:bg-green-50" title="Descargar video">
                                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                  </svg>
                                </button>
                                <button class="text-gray-400 hover:text-blue-500 transition-colors duration-200 p-2 rounded hover:bg-blue-50" title="Editar video">
                                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                  </svg>
                                </button>
                              </div>
                            `;const Ze=document.createElement("div");Ze.className="mb-4";const lt=vs(r);if(lt.length>0){const ae=lt.map(({tag:Ue,categoryKey:nt,color:qe})=>`<span class="inline-block px-3 py-1 rounded-full text-sm font-medium ${et(qe)} mr-2 mb-2">${Ue}</span>`).join("");Ze.innerHTML=`
                               <h4 class="text-sm font-medium text-gray-700 mb-2">Etiquetas:</h4>
                               <div class="flex flex-wrap">${ae}</div>
                             `}else Ze.innerHTML=`
                               <h4 class="text-sm font-medium text-gray-700 mb-2">Etiquetas:</h4>
                               <span class="text-gray-400 text-sm">Sin etiquetas</span>
                             `;const rt=document.createElement("div");rt.className="mb-4";const ns=js(r);if(ns.length>0){const ae=ns.map(({tag:Ue})=>`<span class="inline-block px-3 py-1 rounded-full text-sm font-medium bg-gradient-to-r from-blue-500 to-purple-500 text-white mr-2 mb-2">${Ue}</span>`).join("");rt.innerHTML=`
                               <h4 class="text-sm font-medium text-blue-600 uppercase tracking-wide mb-2">Etiquetas Iniciales:</h4>
                               <div class="flex flex-wrap">${ae}</div>
                             `}const os=document.createElement("div");os.className="mb-4";const ls=Ns(r);if(ls.length>0){const ae=ls.map(({tag:Ue})=>`<span class="inline-block px-3 py-1 rounded-full text-sm font-medium bg-gradient-to-r from-green-500 to-teal-500 text-white mr-2 mb-2">${Ue}</span>`).join("");os.innerHTML=`
                               <h4 class="text-sm font-medium text-green-600 uppercase tracking-wide mb-2">Etiquetas Finales:</h4>
                               <div class="flex flex-wrap">${ae}</div>
                             `}ye.appendChild(me),ye.appendChild(Le),ye.appendChild(Ze),ns.length>0&&ye.appendChild(rt),ls.length>0&&ye.appendChild(os),E.appendChild(P),E.appendChild(Y),E.appendChild(ye),u.appendChild(E),document.body.appendChild(u);const{createRoot:ma}=await pt(async()=>{const{createRoot:ae}=await import("./index-CqYG162O.js").then(Ue=>Ue.c);return{createRoot:ae}},__vite__mapDeps([1,2])),Es=ma(Y);Es.render(Ca.createElement(Dt,{src:r.videoUrl,size:"large",loop:!0,initialShowControls:!0,autoplay:!0,muted:!1,className:"w-full max-w-3xl",resolutions:["auto","4k","1080p","720p","480p","360p"],currentResolution:"auto",videoTitle:r.title||"video",onResolutionChange:ae=>{}})),u._root=Es;const is=()=>{u._root&&u._root.unmount(),document.body.contains(u)&&document.body.removeChild(u)};P.querySelector("button").onclick=is,u.onclick=ae=>{ae.target===u&&is()},Le.querySelector('button[title="Descargar video"]').onclick=()=>{rs(r)},Le.querySelector('button[title="Editar video"]').onclick=()=>{is(),Pe(r)};const cs=Le.querySelector('div[title*="Puntuación"]'),Ot=cs.querySelectorAll("svg"),ha=cs.querySelector("span");Ot.forEach((ae,Ue)=>{const nt=Ue+1;ae.addEventListener("mouseenter",()=>{Ot.forEach((qe,Qe)=>{Qe<=Ue&&(qe.classList.add("text-yellow-400","fill-current"),qe.classList.remove("text-gray-300"))})}),ae.addEventListener("mouseleave",()=>{Ot.forEach((qe,Qe)=>{const ht=r.rating||0;Qe<ht?(qe.classList.add("text-yellow-400","fill-current"),qe.classList.remove("text-gray-300")):(qe.classList.remove("text-yellow-400","fill-current"),qe.classList.add("text-gray-300"))})}),ae.addEventListener("click",async()=>{try{const Qe=(r.rating||0)>=nt?0:nt;await _t(r.id,{rating:Qe}),r.rating=Qe,Ot.forEach((ht,Ct)=>{Ct<Qe?(ht.classList.add("text-yellow-400","fill-current"),ht.classList.remove("text-gray-300")):(ht.classList.remove("text-yellow-400","fill-current"),ht.classList.add("text-gray-300"))}),ha.textContent=Qe,cs.title=`Puntuación: ${Qe}/5`}catch(qe){console.error("Error al actualizar puntuación:",qe)}})});const Vt=Le.querySelector('button[title*="like"]');Vt.onclick=async()=>{if(!Q){alert("Debes iniciar sesión para dar like");return}try{const ae=await ms(r.id,Q.uid);if(ae.success){r.likes=ae.likes,r.likedBy=ae.likedBy,r.userLiked=ae.userLiked,c(ht=>ht.map(Ct=>Ct.id===r.id?{...Ct,likes:ae.likes,likedBy:ae.likedBy,userLiked:ae.userLiked}:Ct));const Ue=Vt.querySelector("svg"),nt=Vt,qe=Vt.querySelector("span");ae.userLiked?(Ue.classList.add("fill-current","text-red-500"),Ue.classList.remove("text-gray-400"),nt.classList.add("text-red-500"),nt.classList.remove("text-gray-400"),nt.title="Quitar like"):(Ue.classList.remove("fill-current","text-red-500"),Ue.classList.add("text-gray-400"),nt.classList.remove("text-red-500"),nt.classList.add("text-gray-400"),nt.title="Dar like"),qe.textContent=ae.likes;const Qe=ae.userLiked?"dado like a":"quitado like de"}else console.error("Error al actualizar like")}catch(ae){console.error("Error al actualizar like:",ae)}}}catch(u){console.error("Error al abrir modal de video:",u)}},className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("svg",{className:"w-12 h-12 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})})]}),e.jsxs("div",{className:`${se().compact?"p-2":"p-4"}`,children:[e.jsxs("div",{className:`flex items-center justify-between ${se().compact?"mb-1":"mb-2"}`,children:[e.jsx("h3",{className:`font-semibold text-gray-800 ${se().titleSize}`,children:r.title}),e.jsxs("div",{className:"flex items-center space-x-1",children:[[1,2,3,4,5].map(u=>{const E=(r.rating||0)>=u;return e.jsx("svg",{className:`${se().compact?"h-3 w-3":"h-4 w-4"} ${E?"text-yellow-400 fill-current":"text-gray-300"} cursor-pointer`,fill:"currentColor",viewBox:"0 0 24 24",onClick:async()=>{try{const Y=(r.rating||0)>=u?0:u;await _t(r.id,{rating:Y}),r.rating=Y}catch(P){console.error("Error updating rating:",P)}},children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})},u)}),e.jsxs("span",{className:`${se().compact,"text-xs"} font-medium text-gray-500 ml-1`,children:["(",r.rating||0,")"]})]})]}),e.jsx("p",{className:`text-gray-600 text-sm ${se().compact?"mb-2":"mb-3"} ${se().descriptionLines===1?"line-clamp-1":se().descriptionLines===2?"line-clamp-2":se().descriptionLines===3?"line-clamp-3":"line-clamp-4"}`,children:r.description||"Sin descripción"}),se().showTags&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:(()=>{const u=vs(r);return u.length>0?u.map(({tag:E,categoryKey:P,color:Y})=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${et(Y)}`,children:E},`${P}-${E}`)):e.jsx("span",{className:"text-gray-400 text-sm",children:"Sin etiquetas"})})()}),se().showTags&&(()=>{const u=js(r);return u.length>0?e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-blue-600 uppercase tracking-wide",children:"Iniciales:"})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map(({tag:E,categoryKey:P,color:Y})=>e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-sm",children:E},`inicial-${P}-${E}`))})]}):null})(),se().showTags&&(()=>{const u=Ns(r);return u.length>0?e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-green-600 uppercase tracking-wide",children:"Finales:"})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map(({tag:E,categoryKey:P,color:Y})=>e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-sm",children:E},`final-${P}-${E}`))})]}):null})(),se().compact?e.jsx($r,{video:r,onLike:()=>R(r),onEdit:()=>Pe(r),onDelete:()=>Te(r),onAddToSequence:()=>C(r),onDownload:()=>rs(r),onPlay:()=>Ft(r),isVideoInSequence:de(r),isBuilderOpen:ke,isVideoCompatible:$e(r),type:"video"}):e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"font-medium",children:[(r.fileSize/(1024*1024)).toFixed(2)," MB"]}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsx("span",{className:"text-gray-600",children:r.resolution&&r.resolution!=="Unknown"?r.resolution:"HD"}),r.bpm&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("span",{className:"text-purple-600 font-medium flex items-center space-x-1",children:[e.jsx(Ht,{className:"h-3 w-3"}),e.jsxs("span",{children:[r.bpm," BPM"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>Ft(r),className:"text-gray-400 hover:text-blue-500 transition-colors duration-200 p-1 rounded hover:bg-blue-50",title:"Reproducir video",children:e.jsx(Ye,{className:"h-4 w-4"})}),e.jsxs("button",{onClick:()=>R(r),className:`flex items-center space-x-1 transition-colors duration-200 p-1 rounded hover:bg-red-50 ${r.userLiked?"text-red-500":"text-gray-400 hover:text-red-500"}`,title:r.userLiked?"Quitar like":"Dar like",children:[e.jsx(Tt,{className:`h-4 w-4 ${r.userLiked?"fill-current":""}`}),e.jsx("span",{className:"font-medium",children:r.likes||0})]}),e.jsx("button",{onClick:()=>Pe(r),className:"text-gray-400 hover:text-blue-500 transition-colors duration-200 p-1 rounded hover:bg-blue-50",title:"Editar video",children:e.jsx(Gt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Te(r),className:"text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 rounded hover:bg-red-50",title:"Eliminar video",children:e.jsx(vt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>C(r),disabled:de(r),className:`transition-colors duration-200 p-1 rounded ${de(r)?"text-gray-300 cursor-not-allowed":ke&&!$e(r)?"text-red-400 hover:text-red-500 hover:bg-red-50":"text-gray-400 hover:text-purple-500 hover:bg-purple-50"}`,title:de(r)?"Ya en secuencia":ke&&!$e(r)?"Añadir forzadamente (incompatible)":"Añadir a secuencia",children:e.jsx(Zt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{rs(r)},className:"text-gray-400 hover:text-green-500 transition-colors duration-200 p-1 rounded hover:bg-green-50",title:"Descargar video",children:e.jsx(ut,{className:"h-4 w-4"})})]})]})]})]},r.id))})]}),L==="secuencias"&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-800",children:["Secuencias de ",S.toLowerCase()," (",M.length,")"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Bs,{type:"sequence"}),e.jsxs("button",{onClick:Ae,className:"flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-lg font-medium shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105",children:[e.jsx(xs,{className:"h-4 w-4"}),e.jsx("span",{children:"CREAR SECUENCIA"})]})]})]}),_?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Cargando secuencias..."})]}):e.jsx(Cr,{sequences:M,onDeleteSequence:tt,onPlaySequence:ft,onEditSequence:jt,onDownloadSequence:as})]})]}),e.jsx(lr,{isOpen:s,onClose:()=>a(!1),onVideoUploaded:Xe,page:"figuras",style:S}),e.jsx(ir,{isOpen:t.isOpen,onClose:g,video:t.video,onVideoUpdated:$,page:"figuras",style:S}),e.jsx(Lt,{isOpen:q.isOpen,onClose:ta,onConfirm:()=>at(q.type),title:q.type==="update"?"Actualizar Rutas de Thumbnails":q.type==="cleanup"?"Limpiar Archivos Huérfanos":q.type==="cleanup-tags"?"Limpiar Tags Duplicados":"Eliminar Todos los Videos",message:q.type==="update"?"¿Actualizar las rutas de thumbnails de videos existentes? Esto corregirá problemas de eliminación.":q.type==="cleanup"?"¿Limpiar archivos huérfanos? Esto eliminará archivos que no tienen documento en Firestore.":q.type==="cleanup-tags"?"¿Limpiar tags duplicados? Esto eliminará etiquetas repetidas en todos los videos manteniendo solo una instancia de cada tag.":"¿Eliminar TODOS los videos de Firebase y Storage? Esta acción es IRREVERSIBLE y eliminará todos los datos.",confirmText:q.type==="update"?"Actualizar":q.type==="cleanup"?"Limpiar":q.type==="cleanup-tags"?"Limpiar Tags":"Eliminar Todo",cancelText:"Cancelar"}),e.jsx(Lt,{isOpen:re.isOpen,onClose:Nt,onConfirm:Et,title:"🎬 Cargar Secuencia",message:`¿Deseas cargar la secuencia "${(ks=re.sequence)==null?void 0:ks.name}"?

Esto reemplazará la secuencia actual en construcción y perderás todos los cambios no guardados.

¿Estás seguro de que quieres continuar?`,confirmText:"Sí, Cargar",cancelText:"Cancelar",type:"warning"}),e.jsx(Lt,{isOpen:y.isOpen,onClose:st,onConfirm:()=>Ce(y.video),title:"🗑️ Eliminar Video",message:`¿Estás seguro de que quieres eliminar el video "${(Ss=y.video)==null?void 0:Ss.title}"?

Esta acción eliminará permanentemente:
• El archivo de video de Firebase Storage
• El thumbnail del video
• Los metadatos de Firestore

Esta acción NO se puede deshacer.`,confirmText:"Sí, Eliminar",cancelText:"Cancelar",type:"danger"}),Me&&ve&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"relative w-full max-w-3xl h-auto max-h-[85vh] bg-white rounded-lg overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 border-b flex-shrink-0",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["🎬 ",ve.title]}),e.jsx("button",{onClick:b,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(ot,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"flex-1 min-h-0 p-4",children:e.jsx("div",{className:"w-full h-full max-h-[65vh] flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsx(fs,{videos:[ve],className:"w-full h-full",showControls:!0,autoplay:!0,loop:!1,muted:!1})})})})]})}),k&&we&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"relative w-full max-w-3xl h-auto max-h-[85vh] bg-white rounded-lg overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 border-b flex-shrink-0",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["🎬 Secuencia: ",we.name]}),e.jsx("button",{onClick:X,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(ot,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"flex-1 min-h-0 p-4",children:e.jsx("div",{className:"w-full h-full max-h-[65vh] flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsx(fs,{videos:we.videos,className:"w-full h-full",showControls:!0,autoplay:!0,loop:!1,muted:!1})})})})]})}),e.jsx(fr,{isOpen:je.isOpen,onClose:Pt,video:je.sequence?{...je.sequence,title:je.sequence.name,file:null}:null,onDownloadComplete:()=>{N("Secuencia descargada correctamente","success"),Pt()}}),i.map(r=>e.jsx(At,{message:r.message,type:r.type,onClose:()=>be(r.id)},r.id))]})};export{_r as default};
//# sourceMappingURL=FigurasPage-B4RQfBco.js.map
