const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/firebase-storage-8aoBMGXB.js","assets/firebase-core-C4wBixGx.js","assets/vendor-jszip-B6VlRRbe.js","assets/vendor-react-Q3K9tvtn.js","assets/index-DOeBVGYV.js","assets/vendor-router-DMsCbgMp.js","assets/firebase-auth-BJ8Rxff9.js","assets/firebase-firestore-DFVBa-v3.js","assets/vendor-icons-DLh5V_hl.js","assets/index-D5-qQo4z.css"])))=>i.map(i=>d[i]);
import{s as tt,j as e,u as It,b as Ys,d as Js,e as Mt,_ as ot,f as Ot,g as Cs,t as Qt,h as ns,i as ea,k as ta,l as sa,m as aa,n as xs,o as ra,p as na,q as oa,r as la}from"./index-DOeBVGYV.js";import{r as n,b as ia}from"./vendor-react-Q3K9tvtn.js";import{listAll as Yt,ref as st,deleteObject as ht,getDownloadURL as At,uploadBytes as $s,uploadBytesResumable as ca}from"./firebase-storage-8aoBMGXB.js";import{X as et,i as Ft,A as bt,q as da,r as Ts,s as Ls,t as Jt,u as Rs,v as We,w as es,R as Ms,D as at,x as Ds,y as As,z as ts,I as dt,J as ua,K as ma,k as Pt,N as zt,O as Ut,T as gs,V as ha,Q as Lt,W as xa,Y as ss,p as Vt,_ as ga,M as Dt,H as pt,$ as pa,a0 as Fs,a1 as ps,a2 as fa,a3 as ba,a4 as fs,a5 as ya,Z as wa,n as bs,S as ys,a6 as va,a7 as ja,a8 as Na,a9 as ka,E as Sa}from"./vendor-icons-DLh5V_hl.js";import{f as os,F as Ea}from"./vendor-ffmpeg-B1ncfXmI.js";import{q as Ca,c as Ps,w as $a,o as Ta,a as La,d as zs,s as as,u as Ra,j as Ma,h as Da}from"./firebase-firestore-DFVBa-v3.js";import"./vendor-router-DMsCbgMp.js";import"./firebase-core-C4wBixGx.js";import"./firebase-auth-BJ8Rxff9.js";const Aa=async a=>{try{const r=URL.createObjectURL(a),t=document.createElement("video");t.crossOrigin="anonymous",t.muted=!0,t.playsInline=!0;const o=document.createElement("canvas"),l=o.getContext("2d");return new Promise((c,h)=>{t.onloadedmetadata=()=>{const m=t.videoWidth/t.videoHeight;let y,p;m>1?(y=1280,p=1280/m):(p=720,y=720*m),o.width=y,o.height=p;const T=t.duration;t.currentTime=Math.min(T*.5,1),t.onseeked=()=>{try{l.drawImage(t,0,0,o.width,o.height),o.toBlob(j=>{if(j){const f=URL.createObjectURL(j);URL.revokeObjectURL(r),t.remove(),o.remove(),c({success:!0,thumbnailURL:f,blob:j,error:null})}else h(new Error("No se pudo generar el thumbnail"))},"image/jpeg",.95)}catch(j){h(new Error(`Error al capturar frame: ${j.message}`))}},t.onerror=()=>{h(new Error("Error al cargar el video para thumbnail"))}},t.onerror=()=>{URL.revokeObjectURL(r),t.remove(),o.remove(),h(new Error("Error al cargar el video"))},t.src=r})}catch(r){return{success:!1,thumbnailURL:"https://via.placeholder.com/300x200/1a1a1a/ffffff?text=VIDEO",blob:null,error:r.message}}},mt=async(a,r,t)=>{try{const o=st(tt,r),l={contentType:a.type,customMetadata:{uploadedAt:new Date().toISOString(),originalName:a.name,fileSize:a.size.toString()}},c=await $s(o,a,l);return{success:!0,url:await At(c.ref),path:c.ref.fullPath,error:null}}catch(o){return console.error("Error uploading file:",o),{success:!1,url:null,path:null,error:o.message}}},ws=async a=>{try{const r=st(tt,a);return await ht(r),{success:!0,error:null}}catch(r){return{success:!1,error:r.message}}},Fa=async(a,r,t)=>{try{if(!a.type.startsWith("video/"))throw new Error("El archivo debe ser un video");const o=100*1024*1024;if(a.size>o)throw new Error("El video es demasiado grande. MÃ¡ximo 100MB");console.log("Subiendo video a Firebase Storage...");const l={contentType:a.type,customMetadata:{uploadedAt:new Date().toISOString(),originalName:a.name,fileSize:a.size.toString(),fileType:"video"}},c=st(tt,r);try{const h=await $s(c,a,l),x=await At(h.ref);return console.log("Video subido exitosamente a Firebase Storage:",x),{success:!0,url:x,path:h.ref.fullPath,error:null,simulated:!1}}catch(h){console.error("Error con uploadBytes, intentando con uploadBytesResumable:",h);const x=ca(c,a,l);return new Promise((i,m)=>{x.on("state_changed",y=>{const p=y.bytesTransferred/y.totalBytes*100;t&&t(p)},y=>{console.error("Error uploading video:",y);let p="Error al subir el video";y.code==="storage/unauthorized"?p="No tienes permisos para subir videos":y.code==="storage/quota-exceeded"?p="Se ha excedido la cuota de almacenamiento":y.code==="storage/retry-limit-exceeded"?p="Error de conexiÃ³n. Intenta de nuevo":y.code==="storage/canceled"?p="Upload cancelado":y.message&&(p=y.message),i({success:!1,url:null,path:null,error:p,simulated:!1})},async()=>{try{const y=await At(x.snapshot.ref);console.log("Video subido exitosamente a Firebase Storage:",y),i({success:!0,url:y,path:x.snapshot.ref.fullPath,error:null,simulated:!1})}catch{i({success:!1,url:null,path:null,error:"Error al obtener la URL del video",simulated:!1})}})})}}catch(o){console.error("Error uploading video:",o);let l="Error al subir el video";return o.code==="storage/unauthorized"?l="No tienes permisos para subir videos":o.code==="storage/quota-exceeded"?l="Se ha excedido la cuota de almacenamiento":o.code==="storage/retry-limit-exceeded"?l="Error de conexiÃ³n. Intenta de nuevo":o.message&&(l=o.message),{success:!1,url:null,path:null,error:l,simulated:!1}}},vs=async(a,r)=>{try{console.log("ðŸ—‘ï¸ Iniciando eliminaciÃ³n de archivos:"),console.log("ðŸ“ Video path:",a),console.log("ðŸ–¼ï¸ Thumbnail path:",r);const t=[];if(a){console.log("ðŸŽ¬ Eliminando video:",a);const o=st(tt,a);t.push(ht(o))}else console.log("âš ï¸ No hay ruta de video para eliminar");if(r&&r!==null&&r!==""){console.log("ðŸ–¼ï¸ Eliminando thumbnail:",r);const o=st(tt,r);t.push(ht(o))}else console.log("âš ï¸ No hay ruta de thumbnail para eliminar (thumbnailPath:",r,")");return console.log(`ðŸ“Š Archivos a eliminar: ${t.length}`),t.length===0?(console.log("âš ï¸ No hay archivos para eliminar"),{success:!0,error:null,deletedCount:0}):(await Promise.all(t),console.log("âœ… Archivos eliminados exitosamente"),{success:!0,error:null,deletedCount:t.length})}catch(t){return console.error("âŒ Error deleting video:",t),{success:!1,error:t.message,deletedCount:0}}},Pa=async()=>{try{console.log("ðŸ—‘ï¸ Iniciando eliminaciÃ³n de todos los archivos de videos...");const a=await js("videos");console.log(`âœ… Archivos de videos eliminados: ${a.deletedCount}`);const r=await js("thumbnails");return console.log(`âœ… Archivos de thumbnails eliminados: ${r.deletedCount}`),{success:!0,videosDeleted:a.deletedCount,thumbnailsDeleted:r.deletedCount,error:null}}catch(a){return console.error("âŒ Error al eliminar archivos de videos:",a),{success:!1,videosDeleted:0,thumbnailsDeleted:0,error:a.message}}},js=async a=>{try{console.log(`ðŸ—‘ï¸ Eliminando archivos en carpeta: ${a}`);const r=st(tt,a),t=await Yt(r);if(t.items.length===0)return console.log(`âœ… No hay archivos en ${a}`),{success:!0,deletedCount:0,error:null};console.log(`ðŸ“Š Archivos a eliminar en ${a}: ${t.items.length}`);const o=t.items.map(async x=>{try{return await ht(x),{success:!0,path:x.fullPath}}catch(i){return console.error(`âŒ Error eliminando ${x.fullPath}:`,i),{success:!1,path:x.fullPath,error:i.message}}}),l=await Promise.all(o),c=l.filter(x=>x.success).length,h=l.filter(x=>!x.success).length;return console.log(`âœ… ${c} archivos eliminados exitosamente en ${a}`),h>0&&console.log(`âš ï¸ ${h} archivos fallaron al eliminar en ${a}`),{success:!0,deletedCount:c,failedCount:h,error:null}}catch(r){return console.error(`âŒ Error al eliminar archivos en ${a}:`,r),{success:!1,deletedCount:0,failedCount:0,error:r.message}}},za=async a=>{try{console.log("ðŸ§¹ Iniciando limpieza de archivos huÃ©rfanos...");const r=await Yt(st(tt,"videos")),t=await Yt(st(tt,"thumbnails")),o=new Set(a.map(i=>i.videoPath).filter(Boolean)),l=new Set(a.map(i=>i.thumbnailPath).filter(Boolean)),c=r.items.filter(i=>!o.has(i.fullPath)),h=t.items.filter(i=>!l.has(i.fullPath));console.log(`ðŸ“Š Archivos huÃ©rfanos encontrados: ${c.length} videos, ${h.length} thumbnails`);const x=[...c.map(i=>ht(i)),...h.map(i=>ht(i))];return x.length>0?(await Promise.all(x),console.log(`âœ… ${x.length} archivos huÃ©rfanos eliminados`)):console.log("âœ… No se encontraron archivos huÃ©rfanos"),{success:!0,orphanedVideosDeleted:c.length,orphanedThumbnailsDeleted:h.length,error:null}}catch(r){return console.error("âŒ Error en limpieza de archivos huÃ©rfanos:",r),{success:!1,orphanedVideosDeleted:0,orphanedThumbnailsDeleted:0,error:r.message}}},Ns=async a=>{try{const r=st(tt,a),t=await At(r),o=await fetch(t);if(!o.ok)throw new Error(`Error al descargar archivo: ${o.status}`);return await o.blob()}catch(r){throw console.error(`Error descargando archivo ${a}:`,r),r}},ks=(a,r)=>new File([a],r,{type:a.type}),Ua=async a=>{try{console.log("ðŸ”„ Iniciando migraciÃ³n de videos a estructura organizada...");const r=[];for(const c of a)try{if(c.videoPath&&c.videoPath.includes("/figuras/")||c.videoPath&&c.videoPath.includes("/escuela/")||c.videoPath&&c.videoPath.includes("/eventos/")){console.log(`â­ï¸ Video ${c.title} ya estÃ¡ en estructura organizada`),r.push({videoId:c.id,title:c.title,status:"already_organized",error:null});continue}const h=c.style||"salsa",x="figuras",i=c.videoPath,m=c.thumbnailPath,y=`videos/${x}/${h}/${i.split("/").pop()}`,p=m?`thumbnails/${x}/${h}/${m.split("/").pop()}`:null;console.log(`ðŸ”„ Migrando video: ${c.title}`),console.log(`   De: ${i}`),console.log(`   A: ${y}`);let T=!1,j=!1;try{console.log(`ðŸ“¥ Descargando video: ${i}`);const f=await Ns(i),O=ks(f,i.split("/").pop());console.log(`ðŸ“¤ Subiendo video a nueva ubicaciÃ³n: ${y}`),await mt(O,y),T=!0,console.log("âœ… Video migrado exitosamente"),console.log(`ðŸ—‘ï¸ Eliminando archivo original: ${i}`),await ws(i)}catch(f){throw console.error(`âŒ Error migrando video ${c.title}:`,f),new Error(`Error migrando video: ${f.message}`)}if(m&&p)try{console.log(`ðŸ“¥ Descargando thumbnail: ${m}`);const f=await Ns(m),O=ks(f,m.split("/").pop());console.log(`ðŸ“¤ Subiendo thumbnail a nueva ubicaciÃ³n: ${p}`),await mt(O,p),j=!0,console.log("âœ… Thumbnail migrado exitosamente"),console.log(`ðŸ—‘ï¸ Eliminando thumbnail original: ${m}`),await ws(m)}catch(f){console.error(`âŒ Error migrando thumbnail ${c.title}:`,f)}r.push({videoId:c.id,title:c.title,oldVideoPath:i,newVideoPath:y,oldThumbnailPath:m,newThumbnailPath:p,status:"migrated",videoMigrated:T,thumbnailMigrated:j,error:null})}catch(h){console.error(`âŒ Error migrando video ${c.title}:`,h),r.push({videoId:c.id,title:c.title,status:"error",error:h.message})}const t=r.filter(c=>c.status==="migrated").length,o=r.filter(c=>c.status==="already_organized").length,l=r.filter(c=>c.status==="error").length;return console.log(`âœ… MigraciÃ³n completada: ${t} migrados, ${o} ya organizados, ${l} fallidos`),{success:!0,totalVideos:a.length,successfulMigrations:t,alreadyOrganized:o,failedMigrations:l,results:r,error:null}}catch(r){return console.error("âŒ Error en migraciÃ³n de videos:",r),{success:!1,totalVideos:0,successfulMigrations:0,alreadyOrganized:0,failedMigrations:0,results:[],error:r.message}}},Rt={figuras:{name:"FIGURAS",icon:"Music",styles:{salsa:{name:"SALSA",icon:"Music",color:"salsa",categories:{estilo:{name:"ESTILO",color:"pink",tags:["Salsa","Salsa en lÃ­nea On1","Salsa cubana","Estilo LA","Estilo NY","Estilo show"]},subestilo:{name:"SUBESTILO/TÃ‰CNICA",color:"orange",tags:["Pasitos libres","Parejas","Footwork On1","Footwork On2","Shines","Fusionado con afro","Body movement"]},tipo:{name:"TIPO DE FIGURA",color:"green",tags:["Cross Body Lead","Copa","Sombrero","Dile que no","Setenta","Vacilala","Enchufla"]},manos:{name:"MANOS/TÃ‰CNICA DE AGARRE",color:"blue",tags:["Una mano","Dos manos paralelas","Cruzadas","Entrelazadas","Cambio de manos","Manos abiertas","Sin contacto"]}}},bachata:{name:"BACHATA",icon:"Heart",color:"bachata",categories:{estilo:{name:"ESTILO",color:"red",tags:["Bachata dominicana","Bachata moderna","Bachata sensual","Bachata urbana"]},subestilo:{name:"SUBESTILO/TÃ‰CNICA",color:"orange",tags:["Body rolls","Hip movement","Footwork bÃ¡sico","Turns"]},tipo:{name:"TIPO DE FIGURA",color:"green",tags:["Dile que no","Setenta","Vacilala","Sombrero","Copa"]},manos:{name:"MANOS/TÃ‰CNICA DE AGARRE",color:"blue",tags:["Una mano","Dos manos","Cruzadas","Entrelazadas"]}}},kizomba:{name:"KIZOMBA",icon:"Zap",color:"kizomba",categories:{estilo:{name:"ESTILO",color:"yellow",tags:["Kizomba tradicional","Kizomba urbana","Tarraxinha","Semba"]},subestilo:{name:"SUBESTILO/TÃ‰CNICA",color:"orange",tags:["Body movement","Hip rolls","Footwork","Turns"]},tipo:{name:"TIPO DE FIGURA",color:"green",tags:["SaÃ­da","Volta","Tarraxinha","Semba step"]},manos:{name:"MANOS/TÃ‰CNICA DE AGARRE",color:"blue",tags:["Una mano","Dos manos","Cruzadas","Sin contacto"]}}},zouk:{name:"ZOUK",icon:"Star",color:"zouk",categories:{estilo:{name:"ESTILO",color:"purple",tags:["Zouk brasileÃ±o","Zouk flow","Zouk neofusion","Zouk tradicional"]},subestilo:{name:"SUBESTILO/TÃ‰CNICA",color:"orange",tags:["Body rolls","Head movement","Footwork","Turns"]},tipo:{name:"TIPO DE FIGURA",color:"green",tags:["Lateral","Tranca","PiÃ£o","BalanÃ§o"]},manos:{name:"MANOS/TÃ‰CNICA DE AGARRE",color:"blue",tags:["Una mano","Dos manos","Cruzadas","Entrelazadas"]}}},merengue:{name:"MERENGUE",icon:"Sun",color:"merengue",categories:{estilo:{name:"ESTILO",color:"orange",tags:["Merengue dominicano","Merengue tradicional","Merengue moderno"]},subestilo:{name:"SUBESTILO/TÃ‰CNICA",color:"orange",tags:["Hip movement","Footwork bÃ¡sico","Turns simples"]},tipo:{name:"TIPO DE FIGURA",color:"green",tags:["Giros simples","Cambios de direcciÃ³n","Pasos bÃ¡sicos"]},manos:{name:"MANOS/TÃ‰CNICA DE AGARRE",color:"blue",tags:["Una mano","Dos manos","Sin contacto"]}}}}},escuela:{name:"ESCUELA",icon:"GraduationCap",styles:{salsa:{name:"SALSA",icon:"Music",color:"pink",categories:{nivel:{name:"NIVEL",color:"green",tags:["Principiante","Intermedio","Avanzado","Experto"]},tipo:{name:"TIPO DE CURSO",color:"blue",tags:["BÃ¡sico","TÃ©cnica","CoreografÃ­a","Ritmo","Musicalidad"]},duracion:{name:"DURACIÃ“N",color:"orange",tags:["5-15 min","10-25 min","15-45 min","20-60 min"]},instructor:{name:"INSTRUCTOR",color:"purple",tags:["Carlos RodrÃ­guez","MarÃ­a GonzÃ¡lez","Juan PÃ©rez","Ana LÃ³pez"]}}}}},eventos:{name:"EVENTOS",icon:"Calendar",styles:{salsa:{name:"SALSA",icon:"Music",color:"pink",categories:{tipo:{name:"TIPO DE EVENTO",color:"green",tags:["CompeticiÃ³n","Encuentro","Congreso","Workshop","Fiesta"]},ubicacion:{name:"UBICACIÃ“N",color:"blue",tags:["Madrid","Barcelona","Valencia","Sevilla","Bilbao"]},nivel:{name:"NIVEL",color:"orange",tags:["Todos los niveles","Intermedio-Avanzado","Solo avanzado"]},fecha:{name:"FECHA",color:"purple",tags:["Este mes","PrÃ³ximo mes","Este trimestre","Este aÃ±o"]}}}}}},wt=(a="figuras",r="salsa")=>{const[t,o]=n.useState(a),[l,c]=n.useState(r);n.useEffect(()=>{c(r)},[r]),n.useEffect(()=>{o(a)},[a]);const h=n.useMemo(()=>{const j=Rt[t];if(!j)return null;const f=j.styles[l];return f?f.categories:null},[t,l]),x=n.useMemo(()=>{if(!h)return[];const j=[];return Object.entries(h).forEach(([f,O])=>{O.tags.forEach(_=>{j.push({tag:_,category:f,categoryName:O.name,color:O.color})})}),j},[h]),i=n.useMemo(()=>h?Object.entries(h).map(([j,f])=>({key:j,name:f.name,color:f.color,tags:f.tags})):[],[h]),m=n.useMemo(()=>{const j=Rt[t];return j?Object.entries(j.styles).map(([f,O])=>({key:f,name:O.name,color:O.color,icon:O.icon})):[]},[t]),y=n.useMemo(()=>Object.entries(Rt).map(([j,f])=>({key:j,name:f.name,icon:f.icon})),[]);return{selectedPage:t,selectedStyle:l,setSelectedPage:o,setSelectedStyle:c,currentCategories:h,availableTags:x,categoriesList:i,availableStyles:m,availablePages:y,categoryStructure:Rt,getColorClasses:j=>({salsa:"bg-orange-100 text-orange-800 border-orange-200",bachata:"bg-emerald-100 text-emerald-800 border-emerald-200",merengue:"bg-cyan-100 text-cyan-800 border-cyan-200",zouk:"bg-violet-100 text-violet-800 border-violet-200",kizomba:"bg-amber-100 text-amber-800 border-amber-200",pink:"bg-pink-100 text-pink-800 border-pink-200",red:"bg-red-100 text-red-800 border-red-200",orange:"bg-orange-100 text-orange-800 border-orange-200",yellow:"bg-yellow-100 text-yellow-800 border-yellow-200",green:"bg-green-100 text-green-800 border-green-200",blue:"bg-blue-100 text-blue-800 border-blue-200",purple:"bg-purple-100 text-purple-800 border-purple-200"})[j]||"bg-gray-100 text-gray-800 border-gray-200",getGradientClasses:j=>({salsa:"from-orange-400 to-pink-500",bachata:"from-emerald-400 to-teal-600",merengue:"from-cyan-400 to-blue-600",zouk:"from-violet-400 to-indigo-600",kizomba:"from-amber-400 to-orange-600",pink:"from-pink-500 to-rose-500",red:"from-red-500 to-pink-500",orange:"from-orange-500 to-red-500",yellow:"from-yellow-500 to-orange-500",green:"from-green-500 to-emerald-500",blue:"from-blue-500 to-cyan-500",purple:"from-purple-500 to-pink-500"})[j]||"from-gray-500 to-gray-600"}},vt=({message:a,type:r="success",duration:t=5e3,onClose:o})=>{const[l,c]=n.useState(!0);n.useEffect(()=>{const i=setTimeout(()=>{c(!1),setTimeout(()=>{o==null||o()},300)},t);return()=>clearTimeout(i)},[t,o]);const h=()=>{switch(r){case"success":return e.jsx(Ft,{className:"w-5 h-5"});case"error":return e.jsx(da,{className:"w-5 h-5"});case"warning":return e.jsx(bt,{className:"w-5 h-5"});default:return e.jsx(Ft,{className:"w-5 h-5"})}},x=()=>{switch(r){case"success":return"bg-gradient-to-r from-green-500 to-emerald-500 text-white border-green-400";case"error":return"bg-gradient-to-r from-red-500 to-pink-500 text-white border-red-400";case"warning":return"bg-gradient-to-r from-orange-500 to-red-500 text-white border-orange-400";default:return"bg-gradient-to-r from-green-500 to-emerald-500 text-white border-green-400"}};return e.jsx("div",{className:`
        fixed top-4 right-4 z-50 max-w-sm w-full
        transform transition-all duration-300 ease-in-out
        ${l?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
      `,children:e.jsxs("div",{className:`
        flex items-center justify-between p-4 rounded-lg shadow-lg border
        ${x()}
      `,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[h(),e.jsx("span",{className:"font-medium",children:a})]}),e.jsx("button",{onClick:()=>{c(!1),setTimeout(()=>o==null?void 0:o(),300)},className:"ml-4 text-white hover:text-gray-200 transition-colors",children:e.jsx(et,{className:"w-4 h-4"})})]})})},yt=({src:a,size:r="medium",loop:t=!1,loopSegment:o=null,showControls:l=!0,autoplay:c=!1,muted:h=!1,onTimeUpdate:x=null,onEnded:i=null,className:m="",resolutions:y=null,currentResolution:p=null,onResolutionChange:T=null,videoTitle:j="video"})=>{const f=n.useRef(null),O=n.useRef(null),[_,w]=n.useState(!1),[L,B]=n.useState(0),[v,V]=n.useState(0),[q,J]=n.useState(1),[ae,ue]=n.useState(h),[ye,re]=n.useState(!1),[Pe,we]=n.useState(null),[$e,Te]=n.useState(!1),[be,De]=n.useState(!1),[Le,I]=n.useState((o==null?void 0:o.start)||0),[fe,he]=n.useState((o==null?void 0:o.end)||0),[k,P]=n.useState(!!o),[U,G]=n.useState(!1),[W,X]=n.useState(!1),[oe,d]=n.useState(0),[D,M]=n.useState(0),[H,z]=n.useState(l),[Q,te]=n.useState(null),[me,A]=n.useState(!1),[ee,le]=n.useState(p||"auto"),[ne,Ae]=n.useState(null),[ve,Re]=n.useState(null),[xe,je]=n.useState(!1),[Ne,ie]=n.useState(1),[Se,Ge]=n.useState("horizontal"),ze=[.25,.5,.75,1,1.25,1.5,2];n.useEffect(()=>{if(f.current&&k&&_&&U&&W){const b=f.current,Z=()=>{b.currentTime>=fe&&(b.currentTime=Le)};return b.addEventListener("timeupdate",Z),()=>b.removeEventListener("timeupdate",Z)}},[k,Le,fe,_,U,W]),n.useEffect(()=>{const b=Z=>{if(!f.current)return;const ke=document.activeElement;if(!(ke&&(ke.tagName==="INPUT"||ke.tagName==="TEXTAREA"||ke.contentEditable==="true"||ke.classList.contains("ql-editor"))))switch(Z.code){case"Space":Z.preventDefault(),C();break;case"ArrowLeft":Z.preventDefault(),K(-10);break;case"ArrowRight":Z.preventDefault(),K(10);break;case"KeyA":Z.preventDefault(),I(L);break;case"KeyB":Z.preventDefault(),he(L);break;case"KeyL":Z.preventDefault(),De(!be);break;case"KeyS":{Z.preventDefault();const Xe=(ze.indexOf(Ne)+1)%ze.length;ut(ze[Xe]);break}}};return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[L,be,Ne]),n.useEffect(()=>{if(H&&_){const b=setTimeout(()=>{z(!1)},4e3);return te(b),()=>clearTimeout(b)}},[H,_]),n.useEffect(()=>()=>{Q&&clearTimeout(Q),Pe&&clearTimeout(Pe)},[]),n.useEffect(()=>{f.current&&(f.current.volume=q,f.current.muted=ae,f.current.playbackRate=Ne)},[q,ae,Ne]),n.useEffect(()=>{ee==="auto"&&ne&&Re(ne)},[ee,ne]),n.useEffect(()=>{const b=Z=>{me&&A(!1),xe&&je(!1)};return document.addEventListener("click",b),()=>document.removeEventListener("click",b)},[me,xe]);const S=()=>{z(!0),Q&&clearTimeout(Q)},Ie=()=>{S()},[Oe,ce]=n.useState(0),[Be,Ke]=n.useState(0),rt=b=>{const Z=Date.now();if(Z-Oe<300){const Ee=b.currentTarget.getBoundingClientRect(),Xe=b.clientX-Ee.left,Qe=Ee.width;Xe<Qe/2?K(-10):K(10),Ke(0),ce(0)}else Ke(1),ce(Z)},C=()=>{f.current&&(_?f.current.pause():f.current.play(),w(!_))},K=b=>{if(f.current){const Z=Math.max(0,Math.min(v,L+b));f.current.currentTime=Z,B(Z)}},qe=()=>{f.current&&(B(f.current.currentTime),x==null||x(f.current.currentTime))},Me=()=>{if(f.current){V(f.current.duration);const b=f.current,Z=b.videoWidth,ke=b.videoHeight;if(Z&&ke){const Ee=ke>Z;Ge(Ee?"vertical":"horizontal");const Xe=Math.max(Z,ke);let Qe="480p";Xe>=3840?Qe="4k":Xe>=1920?Qe="1080p":Xe>=1280?Qe="720p":Xe>=854?Qe="480p":Qe="360p",Ae(Qe)}c&&(b.play(),w(!0))}},g=()=>{be&&!k?f.current&&(f.current.currentTime=0,f.current.play()):k?f.current&&(f.current.currentTime=Le,f.current.play()):w(!1),i==null||i()},$=b=>{if(f.current){const Z=b.currentTarget.getBoundingClientRect(),Ee=(b.clientX-Z.left)/Z.width*v;f.current.currentTime=Ee,B(Ee)}},R=()=>{if(f.current){const b=!ae;f.current.muted=b,ue(b),b?f.current.volume=0:f.current.volume=q}},N=b=>{const Z=parseFloat(b.target.value);f.current&&(f.current.volume=Z,J(Z),Z===0?(f.current.muted=!0,ue(!0)):(f.current.muted=!1,ue(!1)))},ge=()=>{try{document.fullscreenElement?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),Te(!1)):(O.current.requestFullscreen?O.current.requestFullscreen():O.current.webkitRequestFullscreen?O.current.webkitRequestFullscreen():O.current.msRequestFullscreen&&O.current.msRequestFullscreen(),Te(!0))}catch(b){console.error("Error toggling fullscreen:",b)}},Ve=b=>{b==="start"?U?(G(!1),I(0)):(G(!0),I(L),d(L)):W?(X(!1),he(0)):(X(!0),he(L),M(L))},Ze=b=>{const Z=Math.floor(b/60),ke=Math.floor(b%60);return`${Z}:${ke.toString().padStart(2,"0")}`},lt=b=>{le(b),A(!1),b==="auto"&&ne?Re(ne):b!=="auto"&&Re(null),T==null||T(b)},ut=b=>{f.current&&(f.current.playbackRate=b,ie(b)),je(!1)},xt=b=>b===1?"Normal":`${b}x`,jt=b=>{switch(b){case"auto":return ve?`Auto (${ve})`:"Auto";case"4k":return"4K";case"1080p":return"1080p";case"720p":return"720p";case"480p":return"480p";case"360p":return"360p";default:return b}},Ht=b=>{if(!ne)return!0;const Z=["360p","480p","720p","1080p","4k"],ke=Z.indexOf(ne);return Z.indexOf(b)<=ke},Nt=()=>{let b="";switch(r){case"small":b="max-w-xs";break;case"medium":b="max-w-md";break;case"large":b="max-w-2xl";break;case"fullscreen":return"w-full h-full";default:b="max-w-md"}return r==="fullscreen"?b:`${b} ${Se==="vertical"?"aspect-[9/16]":"aspect-video"}`},kt=async()=>{try{if(a&&(a.includes("firebase")||a.includes("googleapis"))){const b=await fetch(a);if(!b.ok)throw new Error(`HTTP error! status: ${b.status}`);const Z=await b.blob(),ke=URL.createObjectURL(Z),Ee=document.createElement("a");Ee.href=ke,Ee.download=j||"video.mp4",Ee.style.display="none",document.body.appendChild(Ee),Ee.click(),document.body.removeChild(Ee),setTimeout(()=>{URL.revokeObjectURL(ke)},1e3)}else{const b=document.createElement("a");b.href=a,b.download=j||"video.mp4",b.style.display="none",document.body.appendChild(b),b.click(),document.body.removeChild(b)}}catch(b){console.error("Error en descarga:",b),alert(`Error al descargar el video: ${b.message}`)}};return e.jsxs("div",{ref:O,className:`relative bg-black rounded-lg overflow-hidden video-player-container ${Nt()} ${m} ${Se==="vertical"?"video-player-vertical":""}`,onMouseMove:S,onMouseLeave:()=>{if(_){const b=setTimeout(()=>{z(!1)},4e3);te(b)}},onTouchStart:S,onTouchMove:S,onClick:Ie,onDoubleClick:rt,children:[e.jsx("video",{ref:f,src:a,className:`w-full h-full cursor-pointer ${r==="fullscreen"?"object-contain":"object-cover"}`,muted:ae,loop:be&&!k,onTimeUpdate:qe,onLoadedMetadata:Me,onEnded:g,onPlay:()=>w(!0),onPause:()=>w(!1),onClick:Ie,onDoubleClick:rt,onTouchStart:S,onTouchMove:S}),H&&e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent",onMouseMove:S,onTouchStart:S,onTouchMove:S,children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 flex justify-end items-center",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:ge,onTouchStart:S,className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",children:$e?e.jsx(Ts,{className:"w-4 h-4"}):e.jsx(Ls,{className:"w-4 h-4"})})})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>K(-10),onTouchStart:S,className:"p-3 rounded-full bg-black/60 text-white hover:bg-black/80 transition-colors z-10 hidden md:flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center",children:e.jsx(Jt,{className:"w-3 h-3"})}),e.jsx("span",{className:"text-sm font-medium",children:"10"})]})}),e.jsx("button",{onClick:C,onTouchStart:S,className:"p-4 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",children:_?e.jsx(Rs,{className:"w-8 h-8"}):e.jsx(We,{className:"w-8 h-8"})}),e.jsx("button",{onClick:()=>K(10),onTouchStart:S,className:"p-3 rounded-full bg-black/60 text-white hover:bg-black/80 transition-colors z-10 hidden md:flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"10"}),e.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center",children:e.jsx(es,{className:"w-3 h-3"})})]})})]})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[e.jsxs("div",{className:"flex justify-end mb-2 space-x-2",children:[e.jsx("button",{onClick:()=>De(!be),onTouchStart:S,className:`p-2 rounded-full transition-colors z-10 ${be?"bg-blue-500 text-white":"bg-white/20 text-white hover:bg-white/30"}`,title:"Bucle",children:e.jsx(Ms,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{const b=!k;P(b),b?(oe>0&&(G(!0),I(oe)),D>0&&(X(!0),he(D))):(G(!1),X(!1),I(0),he(0))},onTouchStart:S,className:`p-2 rounded-full transition-colors z-10 ${k?"bg-green-500 text-white":"bg-white/20 text-white hover:bg-white/30"}`,title:"Segmento A-B",children:e.jsx("div",{className:"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none",children:"A-B"})}),y&&y.length>0&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>A(!me),onTouchStart:S,className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",title:"ResoluciÃ³n",children:e.jsx("div",{className:"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none",children:jt(ee)})}),me&&e.jsx("div",{className:"absolute bottom-full right-0 mb-2 bg-black/90 rounded-lg p-2 z-20 min-w-[80px]",onTouchStart:S,onTouchMove:S,children:y.map(b=>{const Z=Ht(b);return e.jsxs("button",{onClick:()=>Z&&lt(b),className:`w-full text-left px-3 py-1 rounded text-xs transition-colors ${Z?ee===b?"bg-blue-500 text-white":"text-white hover:bg-white/20":"text-gray-500 cursor-not-allowed opacity-50"}`,disabled:!Z,children:[jt(b),!Z&&e.jsx("span",{className:"ml-1 text-[10px] opacity-75",children:"(no disponible)"})]},b)})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>je(!xe),onTouchStart:S,className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",title:"Velocidad de reproducciÃ³n",children:e.jsx("div",{className:"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none",children:Ne===1?"1x":`${Ne}x`})}),xe&&e.jsx("div",{className:"absolute bottom-full right-0 mb-2 bg-black/90 rounded-lg p-2 z-20 min-w-[80px]",onTouchStart:S,onTouchMove:S,children:ze.map(b=>e.jsx("button",{onClick:()=>ut(b),className:`w-full text-left px-3 py-1 rounded text-xs transition-colors ${Ne===b?"bg-blue-500 text-white":"text-white hover:bg-white/20"}`,children:xt(b)},b))})]}),e.jsx("button",{onClick:kt,onTouchStart:S,className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",title:"Descargar video",children:e.jsx(at,{className:"w-4 h-4"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:R,onTouchStart:S,className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",onMouseEnter:()=>re(!0),onMouseLeave:()=>{const b=setTimeout(()=>re(!1),1e3);we(b)},children:ae?e.jsx(Ds,{className:"w-4 h-4"}):e.jsx(As,{className:"w-4 h-4"})}),ye&&e.jsx("div",{className:"absolute bottom-full right-0 mb-2 bg-black/80 rounded-lg p-3 z-20",onMouseEnter:()=>{Pe&&(clearTimeout(Pe),we(null))},onMouseLeave:()=>{const b=setTimeout(()=>re(!1),1e3);we(b)},onTouchStart:S,onTouchMove:S,children:e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:q,onChange:N,onTouchStart:S,onTouchMove:S,className:"w-2 h-20 bg-gray-600 rounded-lg appearance-none cursor-pointer slider-vertical",style:{background:`linear-gradient(to top, #3b82f6 0%, #3b82f6 ${q*100}%, #4b5563 ${q*100}%, #4b5563 100%)`},orient:"vertical"}),e.jsxs("span",{className:"text-white text-xs",children:[Math.round(q*100),"%"]})]})})]})]}),e.jsx("div",{className:"relative mb-4",children:e.jsxs("div",{className:"w-full h-2 bg-white/20 rounded-full cursor-pointer relative",onClick:$,onTouchStart:S,onTouchMove:S,children:[e.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${L/v*100}%`}}),k&&U&&e.jsx("div",{className:"absolute top-0 w-1 h-full bg-green-500 z-10",style:{left:`${Le/v*100}%`}}),k&&W&&e.jsx("div",{className:"absolute top-0 w-1 h-full bg-red-500 z-10",style:{left:`${fe/v*100}%`}})]})}),e.jsxs("div",{className:"flex items-center justify-between text-white text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:[Ze(L)," / ",Ze(v)]}),Ne!==1&&e.jsxs("span",{className:"text-blue-400 font-medium",children:[Ne,"x"]}),k&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>Ve("start"),onTouchStart:S,className:`px-2 py-1 rounded text-xs transition-colors ${U?"bg-green-500 text-white":"bg-gray-600 text-gray-300 hover:bg-gray-500"}`,children:["A: ",U?Ze(Le):"--:--"]}),e.jsxs("button",{onClick:()=>Ve("end"),onTouchStart:S,className:`px-2 py-1 rounded text-xs transition-colors ${W?"bg-red-500 text-white":"bg-gray-600 text-gray-300 hover:bg-gray-500"}`,children:["B: ",W?Ze(fe):"--:--"]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"text-xs opacity-75",children:be&&(k&&U&&W?"Bucle A-B":"Bucle completo")})})]})]})]})]})},Va=async a=>{try{console.log("ðŸŽµ Iniciando detecciÃ³n de BPM para:",a.name);const r=new(window.AudioContext||window.webkitAudioContext),t=await a.arrayBuffer(),o=await r.decodeAudioData(t);if(!Ia(o))return console.log("ðŸŽµ Video sin audio significativo, usando BPM por defecto"),{success:!1,bpm:null,originalBPM:null,error:"Video sin audio significativo"};console.log("ðŸŽµ Audio decodificado, detectando BPM...");const c=await Oa(o),h=Math.round(c);return console.log(`âœ… BPM detectado: ${h} para ${a.name}`),{success:!0,bpm:h,originalBPM:c,error:null}}catch(r){return console.error("âŒ Error al detectar BPM:",r),{success:!1,bpm:null,originalBPM:null,error:r.message}}},Ia=a=>{const r=a.getChannelData(0),t=a.sampleRate,o=Math.min(5*t,r.length),l=r.slice(0,o),c=Math.sqrt(l.reduce((h,x)=>h+x*x,0)/l.length);return console.log(`ðŸŽµ Nivel de audio RMS: ${c.toFixed(4)}`),c>.01},Oa=async a=>{const r=a.sampleRate,t=a.getChannelData(0),o=Math.min(10*r,t.length),l=t.slice(0,o),c=Ba(l,r),h=[];for(let x=1;x<c.length;x++)h.push(c[x]-c[x-1]);if(h.length>0){const x=h.reduce((y,p)=>y+p,0)/h.length,i=60*r/x;if(console.log(`ðŸŽµ BPM calculado: ${i}, intervalos: ${h.length}, promedio: ${x}`),i>300)return console.log(`ðŸŽµ BPM demasiado alto (${i}), probablemente error de detecciÃ³n`),120;const m=Math.max(80,Math.min(180,i));return i!==m&&console.log(`ðŸŽµ BPM ajustado de ${i} a ${m}`),m>=175&&(console.log(`ðŸŽµ BPM muy alto (${m}), verificando si es real...`),h.filter(p=>Math.abs(p-x)<x*.3).length<h.length*.7)?(console.log("ðŸŽµ BPM alto pero intervalos inconsistentes, usando BPM por defecto"),120):m}return console.log("ðŸŽµ No se detectaron intervalos, usando BPM por defecto: 120"),120},Ba=(a,r)=>{const t=[],o=a.map(i=>i*i),l=o.reduce((i,m)=>i+m,0)/o.length,c=Math.max(.01,Math.min(.5,l*3)),h=r*.5;console.log(`ðŸŽµ Detectando picos con umbral: ${c.toFixed(4)}, energÃ­a promedio: ${l.toFixed(4)}`);const x=Math.floor(r*.1);for(let i=x;i<a.length-x;i++){const m=a.slice(i-x,i+x),y=Math.max(...m);a[i]===y&&a[i]>c&&(t.length===0||i-t[t.length-1]>h)&&t.push(i)}if(console.log(`ðŸŽµ Picos detectados: ${t.length}`),t.length<3){console.log("ðŸŽµ Pocos picos detectados, reduciendo umbral...");const i=c*.5;t.length=0;for(let m=x;m<a.length-x;m++){const y=a.slice(m-x,m+x),p=Math.max(...y);a[m]===p&&a[m]>i&&(t.length===0||m-t[t.length-1]>h)&&t.push(m)}console.log(`ðŸŽµ Picos detectados con umbral reducido: ${t.length}`)}return t},qa=a=>a<80||a>180?(console.warn(`âš ï¸ BPM fuera de rango para salsa: ${a} (rango esperado: 80-180)`),!1):!0,Ha=({isOpen:a,onClose:r,onVideoUploaded:t,page:o="figuras",style:l="salsa"})=>{const{user:c}=It(),{currentCategories:h,categoriesList:x}=wt(o,l),i=n.useRef(null),[m,y]=n.useState([]),[p,T]=n.useState(!1),[j,f]=n.useState({}),[O,_]=n.useState(1),[w,L]=n.useState({}),[B,v]=n.useState([]),[V,q]=n.useState({}),J=n.useRef({}),[ae,ue]=n.useState(new Set);n.useEffect(()=>{a?_(1):ye()},[a]),n.useEffect(()=>{if(h){const d={};Object.keys(h).forEach(D=>{d[D]=[]}),q(d)}},[h]);const ye=()=>{Object.values(w).forEach(d=>{d.videoPreview&&URL.revokeObjectURL(d.videoPreview),d.thumbnailPreview&&URL.revokeObjectURL(d.thumbnailPreview)}),y([]),L({}),ue(new Set),f({}),T(!1),_(1),i.current&&(i.current.value="")},re=(d,D="success")=>{const M=Date.now();v(H=>[...H,{id:M,message:d,type:D}])},Pe=d=>{v(D=>D.filter(M=>M.id!==d))},we=d=>{ue(D=>{const M=new Set(D);return M.has(d)?M.delete(d):M.add(d),M})},$e=d=>{ue(d?new Set(m.map(D=>D.name)):new Set)},Te=d=>{const M=Array.from(d.target.files).filter(z=>z.type.startsWith("video/"));if(M.length===0){re("Por favor selecciona archivos de video vÃ¡lidos","error");return}const H=M.filter(z=>!m.some(Q=>Q.name===z.name));if(H.length===0){re("Algunos archivos ya estÃ¡n seleccionados","warning");return}y(z=>[...z,...H]),H.forEach(async z=>{const Q=URL.createObjectURL(z);try{const te=await I(z),me=URL.createObjectURL(te);L(A=>({...A,[z.name]:{...A[z.name],videoPreview:Q,thumbnailPreview:me}}))}catch(te){console.warn("Error generando thumbnail para vista previa:",te),L(me=>({...me,[z.name]:{...me[z.name],videoPreview:Q}}))}}),re(`${H.length} video(s) agregado(s)`,"success")},be=d=>{const D=m[d];D&&w[D.name]&&(w[D.name].videoPreview&&URL.revokeObjectURL(w[D.name].videoPreview),w[D.name].thumbnailPreview&&URL.revokeObjectURL(w[D.name].thumbnailPreview)),y(M=>M.filter((H,z)=>z!==d)),L(M=>{const H={...M};return delete H[D.name],H}),ue(M=>{const H=new Set(M);return H.delete(D.name),H})},De=(d,D)=>{q(M=>{const H=M[d]||[];if(H.includes(D))return{...M,[d]:H.filter(Q=>Q!==D)};{const Q=[...new Set([...H,D])];return{...M,[d]:Q}}})},Le=async d=>{var D;try{if((D=w[d.name])!=null&&D.customThumbnailFile){const M=w[d.name].customThumbnailFile,H=`thumbnails/${o}/${l}/${Date.now()}_${d.name.replace(/\.[^/.]+$/,".jpg")}`,z=await mt(M,H);if(z.success)return{url:z.url,path:z.path}}try{const M=await Promise.race([Aa(d),new Promise((H,z)=>setTimeout(()=>z(new Error("Timeout")),15e3))]);if(M.success&&M.blob){const H=`thumbnails/${o}/${l}/${Date.now()}_${d.name.replace(/\.[^/.]+$/,".jpg")}`,z=await mt(M.blob,H);if(z.success)return M.thumbnailURL&&URL.revokeObjectURL(M.thumbnailURL),{url:z.url,path:z.path}}}catch(M){console.warn("Error generando thumbnail automÃ¡tico:",M)}try{const M=await I(d);if(M){const H=`thumbnails/${o}/${l}/${Date.now()}_${d.name.replace(/\.[^/.]+$/,".jpg")}`,z=await mt(M,H);if(z.success)return{url:z.url,path:z.path}}}catch(M){console.warn("Error generando thumbnail por defecto:",M)}return{url:null,path:null}}catch(M){return console.error("Error en generateThumbnail:",M),{url:null,path:null}}},I=async d=>new Promise((D,M)=>{try{const H=URL.createObjectURL(d),z=document.createElement("video");z.crossOrigin="anonymous",z.muted=!0,z.playsInline=!0;const Q=document.createElement("canvas"),te=Q.getContext("2d");Q.width=1280,Q.height=720,z.onloadedmetadata=()=>{try{z.currentTime=.1,z.onseeked=()=>{try{te.drawImage(z,0,0,Q.width,Q.height),Q.toBlob(me=>{me?(URL.revokeObjectURL(H),z.remove(),Q.remove(),D(me)):M(new Error("No se pudo generar el thumbnail por defecto"))},"image/jpeg",.95)}catch(me){M(new Error(`Error al capturar frame por defecto: ${me.message}`))}},z.onerror=()=>{M(new Error("Error al cargar el video para thumbnail por defecto"))}}catch(me){M(new Error(`Error al procesar metadata por defecto: ${me.message}`))}},z.onerror=()=>{URL.revokeObjectURL(H),z.remove(),Q.remove(),M(new Error("Error al cargar el video por defecto"))},z.src=H}catch(H){M(new Error(`Error al generar thumbnail por defecto: ${H.message}`))}}),fe=async(d,D)=>{var M,H,z,Q;try{if((await Ys(d.name)).isDuplicate)return re(`Video "${d.name}" ya existe en la base de datos`,"warning"),null;const me=await Le(d),A=`videos/${o}/${l}/${Date.now()}_${d.name}`,ee=await Fa(d,A,S=>{f(Ie=>({...Ie,[D]:S}))});if(!ee.success)return re(`Error al subir ${d.name}: ${ee.error}`,"error"),null;const le={...V,estilo:V.estilo||[]},ne=J.current[`${d.name}-title`],Ae=J.current[`${d.name}-description`],ve=((M=ne==null?void 0:ne.value)==null?void 0:M.trim())||((H=w[d.name])==null?void 0:H.title)||d.name.replace(/\.[^/.]+$/,""),Re=((z=Ae==null?void 0:Ae.value)==null?void 0:z.trim())||((Q=w[d.name])==null?void 0:Q.description)||"";let xe=null,je=null,Ne=null;try{const S=document.createElement("video");S.src=URL.createObjectURL(d),await new Promise((Ie,Oe)=>{S.onloadedmetadata=()=>{je=S.videoWidth,Ne=S.videoHeight;const ce=Math.max(je,Ne);ce>=3840?xe="4K":ce>=1920?xe="1080p":ce>=1280?xe="720p":ce>=854?xe="480p":xe="360p",URL.revokeObjectURL(S.src),Ie()},S.onerror=Oe})}catch(S){console.warn("No se pudo detectar la resoluciÃ³n del video:",S),xe="Unknown"}let ie=null,Se=!1;try{const S=await Va(d);S.success&&qa(S.bpm)&&(ie=S.bpm,Se=!0)}catch(S){console.error("âŒ Error al detectar BPM:",S)}const Ge={title:ve,originalTitle:d.name,description:Re,videoUrl:ee.url,thumbnailUrl:me.url||null,videoPath:ee.path,thumbnailPath:me.path||null,fileSize:d.size,fileType:d.type,duration:0,resolution:xe,videoWidth:je,videoHeight:Ne,style:l,tags:le,uploadedBy:(c==null?void 0:c.uid)||"anonymous",uploadedAt:new Date().toISOString(),views:0,likes:0,likedBy:[],bpm:ie,bpmDetected:Se},ze=await Js(Ge);return ze.success?(re(`${d.name} subido exitosamente`,"success"),{...Ge,id:ze.id}):(re(`Error al guardar metadatos de ${d.name}`,"error"),null)}catch(te){return console.error("Error uploading video:",te),re(`Error inesperado al subir ${d.name}`,"error"),null}},he=async()=>{if(m.length===0){re("Selecciona al menos un video","error");return}T(!0);const d=[];for(let D=0;D<m.length;D++){const M=m[D],H=await fe(M,D);H&&d.push(H)}T(!1),d.length>0&&(re(`${d.length} video(s) subido(s) correctamente`,"success"),d.forEach(D=>t(D)),r())},k=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Seleccionar Videos"}),e.jsx("p",{className:"text-gray-600",children:"Selecciona uno o varios videos para subir"})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 hover:border-pink-400 transition-colors duration-200",children:[e.jsx("input",{ref:i,type:"file",multiple:!0,accept:"video/*",onChange:Te,className:"hidden"}),e.jsxs("button",{onClick:()=>{var d;return(d=i.current)==null?void 0:d.click()},className:"w-full flex flex-col items-center justify-center space-y-2 text-gray-600 hover:text-pink-500 transition-colors duration-200",children:[e.jsx(ts,{className:"h-12 w-12"}),e.jsx("span",{className:"font-medium text-center",children:"Haz clic para seleccionar videos"}),e.jsx("span",{className:"text-sm text-center",children:"MP4, AVI, MOV, etc. (mÃ¡x. 100MB cada uno)"})]})]}),m.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:["Videos seleccionados (",m.length,")"]}),m.map((d,D)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:d.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(d.size/(1024*1024)).toFixed(2)," MB"]})]}),e.jsx("button",{onClick:()=>be(D),className:"p-1 text-red-500 hover:text-red-700 transition-colors duration-200",children:e.jsx(dt,{className:"h-4 w-4"})})]},D))]})]}),P=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Configurar Videos"}),e.jsx("p",{className:"text-gray-600",children:"Personaliza la informaciÃ³n de tus videos antes de subirlos"})]}),m.length>1&&e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsxs("button",{onClick:()=>$e(!0),className:"flex items-center space-x-1 px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors",children:[e.jsx(ua,{className:"h-4 w-4"}),e.jsx("span",{children:"Plegar Todo"})]}),e.jsxs("button",{onClick:()=>$e(!1),className:"flex items-center space-x-1 px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors",children:[e.jsx(ma,{className:"h-4 w-4"}),e.jsx("span",{children:"Desplegar Todo"})]})]}),m.map((d,D)=>{var H,z,Q,te,me;const M=ae.has(d.name);return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"w-12 h-9 bg-gray-100 rounded flex items-center justify-center relative overflow-hidden",children:[(H=w[d.name])!=null&&H.thumbnailPreview?e.jsx("img",{src:w[d.name].thumbnailPreview,alt:"Vista previa del video",className:"w-full h-full object-cover",onError:A=>{A.target.style.display="none",A.target.nextSibling.style.display="flex"}}):null,e.jsx("span",{className:"text-xs text-gray-500",style:{display:(z=w[d.name])!=null&&z.thumbnailPreview?"none":"flex"},children:"VIDEO"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:d.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(d.size/(1024*1024)).toFixed(2)," MB"]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:()=>we(d.name),className:"p-1 text-gray-500 hover:text-gray-700 transition-colors",title:M?"Desplegar":"Plegar",children:M?e.jsx(Pt,{className:"h-4 w-4"}):e.jsx(zt,{className:"h-4 w-4"})})})]}),!M&&e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Vista previa del video"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(yt,{src:((Q=w[d.name])==null?void 0:Q.videoPreview)||URL.createObjectURL(d),size:"medium",loop:!0,showControls:!0,autoplay:!1,muted:!1,className:"w-full max-w-2xl",resolutions:["auto","4k","1080p","720p","480p","360p"],currentResolution:"auto",videoTitle:((te=w[d.name])==null?void 0:te.title)||d.name.replace(/\.[^/.]+$/,""),onResolutionChange:A=>{}})}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsx("span",{children:d.name}),e.jsxs("span",{children:[(d.size/(1024*1024)).toFixed(2)," MB"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nombre del video"}),e.jsx("input",{type:"text","data-file":d.name,"data-field":"title",ref:A=>{var ee;A&&(J.current[`${d.name}-title`]=A,A.value||(A.value=((ee=w[d.name])==null?void 0:ee.title)||d.name.replace(/\.[^/.]+$/,"")))},onBlur:A=>{var le;const ee=A.target.value.trim();ee!==(((le=w[d.name])==null?void 0:le.title)||d.name.replace(/\.[^/.]+$/,""))&&L(ne=>({...ne,[d.name]:{...ne[d.name],title:ee}}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Ingresa un nombre para el video"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"DescripciÃ³n (opcional)"}),e.jsx("textarea",{"data-file":d.name,"data-field":"description",ref:A=>{var ee;A&&(J.current[`${d.name}-description`]=A,A.value||(A.value=((ee=w[d.name])==null?void 0:ee.description)||""))},onBlur:A=>{var le;const ee=A.target.value.trim();ee!==(((le=w[d.name])==null?void 0:le.description)||"")&&L(ne=>({...ne,[d.name]:{...ne[d.name],description:ee}}))},rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Describe brevemente el contenido del video..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Thumbnail personalizado (opcional)"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-40 h-24 bg-gray-100 rounded border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden",children:(me=w[d.name])!=null&&me.customThumbnail?e.jsx("img",{src:w[d.name].customThumbnail,alt:"Thumbnail personalizado",className:"w-full h-full object-cover rounded"}):e.jsx("span",{className:"text-xs text-gray-500",children:"IMG"})}),e.jsx("input",{type:"file",accept:"image/*",onChange:A=>{const ee=A.target.files[0];if(ee){const le=new FileReader;le.onload=ne=>{L(Ae=>({...Ae,[d.name]:{...Ae[d.name],customThumbnail:ne.target.result,customThumbnailFile:ee}}))},le.readAsDataURL(ee)}},className:"flex-1 text-sm text-gray-500 file:mr-4 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-sm file:font-medium file:bg-pink-50 file:text-pink-700 hover:file:bg-pink-100"})]})]})]})]},D)}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Etiquetas para todos los videos"}),x.map(d=>e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 capitalize",children:d.name}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.tags.map(D=>{var M;return e.jsx("button",{onClick:()=>De(d.key,D),className:`px-3 py-1 rounded-full text-sm font-medium transition-all duration-200 ${(M=V[d.key])!=null&&M.includes(D)?"bg-gradient-to-r from-pink-500 to-orange-500 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:D},D)})})]},d.key))]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(bt,{className:"h-5 w-5 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-800 font-medium",children:"InformaciÃ³n"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Personaliza cada video individualmente y aplica etiquetas que se usarÃ¡n para todos los videos seleccionados."})]})]})})]}),U=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Subiendo Videos"}),e.jsxs("p",{className:"text-gray-600",children:["Procesando ",m.length," video(s)..."]})]}),m.map((d,D)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-900",children:d.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:[j[D]||0,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-pink-500 to-orange-500 h-2 rounded-full transition-all duration-300",style:{width:`${j[D]||0}%`}})})]},D))]}),G=()=>{switch(O){case 1:return e.jsx(k,{});case 2:return e.jsx(P,{});case 3:return e.jsx(U,{});default:return e.jsx(k,{})}},W=()=>{switch(O){case 1:return m.length>0;case 2:return!0;case 3:return!1;default:return!1}},X=()=>{O===2?he():(_(d=>d+1),O===1&&ue(new Set(m.map(d=>d.name))))},oe=()=>{_(d=>Math.max(1,d-1))};return a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-pink-500 to-orange-500 rounded-full",children:e.jsx(ts,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Subir Videos"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Paso ",O," de 3"]})]})]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",children:e.jsx(et,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:G()}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:oe,disabled:O===1||p,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"AtrÃ¡s"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:r,disabled:p,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),O<3&&e.jsx("button",{onClick:X,disabled:!W()||p,className:"px-6 py-2 bg-gradient-to-r from-pink-500 to-orange-500 text-white rounded-lg font-medium hover:shadow-lg transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:O===2?"Subir Videos":"Siguiente"})]})]})]})}),B.map(d=>e.jsx(vt,{message:d.message,type:d.type,onClose:()=>Pe(d.id)},d.id))]}):null},_a=({isOpen:a,onClose:r,video:t,onVideoUpdated:o,page:l="figuras",style:c="salsa"})=>{const{user:h}=It(),{currentCategories:x,categoriesList:i}=wt(l,c),[m,y]=n.useState(!1),[p,T]=n.useState([]),[j,f]=n.useState(""),[O,_]=n.useState(""),[w,L]=n.useState(null),[B,v]=n.useState(null),[V,q]=n.useState({}),[J,ae]=n.useState({}),[ue,ye]=n.useState({}),[re,Pe]=n.useState(new Set(["tags-iniciales","tags-finales"]));n.useEffect(()=>{if(!(!a||!t)&&(f(t.title||""),_(t.description||""),L(t.thumbnailUrl||null),v(null),x)){const k={},P={},U={};Object.keys(x).forEach(G=>{var W,X,oe;k[G]=((W=t.tags)==null?void 0:W[G])||[],P[G]=((X=t.tagsIniciales)==null?void 0:X[G])||[],U[G]=((oe=t.tagsFinales)==null?void 0:oe[G])||[]}),q(k),ae(P),ye(U)}},[a,t,x]),n.useEffect(()=>{a||(f(""),_(""),L(null),v(null),q({}),ae({}),ye({}))},[a]);const we=(k,P="success")=>{const U=Date.now();T(G=>[...G,{id:U,message:k,type:P}])},$e=k=>{T(P=>P.filter(U=>U.id!==k))},Te=k=>{Pe(P=>{const U=new Set(P);return U.has(k)?U.delete(k):U.add(k),U})},be=(k,P)=>{q(U=>{const G=U[k]||[];if(G.includes(P))return{...U,[k]:G.filter(X=>X!==P)};{const X=[...new Set([...G,P])];return{...U,[k]:X}}})},De=(k,P)=>{ae(U=>{const G=U[k]||[];if(G.includes(P))return{...U,[k]:G.filter(X=>X!==P)};{const X=[...new Set([...G,P])];return{...U,[k]:X}}})},Le=(k,P)=>{ye(U=>{const G=U[k]||[];if(G.includes(P))return{...U,[k]:G.filter(X=>X!==P)};{const X=[...new Set([...G,P])];return{...U,[k]:X}}})},I=k=>{const P=k.target.files[0];if(P){const U=new FileReader;U.onload=G=>{L(G.target.result),v(P)},U.readAsDataURL(P)}},fe=async k=>{try{const P=document.createElement("video");P.src=k,await new Promise((U,G)=>{P.onloadedmetadata=()=>{const W=P.videoWidth,X=P.videoHeight,oe=Math.max(W,X);let d="Unknown";oe>=3840?d="4K":oe>=1920?d="1080p":oe>=1280?d="720p":oe>=854?d="480p":d="360p",U({resolution:d,videoWidth:W,videoHeight:X})},P.onerror=G,setTimeout(()=>G(new Error("Timeout")),1e4)})}catch(P){return console.warn("No se pudo detectar la resoluciÃ³n del video:",P),{resolution:"Unknown",videoWidth:null,videoHeight:null}}},he=async()=>{if(t){y(!0);try{let k=t.thumbnailUrl,P=t.thumbnailPath;if(B){const D=`thumbnails/${Date.now()}_${t.originalTitle.replace(/\.[^/.]+$/,".jpg")}`,M=await mt(B,D);if(M.success)k=M.url,P=M.path;else{we("Error al subir el nuevo thumbnail","error"),y(!1);return}}const U={...V,estilo:V.estilo||[]};let G=t.resolution,W=t.videoWidth,X=t.videoHeight;if(!G||G==="Unknown")try{const D=await fe(t.videoUrl);G=D.resolution,W=D.videoWidth,X=D.videoHeight}catch(D){console.warn("No se pudo detectar la resoluciÃ³n:",D),G="Unknown"}const oe={title:j.trim(),description:O.trim(),thumbnailUrl:k,thumbnailPath:P,resolution:G,videoWidth:W,videoHeight:X,tags:U,tagsIniciales:J,tagsFinales:ue,updatedBy:(h==null?void 0:h.uid)||"anonymous",updatedAt:new Date().toISOString()},d=await Mt(t.id,oe);d.success?(we("Video actualizado exitosamente","success"),o({...t,...oe}),r()):we(`Error al actualizar video: ${d.error}`,"error")}catch(k){console.error("Error updating video:",k),we("Error inesperado al actualizar video","error")}y(!1)}};return!a||!t?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full",children:e.jsx(Ut,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Editar Video"}),e.jsx("p",{className:"text-sm text-gray-500",children:t.title})]})]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",children:e.jsx(et,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Vista previa del video"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(yt,{src:t.videoUrl,size:"medium",loop:!0,showControls:!0,autoplay:!1,muted:!1,className:"w-full max-w-2xl",resolutions:["auto","4k","1080p","720p","480p","360p"],currentResolution:"auto",videoTitle:t.title||"video",onResolutionChange:k=>{}})}),e.jsx("div",{className:"flex items-center justify-between text-sm text-gray-600",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:t.originalTitle}),e.jsx("span",{className:"text-gray-400",children:"â€¢"}),e.jsxs("span",{children:[(t.fileSize/(1024*1024)).toFixed(2)," MB"]}),t.resolution&&t.resolution!=="Unknown"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"â€¢"}),e.jsx("span",{children:t.resolution})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"TÃ­tulo del video"}),e.jsx("input",{type:"text",value:j,onChange:k=>f(k.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-500",placeholder:"Ingresa un tÃ­tulo para el video"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"DescripciÃ³n"}),e.jsx("textarea",{value:O,onChange:k=>_(k.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-500",placeholder:"Describe brevemente el contenido del video..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Thumbnail personalizado"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-40 h-24 bg-gray-100 rounded border-2 border-dashed border-gray-300 flex items-center justify-center",children:w?e.jsx("img",{src:w,alt:"Thumbnail",className:"w-full h-full object-cover rounded"}):e.jsx("span",{className:"text-xs text-gray-500",children:"IMG"})}),e.jsx("input",{type:"file",accept:"image/*",onChange:I,className:"flex-1 text-sm text-gray-500 file:mr-4 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Tags Normales"}),i.map(k=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-gray-700 capitalize",children:k.name}),e.jsx("div",{className:"flex flex-wrap gap-2",children:k.tags.map(P=>{var U;return e.jsx("button",{onClick:()=>be(k.key,P),className:`px-3 py-1 rounded-full text-sm font-medium transition-all duration-200 ${(U=V[k.key])!=null&&U.includes(P)?"bg-gradient-to-r from-pink-500 to-orange-500 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:P},P)})})]},k.key))]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("button",{onClick:()=>Te("tags-iniciales"),className:"flex items-center justify-between w-full p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg hover:from-blue-100 hover:to-purple-100 transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(gs,{className:"h-5 w-5 text-blue-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Tags Iniciales (cÃ³mo empieza la figura)"})]}),re.has("tags-iniciales")?e.jsx(Pt,{className:"h-5 w-5 text-gray-500"}):e.jsx(zt,{className:"h-5 w-5 text-gray-500"})]}),e.jsx("div",{className:`mt-4 transition-all duration-300 ease-in-out overflow-hidden ${re.has("tags-iniciales")?"max-h-0 opacity-0":"max-h-96 opacity-100"}`,children:e.jsx("div",{className:"space-y-4 bg-blue-50 rounded-lg p-4",children:i.map(k=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("h6",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:k.name}),e.jsx("div",{className:"flex flex-wrap gap-2",children:k.tags.map(P=>{var U;return e.jsx("button",{onClick:()=>De(k.key,P),className:`px-2 py-1 rounded-full text-xs font-medium transition-all duration-200 ${(U=J[k.key])!=null&&U.includes(P)?"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg":"bg-white text-gray-700 hover:bg-blue-100"}`,children:P},`inicial-${P}`)})})]},`inicial-${k.key}`))})})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("button",{onClick:()=>Te("tags-finales"),className:"flex items-center justify-between w-full p-4 bg-gradient-to-r from-green-50 to-teal-50 rounded-lg hover:from-green-100 hover:to-teal-100 transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(gs,{className:"h-5 w-5 text-green-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Tags Finales (cÃ³mo termina la figura)"})]}),re.has("tags-finales")?e.jsx(Pt,{className:"h-5 w-5 text-gray-500"}):e.jsx(zt,{className:"h-5 w-5 text-gray-500"})]}),e.jsx("div",{className:`mt-4 transition-all duration-300 ease-in-out overflow-hidden ${re.has("tags-finales")?"max-h-0 opacity-0":"max-h-96 opacity-100"}`,children:e.jsx("div",{className:"space-y-4 bg-green-50 rounded-lg p-4",children:i.map(k=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("h6",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:k.name}),e.jsx("div",{className:"flex flex-wrap gap-2",children:k.tags.map(P=>{var U;return e.jsx("button",{onClick:()=>Le(k.key,P),className:`px-2 py-1 rounded-full text-xs font-medium transition-all duration-200 ${(U=ue[k.key])!=null&&U.includes(P)?"bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-lg":"bg-white text-gray-700 hover:bg-green-100"}`,children:P},`final-${P}`)})})]},`final-${k.key}`))})})]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(bt,{className:"h-5 w-5 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-800 font-medium",children:"InformaciÃ³n"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Los tags iniciales y finales ayudarÃ¡n a crear secuencias lÃ³gicas conectando figuras."})]})]})})]})}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:r,disabled:m,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),e.jsx("button",{onClick:he,disabled:m||!j.trim(),className:"px-6 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg font-medium hover:shadow-lg transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:m?"Guardando...":"Guardar Cambios"})]})]})}),p.map(k=>e.jsx(vt,{message:k.message,type:k.type,onClose:()=>$e(k.id)},k.id))]})};let ct=null;const Bt=async()=>{if(ct&&ct.FS)return console.log("âœ… FFmpeg ya inicializado, reutilizando instancia"),ct;console.log("ðŸŽ¬ Inicializando FFmpeg..."),ct=new Ea;try{return await ct.load(),console.log("âœ… FFmpeg inicializado correctamente"),ct}catch(a){throw console.error("âŒ Error al inicializar FFmpeg:",a),ct=null,new Error("No se pudo inicializar FFmpeg")}},Wa=async(a,r,t="output.mp4")=>{try{console.log(`ðŸŽ¬ Ajustando velocidad del video: factor ${r}`);const o=await Bt();if(!o||!o.FS)throw new Error("FFmpeg no estÃ¡ correctamente inicializado");o.FS("writeFile","input.mp4",await os(a));try{await o.run("-i","input.mp4","-filter:v",`setpts=${1/r}*PTS`,"-filter:a",`atempo=${r}`,"-c:v","libx264","-c:a","aac","-preset","fast",t)}catch(c){console.log("âš ï¸ Error con audio, procesando solo video:",c.message),await o.run("-i","input.mp4","-filter:v",`setpts=${1/r}*PTS`,"-c:v","libx264","-an","-preset","fast",t)}const l=o.FS("readFile",t);try{o.FS("unlink","input.mp4"),o.FS("unlink",t)}catch{console.warn("âš ï¸ No se pudieron limpiar archivos temporales")}return console.log("âœ… Velocidad ajustada correctamente"),{success:!0,data:l,error:null}}catch(o){return console.error("âŒ Error al ajustar velocidad:",o),{success:!1,data:null,error:o.message}}},Ga=async(a,r=!1,t=null)=>{try{console.log(`ðŸŽ¬ Creando preview de secuencia con ${a.length} videos...`),console.log(`ðŸŽ¬ Control BPM: ${r?"Activado":"Desactivado"}`),r&&t&&console.log(`ðŸŽ¬ BPM objetivo: ${t}`);const o=await Bt(),l=[],c=r&&t;for(let i=0;i<a.length;i++){const m=a[i];let y;if(m.file)y=m.file,console.log(`âœ… Video ${i+1}/${a.length}: ${m.title} (archivo local)`);else if(m.videoUrl){console.log(`ðŸ“¥ Descargando video ${i+1}/${a.length} desde URL...`);try{const p=await fetch(m.videoUrl,{mode:"cors",credentials:"omit",headers:{Accept:"video/*,*/*;q=0.9","Cache-Control":"no-cache"}});if(!p.ok)throw new Error(`HTTP ${p.status}: ${p.statusText}`);y=await p.blob(),console.log(`âœ… Video ${i+1}/${a.length}: ${m.title} descargado (${y.size} bytes)`)}catch(p){console.warn(`âš ï¸ Error en fetch directo: ${p.message}`);try{const{getStorage:T,ref:j,getDownloadURL:f}=await ot(async()=>{const{getStorage:v,ref:V,getDownloadURL:q}=await import("./firebase-storage-8aoBMGXB.js");return{getStorage:v,ref:V,getDownloadURL:q}},__vite__mapDeps([0,1])),O=T();let _=m.videoUrl;if(m.videoUrl.includes("firebasestorage.googleapis.com")){const v=m.videoUrl.split("/o/");v.length>1&&(_=decodeURIComponent(v[1].split("?")[0]))}const w=j(O,_),L=await f(w),B=await fetch(L);if(!B.ok)throw new Error(`HTTP ${B.status}: ${B.statusText}`);y=await B.blob(),console.log(`âœ… Video ${i+1}/${a.length}: ${m.title} descargado via Firebase (${y.size} bytes)`)}catch(T){throw new Error(`Error descargando video ${i+1} (${m.title}): ${T.message}`)}}}else throw new Error(`Video ${i+1} (${m.title}) no tiene archivo ni URL asociada`);if(c&&m.bpm){const p=t/m.bpm;console.log(`ðŸŽ¬ Procesando video ${i+1}/${a.length}: ${m.title} (BPM: ${m.bpm} â†’ ${t}, factor: ${p.toFixed(2)}x)`);const T=await Wa(y,p,`preview${i}.mp4`);if(!T.success)throw new Error(`Error al procesar video ${i+1} (${m.title}): ${T.error}`);l.push(T.data)}else console.log(`ðŸŽ¬ Usando video ${i+1}/${a.length}: ${m.title} (sin procesamiento)`),l.push(y)}console.log("ðŸŽ¬ Concatenando videos para preview...");for(let i=0;i<l.length;i++){const m=l[i],y=m instanceof Blob?await os(m):m;o.FS("writeFile",`preview${i}.mp4`,y),console.log(`ðŸ“ Video ${i+1}/${l.length} escrito al sistema de archivos`)}const h=l.map((i,m)=>`file preview${m}.mp4`).join(`
`);o.FS("writeFile","filelist.txt",h),console.log("ðŸ“‹ Lista de archivos creada"),console.log("ðŸ”— Iniciando concatenaciÃ³n..."),await o.run("-f","concat","-safe","0","-i","filelist.txt","-c","copy","-avoid_negative_ts","make_zero","sequence_preview.mp4"),console.log("âœ… ConcatenaciÃ³n completada");const x=o.FS("readFile","sequence_preview.mp4");for(let i=0;i<l.length;i++)try{o.FS("unlink",`preview${i}.mp4`)}catch{console.warn(`âš ï¸ No se pudo limpiar archivo temporal preview${i}.mp4`)}try{o.FS("unlink","filelist.txt"),o.FS("unlink","sequence_preview.mp4")}catch{console.warn("âš ï¸ No se pudieron limpiar algunos archivos temporales")}return console.log("âœ… Preview de secuencia creado correctamente"),{success:!0,data:x,error:null}}catch(o){return console.error("âŒ Error al crear preview de secuencia:",o),{success:!1,data:null,error:o.message}}},Us=async(a,r="mp4",t="720p")=>{try{console.log(`ðŸŽ¬ Convirtiendo video a formato ${r} con resoluciÃ³n ${t}...`);const o=await Bt();o.FS("writeFile","input.mp4",await os(a));let l=[],c=[];switch(t){case"360p":l=["-vf","scale=-1:360"],c=["-crf","28","-preset","ultrafast"];break;case"480p":l=["-vf","scale=-1:480"],c=["-crf","25","-preset","fast"];break;case"720p":l=["-vf","scale=-1:720"],c=["-crf","23","-preset","fast"];break;case"1080p":l=["-vf","scale=-1:1080"],c=["-crf","20","-preset","medium"];break;case"4k":l=["-vf","scale=-1:2160"],c=["-crf","18","-preset","medium"];break;default:l=["-vf","scale=-1:720"],c=["-crf","23","-preset","fast"]}await o.run("-i","input.mp4",...l,...c,`output.${r}`);const h=o.FS("readFile",`output.${r}`);return o.FS("unlink","input.mp4"),o.FS("unlink",`output.${r}`),console.log("âœ… Video convertido correctamente"),{success:!0,data:h,format:r,error:null}}catch(o){return console.error("âŒ Error al convertir video:",o),{success:!1,data:null,format:null,error:o.message}}},Ss=async a=>{try{if(console.log(`ðŸ“¥ Descarga directa de secuencia: ${a.name}`),!a.videos||a.videos.length===0)throw new Error("La secuencia no tiene videos");if(a.videos.length===1){const c=a.videos[0];if(c.file)return{success:!0,data:c.file,format:"mp4",error:null};if(c.videoUrl){const h=await fetch(c.videoUrl);if(!h.ok)throw new Error("Error descargando video");return{success:!0,data:await h.blob(),format:"mp4",error:null}}}const r=await ot(()=>import("./vendor-jszip-B6VlRRbe.js").then(c=>c.j),__vite__mapDeps([2,3])),t=new r.default,o=(a.name||a.title||"secuencia").replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s+/g,"_").toLowerCase();for(let c=0;c<a.videos.length;c++){const h=a.videos[c];let x;if(h.file)x=h.file;else if(h.videoUrl){const m=await fetch(h.videoUrl);if(!m.ok)throw new Error(`Error descargando video ${c+1}`);x=await m.blob()}else throw new Error(`Video ${c+1} no tiene archivo ni URL`);const i=`${o}_${c+1}.mp4`;t.file(i,x),console.log(`ðŸ“ Agregando al ZIP: ${i}`)}return{success:!0,data:await t.generateAsync({type:"blob"}),format:"zip",error:null}}catch(r){return console.error("âŒ Error en descarga directa:",r),{success:!1,data:null,format:null,error:r.message}}},Ka=async(a,r="mp4",t="720p")=>{try{if(console.log(`ðŸŽ¬ Generando video de secuencia: ${a.name}`),console.log(`ðŸ“¹ Formato: ${r}, ResoluciÃ³n: ${t}`),!a.videos||a.videos.length===0)throw new Error("La secuencia no tiene videos");const o=a.useBPMControl||!1,l=a.targetBPM||null;if(console.log(`ðŸŽµ ConfiguraciÃ³n BPM: ${o?"Activado":"Desactivado"}, BPM: ${l}`),!o||!l)return console.log("ðŸš€ Usando descarga directa (sin FFmpeg)"),await Ss(a);console.log("ðŸŽ¬ Intentando inicializar FFmpeg...");const c=Bt(),h=new Promise((i,m)=>setTimeout(()=>m(new Error("Timeout inicializando FFmpeg")),1e4));try{await Promise.race([c,h])}catch{return console.warn("âš ï¸ FFmpeg no pudo inicializarse, usando descarga directa"),await Ss(a)}const x=await Ga(a.videos,o,l);if(!x.success)throw new Error(`Error generando video: ${x.error}`);if(r!=="mp4"||t!=="720p"){console.log(`ðŸ”„ Convirtiendo a formato ${r} con resoluciÃ³n ${t}...`);const i=await Us(new Blob([x.data],{type:"video/mp4"}),r,t);if(!i.success)throw new Error(`Error convirtiendo formato: ${i.error}`);return{success:!0,data:i.data,format:r,error:null}}return{success:!0,data:x.data,format:"mp4",error:null}}catch(o){return console.error("âŒ Error generando video de secuencia:",o),{success:!1,data:null,format:null,error:o.message}}},Za=({isOpen:a,onClose:r,video:t,onDownloadComplete:o})=>{const[l,c]=n.useState("mp4"),[h,x]=n.useState("720p"),[i,m]=n.useState(!1),[y,p]=n.useState(0),T=[{value:"mp4",label:"MP4",description:"Formato estÃ¡ndar, compatible con todo"},{value:"avi",label:"AVI",description:"Formato clÃ¡sico, buena calidad"},{value:"mov",label:"MOV",description:"Formato Apple, alta calidad"},{value:"webm",label:"WebM",description:"Formato web, archivos pequeÃ±os"}],j=[{value:"360p",label:"360p",description:"Calidad baja, archivo pequeÃ±o"},{value:"480p",label:"480p",description:"Calidad estÃ¡ndar, balance"},{value:"720p",label:"720p",description:"HD, buena calidad"},{value:"1080p",label:"1080p",description:"Full HD, alta calidad"},{value:"4k",label:"4K",description:"Ultra HD, mÃ¡xima calidad"}],f=async()=>{if(!t){console.error("No hay video para descargar");return}m(!0),p(0);try{const w=setInterval(()=>{p(B=>B>=90?(clearInterval(w),90):B+10)},500);let L;try{if(t.videos&&Array.isArray(t.videos))L=await Ka(t,l,h);else if(t.file)L=await Us(t.file,l,h);else throw new Error("Formato de video no vÃ¡lido");clearInterval(w),p(100),await new Promise(B=>setTimeout(B,200))}catch(B){throw clearInterval(w),B}if(L.success){const B=L.format==="zip"?"application/zip":`video/${L.format||l}`,v=new Blob([L.data],{type:B});try{const V=await O();if(V){const q=L.format==="zip"?"zip":L.format||l,J=`${t.title||t.name}_${h}.${q}`,ue=await(await V.getFileHandle(J,{create:!0})).createWritable();await ue.write(v),await ue.close()}else{const q=URL.createObjectURL(v),J=document.createElement("a");J.href=q;const ae=L.format==="zip"?"zip":L.format||l;J.download=`${t.title||t.name}_${h}.${ae}`,document.body.appendChild(J),J.click(),document.body.removeChild(J),URL.revokeObjectURL(q)}o&&o(),r()}catch(V){throw console.error("Error al guardar archivo:",V),new Error("Error al guardar el archivo")}}else throw new Error(L.error)}catch(w){console.error("âŒ Error al descargar video:",w),alert(`Error al procesar video: ${w.message}`)}finally{m(!1),p(0)}},O=async()=>{try{return"showDirectoryPicker"in window?await window.showDirectoryPicker():null}catch{return null}},_=async()=>{if(!t||!t.file){console.error("No hay video para descargar");return}try{const w=await O();if(w){const L=`${t.title||t.name}.mp4`,v=await(await w.getFileHandle(L,{create:!0})).createWritable();await v.write(t.file),await v.close()}else{const L=URL.createObjectURL(t.file),B=document.createElement("a");B.href=L,B.download=t.title||"video",document.body.appendChild(B),B.click(),document.body.removeChild(B),URL.revokeObjectURL(L)}r()}catch(w){console.error("Error en descarga directa:",w),alert("Error al descargar el archivo")}};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(at,{className:"h-5 w-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:t!=null&&t.videos?"Descargar Secuencia":"Descargar Video"})]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(et,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ha,{className:"h-8 w-8 text-gray-400"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-gray-800 truncate",children:(t==null?void 0:t.title)||(t==null?void 0:t.name)||"Sin tÃ­tulo"}),t!=null&&t.videos?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[t.videos.length," videos â€¢ DuraciÃ³n aproximada: ",Math.floor(t.videos.length*30/60),":",(t.videos.length*30%60).toString().padStart(2,"0")]}),t.useBPMControl&&t.targetBPM&&e.jsxs("p",{className:"text-sm text-purple-600",children:["BPM ajustado: ",t.targetBPM]}),t.description&&e.jsx("p",{className:"text-sm text-gray-600",children:t.description})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:t!=null&&t.fileSize?`${(t.fileSize/(1024*1024)).toFixed(2)} MB`:"TamaÃ±o desconocido"}),(t==null?void 0:t.bpm)&&e.jsxs("p",{className:"text-sm text-purple-600",children:["BPM: ",t.bpm]})]})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Formato de salida"}),e.jsx("div",{className:"space-y-2",children:T.map(w=>e.jsxs("label",{className:`flex items-center p-3 border rounded-lg cursor-pointer transition-colors ${l===w.value?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"format",value:w.value,checked:l===w.value,onChange:L=>c(L.target.value),className:"sr-only"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 flex items-center justify-center ${l===w.value?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:l===w.value&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:w.label}),e.jsx("div",{className:"text-sm text-gray-500",children:w.description})]})]})]},w.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"ResoluciÃ³n"}),e.jsx("div",{className:"space-y-2",children:j.map(w=>e.jsxs("label",{className:`flex items-center p-3 border rounded-lg cursor-pointer transition-colors ${h===w.value?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"resolution",value:w.value,checked:h===w.value,onChange:L=>x(L.target.value),className:"sr-only"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 flex items-center justify-center ${h===w.value?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:h===w.value&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:w.label}),e.jsx("div",{className:"text-sm text-gray-500",children:w.description})]})]})]},w.value))})]}),i&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"Procesando video..."}),e.jsxs("span",{children:[y,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${y}%`}})})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:_,disabled:i,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:"Descargar original"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:r,disabled:i,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:f,disabled:i,className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${i?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:i?"Procesando...":"Descargar"})]})]})]})}):null},ft=({isOpen:a,onClose:r,onConfirm:t,title:o="Confirmar acciÃ³n",message:l="Â¿EstÃ¡s seguro de que quieres realizar esta acciÃ³n?",confirmText:c="Confirmar",cancelText:h="Cancelar",type:x="warning"})=>{if(!a)return null;const i=()=>{switch(x){case"danger":return e.jsx(Lt,{className:"w-8 h-8 text-red-500"});case"warning":return e.jsx(Lt,{className:"w-8 h-8 text-orange-500"});case"info":return e.jsx(Lt,{className:"w-8 h-8 text-blue-500"});default:return e.jsx(Lt,{className:"w-8 h-8 text-orange-500"})}},m=()=>{switch(x){case"danger":return"bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600";case"warning":return"bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600";case"info":return"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600";default:return"bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600"}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:r}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[i(),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:o})]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(et,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"text-gray-600 leading-relaxed whitespace-pre-line",children:l})}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors font-medium",children:h}),e.jsx("button",{onClick:()=>{t(),r()},className:`px-4 py-2 text-white rounded-lg transition-all font-medium ${m()}`,children:c})]})]})]})},qt="sequences",Xa=async a=>{console.log("ðŸ”¥ Firebase: Creando secuencia..."),console.log("ðŸ“¦ Datos de secuencia:",a);try{const r={...a,createdAt:as(),updatedAt:as()};console.log("â° Secuencia con timestamps:",r);const t=await Ma(Ps(Ot,qt),r);console.log("ðŸ“„ Documento creado con ID:",t.id);const o={id:t.id,...a,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return console.log("âœ… Secuencia creada exitosamente:",o),o}catch(r){throw console.error("âŒ Error al crear secuencia:",r),new Error("No se pudo crear la secuencia")}},Qa=async(a,r)=>{try{const t=zs(Ot,qt,a),o={...r,updatedAt:as()};return await Ra(t,o),{id:a,...r,updatedAt:new Date().toISOString()}}catch(t){throw console.error("Error al actualizar secuencia:",t),new Error("No se pudo actualizar la secuencia")}},Ya=async a=>{try{const r=zs(Ot,qt,a);return await Da(r),{success:!0}}catch(r){throw console.error("Error al eliminar secuencia:",r),new Error("No se pudo eliminar la secuencia")}},Ja=(a,r)=>{console.log("ðŸŽ¬ Firebase: SuscribiÃ©ndose a secuencias para estilo:",a);try{const t=Ca(Ps(Ot,qt),$a("style","==",a),Ta("createdAt","desc"));return La(t,o=>{console.log(`ðŸŽ¬ Firebase: ActualizaciÃ³n recibida - ${o.size} secuencias para ${a}`);const l=[];o.forEach(c=>{var i,m,y,p,T,j,f;const h=c.data(),x={id:c.id,...h,createdAt:((y=(m=(i=h.createdAt)==null?void 0:i.toDate)==null?void 0:m.call(i))==null?void 0:y.toISOString())||h.createdAt,updatedAt:((j=(T=(p=h.updatedAt)==null?void 0:p.toDate)==null?void 0:T.call(p))==null?void 0:j.toISOString())||h.updatedAt};l.push(x),console.log(`ðŸ“‹ Secuencia cargada: ${x.name} (${((f=x.videos)==null?void 0:f.length)||0} videos)`)}),console.log(`ðŸŽ‰ Total de secuencias cargadas: ${l.length}`),r(l)})}catch(t){throw console.error("âŒ Error al suscribirse a secuencias por estilo:",t),new Error("No se pudo suscribir a las secuencias")}},er=a=>{const[r,t]=n.useState(null),[o,l]=n.useState(null),c=n.useCallback(T=>{t(T)},[]),h=n.useCallback((T,j)=>{T.preventDefault(),l(j)},[]),x=n.useCallback((T,j)=>{T.preventDefault(),l(j)},[]),i=n.useCallback(T=>{T.preventDefault(),l(null)},[]),m=n.useCallback((T,j)=>{T.preventDefault(),r!==null&&r!==j&&a(r,j),t(null),l(null)},[r,a]),y=n.useCallback(()=>{t(null),l(null)},[]),p=n.useCallback(T=>{const j={cursor:"grab",transition:"all 0.2s ease",transform:"scale(1)",opacity:1};return r===T&&(j.cursor="grabbing",j.transform="scale(1.05) rotate(2deg)",j.opacity=.7,j.zIndex=1e3),o===T&&r!==T&&(j.transform="scale(1.02)",j.borderLeft="4px solid #3b82f6",j.backgroundColor="#f0f9ff"),j},[r,o]);return{draggedIndex:r,dragOverIndex:o,handleDragStart:c,handleDragOver:h,handleDragEnter:x,handleDragLeave:i,handleDrop:m,handleDragEnd:y,getDragStyles:p}},rs=({videos:a,currentBPM:r=null,className:t="",showControls:o=!0,autoplay:l=!1,loop:c=!1,muted:h=!1})=>{const[x,i]=n.useState(0),[m,y]=n.useState(!1),[p,T]=n.useState(h),[j,f]=n.useState(!1),[O,_]=n.useState(o),[w,L]=n.useState(0),[B,v]=n.useState(0),[V,q]=n.useState(1),[J,ae]=n.useState(1),[ue,ye]=n.useState(!1),[re,Pe]=n.useState(null),[we,$e]=n.useState(!1),[Te,be]=n.useState(0),[De,Le]=n.useState(0),[I,fe]=n.useState(!1),[he,k]=n.useState(!1),[P,U]=n.useState(!1),[G,W]=n.useState(0),[X,oe]=n.useState(0),[d,D]=n.useState(null),[M,H]=n.useState(!1),[z,Q]=n.useState(1),[te,me]=n.useState(!0),A=n.useRef(null),ee=n.useRef(null),le=a[x],ne=[.25,.5,.75,1,1.25,1.5,2];n.useEffect(()=>{q(1),A.current&&(A.current.playbackRate=1)},[x]),n.useEffect(()=>{if(A.current&&I&&m&&he&&P){const C=A.current,K=()=>{C.currentTime>=De&&(C.currentTime=Te)};return C.addEventListener("timeupdate",K),()=>C.removeEventListener("timeupdate",K)}},[I,Te,De,m,he,P]),n.useEffect(()=>{if(o&&m){d&&clearTimeout(d);const C=setTimeout(()=>{_(!1)},4e3);D(C)}return()=>{d&&clearTimeout(d)}},[m,o]),n.useEffect(()=>()=>{d&&clearTimeout(d),re&&clearTimeout(re)},[]),n.useEffect(()=>{const C=K=>{M&&H(!1)};return document.addEventListener("click",C),()=>document.removeEventListener("click",C)},[M]);const Ae=()=>{_(!0),d&&clearTimeout(d)},ve=()=>{we&&!I?A.current&&(A.current.currentTime=0,A.current.play()):I&&he&&P?A.current&&(A.current.currentTime=Te,A.current.play()):y(!1)},Re=()=>{A.current&&L(A.current.currentTime)},xe=()=>{A.current&&(v(A.current.duration),A.current.playbackRate=z,q(z))},je=()=>{A.current&&(m?A.current.pause():A.current.play(),y(!m))},Ne=()=>{x>0&&(i(C=>C-1),L(0),A.current&&(A.current.currentTime=0))},ie=()=>{x<a.length-1&&(i(C=>C+1),L(0),A.current&&(A.current.currentTime=0))},Se=C=>{if(A.current){const K=Math.max(0,Math.min(B,w+C));A.current.currentTime=K,L(K)}},Ge=()=>{if(A.current){const C=!p;A.current.muted=C,T(C),C?A.current.volume=0:A.current.volume=J}},ze=C=>{const K=parseFloat(C.target.value);A.current&&(A.current.volume=K,ae(K),K===0?(A.current.muted=!0,T(!0)):(A.current.muted=!1,T(!1)))},S=()=>{try{document.fullscreenElement?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),f(!1)):(ee.current.requestFullscreen?ee.current.requestFullscreen():ee.current.webkitRequestFullscreen?ee.current.webkitRequestFullscreen():ee.current.msRequestFullscreen&&ee.current.msRequestFullscreen(),f(!0))}catch(C){console.error("Error toggling fullscreen:",C)}},Ie=C=>{if(A.current){const K=C.currentTarget.getBoundingClientRect(),g=(C.clientX-K.left)/K.width*B;A.current.currentTime=g,L(g)}},Oe=C=>{C==="start"?he?(k(!1),be(0)):(k(!0),be(w),W(w)):P?(U(!1),Le(0)):(U(!0),Le(w),oe(w))},ce=C=>{const K=Math.floor(C/60),qe=Math.floor(C%60);return`${K}:${qe.toString().padStart(2,"0")}`},Be=C=>{Q(C),A.current&&(A.current.playbackRate=C,q(C)),H(!1)},Ke=C=>C===1?"Normal":`${C}x`,rt=async()=>{try{if(le.videoUrl&&(le.videoUrl.includes("firebase")||le.videoUrl.includes("googleapis"))){const C=await fetch(le.videoUrl);if(!C.ok)throw new Error(`HTTP error! status: ${C.status}`);const K=await C.blob(),qe=URL.createObjectURL(K),Me=document.createElement("a");Me.href=qe,Me.download=le.title||"video.mp4",Me.style.display="none",document.body.appendChild(Me),Me.click(),document.body.removeChild(Me),setTimeout(()=>{URL.revokeObjectURL(qe)},1e3)}else{const C=document.createElement("a");C.href=le.videoUrl,C.download=le.title||"video.mp4",C.style.display="none",document.body.appendChild(C),C.click(),document.body.removeChild(C)}}catch(C){console.error("Error en descarga:",C),alert(`Error al descargar el video: ${C.message}`)}};return n.useEffect(()=>{const C=K=>{if(K.target.tagName!=="INPUT")switch(K.code){case"Space":K.preventDefault(),je();break;case"KeyF":K.preventDefault(),S();break;case"KeyM":K.preventDefault(),Ge();break;case"ArrowLeft":K.preventDefault(),K.ctrlKey||K.metaKey?Ne():Se(-10);break;case"ArrowRight":K.preventDefault(),K.ctrlKey||K.metaKey?ie():Se(10);break;case"KeyA":K.preventDefault(),Oe("start");break;case"KeyB":K.preventDefault(),Oe("end");break;case"KeyL":K.preventDefault(),$e(!we);break;case"KeyS":{K.preventDefault();const Me=(ne.indexOf(z)+1)%ne.length;Be(ne[Me]);break}}};return document.addEventListener("keydown",C),()=>document.removeEventListener("keydown",C)},[w,B,x,we,z]),le?e.jsxs("div",{ref:ee,className:`relative bg-black rounded-lg overflow-hidden ${t}`,onMouseEnter:Ae,onMouseLeave:()=>{if(m){const C=setTimeout(()=>{_(!1)},4e3);D(C)}},onTouchStart:Ae,onTouchMove:Ae,children:[e.jsx("video",{ref:A,src:le.videoUrl,className:"w-full h-full object-contain cursor-pointer",onEnded:ve,onTimeUpdate:Re,onLoadedMetadata:xe,onPlay:()=>y(!0),onPause:()=>y(!1),muted:p,autoPlay:l,loop:!1,onClick:Ae}),e.jsxs("div",{className:"absolute top-2 left-2 bg-black bg-opacity-75 text-white px-3 py-2 rounded-lg text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"font-medium",children:[x+1," / ",a.length]}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsx("span",{className:"max-w-xs truncate",children:le.title}),V!==1&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsxs("span",{className:"text-blue-400 font-medium",children:[V.toFixed(2),"x"]})]})]}),a.length>1&&e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Usa Ctrl+â†/â†’ para cambiar de video"})]}),O&&e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent flex flex-col justify-end",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 flex justify-end items-center",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:S,className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",children:j?e.jsx(Ts,{className:"w-4 h-4"}):e.jsx(Ls,{className:"w-4 h-4"})})})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:Ne,disabled:x===0,className:`p-2 rounded-full transition-colors z-10 ${x===0?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-black/60 text-white hover:bg-black/80"}`,title:"Video anterior (Ctrl+â†)",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-current flex items-center justify-center",children:e.jsx(Jt,{className:"w-1.5 h-1.5"})}),e.jsx("span",{className:"text-xs font-medium",children:"Anterior"})]})}),e.jsx("button",{onClick:()=>Se(-10),className:"p-3 rounded-full bg-black/60 text-white hover:bg-black/80 transition-colors z-10 hidden md:flex items-center justify-center",title:"Retroceder 10s (â†)",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center",children:e.jsx(Jt,{className:"w-3 h-3"})}),e.jsx("span",{className:"text-sm font-medium",children:"10"})]})}),e.jsx("button",{onClick:je,className:"p-4 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",title:"Play/Pause (Espacio)",children:m?e.jsx(Rs,{className:"w-8 h-8"}):e.jsx(We,{className:"w-8 h-8"})}),e.jsx("button",{onClick:()=>Se(10),className:"p-3 rounded-full bg-black/60 text-white hover:bg-black/80 transition-colors z-10 hidden md:flex items-center justify-center",title:"Adelantar 10s (â†’)",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"10"}),e.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center",children:e.jsx(es,{className:"w-3 h-3"})})]})}),e.jsx("button",{onClick:ie,disabled:x===a.length-1,className:`p-2 rounded-full transition-colors z-10 ${x===a.length-1?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-black/60 text-white hover:bg-black/80"}`,title:"Siguiente video (Ctrl+â†’)",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Siguiente"}),e.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-current flex items-center justify-center",children:e.jsx(es,{className:"w-1.5 h-1.5"})})]})})]})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[e.jsxs("div",{className:"flex justify-end mb-2 space-x-2",children:[e.jsx("button",{onClick:()=>$e(!we),className:`p-2 rounded-full transition-colors z-10 ${we?"bg-blue-500 text-white":"bg-white/20 text-white hover:bg-white/30"}`,title:"Bucle",children:e.jsx(Ms,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{const C=!I;fe(C),C?(G>0&&(k(!0),be(G)),X>0&&(U(!0),Le(X))):(k(!1),U(!1),be(0),Le(0))},className:`p-2 rounded-full transition-colors z-10 ${I?"bg-green-500 text-white":"bg-white/20 text-white hover:bg-white/30"}`,title:"Segmento A-B",children:e.jsx("div",{className:"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none",children:"A-B"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>H(!M),className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",title:"Velocidad de reproducciÃ³n",children:e.jsx("div",{className:"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none",children:z===1?"1x":`${z}x`})}),M&&e.jsx("div",{className:"absolute bottom-full right-0 mb-2 bg-black/90 rounded-lg p-2 z-20 min-w-[80px]",children:ne.map(C=>e.jsx("button",{onClick:()=>Be(C),className:`w-full text-left px-3 py-1 rounded text-xs transition-colors ${z===C?"bg-blue-500 text-white":"text-white hover:bg-white/20"}`,children:Ke(C)},C))})]}),e.jsx("button",{onClick:rt,className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",title:"Descargar video",children:e.jsx(at,{className:"w-4 h-4"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:Ge,className:"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10",onMouseEnter:()=>ye(!0),onMouseLeave:()=>{const C=setTimeout(()=>ye(!1),1e3);Pe(C)},children:p?e.jsx(Ds,{className:"w-4 h-4"}):e.jsx(As,{className:"w-4 h-4"})}),ue&&e.jsx("div",{className:"absolute bottom-full right-0 mb-2 bg-black/80 rounded-lg p-3 z-20",onMouseEnter:()=>{re&&(clearTimeout(re),Pe(null))},onMouseLeave:()=>{const C=setTimeout(()=>ye(!1),1e3);Pe(C)},children:e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:J,onChange:ze,className:"w-2 h-20 bg-gray-600 rounded-lg appearance-none cursor-pointer slider-vertical",style:{background:`linear-gradient(to top, #3b82f6 0%, #3b82f6 ${J*100}%, #4b5563 ${J*100}%, #4b5563 100%)`},orient:"vertical"}),e.jsxs("span",{className:"text-white text-xs",children:[Math.round(J*100),"%"]})]})})]})]}),e.jsx("div",{className:"relative mb-4",children:e.jsxs("div",{className:"w-full h-2 bg-white/20 rounded-full cursor-pointer relative",onClick:Ie,children:[e.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${w/B*100}%`}}),I&&he&&e.jsx("div",{className:"absolute top-0 w-1 h-full bg-green-500 z-10",style:{left:`${Te/B*100}%`}}),I&&P&&e.jsx("div",{className:"absolute top-0 w-1 h-full bg-red-500 z-10",style:{left:`${De/B*100}%`}})]})}),e.jsxs("div",{className:"flex items-center justify-between text-white text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:[ce(w)," / ",ce(B)]}),V!==1&&e.jsxs("span",{className:"text-blue-400 font-medium",children:[V.toFixed(2),"x"]}),I&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>Oe("start"),className:`px-2 py-1 rounded text-xs transition-colors ${he?"bg-green-500 text-white":"bg-gray-600 text-gray-300 hover:bg-gray-500"}`,children:["A: ",he?ce(Te):"--:--"]}),e.jsxs("button",{onClick:()=>Oe("end"),className:`px-2 py-1 rounded text-xs transition-colors ${P?"bg-red-500 text-white":"bg-gray-600 text-gray-300 hover:bg-gray-500"}`,children:["B: ",P?ce(De):"--:--"]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"text-xs opacity-75",children:we&&(I&&he&&P?"Bucle A-B":"Bucle completo")})})]}),a.length>1&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-300 mb-1",children:[e.jsx("span",{children:"Progreso de la secuencia"}),e.jsxs("span",{children:[x+1," de ",a.length]})]}),e.jsx("div",{className:"w-full h-1 bg-gray-600 rounded-full",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-300",style:{width:`${(x+1)/a.length*100}%`}})})]})]})]})]}):e.jsx("div",{className:`bg-black rounded-lg flex items-center justify-center ${t}`,children:e.jsx("div",{className:"text-white text-center",children:e.jsx("p",{children:"No hay videos en la secuencia"})})})};class tr{constructor(){this.isLoaded=!0}async load(){return Promise.resolve()}async combineVideos(r,t){try{console.log("Iniciando combinaciÃ³n con MediaRecorder optimizado..."),t&&t({stage:"init",current:0,total:100,message:"Iniciando MediaRecorder..."});const o=[];for(let c=0;c<r.length;c++){const h=r[c];console.log(`Descargando video ${c+1}/${r.length}: ${h.title}`),t&&t({stage:"download",current:(c+1)/r.length*50,total:100,message:`Descargando: ${h.title}`});try{const{ref:x,getDownloadURL:i}=await ot(async()=>{const{ref:f,getDownloadURL:O}=await import("./firebase-storage-8aoBMGXB.js");return{ref:f,getDownloadURL:O}},__vite__mapDeps([0,1])),{storage:m}=await ot(async()=>{const{storage:f}=await import("./index-DOeBVGYV.js").then(O=>O.x);return{storage:f}},__vite__mapDeps([4,3,5,1,6,7,0,8,9])),y=x(m,h.videoPath),p=await i(y);console.log(`URL de descarga obtenida para ${h.title}:`,p);const T=await fetch(p);if(!T.ok)throw new Error(`Error descargando video: ${T.statusText}`);const j=await T.blob();o.push(j),console.log(`Video ${c+1} descargado: ${h.title}`)}catch(x){throw console.error(`Error con video ${h.title}:`,x),new Error(`Error procesando video ${h.title}: ${x.message}`)}}t&&t({stage:"combine",current:50,total:100,message:"Combinando videos..."});const l=await this.combineVideoBlobs(o);return t&&t({stage:"complete",current:100,total:100,message:"Â¡CombinaciÃ³n completada!"}),console.log("CombinaciÃ³n completada, archivo creado"),l}catch(o){throw console.error("Error combinando videos:",o),new Error(`Error combinando videos: ${o.message}`)}}async combineVideoBlobs(r){return new Promise((t,o)=>{try{const l=document.createElement("canvas"),c=l.getContext("2d");l.width=1920,l.height=1080;const h=l.captureStream(60),x=new MediaRecorder(h,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:3e7}),i=[];x.ondataavailable=p=>{p.data.size>0&&i.push(p.data)},x.onstop=()=>{const p=new Blob(i,{type:"video/webm"});t(p)},x.onerror=p=>{o(p)},x.start();let m=0;const y=()=>{if(m>=r.length){x.stop();return}const p=r[m],T=URL.createObjectURL(p),j=document.createElement("video");j.onloadedmetadata=()=>{j.currentTime=0,j.muted=!1,j.volume=1,j.play()},j.ontimeupdate=()=>{c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.clearRect(0,0,l.width,l.height);const f=j.videoWidth/j.videoHeight,O=l.width/l.height;let _,w,L,B;f>O?(_=l.width,w=l.width/f,L=0,B=(l.height-w)/2):(w=l.height,_=l.height*f,L=(l.width-_)/2,B=0),c.drawImage(j,L,B,_,w)},j.onplay=()=>{const f=()=>{if(!j.paused&&!j.ended){c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.clearRect(0,0,l.width,l.height);const O=j.videoWidth/j.videoHeight,_=l.width/l.height;let w,L,B,v;O>_?(w=l.width,L=l.width/O,B=0,v=(l.height-L)/2):(L=l.height,w=l.height*O,B=(l.width-w)/2,v=0),c.drawImage(j,B,v,w,L),requestAnimationFrame(f)}};requestAnimationFrame(f)},j.onended=()=>{URL.revokeObjectURL(T),m++,setTimeout(y,100)},j.src=T};y()}catch(l){o(l)}})}async combineVideosSimple(r,t){return this.combineVideos(r,t)}async cleanup(r){try{console.log("Limpiando archivos temporales...");for(const t of r)await this.ffmpeg.deleteFile(t);await this.ffmpeg.deleteFile("filelist.txt"),await this.ffmpeg.deleteFile("output.mp4"),console.log("Archivos temporales eliminados")}catch(t){console.warn("Error limpiando archivos temporales:",t)}}async getVideoInfo(r){try{const o=await(await fetch(r)).blob();return{size:o.size,type:o.type,duration:null}}catch(t){return console.error("Error obteniendo informaciÃ³n del video:",t),null}}}const sr=({isOpen:a,onClose:r,videos:t,sequenceName:o="Secuencia"})=>{const[l,c]=n.useState(null),[h,x]=n.useState(!1),[i,m]=n.useState(null),[y,p]=n.useState(null),[T,j]=n.useState("fast"),f=new tr;n.useEffect(()=>{a&&(c(null),m(null),p(null),x(!1))},[a]);const O=async()=>{if(!t||t.length===0){m("No hay videos para combinar");return}x(!0),m(null),c({stage:"init",current:0,total:100,message:"Iniciando FFmpeg.wasm..."});try{const V=await f.combineVideos(t,c),q=URL.createObjectURL(V);p(q),c({stage:"complete",current:100,total:100,message:"Â¡Videos combinados exitosamente!"})}catch(V){console.error("Error en descarga:",V),m(`Error combinando videos: ${V.message}`),c(null)}finally{x(!1)}},_=()=>{if(y){const V=document.createElement("a");V.href=y,V.download=`${o}.webm`,document.body.appendChild(V),V.click(),document.body.removeChild(V)}},w=()=>i?"text-red-500":(l==null?void 0:l.stage)==="complete"?"text-green-500":"text-blue-500",L=()=>i?e.jsx(bt,{className:"h-5 w-5"}):(l==null?void 0:l.stage)==="complete"?e.jsx(Ft,{className:"h-5 w-5"}):e.jsx(xa,{className:"h-5 w-5 animate-spin"}),B=()=>i?"bg-red-500":(l==null?void 0:l.stage)==="complete"?"bg-green-500":"bg-blue-500",v=()=>{switch(l==null?void 0:l.stage){case"init":return"Inicializando FFmpeg.wasm...";case"download":return"Descargando videos...";case"combine":return"Combinando videos con FFmpeg...";case"finalize":return"Finalizando archivo...";case"complete":return"Â¡Proceso completado!";default:return"Preparando..."}};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Descargar Secuencia"}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:h,children:e.jsx(et,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsxs("strong",{children:[(t==null?void 0:t.length)||0," videos"]})," serÃ¡n combinados en uno solo"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["DuraciÃ³n total: ",t==null?void 0:t.reduce((V,q)=>V+(q.duration||0),0).toFixed(1),"s",(t==null?void 0:t.some(V=>!V.duration))&&" (calculando...)"]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Formato: WebM (calidad optimizada con MediaRecorder)"})]}),l&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[L(),e.jsx("span",{className:`text-sm font-medium ${w()}`,children:l.message})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${B()}`,style:{width:`${l.current}%`}})}),e.jsx("p",{className:"text-xs text-gray-500",children:v()})]}),i&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(bt,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"text-sm text-red-700",children:i})]})}),y&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ft,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-sm text-green-700",children:"Â¡Videos combinados exitosamente!"})]})})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[!h&&!y&&e.jsxs("button",{onClick:O,className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2",children:[e.jsx(at,{className:"h-4 w-4"}),e.jsx("span",{children:"Combinar Videos"})]}),y&&e.jsxs("button",{onClick:_,className:"flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center space-x-2",children:[e.jsx(at,{className:"h-4 w-4"}),e.jsx("span",{children:"Descargar WebM"})]}),e.jsx("button",{onClick:r,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",disabled:h,children:y?"Cerrar":"Cancelar"})]})]})}):null},ar=({isOpen:a,onClose:r,videos:t,onSaveSequence:o,onToggleShowAll:l,showAllVideos:c,style:h="salsa",isIntegrated:x=!1,onToggleBuilder:i})=>{const{categoriesList:m,getColorClasses:y}=wt("figuras",h),{user:p}=It(),[T,j]=n.useState(null),[f,O]=n.useState(!1),[_,w]=n.useState(!1),[L,B]=n.useState(null),[v,V]=n.useState(null),[q,J]=n.useState(null),[ae,ue]=n.useState({}),[ye,re]=n.useState(!0),[Pe,we]=n.useState(!1),[$e,Te]=n.useState(null),be=g=>{if(!g.tags||Object.keys(g.tags).length===0)return[];const $=[];return m.forEach(R=>{const N=g.tags[R.key];Array.isArray(N)&&N.forEach(ge=>{$.push({tag:ge,categoryKey:R.key,color:R.color})})}),$},De=g=>{if(!g.tagsIniciales||Object.keys(g.tagsIniciales).length===0)return[];const $=[];return m.forEach(R=>{const N=g.tagsIniciales[R.key];Array.isArray(N)&&N.forEach(ge=>{$.push({tag:ge,categoryKey:R.key,color:R.color,type:"inicial"})})}),$},Le=g=>{if(!g.tagsFinales||Object.keys(g.tagsFinales).length===0)return[];const $=[];return m.forEach(R=>{const N=g.tagsFinales[R.key];Array.isArray(N)&&N.forEach(ge=>{$.push({tag:ge,categoryKey:R.key,color:R.color,type:"final"})})}),$},{sequence:I,sequenceName:fe,sequenceDescription:he,editingSequenceId:k,addVideoToSequence:P,removeVideoFromSequence:U,reorderSequence:G,generateRandomSequence:W,clearSequence:X,setSequenceName:oe,setSequenceDescription:d,isVideoCompatible:D,isVideoInSequence:M,toggleBuilder:H,checkCompatibility:z}=Cs();n.useEffect(()=>{const g=I.filter($=>$.bpm);if(g.length>0){const $=g.map(N=>N.bpm),R=$.reduce((N,ge)=>N+ge,0)/$.length;Te(Math.round(R))}else Te(null)},[I]);const{handleDragStart:Q,handleDragOver:te,handleDragEnter:me,handleDragLeave:A,handleDrop:ee,handleDragEnd:le,getDragStyles:ne}=er(G),[Ae,ve]=n.useState([]),[Re,xe]=n.useState({isOpen:!1,type:null}),[je,Ne]=n.useState(5),ie=(g,$="success")=>{const R=Date.now();ve(N=>[...N,{id:R,message:g,type:$}])},Se=g=>{ve($=>$.filter(R=>R.id!==g))},Ge=async g=>{if(!p){ie("Debes iniciar sesiÃ³n para dar like","error");return}try{const $=await Qt(g.id,p.uid);$.success?ie(`Has ${$.userLiked?"dado like a":"quitado like de"} "${g.title}"`,"success"):ie("Error al actualizar like","error")}catch($){console.error("Error al manejar like:",$),ie("Error al actualizar like","error")}},ze=()=>{const g=je-I.length;if(g<=0){ie("La secuencia ya tiene suficientes videos","info");return}if(I.length>0){const $=I[I.length-1],R=t.filter(N=>!I.some(ge=>ge.id===N.id)&&z($,N));if(R.length===0){ie("No hay videos compatibles disponibles para continuar la secuencia","warning");return}if(R.length<g){ie(`Solo hay ${R.length} videos compatibles disponibles de los ${g} necesarios`,"info"),W(t,I.length+R.length),ie(`Secuencia completada con ${R.length} videos adicionales`);return}}W(t,je),ie(`Secuencia completada hasta ${je} videos`)},S=async()=>{if(console.log("ðŸ’¾ Intentando guardar secuencia..."),console.log("ðŸ“ Nombre:",fe),console.log("ðŸ“‹ Videos en secuencia:",I.length),console.log("ðŸŽ¨ Estilo:",h),console.log("ðŸ”„ Editando secuencia ID:",k),!fe.trim()){ie("Por favor, aÃ±ade un nombre a la secuencia","error");return}if(I.length===0){ie("La secuencia debe tener al menos un video","error");return}try{const g=await Me(),$={name:fe,description:he,videos:I,style:h,tags:ae,thumbnailUrl:g,resolution:I.length>0?I[0].resolution:"HD",createdAt:new Date().toISOString()};k&&($.id=k),await o($),ie(k?"âœ… Secuencia actualizada exitosamente":'âœ… Secuencia guardada exitosamente. Ve a "GALERÃA DE SECUENCIAS" para verla.'),X(),i&&i()}catch(g){console.error("âŒ Error al guardar secuencia:",g),ie("Error al guardar la secuencia","error")}},Ie=()=>{I.length>0||fe.trim()||he.trim()?xe({isOpen:!0,type:"cancel"}):i&&i()},Oe=()=>{xe({isOpen:!0,type:"clear"})},ce=()=>{Re.type==="cancel"?(X(),i&&i()):Re.type==="clear"&&X(),xe({isOpen:!1,type:null})};n.useEffect(()=>{const g=setTimeout(()=>{rt()},500);return()=>clearTimeout(g)},[I]),n.useEffect(()=>()=>{L&&URL.revokeObjectURL(L)},[L]);const Be=g=>{if(!g||!g.resolution)return["auto","360p","480p","720p","1080p"];const $=g.resolution.toLowerCase(),R=["auto"];return $.includes("4k")||$.includes("2160p")?R.push("360p","480p","720p","1080p","4k"):$.includes("1080p")||$.includes("1920")?R.push("360p","480p","720p","1080p"):$.includes("720p")||$.includes("1280")?R.push("360p","480p","720p"):$.includes("480p")||$.includes("854")?R.push("360p","480p"):R.push("360p"),R},Ke=g=>{console.log("ðŸŽ¬ Reproduciendo video individual:",g.title),j(g),O(!0),ie(`ðŸŽ¬ Reproduciendo: ${g.title}`,"info")},rt=async()=>{if(!I||I.length===0){B(null),V(null);return}const g=JSON.stringify({videos:I.map($=>$.id),sequenceLength:I.length});if(!(q===g&&L)){w(!0),V(null);try{if(console.log("ðŸŽ¬ Generando preview en tiempo real..."),I.filter(R=>R.videoUrl).length===0)throw new Error("No hay videos vÃ¡lidos en la secuencia");B("sequence-timeline"),J(g),console.log("âœ… Preview en tiempo real generado (modo timeline)")}catch($){console.error("âŒ Error al generar preview en tiempo real:",$),V($.message)}finally{w(!1)}}},C=(g,$)=>{ue(R=>{const N=R[g]||[];if(N.includes($)){const Ve=N.filter(Ze=>Ze!==$);if(Ve.length===0){const{[g]:Ze,...lt}=R;return lt}else return{...R,[g]:Ve}}else return{...R,[g]:[...N,$]}})},K=(g,$)=>{var R;return((R=ae[g])==null?void 0:R.includes($))||!1},qe=()=>{const g=[];return m.forEach($=>{const R=ae[$.key];Array.isArray(R)&&R.forEach(N=>{g.push({tag:N,categoryKey:$.key,color:$.color})})}),g},Me=async()=>{if(I.length===0)return null;try{const g=I[0];if(g.thumbnailUrl)return g.thumbnailUrl;const{getStorage:$,ref:R,getDownloadURL:N}=await ot(async()=>{const{getStorage:lt,ref:ut,getDownloadURL:xt}=await import("./firebase-storage-8aoBMGXB.js");return{getStorage:lt,ref:ut,getDownloadURL:xt}},__vite__mapDeps([0,1])),ge=$(),Ve=R(ge,g.videoUrl);return await N(Ve)}catch(g){return console.error("Error al generar thumbnail:",g),null}};return a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Constructor de Secuencias"}),e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:[I.length," videos"]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(et,{className:"w-5 h-5"})})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"md:col-span-2 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("input",{type:"text",placeholder:"Nombre de la secuencia...",value:fe,onChange:g=>oe(g.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),!fe.trim()&&I.length>0&&e.jsx("p",{className:"text-xs text-orange-600",children:"âš ï¸ AÃ±ade un nombre para poder guardar la secuencia"})]}),e.jsx("textarea",{placeholder:"DescripciÃ³n (opcional)...",value:he,onChange:g=>d(g.target.value),rows:"2",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]}),e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-center",children:"NÃºmero de videos:"}),e.jsx("input",{type:"number",value:je,onChange:g=>Ne(Math.max(1,parseInt(g.target.value)||5)),min:"1",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-center text-sm",placeholder:"5"}),I.length>0&&e.jsx("div",{className:"text-xs text-gray-500 text-center",children:(()=>{const g=I[I.length-1],$=t.filter(N=>!I.some(ge=>ge.id===N.id)&&z(g,N)),R=je-I.length;return`${$.length} compatibles disponibles (necesitas ${R})`})()})]}),e.jsxs("button",{onClick:ze,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-colors",children:[e.jsx(ss,{className:"w-4 h-4"}),e.jsxs("span",{children:["Completar hasta ",je]})]}),e.jsxs("button",{onClick:Oe,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors",children:[e.jsx(dt,{className:"w-4 h-4"}),e.jsx("span",{children:"Limpiar"})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center",children:[e.jsx(We,{className:"h-5 w-5 text-blue-600 mr-2"}),"Preview en Tiempo Real"]}),_&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"}),e.jsx("span",{className:"text-gray-600",children:"Generando preview..."})]}),v&&e.jsx("div",{className:"flex items-center justify-center py-8 text-red-600",children:e.jsxs("span",{children:["âŒ Error: ",v]})}),!_&&!v&&L&&e.jsx("div",{className:"space-y-4",children:L==="sequence-timeline"?e.jsx(rs,{videos:I,currentBPM:$e,className:"w-full h-96",showControls:!0,autoplay:!1,loop:!1,muted:!1}):e.jsx("div",{className:"bg-black rounded-lg overflow-hidden",children:e.jsx(yt,{src:L,className:"w-full h-96 object-contain",showControls:!0,autoplay:!1,loop:!1,muted:!1,size:"medium",videoTitle:"Preview de Secuencia"})})}),!_&&!v&&I.length===0&&e.jsx("div",{className:"flex items-center justify-center py-8 text-gray-500",children:e.jsx("span",{children:"AÃ±ade videos a la secuencia para ver el preview"})})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-700",children:["Secuencia Actual (",I.length," videos)"]})}),I.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 bg-gray-50 rounded-lg",children:[e.jsx(Vt,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No hay videos en la secuencia"}),e.jsx("p",{className:"text-sm",children:"Selecciona videos de la galerÃ­a para comenzar"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:I.map((g,$)=>e.jsxs("div",{draggable:!0,onDragStart:()=>Q($),onDragOver:R=>te(R,$),onDragEnter:R=>me(R,$),onDragLeave:A,onDrop:R=>ee(R,$),onDragEnd:le,style:ne($),className:"bg-white rounded-lg shadow-md overflow-hidden border border-gray-100 hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02] relative",children:[e.jsxs("div",{className:"absolute top-2 left-2 z-10 flex items-center space-x-2",children:[e.jsxs("div",{className:"bg-purple-500 text-white px-2 py-1 rounded-full text-sm font-bold shadow-lg",children:["#",$+1]}),e.jsx("button",{onClick:()=>U($),className:"bg-red-500 text-white p-1 rounded-full hover:bg-red-600 transition-colors shadow-lg",title:"Eliminar de la secuencia",children:e.jsx(dt,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsx(ga,{className:"w-5 h-5 text-gray-400 cursor-grab hover:text-gray-600 transition-colors"})}),e.jsx("div",{className:"relative group",children:e.jsxs("div",{className:"w-full aspect-video bg-gradient-to-br from-gray-100 to-gray-200 relative overflow-hidden flex items-center justify-center",children:[g.thumbnailUrl&&g.thumbnailUrl!=="https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO"?e.jsx("img",{src:g.thumbnailUrl,alt:g.title,className:"w-full h-full object-cover",loading:"lazy",onError:R=>{R.target.style.display="none",R.target.nextSibling.style.display="flex"}}):null,e.jsxs("div",{className:`flex flex-col items-center justify-center text-gray-500 ${g.thumbnailUrl&&g.thumbnailUrl!=="https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO"?"hidden":"flex"}`,children:[e.jsx("svg",{className:"w-12 h-12 mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),e.jsx("span",{className:"text-sm font-medium",children:g.title})]}),e.jsx("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-sm font-medium",children:g.resolution&&g.resolution!=="Unknown"?g.resolution:"HD"}),e.jsx("button",{onClick:()=>Ke(g),className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("svg",{className:"w-12 h-12 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})})]})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-800 text-lg truncate",children:g.title}),e.jsxs("div",{className:"flex items-center space-x-1",children:[[1,2,3,4,5].map(R=>{const N=(g.rating||0)>=R;return e.jsx("svg",{className:`h-4 w-4 ${N?"text-yellow-400 fill-current":"text-gray-300"}`,fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})},R)}),e.jsxs("span",{className:"text-xs font-medium text-gray-500 ml-1",children:["(",g.rating||0,")"]})]})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:g.description||"Sin descripciÃ³n"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:(()=>{const R=be(g);return R.length>0?R.map(({tag:N,categoryKey:ge,color:Ve})=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${y(Ve)}`,children:N},`${ge}-${N}`)):e.jsx("span",{className:"text-gray-400 text-sm",children:"Sin etiquetas"})})()}),(()=>{const R=De(g);return R.length>0?e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-blue-600 uppercase tracking-wide",children:"Iniciales:"})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(({tag:N,categoryKey:ge,color:Ve})=>e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-sm",children:N},`inicial-${ge}-${N}`))})]}):null})(),(()=>{const R=Le(g);return R.length>0?e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-green-600 uppercase tracking-wide",children:"Finales:"})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(({tag:N,categoryKey:ge,color:Ve})=>e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-sm",children:N},`final-${ge}-${N}`))})]}):null})(),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"font-medium",children:[(g.fileSize/(1024*1024)).toFixed(2)," MB"]}),e.jsx("span",{className:"text-gray-400",children:"â€¢"}),e.jsx("span",{className:"text-gray-600",children:g.resolution&&g.resolution!=="Unknown"?g.resolution:"HD"}),e.jsx("span",{className:"text-gray-400",children:"â€¢"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Dt,{className:"h-3 w-3 text-purple-500"}),e.jsxs("span",{className:"font-medium text-purple-600",children:[g.bpm||"N/A"," BPM"]})]})]}),e.jsxs("button",{onClick:()=>Ge(g),className:`flex items-center space-x-1 transition-colors duration-200 p-1 rounded hover:bg-red-50 ${g.userLiked?"text-red-500":"text-gray-400 hover:text-red-500"}`,title:g.userLiked?"Quitar like":"Dar like",children:[e.jsx(pt,{className:`h-4 w-4 ${g.userLiked?"fill-current":""}`}),e.jsx("span",{className:"font-medium",children:g.likes||0})]})]})]})]},`${g.id}-${$}`))})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"h-5 w-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Tags de Secuencia"})]}),e.jsx("button",{onClick:()=>re(!ye),className:"p-1 text-gray-500 hover:text-gray-700 transition-colors",title:ye?"Expandir tags":"Colapsar tags",children:e.jsx("svg",{className:`w-4 h-4 transform transition-transform ${ye?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),(()=>{const g=qe();return g.length>0?e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(({tag:$,categoryKey:R,color:N})=>e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${y(N)} flex items-center space-x-1`,children:[e.jsx("span",{children:$}),e.jsx("button",{onClick:()=>C(R,$),className:"ml-1 hover:bg-black hover:bg-opacity-20 rounded-full p-0.5",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},`${R}-${$}`))})}):null})(),e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-in-out ${ye?"max-h-0 opacity-0":"max-h-96 opacity-100"}`,children:e.jsx("div",{className:"space-y-4",children:m.map(g=>e.jsxs("div",{className:"border-t border-gray-100 pt-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center space-x-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${y(g.color).replace("text-","bg-")}`}),e.jsx("span",{children:g.name})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:g.tags.map($=>e.jsx("button",{onClick:()=>C(g.key,$),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${K(g.key,$)?y(g.color):"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:$},$))})]},g.key))})})]})}),e.jsxs("div",{className:"flex space-x-3 pt-4 border-t",children:[e.jsxs("button",{onClick:S,disabled:I.length===0||!fe.trim(),className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:[e.jsx(pa,{className:"w-4 h-4"}),e.jsx("span",{children:k?"Actualizar Secuencia":"Guardar Secuencia"})]}),e.jsx("button",{onClick:Ie,className:"px-6 py-2 border border-gray-300 hover:bg-gray-50 rounded-lg transition-colors",children:"Cancelar"})]})]})]}),f&&T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-95 flex items-center justify-center z-50 p-4",onClick:()=>O(!1),children:e.jsxs("div",{className:"bg-black rounded-lg overflow-hidden w-full max-w-6xl max-h-[95vh] flex flex-col",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700 bg-gray-900",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:T.title}),e.jsx("button",{onClick:()=>O(!1),className:"text-gray-400 hover:text-white text-2xl font-bold p-2 hover:bg-gray-800 rounded transition-colors",children:"Ã—"})]}),e.jsx("div",{className:"flex-1 bg-black flex items-center justify-center p-4",children:e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(yt,{src:T.videoUrl,className:"max-w-full max-h-full object-contain",showControls:!0,autoplay:!1,loop:!1,muted:!1,resolutions:Be(T),currentResolution:"auto",videoTitle:T.title,size:"fullscreen"})})})]})}),e.jsx(ft,{isOpen:Re.isOpen,onClose:()=>xe({isOpen:!1,type:null}),onConfirm:ce,title:Re.type==="cancel"?"Â¿Cancelar secuencia?":"Â¿Limpiar secuencia?",message:Re.type==="cancel"?"Â¿EstÃ¡s seguro de que quieres cancelar? Se perderÃ¡n todos los cambios.":"Â¿EstÃ¡s seguro de que quieres limpiar la secuencia actual?",confirmText:"Confirmar",cancelText:"Cancelar"}),Ae.map(g=>e.jsx(vt,{message:g.message,type:g.type,onClose:()=>Se(g.id)},g.id)),e.jsx(sr,{isOpen:Pe,onClose:()=>we(!1),videos:I,sequenceName:fe||"Secuencia"})]}):null},rr=({src:a,alt:r,className:t="",fallbackSrc:o="/placeholder-video.svg",showPlayIcon:l=!1,...c})=>{const[h,x]=n.useState(!1),[i,m]=n.useState(!0),y=()=>{m(!1),x(!1)},p=()=>{m(!1),x(!0)},T=!a||a===null||a===void 0||a==="https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO"||a==="https://via.placeholder.com/300x200/1a1a1a/ffffff?text=EVENTO",j=T||h?o:a;return e.jsxs("div",{className:`relative ${t}`,...c,children:[i&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-200 animate-pulse flex items-center justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-8 h-8 border-3 border-gray-300 border-t-pink-500 rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-0 w-8 h-8 border-3 border-transparent border-t-pink-300 rounded-full animate-spin",style:{animationDelay:"-0.5s"}})]})}),e.jsx("img",{src:j,alt:r,className:`w-full h-full object-cover transition-all duration-300 ${i?"opacity-0 scale-95":"opacity-100 scale-100"}`,onLoad:y,onError:p,loading:"lazy",decoding:"async",fetchPriority:"high"}),l&&!i&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-20 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 bg-white bg-opacity-90 rounded-full flex items-center justify-center",children:e.jsx(We,{className:"w-4 h-4 text-gray-800 fill-current"})})}),(h||T)&&!i&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Fs,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"Sin miniatura"}),l&&e.jsx("div",{className:"mt-2 w-6 h-6 bg-white bg-opacity-90 rounded-full flex items-center justify-center mx-auto",children:e.jsx(We,{className:"w-3 h-3 text-gray-600 fill-current"})})]})})]})},nr=({sequences:a,onDeleteSequence:r,onPlaySequence:t,onEditSequence:o,onEditThumbnail:l,onDownloadSequence:c})=>{var B;const[h,x]=n.useState([]),[i,m]=n.useState({isOpen:!1,sequence:null}),{getColorClasses:y}=wt("figuras","salsa"),{getSequenceConfig:p}=ns(),T=(v,V="success")=>{const q=Date.now();x(J=>[...J,{id:q,message:v,type:V}])},j=v=>{x(V=>V.filter(q=>q.id!==v))},f=v=>{m({isOpen:!0,sequence:v})},O=async()=>{try{await r(i.sequence.id),T("Secuencia eliminada exitosamente")}catch{T("Error al eliminar la secuencia","error")}m({isOpen:!1,sequence:null})},_=v=>{try{t(v),T("Reproduciendo secuencia")}catch{T("Error al reproducir la secuencia","error")}},w=v=>{try{c?(c(v),T("Abriendo opciones de descarga")):T("Funcionalidad de descarga no disponible","warning")}catch{T("Error al abrir descarga","error")}},L=v=>{if(!v.tags||Object.keys(v.tags).length===0)return[];const V=[];return[{key:"dificultad",color:"red"},{key:"estilo",color:"blue"},{key:"nivel",color:"green"},{key:"figura",color:"purple"},{key:"posicion",color:"orange"},{key:"transicion",color:"teal"}].forEach(J=>{const ae=v.tags[J.key];Array.isArray(ae)&&ae.forEach(ue=>{V.push({tag:ue,categoryKey:J.key,color:J.color})})}),V};return a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(We,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay secuencias guardadas"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Crea tu primera secuencia usando el constructor de secuencias"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Â¿CÃ³mo crear una secuencia?"}),e.jsxs("ol",{className:"text-sm text-blue-800 space-y-1 text-left",children:[e.jsx("li",{children:'1. Haz clic en "CREAR SECUENCIA"'}),e.jsx("li",{children:'2. AÃ±ade videos con el botÃ³n "+" de la galerÃ­a'}),e.jsx("li",{children:"3. Escribe un nombre para la secuencia"}),e.jsx("li",{children:'4. Haz clic en "Guardar Secuencia"'}),e.jsx("li",{children:"5. Â¡Listo! AparecerÃ¡ aquÃ­ automÃ¡ticamente"})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:`grid gap-6 ${p().grid}`,children:a.map(v=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden border border-gray-100 hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02]",children:[e.jsx("div",{className:"relative group",children:e.jsxs("div",{className:`w-full ${p().aspect} bg-gradient-to-br from-gray-100 to-gray-200 relative overflow-hidden flex items-center justify-center`,children:[v.thumbnailUrl?e.jsx(rr,{src:v.thumbnailUrl,alt:v.name,className:"w-full h-full object-cover"}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-500",children:[e.jsx(We,{className:"w-12 h-12 mb-2 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium",children:v.name})]}),e.jsx("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-sm font-medium",children:v.resolution&&v.resolution!=="Unknown"?v.resolution:"HD"}),e.jsx("button",{onClick:V=>{V.stopPropagation(),l&&l(v)},className:"absolute top-2 right-2 bg-black bg-opacity-75 text-white p-1 rounded hover:bg-opacity-90 transition-colors",title:"Editar thumbnail",children:e.jsx(Fs,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>_(v),className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx(We,{className:"w-12 h-12 text-white"})})]})}),e.jsxs("div",{className:`${p().compact?"p-2":"p-4"}`,children:[e.jsxs("div",{className:`flex items-center justify-between ${p().compact?"mb-1":"mb-2"}`,children:[e.jsx("h3",{className:`font-semibold text-gray-800 ${p().titleSize} truncate`,children:v.name}),e.jsx("div",{className:"flex items-center space-x-1",children:e.jsxs("span",{className:`bg-blue-100 text-blue-800 px-2 py-1 rounded-full ${p().compact,"text-xs"} font-medium`,children:[v.videos.length," videos"]})})]}),p().showIcons?e.jsx("div",{className:"flex items-center justify-center text-gray-500 mb-2",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ps,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-xs font-medium",children:[v.videos.length," videos"]})]})}):e.jsx("p",{className:`text-gray-600 text-sm ${p().compact?"mb-2":"mb-3"} ${p().descriptionLines===1?"line-clamp-1":p().descriptionLines===2?"line-clamp-2":p().descriptionLines===3?"line-clamp-3":"line-clamp-4"}`,children:v.description||"Sin descripciÃ³n"}),p().showTags&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:(()=>{const V=L(v);return V.length>0?V.map(({tag:q,categoryKey:J,color:ae})=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${y(ae)}`,children:q},`${J}-${q}`)):e.jsx("span",{className:"text-gray-400 text-sm",children:"Sin etiquetas"})})()}),p().showStats&&e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 pt-2 border-t border-gray-100",children:[!p().compact&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ps,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium",children:[v.videos.length," videos"]}),e.jsx("span",{className:"text-gray-400",children:"â€¢"}),e.jsx("span",{className:"text-gray-600",children:v.resolution&&v.resolution!=="Unknown"?v.resolution:"HD"})]}),e.jsxs("div",{className:`flex items-center space-x-2 ${p().compact?"w-full justify-center":""}`,children:[e.jsx("button",{onClick:()=>w(v),className:"text-gray-400 hover:text-green-500 transition-colors duration-200 p-1 rounded hover:bg-green-50",title:"Descargar secuencia",children:e.jsx(at,{className:`${p().compact?"h-3 w-3":"h-4 w-4"}`})}),e.jsx("button",{onClick:()=>o(v),className:"text-gray-400 hover:text-blue-500 transition-colors duration-200 p-1 rounded hover:bg-blue-50",title:"Editar secuencia",children:e.jsx(fa,{className:`${p().compact?"h-3 w-3":"h-4 w-4"}`})}),e.jsx("button",{onClick:()=>f(v),className:"text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 rounded hover:bg-red-50",title:"Eliminar secuencia",children:e.jsx(dt,{className:`${p().compact?"h-3 w-3":"h-4 w-4"}`})})]})]})]})]},v.id))}),e.jsx(ft,{isOpen:i.isOpen,onClose:()=>m({isOpen:!1,sequence:null}),onConfirm:O,title:"Â¿Eliminar secuencia?",message:`Â¿EstÃ¡s seguro de que quieres eliminar la secuencia "${(B=i.sequence)==null?void 0:B.name}"? Esta acciÃ³n no se puede deshacer.`,confirmText:"Eliminar",cancelText:"Cancelar",confirmClassName:"bg-red-500 hover:bg-red-600"}),h.map(v=>e.jsx(vt,{message:v.message,type:v.type,onClose:()=>j(v.id)},v.id))]})},Es=({type:a="video"})=>{const{videoCardSize:r,sequenceCardSize:t,setVideoCardSize:o,setSequenceCardSize:l,availableSizes:c,sizeLabels:h}=ns(),x=a==="video"?r:t,i=a==="video"?o:l,m={small:e.jsx(ya,{className:"h-4 w-4"}),medium:e.jsx(fs,{className:"h-4 w-4"}),large:e.jsx(fs,{className:"h-4 w-4"}),"extra-large":e.jsx(ba,{className:"h-4 w-4"})},y={small:"from-gray-400 to-gray-500",medium:"from-blue-400 to-blue-500",large:"from-purple-400 to-purple-500","extra-large":"from-pink-400 to-pink-500"};return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 mr-2",children:"TamaÃ±o:"}),e.jsx("div",{className:"flex bg-gray-100 rounded-lg p-1",children:c.map(p=>e.jsxs("button",{onClick:()=>i(p),className:`flex items-center space-x-1 px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 ${x===p?`bg-gradient-to-r ${y[p]} text-white shadow-lg transform scale-105`:"text-gray-600 hover:text-gray-800 hover:bg-white"}`,title:`${h[p]} - ${p} cards`,children:[m[p],e.jsx("span",{className:"hidden sm:inline",children:h[p]})]},p))})]})},or=({video:a,onLike:r,onEdit:t,onDelete:o,onAddToSequence:l,onDownload:c,onPlay:h,isVideoInSequence:x,isBuilderOpen:i,isVideoCompatible:m,type:y="video"})=>y==="video"?e.jsxs("div",{className:"flex items-center justify-center space-x-1 mt-2",children:[e.jsx("button",{onClick:h,className:"p-1 text-gray-400 hover:text-blue-500 transition-colors rounded",title:"Reproducir",children:e.jsx(We,{className:"h-3 w-3"})}),e.jsx("button",{onClick:r,className:`p-1 transition-colors rounded ${a.userLiked?"text-red-500":"text-gray-400 hover:text-red-500"}`,title:a.userLiked?"Quitar like":"Dar like",children:e.jsx(pt,{className:`h-3 w-3 ${a.userLiked?"fill-current":""}`})}),e.jsx("button",{onClick:l,disabled:x,className:`p-1 transition-colors rounded ${x?"text-gray-300 cursor-not-allowed":i&&!m?"text-red-400 hover:text-red-500":"text-gray-400 hover:text-purple-500"}`,title:x?"Ya en secuencia":i&&!m?"AÃ±adir forzadamente":"AÃ±adir a secuencia",children:e.jsx(Vt,{className:"h-3 w-3"})}),e.jsx("button",{onClick:c,className:"p-1 text-gray-400 hover:text-green-500 transition-colors rounded",title:"Descargar",children:e.jsx(at,{className:"h-3 w-3"})}),e.jsx("button",{onClick:t,className:"p-1 text-gray-400 hover:text-blue-500 transition-colors rounded",title:"Editar",children:e.jsx(Ut,{className:"h-3 w-3"})}),e.jsx("button",{onClick:o,className:"p-1 text-gray-400 hover:text-red-500 transition-colors rounded",title:"Eliminar",children:e.jsx(dt,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"flex items-center justify-center space-x-1 mt-2",children:[e.jsx("button",{onClick:h,className:"p-1 text-gray-400 hover:text-blue-500 transition-colors rounded",title:"Reproducir secuencia",children:e.jsx(We,{className:"h-3 w-3"})}),e.jsx("button",{onClick:c,className:"p-1 text-gray-400 hover:text-green-500 transition-colors rounded",title:"Descargar secuencia",children:e.jsx(at,{className:"h-3 w-3"})}),e.jsx("button",{onClick:t,className:"p-1 text-gray-400 hover:text-blue-500 transition-colors rounded",title:"Editar secuencia",children:e.jsx(Ut,{className:"h-3 w-3"})}),e.jsx("button",{onClick:o,className:"p-1 text-gray-400 hover:text-red-500 transition-colors rounded",title:"Eliminar secuencia",children:e.jsx(dt,{className:"h-3 w-3"})})]}),pr=()=>{var us,ms;const[a,r]=n.useState(!1),[t,o]=n.useState({isOpen:!1,video:null}),[l,c]=n.useState([]),[h,x]=n.useState(!0),[i,m]=n.useState([]),[y,p]=n.useState({isOpen:!1,video:null}),[T,j]=n.useState([]),[f,O]=n.useState(""),[_,w]=n.useState(!1),[L,B]=n.useState("videos"),[v,V]=n.useState("idle"),[q,J]=n.useState({isOpen:!1,type:null}),[ae,ue]=n.useState({isOpen:!1,sequence:null}),[ye,re]=n.useState({isOpen:!1,sequence:null}),[Pe,we]=n.useState({isOpen:!1}),[$e,Te]=n.useState(!1),[be,De]=n.useState(null),[Le,I]=n.useState(!1),[fe,he]=n.useState(null),[k,P]=n.useState(!1),[U,G]=n.useState([]),[W,X]=n.useState("none"),[oe,d]=n.useState(!1),[D,M]=n.useState([]),[H,z]=n.useState(!0),{user:Q}=It(),{getVideoConfig:te,getSequenceConfig:me}=ns(),{addVideoToSequence:A,removeVideoFromSequence:ee,sequence:le,sequenceName:ne,clearSequence:Ae,isBuilderOpen:ve,toggleBuilder:Re,showAllVideos:xe,toggleShowAllVideos:je,getFilteredVideos:Ne,isVideoInSequence:ie,isVideoCompatible:Se,checkCompatibility:Ge,loadSequence:ze}=Cs(),[S,Ie]=n.useState("salsa"),{availableStyles:Oe,getGradientClasses:ce,categoriesList:Be,getColorClasses:Ke}=wt("figuras",S),rt=s=>{G(u=>u.includes(s)?u.filter(E=>E!==s):[...u,s])},C=s=>{A(s),ve||Re()},K={Music:Dt,Heart:pt,Star:bs,Zap:wa};n.useEffect(()=>{V("syncing");const s=ea(S,u=>{c(u),x(!1),V("idle")});return()=>{s()}},[S]),n.useEffect(()=>{l.length>0&&Q&&(async()=>{const u=await Promise.all(l.map(async E=>{try{const[F,Y]=await Promise.all([ta(E.id,Q.uid),sa(E.id,Q.uid)]);return{...E,userLiked:F.userLiked,isFavorite:Y.isFavorite}}catch(F){return console.error("Error al verificar like/favorito para video:",E.id,F),{...E,userLiked:!1,isFavorite:!1}}}));c(u)})()},[l.length,Q]),n.useEffect(()=>{if(S){z(!0);try{const s=Ja(S,u=>{M(u),z(!1)});return()=>{s()}}catch(s){console.error("âŒ Error al suscribirse a secuencias:",s),z(!1)}}},[S]);const qe=async s=>{N(`${s.title} subido exitosamente`,"success")},Me=s=>{o({isOpen:!0,video:s})},g=()=>{o({isOpen:!1,video:null})},$=s=>{c(u=>u.map(E=>E.id===s.id?s:E)),N(`${s.title} actualizado exitosamente`,"success")},R=async s=>{if(!Q){N("Debes iniciar sesiÃ³n para dar like","error");return}try{const u=await Qt(s.id,Q.uid);if(u.success){c(Y=>Y.map(pe=>pe.id===s.id?{...pe,likes:u.likes,likedBy:u.likedBy,userLiked:u.userLiked,isFavorite:u.isFavorite}:pe));const E=u.userLiked?"dado like a":"quitado like de",F=u.isFavorite?"y agregado a favoritos":"y removido de favoritos";N(`Has ${E} "${s.title}" ${F}`,"success")}else N("Error al actualizar like","error")}catch(u){console.error("Error al manejar like:",u),N("Error al actualizar like","error")}},N=(s,u="success")=>{const E=Date.now();m(F=>[...F,{id:E,message:s,type:u}])},ge=s=>{m(u=>u.filter(E=>E.id!==s))},Ve=async s=>{try{const u={...s,style:S};if(s.id){const E=await Qa(s.id,u);N("âœ… Secuencia actualizada exitosamente")}else{const E=await Xa(u);N('âœ… Secuencia guardada exitosamente. Ve a "GALERÃA DE SECUENCIAS" para verla.')}}catch(u){throw console.error("âŒ Error al guardar secuencia:",u),N("Error al guardar la secuencia","error"),u}},Ze=async s=>{try{await Ya(s),N("Secuencia eliminada exitosamente")}catch(u){throw console.error("Error al eliminar secuencia:",u),N("Error al eliminar la secuencia","error"),u}},lt=s=>{he(s),P(!0),N(`ðŸŽ¬ Reproduciendo secuencia: ${s.name}`,"info")},ut=s=>{le.length>0||ne.trim()?ue({isOpen:!0,sequence:s}):(ze(s),N(`Secuencia "${s.name}" cargada para ediciÃ³n`))},xt=()=>{const s=ae.sequence;s&&(ze(s),N(`Secuencia "${s.name}" cargada para ediciÃ³n`)),ue({isOpen:!1,sequence:null})},jt=()=>{ue({isOpen:!1,sequence:null})},Ht=s=>{re({isOpen:!0,sequence:s})},Nt=()=>{re({isOpen:!1,sequence:null})},kt=s=>{De(s),I(!0),N(`ðŸŽ¬ Reproduciendo: ${s.title}`,"info")},b=()=>{I(!1),De(null)},Z=()=>{P(!1),he(null)},ke=async s=>{try{const u=await vs(s.videoPath,s.thumbnailPath);if(!u.success)if(u.error&&u.error.includes("thumbnails")){if(!(await vs(s.videoPath,null)).success){N(`Error al eliminar archivos: ${u.error}`,"error");return}}else{N(`Error al eliminar archivos: ${u.error}`,"error");return}const E=await la(s.id);if(!E.success){N(`Error al eliminar metadatos: ${E.error}`,"error");return}c(F=>F.filter(pe=>pe.id!==s.id)),N(`${s.title} eliminado correctamente`,"success")}catch(u){console.error("âŒ Error deleting video:",u),N("Error inesperado al eliminar video","error")}},Ee=s=>{p({isOpen:!0,video:s})},Xe=()=>{p({isOpen:!1,video:null})},Qe=async s=>{try{if(V("syncing"),N("Iniciando limpieza de datos...","info"),s==="update"){const u=await ra();u.success?N(`âœ… ${u.updatedCount} videos actualizados`,"success"):N(`âŒ Error: ${u.error}`,"error")}else if(s==="cleanup"){const u=await xs(),E=await za(u);E.success?N(`ðŸ§¹ ${E.orphanedVideosDeleted} videos y ${E.orphanedThumbnailsDeleted} thumbnails huÃ©rfanos eliminados`,"success"):N(`âŒ Error: ${E.error}`,"error")}else if(s==="cleanup-tags"){const u=await na();u.success?N(`ðŸ·ï¸ ${u.updatedCount} videos actualizados con tags limpios`,"success"):N(`âŒ Error: ${u.error}`,"error")}else if(s==="delete-all"){if(!window.confirm("Â¿EstÃ¡s seguro de que quieres eliminar TODOS los videos? Esta acciÃ³n no se puede deshacer.")){V("idle");return}const E=await oa();if(!E.success){N(`âŒ Error eliminando documentos: ${E.error}`,"error"),V("idle");return}const F=await Pa();if(!F.success){N(`âŒ Error eliminando archivos: ${F.error}`,"error"),V("idle");return}N(`ðŸ—‘ï¸ ${E.deletedCount} videos eliminados completamente`,"success")}V("idle"),J({isOpen:!1,type:null})}catch(u){console.error("Error en limpieza:",u),N(`âŒ Error inesperado: ${u.message}`,"error"),V("idle")}},St=s=>{J({isOpen:!0,type:s})},Vs=()=>{J({isOpen:!1,type:null})},Is=async()=>{try{N("Ejecutando diagnÃ³stico de videos...","info");const s=await aa();if(s.success){let u=`DiagnÃ³stico: ${s.totalVideos} videos total, ${s.salsaVideos} de salsa`;s.fig003Found?u+=" âœ… Fig003 encontrado":u+=" âŒ Fig003 NO encontrado",s.videosWithoutResolution>0&&(u+=` âš ï¸ ${s.videosWithoutResolution} sin resoluciÃ³n`),N(u,"success")}else N(`Error en diagnÃ³stico: ${s.error}`,"error")}catch(s){console.error("Error ejecutando diagnÃ³stico:",s),N("Error al ejecutar diagnÃ³stico","error")}},Os=async()=>{try{N("ðŸ”„ Actualizando resoluciones de videos...","info");const u=(await xs()).filter(F=>!F.resolution||F.resolution==="Unknown");if(u.length===0){N("âœ… Todos los videos ya tienen resoluciÃ³n detectada","success");return}let E=0;for(const F of u)try{const Y=document.createElement("video");Y.crossOrigin="anonymous",await new Promise((pe,de)=>{Y.onloadedmetadata=()=>{const Ce=Y.videoWidth,He=Y.videoHeight,it=Math.max(Ce,He);let Ye="Unknown";it>=3840?Ye="4K":it>=1920?Ye="1080p":it>=1280?Ye="720p":it>=854?Ye="480p":Ye="360p",Mt(F.id,{resolution:Ye,videoWidth:Ce,videoHeight:He}),E++,pe()},Y.onerror=de,Y.src=F.videoUrl}),Y.remove()}catch(Y){console.error(`Error actualizando resoluciÃ³n para video ${F.id}:`,Y)}N(`âœ… Resoluciones actualizadas: ${E} videos`,"success")}catch(s){console.error("Error al actualizar resoluciones:",s),N("Error al actualizar resoluciones","error")}},Bs=async()=>{try{N("ðŸ”„ Iniciando migraciÃ³n REAL de videos a estructura organizada...","info");const s=await Ua(l);if(s.success){let u=`âœ… MigraciÃ³n REAL completada: ${s.successfulMigrations} videos movidos fÃ­sicamente`;s.alreadyOrganized>0&&(u+=`, ${s.alreadyOrganized} ya organizados`),s.failedMigrations>0&&(u+=`, ${s.failedMigrations} fallidos`),N(u,"success"),window.location.reload()}else N(`âŒ Error en migraciÃ³n: ${s.error}`,"error")}catch(s){console.error("Error ejecutando migraciÃ³n:",s),N("âŒ Error al ejecutar migraciÃ³n","error")}},qs=s=>{j(u=>u.includes(s)?u.filter(F=>F!==s):[...u,s])},Hs=()=>{j([]),O("")},ls=s=>{X(s)},_s=(s,u)=>{if(!s.tags||!Be.find(Y=>Y.key===u))return!1;const F=s.tags[u];return F&&Array.isArray(F)&&F.length>0},Ws=s=>{if(W==="none")return s;const u=[...s];switch(W){case"name":return u.sort((E,F)=>E.title.localeCompare(F.title));case"name-desc":return u.sort((E,F)=>F.title.localeCompare(E.title));case"rating":return u.sort((E,F)=>(F.rating||0)-(E.rating||0));case"rating-desc":return u.sort((E,F)=>(E.rating||0)-(F.rating||0));case"likes":return u.sort((E,F)=>(F.likes||0)-(E.likes||0));case"likes-desc":return u.sort((E,F)=>(E.likes||0)-(F.likes||0));default:return u}},is=s=>{if(!s.tags||Object.keys(s.tags).length===0)return[];const u=[];return Be.forEach(E=>{const F=s.tags[E.key];Array.isArray(F)&&F.forEach(Y=>{u.push({tag:Y,categoryKey:E.key,color:E.color})})}),u},cs=s=>{if(!s.tagsIniciales||Object.keys(s.tagsIniciales).length===0)return[];const u=[];return Be.forEach(E=>{const F=s.tagsIniciales[E.key];Array.isArray(F)&&F.forEach(Y=>{u.push({tag:Y,categoryKey:E.key,color:E.color,type:"inicial"})})}),u},ds=s=>{if(!s.tagsFinales||Object.keys(s.tagsFinales).length===0)return[];const u=[];return Be.forEach(E=>{const F=s.tagsFinales[E.key];Array.isArray(F)&&F.forEach(Y=>{u.push({tag:Y,categoryKey:E.key,color:E.color,type:"final"})})}),u},Et=s=>s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim(),Gs=(s,u)=>{if(!u||u.length===0)return!0;const E=Et(s.title||""),F=Et(s.description||""),Y=[];return s.tags&&Object.values(s.tags).forEach(pe=>{Array.isArray(pe)&&pe.forEach(de=>{Y.push(Et(de))})}),u.every(pe=>{const de=Et(pe);return!!(E.includes(de)||F.includes(de)||Y.some(Ce=>Ce.includes(de)))})},Ks=l.filter(s=>{const u=f.split(" ").map(de=>de.trim()).filter(de=>de.length>0),E=Gs(s,u),F=T.length===0||T.every(de=>s.tags?Object.values(s.tags).some(Ce=>Array.isArray(Ce)&&Ce.includes(de)):!1),Y=U.length===0||U.some(de=>_s(s,de)),pe=!oe||s.isFavorite;return E&&F&&Y&&pe}),Zs=Ne(Ks),Ct=Ws(Zs),_t=async s=>{try{const{ref:u,getDownloadURL:E}=await ot(async()=>{const{ref:Ce,getDownloadURL:He}=await import("./firebase-storage-8aoBMGXB.js");return{ref:Ce,getDownloadURL:He}},__vite__mapDeps([0,1])),{storage:F}=await ot(async()=>{const{storage:Ce}=await import("./index-DOeBVGYV.js").then(He=>He.x);return{storage:Ce}},__vite__mapDeps([4,3,5,1,6,7,0,8,9])),Y=u(F,s.videoPath),pe=await E(Y),de=document.createElement("a");de.href=pe,de.download=s.title||"video",de.target="_blank",de.rel="noopener noreferrer",document.body.appendChild(de),de.click(),document.body.removeChild(de),N("Descarga iniciada","success")}catch(u){console.error("Error en descarga:",u),N("Error al descargar el video","error")}};return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:`${$e?"w-full px-0":"max-w-6xl mx-auto px-6"} py-8`,children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-4xl font-bold mb-2",children:[e.jsx("span",{className:"text-pink-500",children:"FIGURAS"}),e.jsxs("span",{className:`bg-gradient-to-r ${ce(S)} bg-clip-text text-transparent`,children:[" - ",S.toUpperCase()]})]}),e.jsxs("p",{className:"text-gray-600 text-lg",children:["GalerÃ­a de videos de figuras de ",S.toLowerCase()]})]}),e.jsx("div",{className:"flex flex-wrap justify-center gap-3 mb-8",children:Oe.map(s=>{const u=K[s.icon],E=S===s.key,F=ce(s.color);return e.jsxs("button",{onClick:()=>Ie(s.key),className:`relative flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${E?`bg-gradient-to-r ${F} text-white shadow-lg transform scale-105`:"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"}`,children:[u&&e.jsx(u,{className:"h-4 w-4"}),e.jsx("span",{children:s.name})]},s.name)})}),e.jsxs("div",{className:"max-w-2xl mx-auto mb-8",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ys,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx("input",{type:"text",placeholder:`Buscar en ${S.toLowerCase()}... (mÃºltiples palabras, sin tildes)`,value:f,onChange:s=>O(s.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200"})]}),f.trim()&&e.jsx("div",{className:"mt-3 text-center",children:e.jsxs("div",{className:"inline-flex items-center space-x-2 px-4 py-2 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(ys,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{className:"text-sm text-blue-700",children:["Buscando: ",e.jsxs("span",{className:"font-medium",children:['"',f,'"']})]}),e.jsxs("span",{className:"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded",children:[Ct.length," resultado",Ct.length!==1?"s":""]})]})})]}),Be.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>w(!_),className:"flex items-center justify-center space-x-2 mx-auto px-6 py-3 bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 rounded-lg font-medium shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105",children:[e.jsx(va,{className:"h-5 w-5"}),e.jsxs("span",{children:["Filtros Avanzados por Tags - ",S]}),_?e.jsx(zt,{className:"h-5 w-5"}):e.jsx(Pt,{className:"h-5 w-5"})]}),e.jsx("div",{className:`mt-4 transition-all duration-300 ease-in-out overflow-hidden ${_?"max-h-96 opacity-100":"max-h-0 opacity-0"}`,children:e.jsx("div",{className:"space-y-4 bg-gray-50 rounded-lg p-6 border border-gray-200",children:Be.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>rt(s.key),className:`w-full text-center font-medium py-2 px-4 rounded-lg transition-all duration-200 transform hover:scale-105 ${U.includes(s.key)?`bg-gradient-to-r ${ce(S)} text-white shadow-lg`:"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("span",{children:s.name}),U.includes(s.key)&&e.jsx("span",{className:"text-xs bg-white bg-opacity-20 px-2 py-1 rounded",children:"ACTIVO"})]})}),e.jsx("div",{className:"flex flex-wrap justify-center gap-2",children:s.tags.map(u=>e.jsx("button",{onClick:()=>qs(u),className:`px-3 py-1 rounded-full text-sm font-medium transition-all duration-200 ${T.includes(u)?`bg-gradient-to-r ${ce(S)} text-white shadow-lg`:`${Ke(s.color)} hover:bg-opacity-80`}`,children:u},u))})]},s.key))})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mb-6",children:[e.jsxs("button",{onClick:()=>r(!0),className:`flex items-center justify-center space-x-2 px-6 py-3 bg-gradient-to-r ${ce(S)} text-white rounded-lg font-medium shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105`,children:[e.jsx(ts,{className:"h-5 w-5"}),e.jsxs("span",{children:["SUBIR VIDEO(S) A ",S.toUpperCase()]})]}),e.jsxs("button",{onClick:Re,className:`flex items-center justify-center space-x-2 px-6 py-3 rounded-lg font-medium shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 ${ve?"bg-gradient-to-r from-red-500 to-pink-500 text-white":`bg-gradient-to-r ${ce(S)} hover:opacity-90 text-white`}`,children:[e.jsx(ss,{className:"h-5 w-5"}),e.jsx("span",{children:ve?"OCULTAR SECUENCIA":"CREAR SECUENCIA"})]})]}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-3 mb-6",children:[e.jsx("button",{onClick:()=>ls(W==="name"?"name-desc":"name"),className:`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${W==="name"||W==="name-desc"?`bg-gradient-to-r ${ce(S)} text-white shadow-lg`:"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:e.jsx("span",{children:W==="name"?"A-Z":W==="name-desc"?"Z-A":"A-Z"})}),e.jsxs("button",{onClick:()=>ls(W==="rating"?"rating-desc":"rating"),className:`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${W==="rating"||W==="rating-desc"?`bg-gradient-to-r ${ce(S)} text-white shadow-lg`:"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:[e.jsx(bs,{className:"h-4 w-4"}),e.jsx("span",{children:W==="rating"?"PuntuaciÃ³n â†“":W==="rating-desc"?"PuntuaciÃ³n â†‘":"PuntuaciÃ³n"})]}),e.jsxs("button",{onClick:()=>{oe?W==="likes"?X("likes-desc"):W==="likes-desc"?X("likes"):(d(!1),X("none")):(d(!0),X("likes"))},className:`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${oe?`bg-gradient-to-r ${ce(S)} text-white shadow-lg`:"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:[e.jsx(pt,{className:"h-4 w-4"}),e.jsx("span",{children:oe?W==="likes"?"Favoritos â†“":W==="likes-desc"?"Favoritos â†‘":"Ocultar Favoritos":"Mostrar Favoritos"})]})]}),ve&&e.jsx(ar,{isOpen:!0,videos:l,onSaveSequence:Ve,onToggleShowAll:je,showAllVideos:xe,style:S,onToggleBuilder:Re}),e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${v==="idle"?"bg-green-500":v==="syncing"?"bg-yellow-500 animate-pulse":"bg-red-500"}`}),e.jsx("span",{className:"text-sm text-gray-600",children:v==="idle"?"âœ… Sincronizado con Firebase":v==="syncing"?"ðŸ”„ Sincronizando...":"âŒ Error de sincronizaciÃ³n"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:Is,disabled:v==="syncing",className:"px-3 py-1 text-xs bg-purple-500 text-white rounded hover:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"ðŸ” DiagnÃ³stico"}),e.jsx("button",{onClick:Os,disabled:v==="syncing",className:"px-3 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"ðŸ“ Actualizar Resoluciones"}),e.jsx("button",{onClick:()=>St("update"),disabled:v==="syncing",className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"ðŸ”§ Actualizar Rutas"}),e.jsx("button",{onClick:()=>St("cleanup"),disabled:v==="syncing",className:"px-3 py-1 text-xs bg-yellow-500 text-white rounded hover:bg-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"ðŸ§¹ Limpiar HuÃ©rfanos"}),e.jsx("button",{onClick:()=>St("cleanup-tags"),disabled:v==="syncing",className:"px-3 py-1 text-xs bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"ðŸ·ï¸ Limpiar Tags"}),e.jsx("button",{onClick:Bs,disabled:v==="syncing",className:"px-3 py-1 text-xs bg-indigo-500 text-white rounded hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed",title:"Mover fÃ­sicamente videos existentes a estructura organizada (videos/page/style/)",children:"ðŸ“ Migrar Videos REAL"}),e.jsx("button",{onClick:()=>St("delete-all"),disabled:v==="syncing",className:"px-3 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"ðŸ—‘ï¸ Eliminar Todo"})]})]})}),e.jsxs("div",{className:"flex justify-center gap-4 mb-8",children:[e.jsxs("button",{onClick:()=>B("videos"),className:`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${L==="videos"?`bg-gradient-to-r ${ce(S)} text-white shadow-lg transform scale-105`:"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:[e.jsx(Dt,{className:"h-6 w-6"}),e.jsx("span",{children:"GALERÃA DE VIDEOS"})]}),e.jsxs("button",{onClick:()=>B("secuencias"),className:`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${L==="secuencias"?`bg-gradient-to-r ${ce(S)} text-white shadow-lg transform scale-105`:"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}`,children:[e.jsx(Vt,{className:"h-6 w-6"}),e.jsxs("span",{children:["GALERÃA DE SECUENCIAS (",D.length,")"]})]})]}),L==="videos"&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-800",children:["Videos de ",S.toLowerCase()," (",Ct.length,")"]}),(U.length>0||W!=="none"||oe)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[U.length>0&&`Filtrado por: ${U.join(", ")} `,W!=="none"&&`â€¢ Ordenado por: ${W} `,oe&&"â€¢ Solo favoritos"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Es,{type:"video"}),e.jsxs("button",{onClick:()=>Te(!$e),className:`flex items-center space-x-2 px-3 py-2 rounded-lg font-medium transition-all duration-200 ${$e?`bg-gradient-to-r ${ce(S)} text-white shadow-lg`:"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"}`,title:$e?"Modo compacto":"Modo ancho completo",children:[$e?e.jsx(ja,{className:"h-4 w-4"}):e.jsx(Na,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:$e?"Compacto":"Ancho completo"})]}),ve&&e.jsx("button",{onClick:je,className:`flex items-center space-x-2 px-3 py-1 rounded-lg text-sm font-medium transition-colors ${xe?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,title:xe?"Mostrar solo videos compatibles":"Mostrar todos los videos",children:xe?e.jsxs(e.Fragment,{children:[e.jsx(ka,{className:"h-4 w-4"}),e.jsx("span",{children:"Ocultar Incompatibles"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Sa,{className:"h-4 w-4"}),e.jsx("span",{children:"Mostrar Todos"})]})}),(T.length>0||U.length>0||W!=="none"||oe)&&e.jsxs("button",{onClick:()=>{Hs(),G([]),X("none"),d(!1)},className:"text-sm text-gray-500 hover:text-gray-700 transition-colors duration-200",children:["Limpiar todos los filtros ",e.jsx(et,{className:"h-4 w-4 ml-1"})]})]})]}),h?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Cargando videos..."})]}):l.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("p",{className:"text-gray-500 text-lg",children:["No hay videos de ",S.toLowerCase()," aÃºn"]}),e.jsxs("p",{className:"text-gray-400 text-sm mt-2",children:["Sube tu primer video de ",S.toLowerCase()," usando el botÃ³n de arriba"]})]}):e.jsx("div",{className:`grid gap-6 ${te().grid}`,children:Ct.map(s=>e.jsxs("div",{className:`bg-white rounded-lg shadow-md overflow-hidden border hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02] ${ve&&!Se(s)?"border-red-200 opacity-75":"border-gray-100"}`,children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:`w-full ${te().aspect} bg-gradient-to-br from-gray-100 to-gray-200 relative overflow-hidden flex items-center justify-center`,children:[s.thumbnailUrl&&s.thumbnailUrl!=="https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO"?e.jsx("img",{src:s.thumbnailUrl,alt:s.title,className:"w-full h-full object-cover",loading:"lazy",onError:u=>{u.target.style.display="none",u.target.nextSibling.style.display="flex"}}):null,e.jsxs("div",{className:`flex flex-col items-center justify-center text-gray-500 ${s.thumbnailUrl&&s.thumbnailUrl!=="https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO"?"hidden":"flex"}`,children:[e.jsx("svg",{className:"w-12 h-12 mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),e.jsx("span",{className:"text-sm font-medium",children:s.title})]}),e.jsx("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-sm font-medium",children:s.resolution&&s.resolution!=="Unknown"?s.resolution:"HD"}),ve&&e.jsx("div",{className:`absolute top-2 right-2 p-1 rounded-full text-xs font-bold ${Se(s)?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:Se(s)?"âœ…":"âŒ"})]}),e.jsx("button",{onClick:async()=>{try{const u=document.createElement("div");u.className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50";const E=document.createElement("div");E.className="bg-white rounded-lg p-6 max-w-5xl w-full mx-4 max-h-[95vh] overflow-y-auto",E.onclick=se=>se.stopPropagation();const F=document.createElement("div");F.className="flex items-center justify-between mb-4",F.innerHTML=`
                             <h3 class="text-xl font-semibold text-gray-900">${s.title}</h3>
                             <button class="text-gray-400 hover:text-gray-600 transition-colors">
                               <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                               </svg>
                             </button>
                           `;const Y=document.createElement("div");Y.id="video-player-container",Y.className="w-full flex justify-center mb-6";const pe=document.createElement("div");pe.className="w-full max-w-3xl mx-auto";const de=document.createElement("div");de.className="mb-4",de.innerHTML=`
                             <p class="text-gray-600 text-sm">${s.description||"Sin descripciÃ³n"}</p>
                           `;const Ce=document.createElement("div");Ce.className="flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg",Ce.innerHTML=`
                              <div class="flex items-center space-x-4 text-sm text-gray-600">
                                <span class="font-medium">${(s.fileSize/(1024*1024)).toFixed(2)} MB</span>
                                <span class="text-gray-400">â€¢</span>
                                <span class="font-medium">${s.resolution&&s.resolution!=="Unknown"?s.resolution:"HD"}</span>
                                <span class="text-gray-400">â€¢</span>
                                <span class="font-medium">${s.duration?Math.floor(s.duration/60)+":"+String(Math.floor(s.duration%60)).padStart(2,"0"):"N/A"}</span>
                              </div>
                              <div class="flex items-center space-x-2">
                                <div class="flex items-center space-x-1">
                                  <div class="flex items-center space-x-1" title="PuntuaciÃ³n: ${s.rating||0}/5">
                                    ${[1,2,3,4,5].map(se=>`<svg class="w-4 h-4 ${(s.rating||0)>=se?"text-yellow-400 fill-current":"text-gray-300"}" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                      </svg>`).join("")}
                                    <span class="text-sm font-medium text-gray-600">${s.rating||0}</span>
                                  </div>
                                </div>
                                <button class="flex items-center space-x-1 ${s.userLiked?"text-red-500":"text-gray-400 hover:text-red-500"} transition-colors duration-200 p-2 rounded hover:bg-red-50" title="${s.userLiked?"Quitar like":"Dar like"}">
                                  <svg class="w-5 h-5 ${s.userLiked?"fill-current":""}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                  </svg>
                                  <span class="text-sm font-medium">${s.likes||0}</span>
                                </button>
                                <button class="text-gray-400 hover:text-green-500 transition-colors duration-200 p-2 rounded hover:bg-green-50" title="Descargar video">
                                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                  </svg>
                                </button>
                                <button class="text-gray-400 hover:text-blue-500 transition-colors duration-200 p-2 rounded hover:bg-blue-50" title="Editar video">
                                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                  </svg>
                                </button>
                              </div>
                            `;const He=document.createElement("div");He.className="mb-4";const it=is(s);if(it.length>0){const se=it.map(({tag:Fe,categoryKey:Je,color:Ue})=>`<span class="inline-block px-3 py-1 rounded-full text-sm font-medium ${Ke(Ue)} mr-2 mb-2">${Fe}</span>`).join("");He.innerHTML=`
                               <h4 class="text-sm font-medium text-gray-700 mb-2">Etiquetas:</h4>
                               <div class="flex flex-wrap">${se}</div>
                             `}else He.innerHTML=`
                               <h4 class="text-sm font-medium text-gray-700 mb-2">Etiquetas:</h4>
                               <span class="text-gray-400 text-sm">Sin etiquetas</span>
                             `;const Ye=document.createElement("div");Ye.className="mb-4";const Wt=cs(s);if(Wt.length>0){const se=Wt.map(({tag:Fe})=>`<span class="inline-block px-3 py-1 rounded-full text-sm font-medium bg-gradient-to-r from-blue-500 to-purple-500 text-white mr-2 mb-2">${Fe}</span>`).join("");Ye.innerHTML=`
                               <h4 class="text-sm font-medium text-blue-600 uppercase tracking-wide mb-2">Etiquetas Iniciales:</h4>
                               <div class="flex flex-wrap">${se}</div>
                             `}const Gt=document.createElement("div");Gt.className="mb-4";const Kt=ds(s);if(Kt.length>0){const se=Kt.map(({tag:Fe})=>`<span class="inline-block px-3 py-1 rounded-full text-sm font-medium bg-gradient-to-r from-green-500 to-teal-500 text-white mr-2 mb-2">${Fe}</span>`).join("");Gt.innerHTML=`
                               <h4 class="text-sm font-medium text-green-600 uppercase tracking-wide mb-2">Etiquetas Finales:</h4>
                               <div class="flex flex-wrap">${se}</div>
                             `}pe.appendChild(de),pe.appendChild(Ce),pe.appendChild(He),Wt.length>0&&pe.appendChild(Ye),Kt.length>0&&pe.appendChild(Gt),E.appendChild(F),E.appendChild(Y),E.appendChild(pe),u.appendChild(E),document.body.appendChild(u);const{createRoot:Xs}=await ot(async()=>{const{createRoot:se}=await import("./index-DOeBVGYV.js").then(Fe=>Fe.c);return{createRoot:se}},__vite__mapDeps([4,3,5,1,6,7,0,8,9])),hs=Xs(Y);hs.render(ia.createElement(yt,{src:s.videoUrl,size:"large",loop:!0,initialShowControls:!0,autoplay:!0,muted:!1,className:"w-full max-w-3xl",resolutions:["auto","4k","1080p","720p","480p","360p"],currentResolution:"auto",videoTitle:s.title||"video",onResolutionChange:se=>{}})),u._root=hs;const Zt=()=>{u._root&&u._root.unmount(),document.body.contains(u)&&document.body.removeChild(u)};F.querySelector("button").onclick=Zt,u.onclick=se=>{se.target===u&&Zt()},Ce.querySelector('button[title="Descargar video"]').onclick=()=>{_t(s)},Ce.querySelector('button[title="Editar video"]').onclick=()=>{Zt(),Me(s)};const Xt=Ce.querySelector('div[title*="PuntuaciÃ³n"]'),$t=Xt.querySelectorAll("svg"),Qs=Xt.querySelector("span");$t.forEach((se,Fe)=>{const Je=Fe+1;se.addEventListener("mouseenter",()=>{$t.forEach((Ue,_e)=>{_e<=Fe&&(Ue.classList.add("text-yellow-400","fill-current"),Ue.classList.remove("text-gray-300"))})}),se.addEventListener("mouseleave",()=>{$t.forEach((Ue,_e)=>{const nt=s.rating||0;_e<nt?(Ue.classList.add("text-yellow-400","fill-current"),Ue.classList.remove("text-gray-300")):(Ue.classList.remove("text-yellow-400","fill-current"),Ue.classList.add("text-gray-300"))})}),se.addEventListener("click",async()=>{try{const _e=(s.rating||0)>=Je?0:Je;await Mt(s.id,{rating:_e}),s.rating=_e,$t.forEach((nt,gt)=>{gt<_e?(nt.classList.add("text-yellow-400","fill-current"),nt.classList.remove("text-gray-300")):(nt.classList.remove("text-yellow-400","fill-current"),nt.classList.add("text-gray-300"))}),Qs.textContent=_e,Xt.title=`PuntuaciÃ³n: ${_e}/5`}catch(Ue){console.error("Error al actualizar puntuaciÃ³n:",Ue)}})});const Tt=Ce.querySelector('button[title*="like"]');Tt.onclick=async()=>{if(!Q){alert("Debes iniciar sesiÃ³n para dar like");return}try{const se=await Qt(s.id,Q.uid);if(se.success){s.likes=se.likes,s.likedBy=se.likedBy,s.userLiked=se.userLiked,c(nt=>nt.map(gt=>gt.id===s.id?{...gt,likes:se.likes,likedBy:se.likedBy,userLiked:se.userLiked}:gt));const Fe=Tt.querySelector("svg"),Je=Tt,Ue=Tt.querySelector("span");se.userLiked?(Fe.classList.add("fill-current","text-red-500"),Fe.classList.remove("text-gray-400"),Je.classList.add("text-red-500"),Je.classList.remove("text-gray-400"),Je.title="Quitar like"):(Fe.classList.remove("fill-current","text-red-500"),Fe.classList.add("text-gray-400"),Je.classList.remove("text-red-500"),Je.classList.add("text-gray-400"),Je.title="Dar like"),Ue.textContent=se.likes;const _e=se.userLiked?"dado like a":"quitado like de"}else console.error("Error al actualizar like")}catch(se){console.error("Error al actualizar like:",se)}}}catch(u){console.error("Error al abrir modal de video:",u)}},className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("svg",{className:"w-12 h-12 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})})]}),e.jsxs("div",{className:`${te().compact?"p-2":"p-4"}`,children:[e.jsxs("div",{className:`flex items-center justify-between ${te().compact?"mb-1":"mb-2"}`,children:[e.jsx("h3",{className:`font-semibold text-gray-800 ${te().titleSize}`,children:s.title}),e.jsxs("div",{className:"flex items-center space-x-1",children:[[1,2,3,4,5].map(u=>{const E=(s.rating||0)>=u;return e.jsx("svg",{className:`${te().compact?"h-3 w-3":"h-4 w-4"} ${E?"text-yellow-400 fill-current":"text-gray-300"} cursor-pointer`,fill:"currentColor",viewBox:"0 0 24 24",onClick:async()=>{try{const Y=(s.rating||0)>=u?0:u;await Mt(s.id,{rating:Y}),s.rating=Y}catch(F){console.error("Error updating rating:",F)}},children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})},u)}),e.jsxs("span",{className:`${te().compact,"text-xs"} font-medium text-gray-500 ml-1`,children:["(",s.rating||0,")"]})]})]}),e.jsx("p",{className:`text-gray-600 text-sm ${te().compact?"mb-2":"mb-3"} ${te().descriptionLines===1?"line-clamp-1":te().descriptionLines===2?"line-clamp-2":te().descriptionLines===3?"line-clamp-3":"line-clamp-4"}`,children:s.description||"Sin descripciÃ³n"}),te().showTags&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:(()=>{const u=is(s);return u.length>0?u.map(({tag:E,categoryKey:F,color:Y})=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Ke(Y)}`,children:E},`${F}-${E}`)):e.jsx("span",{className:"text-gray-400 text-sm",children:"Sin etiquetas"})})()}),te().showTags&&(()=>{const u=cs(s);return u.length>0?e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-blue-600 uppercase tracking-wide",children:"Iniciales:"})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map(({tag:E,categoryKey:F,color:Y})=>e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-sm",children:E},`inicial-${F}-${E}`))})]}):null})(),te().showTags&&(()=>{const u=ds(s);return u.length>0?e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-green-600 uppercase tracking-wide",children:"Finales:"})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map(({tag:E,categoryKey:F,color:Y})=>e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-sm",children:E},`final-${F}-${E}`))})]}):null})(),te().compact?e.jsx(or,{video:s,onLike:()=>R(s),onEdit:()=>Me(s),onDelete:()=>Ee(s),onAddToSequence:()=>C(s),onDownload:()=>_t(s),onPlay:()=>kt(s),isVideoInSequence:ie(s),isBuilderOpen:ve,isVideoCompatible:Se(s),type:"video"}):e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"font-medium",children:[(s.fileSize/(1024*1024)).toFixed(2)," MB"]}),e.jsx("span",{className:"text-gray-400",children:"â€¢"}),e.jsx("span",{className:"text-gray-600",children:s.resolution&&s.resolution!=="Unknown"?s.resolution:"HD"}),s.bpm&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"â€¢"}),e.jsxs("span",{className:"text-purple-600 font-medium flex items-center space-x-1",children:[e.jsx(Dt,{className:"h-3 w-3"}),e.jsxs("span",{children:[s.bpm," BPM"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>kt(s),className:"text-gray-400 hover:text-blue-500 transition-colors duration-200 p-1 rounded hover:bg-blue-50",title:"Reproducir video",children:e.jsx(We,{className:"h-4 w-4"})}),e.jsxs("button",{onClick:()=>R(s),className:`flex items-center space-x-1 transition-colors duration-200 p-1 rounded hover:bg-red-50 ${s.userLiked?"text-red-500":"text-gray-400 hover:text-red-500"}`,title:s.userLiked?"Quitar like":"Dar like",children:[e.jsx(pt,{className:`h-4 w-4 ${s.userLiked?"fill-current":""}`}),e.jsx("span",{className:"font-medium",children:s.likes||0})]}),e.jsx("button",{onClick:()=>Me(s),className:"text-gray-400 hover:text-blue-500 transition-colors duration-200 p-1 rounded hover:bg-blue-50",title:"Editar video",children:e.jsx(Ut,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Ee(s),className:"text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 rounded hover:bg-red-50",title:"Eliminar video",children:e.jsx(dt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>C(s),disabled:ie(s),className:`transition-colors duration-200 p-1 rounded ${ie(s)?"text-gray-300 cursor-not-allowed":ve&&!Se(s)?"text-red-400 hover:text-red-500 hover:bg-red-50":"text-gray-400 hover:text-purple-500 hover:bg-purple-50"}`,title:ie(s)?"Ya en secuencia":ve&&!Se(s)?"AÃ±adir forzadamente (incompatible)":"AÃ±adir a secuencia",children:e.jsx(Vt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{_t(s)},className:"text-gray-400 hover:text-green-500 transition-colors duration-200 p-1 rounded hover:bg-green-50",title:"Descargar video",children:e.jsx(at,{className:"h-4 w-4"})})]})]})]})]},s.id))})]}),L==="secuencias"&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-800",children:["Secuencias de ",S.toLowerCase()," (",D.length,")"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Es,{type:"sequence"}),e.jsxs("button",{onClick:Re,className:"flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-lg font-medium shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105",children:[e.jsx(ss,{className:"h-4 w-4"}),e.jsx("span",{children:"CREAR SECUENCIA"})]})]})]}),H?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Cargando secuencias..."})]}):e.jsx(nr,{sequences:D,onDeleteSequence:Ze,onPlaySequence:lt,onEditSequence:ut,onDownloadSequence:Ht})]})]}),e.jsx(Ha,{isOpen:a,onClose:()=>r(!1),onVideoUploaded:qe,page:"figuras",style:S}),e.jsx(_a,{isOpen:t.isOpen,onClose:g,video:t.video,onVideoUpdated:$,page:"figuras",style:S}),e.jsx(ft,{isOpen:q.isOpen,onClose:Vs,onConfirm:()=>Qe(q.type),title:q.type==="update"?"Actualizar Rutas de Thumbnails":q.type==="cleanup"?"Limpiar Archivos HuÃ©rfanos":q.type==="cleanup-tags"?"Limpiar Tags Duplicados":"Eliminar Todos los Videos",message:q.type==="update"?"Â¿Actualizar las rutas de thumbnails de videos existentes? Esto corregirÃ¡ problemas de eliminaciÃ³n.":q.type==="cleanup"?"Â¿Limpiar archivos huÃ©rfanos? Esto eliminarÃ¡ archivos que no tienen documento en Firestore.":q.type==="cleanup-tags"?"Â¿Limpiar tags duplicados? Esto eliminarÃ¡ etiquetas repetidas en todos los videos manteniendo solo una instancia de cada tag.":"Â¿Eliminar TODOS los videos de Firebase y Storage? Esta acciÃ³n es IRREVERSIBLE y eliminarÃ¡ todos los datos.",confirmText:q.type==="update"?"Actualizar":q.type==="cleanup"?"Limpiar":q.type==="cleanup-tags"?"Limpiar Tags":"Eliminar Todo",cancelText:"Cancelar"}),e.jsx(ft,{isOpen:ae.isOpen,onClose:jt,onConfirm:xt,title:"ðŸŽ¬ Cargar Secuencia",message:`Â¿Deseas cargar la secuencia "${(us=ae.sequence)==null?void 0:us.name}"?

Esto reemplazarÃ¡ la secuencia actual en construcciÃ³n y perderÃ¡s todos los cambios no guardados.

Â¿EstÃ¡s seguro de que quieres continuar?`,confirmText:"SÃ­, Cargar",cancelText:"Cancelar",type:"warning"}),e.jsx(ft,{isOpen:y.isOpen,onClose:Xe,onConfirm:()=>ke(y.video),title:"ðŸ—‘ï¸ Eliminar Video",message:`Â¿EstÃ¡s seguro de que quieres eliminar el video "${(ms=y.video)==null?void 0:ms.title}"?

Esta acciÃ³n eliminarÃ¡ permanentemente:
â€¢ El archivo de video de Firebase Storage
â€¢ El thumbnail del video
â€¢ Los metadatos de Firestore

Esta acciÃ³n NO se puede deshacer.`,confirmText:"SÃ­, Eliminar",cancelText:"Cancelar",type:"danger"}),Le&&be&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"relative w-full max-w-3xl h-auto max-h-[85vh] bg-white rounded-lg overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 border-b flex-shrink-0",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["ðŸŽ¬ ",be.title]}),e.jsx("button",{onClick:b,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(et,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"flex-1 min-h-0 p-4",children:e.jsx("div",{className:"w-full h-full max-h-[65vh] flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsx(rs,{videos:[be],className:"w-full h-full",showControls:!0,autoplay:!0,loop:!1,muted:!1})})})})]})}),k&&fe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"relative w-full max-w-3xl h-auto max-h-[85vh] bg-white rounded-lg overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 border-b flex-shrink-0",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["ðŸŽ¬ Secuencia: ",fe.name]}),e.jsx("button",{onClick:Z,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(et,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"flex-1 min-h-0 p-4",children:e.jsx("div",{className:"w-full h-full max-h-[65vh] flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsx(rs,{videos:fe.videos,className:"w-full h-full",showControls:!0,autoplay:!0,loop:!1,muted:!1})})})})]})}),e.jsx(Za,{isOpen:ye.isOpen,onClose:Nt,video:ye.sequence?{...ye.sequence,title:ye.sequence.name,file:null}:null,onDownloadComplete:()=>{N("Secuencia descargada correctamente","success"),Nt()}}),i.map(s=>e.jsx(vt,{message:s.message,type:s.type,onClose:()=>ge(s.id)},s.id))]})};export{pr as default};
//# sourceMappingURL=FigurasPage-C05wCM0c.js.map
