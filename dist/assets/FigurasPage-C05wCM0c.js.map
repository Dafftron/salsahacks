{"version":3,"mappings":"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","names":["generateBestVideoThumbnail","videoFile","videoURL","video","canvas","ctx","resolve","reject","videoAspectRatio","canvasWidth","canvasHeight","duration","blob","thumbnailURL","error","uploadFile","file","path","onProgress","storageRef","ref","storage","metadata","snapshot","uploadBytes","getDownloadURL","deleteFile","deleteObject","uploadVideo","maxSize","downloadURL","uploadError","uploadTask","uploadBytesResumable","progress","errorMessage","deleteVideo","videoPath","thumbnailPath","promises","videoRef","thumbnailRef","deleteAllVideoFiles","videosResult","deleteAllFilesInFolder","thumbnailsResult","folderPath","folderRef","result","listAll","deletePromises","itemRef","results","successfulDeletes","r","failedDeletes","cleanupOrphanedFiles","videosFromFirestore","videosFolder","thumbnailsFolder","firestoreVideoPaths","v","firestoreThumbnailPaths","orphanedVideos","item","orphanedThumbnails","downloadFile","fileRef","url","response","blobToFile","filename","migrateVideosToOrganizedStructure","migrationResults","style","page","oldVideoPath","oldThumbnailPath","newVideoPath","newThumbnailPath","videoMigrated","thumbnailMigrated","videoBlob","thumbnailBlob","thumbnailFile","successfulMigrations","alreadyOrganized","failedMigrations","categoryStructure","useCategories","selectedPage","setSelectedPage","useState","selectedStyle","setSelectedStyle","useEffect","currentCategories","useMemo","pageData","styleData","availableTags","allTags","categoryKey","categoryData","tag","categoriesList","key","data","availableStyles","availablePages","color","Toast","message","type","onClose","isVisible","setIsVisible","timer","getIcon","jsx","CheckCircle","XCircle","AlertCircle","getStyles","jsxs","X","VideoPlayer","src","size","loop","loopSegment","initialShowControls","autoplay","muted","onTimeUpdate","onEnded","className","resolutions","currentResolution","onResolutionChange","videoTitle","useRef","containerRef","isPlaying","setIsPlaying","currentTime","setCurrentTime","setDuration","volume","setVolume","isMuted","setIsMuted","showVolumeSlider","setShowVolumeSlider","volumeSliderTimeout","setVolumeSliderTimeout","isFullscreen","setIsFullscreen","isLoopEnabled","setIsLoopEnabled","loopStart","setLoopStart","loopEnd","setLoopEnd","isLoopSegmentMode","setIsLoopSegmentMode","hasPointA","setHasPointA","hasPointB","setHasPointB","savedPointA","setSavedPointA","savedPointB","setSavedPointB","showControls","setShowControls","controlsTimeout","setControlsTimeout","showResolutionMenu","setShowResolutionMenu","selectedResolution","setSelectedResolution","videoMaxResolution","setVideoMaxResolution","currentAutoResolution","setCurrentAutoResolution","showSpeedMenu","setShowSpeedMenu","playbackSpeed","setPlaybackSpeed","videoOrientation","setVideoOrientation","availableSpeeds","checkLoopSegment","handleKeyDown","e","activeElement","togglePlay","skip","nextIndex","handleSpeedChange","timeout","handleClickOutside","event","activateControls","handleVideoClick","lastClickTime","setLastClickTime","clickCount","setClickCount","handleVideoDoubleClick","rect","clickX","videoWidth","seconds","newTime","handleTimeUpdate","handleLoadedMetadata","width","height","isVertical","maxDimension","maxRes","handleEnded","handleSeek","toggleMute","newMutedState","handleVolumeChange","newVolume","toggleFullscreen","setLoopPoint","formatTime","time","minutes","handleResolutionChange","resolution","speed","getSpeedLabel","getResolutionLabel","isResolutionAvailable","resolutionOrder","maxIndex","getSizeClasses","sizeClass","downloadVideo","blobUrl","link","Minimize","Maximize","SkipBack","Pause","Play","SkipForward","RotateCcw","newMode","isAvailable","Download","VolumeX","Volume2","extractBPMFromVideo","audioContext","arrayBuffer","audioBuffer","checkAudioLevel","bpm","detectBPMFromAudioBuffer","roundedBPM","channelData","sampleRate","analysisLength","rms","sum","sample","peaks","detectPeaks","intervals","i","avgInterval","a","b","limitedBPM","interval","energy","avgEnergy","threshold","minDistance","windowSize","windowData","maxInWindow","lowerThreshold","validateBPM","VideoUploadModal","isOpen","onVideoUploaded","user","useAuth","fileInputRef","selectedFiles","setSelectedFiles","uploading","setUploading","uploadProgress","setUploadProgress","currentStep","setCurrentStep","videoData","setVideoData","toasts","setToasts","selectedTags","setSelectedTags","fieldRefs","collapsedVideos","setCollapsedVideos","resetForm","initialTags","addToast","id","prev","removeToast","toast","toggleVideoCollapse","fileName","newSet","toggleAllVideos","collapse","handleFileSelect","videoFiles","newFiles","existingFile","videoPreview","generateDefaultThumbnail","removeFile","index","fileToRemove","_","newData","handleTagToggle","category","currentTags","t","newTags","generateThumbnail","_a","customThumbnailFile","uploadResult","thumbnailError","defaultThumbnail","defaultError","uploadVideoFile","checkVideoDuplicate","thumbnailResult","tagsWithStyle","titleInput","descriptionInput","currentTitle","_b","currentDescription","_c","_d","videoResolution","videoHeight","bpmDetected","bpmResult","videoDoc","docResult","createVideoDocument","handleUpload","uploadedVideos","FileSelectionStep","Upload","Trash2","TagsStep","ChevronsDown","ChevronsUp","fileIndex","isCollapsed","ChevronDown","ChevronUp","el","newTitle","newDescription","reader","UploadStep","renderStep","canProceed","handleNext","handleBack","Fragment","VideoEditModal","onVideoUpdated","loading","setLoading","title","setTitle","description","setDescription","customThumbnail","setCustomThumbnail","setCustomThumbnailFile","tagsIniciales","setTagsIniciales","tagsFinales","setTagsFinales","collapsedSections","setCollapsedSections","initialTagsIniciales","initialTagsFinales","toggleSectionCollapse","sectionName","handleTagInicialToggle","handleTagFinalToggle","handleThumbnailChange","detectVideoResolution","videoUrl","handleSave","thumbnailUrl","resolutionData","updatedData","updateVideoDocument","Edit","Tag","ffmpeg","initFFmpeg","FFmpeg","adjustVideoSpeed","speedFactor","outputName","ffmpegInstance","fetchFile","audioError","createSequencePreview","videos","useBPMControl","targetBPM","processedVideos","needsProcessing","fetchError","getStorage","__vitePreload","storagePath","urlParts","storageError","dataToWrite","fileList","finalData","convertVideoFormat","format","resolutionSettings","qualitySettings","downloadSequenceDirect","sequence","JSZip","n","zip","sequenceName","generateSequenceVideo","ffmpegPromise","timeoutPromise","convertResult","DownloadModal","onDownloadComplete","setFormat","setResolution","isProcessing","setIsProcessing","setProgress","formatOptions","resolutionOptions","handleDownload","progressInterval","mimeType","dirHandle","selectDownloadFolder","extension","writable","handleDirectDownload","Video","option","ConfirmModal","onConfirm","confirmText","cancelText","AlertTriangle","getConfirmButtonStyle","SEQUENCES_COLLECTION","createSequence","sequenceData","sequenceWithTimestamp","serverTimestamp","docRef","addDoc","collection","db","updateSequence","sequenceId","updateData","sequenceRef","doc","updateWithTimestamp","updateDoc","deleteSequence","deleteDoc","subscribeToSequencesByStyle","callback","q","query","where","orderBy","onSnapshot","querySnapshot","sequences","_f","_e","_g","useDragAndDrop","onReorder","draggedIndex","setDraggedIndex","dragOverIndex","setDragOverIndex","handleDragStart","useCallback","handleDragOver","handleDragEnter","handleDragLeave","handleDrop","dropIndex","handleDragEnd","getDragStyles","styles","SequenceVideoPlayer","currentBPM","currentVideoIndex","setCurrentVideoIndex","showControlsUI","setShowControlsUI","playbackRate","setPlaybackRate","manualPlaybackSpeed","setManualPlaybackSpeed","useManualSpeed","setUseManualSpeed","currentVideo","handleVideoEnd","goToPreviousVideo","goToNextVideo","handleProgressClick","handleKeyPress","VideoCombiner","videoBlobs","combinedBlob","stream","mediaRecorder","chunks","processNextVideo","videoAspect","canvasAspect","drawWidth","drawHeight","offsetX","offsetY","renderFrame","VideoDownloadModal","setError","downloadUrl","setDownloadUrl","quality","setQuality","videoCombiner","handleDownloadFile","getProgressColor","getProgressIcon","Loader","getProgressBarColor","getStageDescription","SequenceBuilder","onSaveSequence","onToggleShowAll","showAllVideos","isIntegrated","onToggleBuilder","getColorClasses","selectedVideo","setSelectedVideo","showVideoModal","setShowVideoModal","isCreatingPreview","setIsCreatingPreview","previewVideoUrl","setPreviewVideoUrl","previewError","setPreviewError","lastPreviewData","setLastPreviewData","sequenceTags","setSequenceTags","isTagsSectionCollapsed","setIsTagsSectionCollapsed","showDownloadModal","setShowDownloadModal","setCurrentBPM","getOrderedTags","orderedTags","categoryTags","getOrderedTagsIniciales","getOrderedTagsFinales","sequenceDescription","editingSequenceId","addVideoToSequence","removeVideoFromSequence","reorderSequence","generateRandomSequence","clearSequence","setSequenceName","setSequenceDescription","isVideoCompatible","isVideoInSequence","toggleBuilder","checkCompatibility","useSequenceBuilderContext","videosWithBPM","bpmValues","averageBPM","confirmModal","setConfirmModal","randomCount","setRandomCount","handleVideoLike","toggleVideoLike","handleGenerateRandom","videosNeeded","lastVideo","compatibleVideos","seqVideo","handleSaveSequence","generateSequenceThumbnail","handleCancel","handleClearSequence","handleConfirmAction","timeoutId","generateRealtimePreview","getAvailableResolutions","handlePlayVideo","previewKey","prevTags","removed","rest","isTagSelected","getOrderedSequenceTags","firstVideo","Shuffle","Plus","GripVertical","star","isFilled","Music","Heart","Save","SmartThumbnail","alt","fallbackSrc","showPlayIcon","props","imageError","setImageError","isLoading","setIsLoading","handleImageLoad","handleImageError","shouldShowFallback","imageSrc","Image","SequenceGallery","onDeleteSequence","onPlaySequence","onEditSequence","onEditThumbnail","onDownloadSequence","deleteModal","setDeleteModal","getSequenceConfig","useCardSize","handleDeleteClick","handleConfirmDelete","handlePlaySequence","handleDownloadSequence","Users","Edit3","CardSizeSelector","videoCardSize","sequenceCardSize","setVideoCardSize","setSequenceCardSize","availableSizes","sizeLabels","currentSize","setSize","sizeIcons","LayoutGrid","Grid3X3","Grid","Square","sizeColors","CompactCardActions","onLike","onEdit","onDelete","onAddToSequence","onDownload","onPlay","isBuilderOpen","FigurasPage","isUploadModalOpen","setIsUploadModalOpen","editModal","setEditModal","setVideos","searchTerm","setSearchTerm","showFilters","setShowFilters","activeTab","setActiveTab","syncStatus","setSyncStatus","cleanupModal","setCleanupModal","editSequenceModal","setEditSequenceModal","downloadSequenceModal","setDownloadSequenceModal","migrationModal","setMigrationModal","isFullWidth","setIsFullWidth","showVideoPlayer","setShowVideoPlayer","selectedSequence","setSelectedSequence","showSequencePlayer","setShowSequencePlayer","activeCategoryChips","setActiveCategoryChips","sortBy","setSortBy","showFavorites","setShowFavorites","setSequences","sequencesLoading","setSequencesLoading","getVideoConfig","toggleShowAllVideos","getFilteredVideos","loadSequence","getGradientClasses","handleCategoryTitleClick","chip","handleAddVideoToSequence","iconMap","Star","Zap","unsubscribe","subscribeToVideosByStyle","videosData","updatedVideos","likeResult","favoriteResult","checkUserLikedVideo","checkUserFavorite","sequencesData","handleVideoUploaded","openEditModal","closeEditModal","handleVideoUpdated","updatedVideo","prevVideos","action","favoriteAction","sequenceWithStyle","handleDeleteSequence","handleEditSequence","sequenceToEdit","handleConfirmEditSequence","handleCancelEditSequence","handleCloseDownloadSequence","handleCloseVideoPlayer","handleCloseSequencePlayer","handleDeleteVideo","storageResult","firestoreResult","deleteVideoDocument","openDeleteModal","closeDeleteModal","handleCleanupData","updateVideoThumbnailPaths","getVideos","cleanupDuplicateTags","deleteAllVideos","openCleanupModal","closeCleanupModal","handleDiagnoseVideos","diagnoseVideos","handleUpdateAllResolutions","videosToUpdate","updatedCount","videoElement","handleMigrateVideos","handleTagFilter","clearFilters","handleSortChange","sortKey","hasCategoryTags","cat","sortVideos","videosToSort","sortedVideos","normalizeText","text","advancedSearch","searchTerms","normalizedTitle","normalizedDescription","normalizedTags","searchWord","normalizedSearchWord","baseFilteredVideos","term","searchMatch","tagsMatch","categoryMatch","favoritesMatch","baseCompatibilityFiltered","filteredVideos","IconComponent","isSelected","gradientClass","Search","Filter","Minimize2","Maximize2","EyeOff","Eye","modal","videoContainer","header","videoPlayerContainer","videoInfoContainer","stats","tagsContainer","tagsHTML","tagsInicialesContainer","tagsFinalesContainer","createRoot","root","React","closeModal","ratingContainer","stars","ratingText","starValue","s","currentRating","newRating","likeButton","icon","button","likesText"],"ignoreList":[],"sources":["../../src/services/firebase/storage.js","../../src/hooks/useCategories.js","../../src/components/common/Toast.jsx","../../src/components/video/VideoPlayer.jsx","../../src/services/audio/bpmDetection.js","../../src/components/video/VideoUploadModal.jsx","../../src/components/video/VideoEditModal.jsx","../../src/services/video/videoProcessor.js","../../src/components/video/DownloadModal.jsx","../../src/components/common/ConfirmModal.jsx","../../src/services/firebase/sequences.js","../../src/hooks/useDragAndDrop.js","../../src/components/sequence/SequenceVideoPlayer.jsx","../../src/services/video/videoCombiner.js","../../src/components/video/VideoDownloadModal.jsx","../../src/components/sequence/SequenceBuilder.jsx","../../src/components/common/SmartThumbnail.jsx","../../src/components/sequence/SequenceGallery.jsx","../../src/components/common/CardSizeSelector.jsx","../../src/components/common/CompactCardActions.jsx","../../src/pages/FigurasPage.jsx"],"sourcesContent":["// Servicios de Firebase Storage\r\nimport { \r\n  ref,\r\n  uploadBytes,\r\n  getDownloadURL,\r\n  deleteObject,\r\n  listAll,\r\n  uploadBytesResumable\r\n} from 'firebase/storage';\r\nimport { storage } from './config';\r\n\r\n// Función para generar thumbnail del video completo - ALTA CALIDAD\r\nexport const generateVideoThumbnail = (videoFile) => {\r\n  return new Promise((resolve, reject) => {\r\n    try {\r\n      // Crear URL temporal del video\r\n      const videoURL = URL.createObjectURL(videoFile);\r\n      \r\n      // Crear elemento de video\r\n      const video = document.createElement('video');\r\n      video.crossOrigin = 'anonymous';\r\n      video.muted = true;\r\n      video.playsInline = true;\r\n      \r\n      // Crear canvas para capturar el frame\r\n      const canvas = document.createElement('canvas');\r\n      const ctx = canvas.getContext('2d');\r\n      \r\n      // Configurar canvas para thumbnails de ALTA CALIDAD\r\n      const maxWidth = 1280; // Aumentar de 400 a 1280 para mejor calidad\r\n      const maxHeight = 720; // Aumentar de 400 a 720 para mejor calidad\r\n      \r\n      video.onloadedmetadata = () => {\r\n        try {\r\n          // Calcular las dimensiones manteniendo las proporciones\r\n          const videoAspectRatio = video.videoWidth / video.videoHeight;\r\n          let canvasWidth, canvasHeight;\r\n          \r\n          if (videoAspectRatio > 1) {\r\n            // Video horizontal\r\n            canvasWidth = maxWidth;\r\n            canvasHeight = maxWidth / videoAspectRatio;\r\n          } else {\r\n            // Video vertical\r\n            canvasHeight = maxHeight;\r\n            canvasWidth = maxHeight * videoAspectRatio;\r\n          }\r\n          \r\n          canvas.width = canvasWidth;\r\n          canvas.height = canvasHeight;\r\n          \r\n          // Buscar un frame en el medio del video (como al principio)\r\n          const duration = video.duration;\r\n          const targetTime = Math.min(duration * 0.5, 1); // 50% del video o máximo 1 segundo\r\n          \r\n          video.currentTime = targetTime;\r\n          \r\n          video.onseeked = () => {\r\n            try {\r\n              // Dibujar el frame completo en el canvas\r\n              ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n              \r\n              // Convertir a blob\r\n              canvas.toBlob((blob) => {\r\n                if (blob) {\r\n                  // Crear URL del thumbnail\r\n                  const thumbnailURL = URL.createObjectURL(blob);\r\n                  \r\n                  // Limpiar recursos\r\n                  URL.revokeObjectURL(videoURL);\r\n                  video.remove();\r\n                  canvas.remove();\r\n                  \r\n                  resolve({\r\n                    success: true,\r\n                    thumbnailURL,\r\n                    blob,\r\n                    error: null\r\n                  });\r\n                } else {\r\n                  reject(new Error('No se pudo generar el thumbnail'));\r\n                }\r\n              }, 'image/jpeg', 0.95); // Aumentar calidad de 0.8 a 0.95\r\n              \r\n            } catch (error) {\r\n              reject(new Error(`Error al capturar frame: ${error.message}`));\r\n            }\r\n          };\r\n          \r\n          video.onerror = () => {\r\n            reject(new Error('Error al cargar el video para thumbnail'));\r\n          };\r\n          \r\n        } catch (error) {\r\n          reject(new Error(`Error al procesar metadata: ${error.message}`));\r\n        }\r\n      };\r\n      \r\n      video.onerror = () => {\r\n        // Limpiar recursos en caso de error\r\n        URL.revokeObjectURL(videoURL);\r\n        video.remove();\r\n        canvas.remove();\r\n        reject(new Error('Error al cargar el video'));\r\n      };\r\n      \r\n      // Cargar el video\r\n      video.src = videoURL;\r\n      \r\n    } catch (error) {\r\n      reject(new Error(`Error al generar thumbnail: ${error.message}`));\r\n    }\r\n  });\r\n};\r\n\r\n// Función para generar thumbnail simple (como fig006)\r\nexport const generateBestVideoThumbnail = async (videoFile) => {\r\n  try {\r\n    const videoURL = URL.createObjectURL(videoFile);\r\n    const video = document.createElement('video');\r\n    video.crossOrigin = 'anonymous';\r\n    video.muted = true;\r\n    video.playsInline = true;\r\n    \r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d');\r\n    \r\n    return new Promise((resolve, reject) => {\r\n      video.onloadedmetadata = () => {\r\n        // Configurar canvas para thumbnails de ALTA CALIDAD\r\n        const maxWidth = 1280; // Aumentar de 400 a 1280 para mejor calidad\r\n        const maxHeight = 720; // Aumentar de 400 a 720 para mejor calidad\r\n        \r\n        // Calcular las dimensiones manteniendo las proporciones\r\n        const videoAspectRatio = video.videoWidth / video.videoHeight;\r\n        let canvasWidth, canvasHeight;\r\n        \r\n        if (videoAspectRatio > 1) {\r\n          // Video horizontal\r\n          canvasWidth = maxWidth;\r\n          canvasHeight = maxWidth / videoAspectRatio;\r\n        } else {\r\n          // Video vertical\r\n          canvasHeight = maxHeight;\r\n          canvasWidth = maxHeight * videoAspectRatio;\r\n        }\r\n        \r\n        canvas.width = canvasWidth;\r\n        canvas.height = canvasHeight;\r\n        \r\n        const duration = video.duration;\r\n        \r\n        // Usar solo el punto medio del video (como fig006) o máximo 1 segundo\r\n        video.currentTime = Math.min(duration * 0.5, 1);\r\n        \r\n        video.onseeked = () => {\r\n          try {\r\n            // Dibujar el frame completo en el canvas\r\n            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n            \r\n            canvas.toBlob((blob) => {\r\n              if (blob) {\r\n                const thumbnailURL = URL.createObjectURL(blob);\r\n                \r\n                URL.revokeObjectURL(videoURL);\r\n                video.remove();\r\n                canvas.remove();\r\n                \r\n                resolve({\r\n                  success: true,\r\n                  thumbnailURL,\r\n                  blob,\r\n                  error: null\r\n                });\r\n              } else {\r\n                reject(new Error('No se pudo generar el thumbnail'));\r\n              }\r\n            }, 'image/jpeg', 0.95); // Aumentar calidad de 0.8 a 0.95\r\n            \r\n          } catch (error) {\r\n            reject(new Error(`Error al capturar frame: ${error.message}`));\r\n          }\r\n        };\r\n        \r\n        video.onerror = () => {\r\n          reject(new Error('Error al cargar el video para thumbnail'));\r\n        };\r\n      };\r\n      \r\n      video.onerror = () => {\r\n        URL.revokeObjectURL(videoURL);\r\n        video.remove();\r\n        canvas.remove();\r\n        reject(new Error('Error al cargar el video'));\r\n      };\r\n      \r\n      video.src = videoURL;\r\n    });\r\n    \r\n  } catch (error) {\r\n    return {\r\n      success: false,\r\n      thumbnailURL: 'https://via.placeholder.com/300x200/1a1a1a/ffffff?text=VIDEO',\r\n      blob: null,\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\n// Función de upload simulado para desarrollo (cuando Firebase Storage no está disponible)\r\nexport const uploadVideoSimulated = async (file, path, onProgress) => {\r\n  try {\r\n    // Validar tipo de archivo\r\n    if (!file.type.startsWith('video/')) {\r\n      throw new Error('El archivo debe ser un video');\r\n    }\r\n    \r\n    // Validar tamaño (máximo 100MB)\r\n    const maxSize = 100 * 1024 * 1024; // 100MB\r\n    if (file.size > maxSize) {\r\n      throw new Error('El video es demasiado grande. Máximo 100MB');\r\n    }\r\n    \r\n    // Simular progreso de upload\r\n    for (let i = 0; i <= 100; i += 10) {\r\n      if (onProgress) {\r\n        onProgress(i);\r\n      }\r\n      await new Promise(resolve => setTimeout(resolve, 200)); // Simular delay\r\n    }\r\n    \r\n    // Crear URL temporal del archivo\r\n    const fileUrl = URL.createObjectURL(file);\r\n    \r\n    // Simular metadata\r\n    const metadata = {\r\n      uploadedAt: new Date().toISOString(),\r\n      originalName: file.name,\r\n      fileSize: file.size.toString(),\r\n      fileType: 'video',\r\n      simulated: true\r\n    };\r\n    \r\n    return { \r\n      success: true,\r\n      url: fileUrl, \r\n      path: path,\r\n      error: null,\r\n      simulated: true,\r\n      metadata\r\n    };\r\n    \r\n  } catch (error) {\r\n    console.error('Error uploading video (simulated):', error);\r\n    \r\n    return { \r\n      success: false,\r\n      url: null, \r\n      path: null,\r\n      error: error.message,\r\n      simulated: true\r\n    };\r\n  }\r\n};\r\n\r\n// Subir archivo con progreso\r\nexport const uploadFile = async (file, path, onProgress) => {\r\n  try {\r\n    const storageRef = ref(storage, path);\r\n    \r\n    // Crear metadata para el archivo\r\n    const metadata = {\r\n      contentType: file.type,\r\n      customMetadata: {\r\n        uploadedAt: new Date().toISOString(),\r\n        originalName: file.name,\r\n        fileSize: file.size.toString()\r\n      }\r\n    };\r\n    \r\n    // Subir archivo con metadata\r\n    const snapshot = await uploadBytes(storageRef, file, metadata);\r\n    \r\n    // Obtener URL de descarga\r\n    const downloadURL = await getDownloadURL(snapshot.ref);\r\n    \r\n    return { \r\n      success: true,\r\n      url: downloadURL, \r\n      path: snapshot.ref.fullPath,\r\n      error: null \r\n    };\r\n  } catch (error) {\r\n    console.error('Error uploading file:', error);\r\n    return { \r\n      success: false,\r\n      url: null, \r\n      path: null,\r\n      error: error.message \r\n    };\r\n  }\r\n};\r\n\r\n// Subir imagen con compresión\r\nexport const uploadImage = async (file, path, maxSize = 1024 * 1024) => {\r\n  try {\r\n    // Comprimir imagen si es muy grande\r\n    let fileToUpload = file;\r\n    \r\n    if (file.size > maxSize) {\r\n      const compressedFile = await compressImage(file, maxSize);\r\n      fileToUpload = compressedFile;\r\n    }\r\n    \r\n    return await uploadFile(fileToUpload, path);\r\n  } catch (error) {\r\n    return { \r\n      url: null, \r\n      path: null,\r\n      error: error.message \r\n    };\r\n  }\r\n};\r\n\r\n// Comprimir imagen\r\nconst compressImage = (file, maxSize) => {\r\n  return new Promise((resolve) => {\r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d');\r\n    const img = new Image();\r\n    \r\n    img.onload = () => {\r\n      let { width, height } = img;\r\n      \r\n      // Calcular nuevas dimensiones\r\n      const ratio = Math.min(maxSize / file.size, 1);\r\n      width *= ratio;\r\n      height *= ratio;\r\n      \r\n      canvas.width = width;\r\n      canvas.height = height;\r\n      \r\n      ctx.drawImage(img, 0, 0, width, height);\r\n      \r\n      canvas.toBlob((blob) => {\r\n        const compressedFile = new File([blob], file.name, {\r\n          type: file.type,\r\n          lastModified: Date.now()\r\n        });\r\n        resolve(compressedFile);\r\n      }, file.type, 0.8);\r\n    };\r\n    \r\n    img.src = URL.createObjectURL(file);\r\n  });\r\n};\r\n\r\n// Obtener URL de descarga\r\nexport const getFileURL = async (path) => {\r\n  try {\r\n    const storageRef = ref(storage, path);\r\n    const url = await getDownloadURL(storageRef);\r\n    return { url, error: null };\r\n  } catch (error) {\r\n    return { url: null, error: error.message };\r\n  }\r\n};\r\n\r\n// Eliminar archivo\r\nexport const deleteFile = async (path) => {\r\n  try {\r\n    const storageRef = ref(storage, path);\r\n    await deleteObject(storageRef);\r\n    return { success: true, error: null };\r\n  } catch (error) {\r\n    return { success: false, error: error.message };\r\n  }\r\n};\r\n\r\n// Listar archivos en una carpeta\r\nexport const listFiles = async (folderPath) => {\r\n  try {\r\n    const folderRef = ref(storage, folderPath);\r\n    const result = await listAll(folderRef);\r\n    \r\n    const files = await Promise.all(\r\n      result.items.map(async (itemRef) => {\r\n        const url = await getDownloadURL(itemRef);\r\n        return {\r\n          name: itemRef.name,\r\n          path: itemRef.fullPath,\r\n          url\r\n        };\r\n      })\r\n    );\r\n    \r\n    return { files, error: null };\r\n  } catch (error) {\r\n    return { files: [], error: error.message };\r\n  }\r\n};\r\n\r\n// Subir imagen de perfil\r\nexport const uploadProfileImage = async (file, userId) => {\r\n  const path = `profiles/${userId}/${Date.now()}_${file.name}`;\r\n  return await uploadImage(file, path);\r\n};\r\n\r\n// Subir imagen de nota\r\nexport const uploadNoteImage = async (file, noteId) => {\r\n  const path = `notes/${noteId}/${Date.now()}_${file.name}`;\r\n  return await uploadImage(file, path);\r\n};\r\n\r\n// Subir imagen de evento\r\nexport const uploadEventImage = async (file, eventId) => {\r\n  const path = `events/${eventId}/${Date.now()}_${file.name}`;\r\n  return await uploadImage(file, path);\r\n};\r\n\r\n// Subir imagen de figura\r\nexport const uploadFigureImage = async (file, figureId) => {\r\n  const path = `figures/${figureId}/${Date.now()}_${file.name}`;\r\n  return await uploadImage(file, path);\r\n};\r\n\r\n// Subir video con manejo de errores mejorado y progreso\r\nexport const uploadVideo = async (file, path, onProgress) => {\r\n  try {\r\n    // Validar tipo de archivo\r\n    if (!file.type.startsWith('video/')) {\r\n      throw new Error('El archivo debe ser un video');\r\n    }\r\n    \r\n    // Validar tamaño (máximo 100MB)\r\n    const maxSize = 100 * 1024 * 1024; // 100MB\r\n    if (file.size > maxSize) {\r\n      throw new Error('El video es demasiado grande. Máximo 100MB');\r\n    }\r\n    \r\n    // Ya tienes el plan Blaze, usar Firebase Storage real directamente\r\n    console.log('Subiendo video a Firebase Storage...');\r\n    \r\n    // Crear metadata específica para videos\r\n    const metadata = {\r\n      contentType: file.type,\r\n      customMetadata: {\r\n        uploadedAt: new Date().toISOString(),\r\n        originalName: file.name,\r\n        fileSize: file.size.toString(),\r\n        fileType: 'video'\r\n      }\r\n    };\r\n    \r\n    const storageRef = ref(storage, path);\r\n    \r\n    // Intentar primero con uploadBytes simple\r\n    try {\r\n      const snapshot = await uploadBytes(storageRef, file, metadata);\r\n      const downloadURL = await getDownloadURL(snapshot.ref);\r\n      \r\n      console.log('Video subido exitosamente a Firebase Storage:', downloadURL);\r\n      \r\n      return { \r\n        success: true,\r\n        url: downloadURL, \r\n        path: snapshot.ref.fullPath,\r\n        error: null,\r\n        simulated: false\r\n      };\r\n    } catch (uploadError) {\r\n      console.error('Error con uploadBytes, intentando con uploadBytesResumable:', uploadError);\r\n      \r\n      // Si falla, intentar con uploadBytesResumable\r\n      const uploadTask = uploadBytesResumable(storageRef, file, metadata);\r\n      \r\n      return new Promise((resolve, reject) => {\r\n        uploadTask.on(\r\n          'state_changed',\r\n          (snapshot) => {\r\n            // Progreso del upload\r\n            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\r\n            if (onProgress) {\r\n              onProgress(progress);\r\n            }\r\n          },\r\n          (error) => {\r\n            // Error durante el upload\r\n            console.error('Error uploading video:', error);\r\n            \r\n            let errorMessage = 'Error al subir el video';\r\n            if (error.code === 'storage/unauthorized') {\r\n              errorMessage = 'No tienes permisos para subir videos';\r\n            } else if (error.code === 'storage/quota-exceeded') {\r\n              errorMessage = 'Se ha excedido la cuota de almacenamiento';\r\n            } else if (error.code === 'storage/retry-limit-exceeded') {\r\n              errorMessage = 'Error de conexión. Intenta de nuevo';\r\n            } else if (error.code === 'storage/canceled') {\r\n              errorMessage = 'Upload cancelado';\r\n            } else if (error.message) {\r\n              errorMessage = error.message;\r\n            }\r\n            \r\n            resolve({ \r\n              success: false,\r\n              url: null, \r\n              path: null,\r\n              error: errorMessage,\r\n              simulated: false\r\n            });\r\n          },\r\n          async () => {\r\n            // Upload completado exitosamente\r\n            try {\r\n              const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);\r\n              console.log('Video subido exitosamente a Firebase Storage:', downloadURL);\r\n              resolve({ \r\n                success: true,\r\n                url: downloadURL, \r\n                path: uploadTask.snapshot.ref.fullPath,\r\n                error: null,\r\n                simulated: false\r\n              });\r\n            } catch (error) {\r\n              resolve({ \r\n                success: false,\r\n                url: null, \r\n                path: null,\r\n                error: 'Error al obtener la URL del video',\r\n                simulated: false\r\n              });\r\n            }\r\n          }\r\n        );\r\n      });\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('Error uploading video:', error);\r\n    \r\n    // Manejar errores específicos\r\n    let errorMessage = 'Error al subir el video';\r\n    if (error.code === 'storage/unauthorized') {\r\n      errorMessage = 'No tienes permisos para subir videos';\r\n    } else if (error.code === 'storage/quota-exceeded') {\r\n      errorMessage = 'Se ha excedido la cuota de almacenamiento';\r\n    } else if (error.code === 'storage/retry-limit-exceeded') {\r\n      errorMessage = 'Error de conexión. Intenta de nuevo';\r\n    } else if (error.message) {\r\n      errorMessage = error.message;\r\n    }\r\n    \r\n    return { \r\n      success: false,\r\n      url: null, \r\n      path: null,\r\n      error: errorMessage,\r\n      simulated: false\r\n    };\r\n  }\r\n};\r\n\r\n// Subir video de figura\r\nexport const uploadFigureVideo = async (file, figureId) => {\r\n  const path = `figures/${figureId}/videos/${Date.now()}_${file.name}`;\r\n  return await uploadVideo(file, path);\r\n};\r\n\r\n// Eliminar video completo (archivo + thumbnail)\r\nexport const deleteVideo = async (videoPath, thumbnailPath) => {\r\n  try {\r\n    console.log('🗑️ Iniciando eliminación de archivos:')\r\n    console.log('📁 Video path:', videoPath)\r\n    console.log('🖼️ Thumbnail path:', thumbnailPath)\r\n    \r\n    const promises = [];\r\n    \r\n    // Eliminar archivo de video\r\n    if (videoPath) {\r\n      console.log('🎬 Eliminando video:', videoPath)\r\n      const videoRef = ref(storage, videoPath);\r\n      promises.push(deleteObject(videoRef));\r\n    } else {\r\n      console.log('⚠️ No hay ruta de video para eliminar')\r\n    }\r\n    \r\n    // Eliminar thumbnail (solo si existe y no es null)\r\n    if (thumbnailPath && thumbnailPath !== null && thumbnailPath !== '') {\r\n      console.log('🖼️ Eliminando thumbnail:', thumbnailPath)\r\n      const thumbnailRef = ref(storage, thumbnailPath);\r\n      promises.push(deleteObject(thumbnailRef));\r\n    } else {\r\n      console.log('⚠️ No hay ruta de thumbnail para eliminar (thumbnailPath:', thumbnailPath, ')')\r\n    }\r\n    \r\n    console.log(`📊 Archivos a eliminar: ${promises.length}`)\r\n    \r\n    if (promises.length === 0) {\r\n      console.log('⚠️ No hay archivos para eliminar')\r\n      return { \r\n        success: true, \r\n        error: null,\r\n        deletedCount: 0\r\n      };\r\n    }\r\n    \r\n    await Promise.all(promises);\r\n    \r\n    console.log('✅ Archivos eliminados exitosamente')\r\n    return { \r\n      success: true, \r\n      error: null,\r\n      deletedCount: promises.length\r\n    };\r\n  } catch (error) {\r\n    console.error('❌ Error deleting video:', error);\r\n    return { \r\n      success: false, \r\n      error: error.message,\r\n      deletedCount: 0\r\n    };\r\n  }\r\n};\r\n\r\n// ===== FUNCIONES DE LIMPIEZA DE STORAGE =====\r\n\r\n// Eliminar todos los archivos de videos\r\nexport const deleteAllVideoFiles = async () => {\r\n  try {\r\n    console.log('🗑️ Iniciando eliminación de todos los archivos de videos...')\r\n    \r\n    // Eliminar archivos de videos\r\n    const videosResult = await deleteAllFilesInFolder('videos')\r\n    console.log(`✅ Archivos de videos eliminados: ${videosResult.deletedCount}`)\r\n    \r\n    // Eliminar archivos de thumbnails\r\n    const thumbnailsResult = await deleteAllFilesInFolder('thumbnails')\r\n    console.log(`✅ Archivos de thumbnails eliminados: ${thumbnailsResult.deletedCount}`)\r\n    \r\n    return {\r\n      success: true,\r\n      videosDeleted: videosResult.deletedCount,\r\n      thumbnailsDeleted: thumbnailsResult.deletedCount,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error al eliminar archivos de videos:', error)\r\n    return {\r\n      success: false,\r\n      videosDeleted: 0,\r\n      thumbnailsDeleted: 0,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Eliminar todos los archivos en una carpeta específica\r\nexport const deleteAllFilesInFolder = async (folderPath) => {\r\n  try {\r\n    console.log(`🗑️ Eliminando archivos en carpeta: ${folderPath}`)\r\n    \r\n    const folderRef = ref(storage, folderPath)\r\n    const result = await listAll(folderRef)\r\n    \r\n    if (result.items.length === 0) {\r\n      console.log(`✅ No hay archivos en ${folderPath}`)\r\n      return { success: true, deletedCount: 0, error: null }\r\n    }\r\n    \r\n    console.log(`📊 Archivos a eliminar en ${folderPath}: ${result.items.length}`)\r\n    \r\n    const deletePromises = result.items.map(async (itemRef) => {\r\n      try {\r\n        await deleteObject(itemRef)\r\n        return { success: true, path: itemRef.fullPath }\r\n      } catch (error) {\r\n        console.error(`❌ Error eliminando ${itemRef.fullPath}:`, error)\r\n        return { success: false, path: itemRef.fullPath, error: error.message }\r\n      }\r\n    })\r\n    \r\n    const results = await Promise.all(deletePromises)\r\n    const successfulDeletes = results.filter(r => r.success).length\r\n    const failedDeletes = results.filter(r => !r.success).length\r\n    \r\n    console.log(`✅ ${successfulDeletes} archivos eliminados exitosamente en ${folderPath}`)\r\n    if (failedDeletes > 0) {\r\n      console.log(`⚠️ ${failedDeletes} archivos fallaron al eliminar en ${folderPath}`)\r\n    }\r\n    \r\n    return {\r\n      success: true,\r\n      deletedCount: successfulDeletes,\r\n      failedCount: failedDeletes,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error(`❌ Error al eliminar archivos en ${folderPath}:`, error)\r\n    return {\r\n      success: false,\r\n      deletedCount: 0,\r\n      failedCount: 0,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Limpiar archivos huérfanos (archivos sin documento en Firestore)\r\nexport const cleanupOrphanedFiles = async (videosFromFirestore) => {\r\n  try {\r\n    console.log('🧹 Iniciando limpieza de archivos huérfanos...')\r\n    \r\n    // Obtener todos los archivos de videos y thumbnails\r\n    const videosFolder = await listAll(ref(storage, 'videos'))\r\n    const thumbnailsFolder = await listAll(ref(storage, 'thumbnails'))\r\n    \r\n    // Crear sets de rutas de archivos existentes en Firestore\r\n    const firestoreVideoPaths = new Set(videosFromFirestore.map(v => v.videoPath).filter(Boolean))\r\n    const firestoreThumbnailPaths = new Set(videosFromFirestore.map(v => v.thumbnailPath).filter(Boolean))\r\n    \r\n    // Encontrar archivos huérfanos\r\n    const orphanedVideos = videosFolder.items.filter(item => !firestoreVideoPaths.has(item.fullPath))\r\n    const orphanedThumbnails = thumbnailsFolder.items.filter(item => !firestoreThumbnailPaths.has(item.fullPath))\r\n    \r\n    console.log(`📊 Archivos huérfanos encontrados: ${orphanedVideos.length} videos, ${orphanedThumbnails.length} thumbnails`)\r\n    \r\n    // Eliminar archivos huérfanos\r\n    const deletePromises = [\r\n      ...orphanedVideos.map(item => deleteObject(item)),\r\n      ...orphanedThumbnails.map(item => deleteObject(item))\r\n    ]\r\n    \r\n    if (deletePromises.length > 0) {\r\n      await Promise.all(deletePromises)\r\n      console.log(`✅ ${deletePromises.length} archivos huérfanos eliminados`)\r\n    } else {\r\n      console.log('✅ No se encontraron archivos huérfanos')\r\n    }\r\n    \r\n    return {\r\n      success: true,\r\n      orphanedVideosDeleted: orphanedVideos.length,\r\n      orphanedThumbnailsDeleted: orphanedThumbnails.length,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error en limpieza de archivos huérfanos:', error)\r\n    return {\r\n      success: false,\r\n      orphanedVideosDeleted: 0,\r\n      orphanedThumbnailsDeleted: 0,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Función auxiliar para descargar un archivo desde Firebase Storage\r\nconst downloadFile = async (path) => {\r\n  try {\r\n    const fileRef = ref(storage, path)\r\n    const url = await getDownloadURL(fileRef)\r\n    \r\n    // Descargar el archivo usando fetch\r\n    const response = await fetch(url)\r\n    if (!response.ok) {\r\n      throw new Error(`Error al descargar archivo: ${response.status}`)\r\n    }\r\n    \r\n    const blob = await response.blob()\r\n    return blob\r\n  } catch (error) {\r\n    console.error(`Error descargando archivo ${path}:`, error)\r\n    throw error\r\n  }\r\n}\r\n\r\n// Función auxiliar para convertir blob a File\r\nconst blobToFile = (blob, filename) => {\r\n  return new File([blob], filename, { type: blob.type })\r\n}\r\n\r\n// Migrar videos existentes a la nueva estructura organizada\r\nexport const migrateVideosToOrganizedStructure = async (videosFromFirestore) => {\r\n  try {\r\n    console.log('🔄 Iniciando migración de videos a estructura organizada...')\r\n    \r\n    const migrationResults = []\r\n    \r\n    for (const video of videosFromFirestore) {\r\n      try {\r\n        // Verificar si el video ya está en la nueva estructura\r\n        if (video.videoPath && video.videoPath.includes('/figuras/') || \r\n            video.videoPath && video.videoPath.includes('/escuela/') || \r\n            video.videoPath && video.videoPath.includes('/eventos/')) {\r\n          console.log(`⏭️ Video ${video.title} ya está en estructura organizada`)\r\n          migrationResults.push({\r\n            videoId: video.id,\r\n            title: video.title,\r\n            status: 'already_organized',\r\n            error: null\r\n          })\r\n          continue\r\n        }\r\n        \r\n        // Determinar la nueva ruta basada en el estilo del video\r\n        const style = video.style || 'salsa' // Default a salsa si no hay estilo\r\n        const page = 'figuras' // Default a figuras, se puede mejorar después\r\n        \r\n        const oldVideoPath = video.videoPath\r\n        const oldThumbnailPath = video.thumbnailPath\r\n        \r\n        const newVideoPath = `videos/${page}/${style}/${oldVideoPath.split('/').pop()}`\r\n        const newThumbnailPath = oldThumbnailPath ? \r\n          `thumbnails/${page}/${style}/${oldThumbnailPath.split('/').pop()}` : null\r\n        \r\n        console.log(`🔄 Migrando video: ${video.title}`)\r\n        console.log(`   De: ${oldVideoPath}`)\r\n        console.log(`   A: ${newVideoPath}`)\r\n        \r\n        // MIGRACIÓN REAL DE ARCHIVOS\r\n        let videoMigrated = false\r\n        let thumbnailMigrated = false\r\n        \r\n        // Migrar video\r\n        try {\r\n          console.log(`📥 Descargando video: ${oldVideoPath}`)\r\n          const videoBlob = await downloadFile(oldVideoPath)\r\n          const videoFile = blobToFile(videoBlob, oldVideoPath.split('/').pop())\r\n          \r\n          console.log(`📤 Subiendo video a nueva ubicación: ${newVideoPath}`)\r\n          await uploadFile(videoFile, newVideoPath)\r\n          videoMigrated = true\r\n          console.log(`✅ Video migrado exitosamente`)\r\n          \r\n          // Eliminar archivo original\r\n          console.log(`🗑️ Eliminando archivo original: ${oldVideoPath}`)\r\n          await deleteFile(oldVideoPath)\r\n          \r\n        } catch (error) {\r\n          console.error(`❌ Error migrando video ${video.title}:`, error)\r\n          throw new Error(`Error migrando video: ${error.message}`)\r\n        }\r\n        \r\n        // Migrar thumbnail si existe\r\n        if (oldThumbnailPath && newThumbnailPath) {\r\n          try {\r\n            console.log(`📥 Descargando thumbnail: ${oldThumbnailPath}`)\r\n            const thumbnailBlob = await downloadFile(oldThumbnailPath)\r\n            const thumbnailFile = blobToFile(thumbnailBlob, oldThumbnailPath.split('/').pop())\r\n            \r\n            console.log(`📤 Subiendo thumbnail a nueva ubicación: ${newThumbnailPath}`)\r\n            await uploadFile(thumbnailFile, newThumbnailPath)\r\n            thumbnailMigrated = true\r\n            console.log(`✅ Thumbnail migrado exitosamente`)\r\n            \r\n            // Eliminar archivo original\r\n            console.log(`🗑️ Eliminando thumbnail original: ${oldThumbnailPath}`)\r\n            await deleteFile(oldThumbnailPath)\r\n            \r\n          } catch (error) {\r\n            console.error(`❌ Error migrando thumbnail ${video.title}:`, error)\r\n            // No fallamos la migración completa si falla el thumbnail\r\n          }\r\n        }\r\n        \r\n        migrationResults.push({\r\n          videoId: video.id,\r\n          title: video.title,\r\n          oldVideoPath,\r\n          newVideoPath,\r\n          oldThumbnailPath,\r\n          newThumbnailPath,\r\n          status: 'migrated',\r\n          videoMigrated,\r\n          thumbnailMigrated,\r\n          error: null\r\n        })\r\n        \r\n      } catch (error) {\r\n        console.error(`❌ Error migrando video ${video.title}:`, error)\r\n        migrationResults.push({\r\n          videoId: video.id,\r\n          title: video.title,\r\n          status: 'error',\r\n          error: error.message\r\n        })\r\n      }\r\n    }\r\n    \r\n    const successfulMigrations = migrationResults.filter(r => r.status === 'migrated').length\r\n    const alreadyOrganized = migrationResults.filter(r => r.status === 'already_organized').length\r\n    const failedMigrations = migrationResults.filter(r => r.status === 'error').length\r\n    \r\n    console.log(`✅ Migración completada: ${successfulMigrations} migrados, ${alreadyOrganized} ya organizados, ${failedMigrations} fallidos`)\r\n    \r\n    return {\r\n      success: true,\r\n      totalVideos: videosFromFirestore.length,\r\n      successfulMigrations,\r\n      alreadyOrganized,\r\n      failedMigrations,\r\n      results: migrationResults,\r\n      error: null\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('❌ Error en migración de videos:', error)\r\n    return {\r\n      success: false,\r\n      totalVideos: 0,\r\n      successfulMigrations: 0,\r\n      alreadyOrganized: 0,\r\n      failedMigrations: 0,\r\n      results: [],\r\n      error: error.message\r\n    }\r\n  }\r\n} ","// 🎯 HOOK PARA GESTIÓN DE CATEGORÍAS - SALSAHACKS V2.0\r\n\r\nimport { useState, useMemo, useEffect } from 'react'\r\n\r\n// Estructura jerárquica de categorías (copiada de CategoriesPage.jsx)\r\nconst categoryStructure = {\r\n  figuras: {\r\n    name: 'FIGURAS',\r\n    icon: 'Music',\r\n    styles: {\r\n      salsa: {\r\n        name: 'SALSA',\r\n        icon: 'Music',\r\n        color: 'salsa',\r\n        categories: {\r\n          estilo: {\r\n            name: 'ESTILO',\r\n            color: 'pink',\r\n            tags: ['Salsa', 'Salsa en línea On1', 'Salsa cubana', 'Estilo LA', 'Estilo NY', 'Estilo show']\r\n          },\r\n          subestilo: {\r\n            name: 'SUBESTILO/TÉCNICA',\r\n            color: 'orange',\r\n            tags: ['Pasitos libres', 'Parejas', 'Footwork On1', 'Footwork On2', 'Shines', 'Fusionado con afro', 'Body movement']\r\n          },\r\n          tipo: {\r\n            name: 'TIPO DE FIGURA',\r\n            color: 'green',\r\n            tags: ['Cross Body Lead', 'Copa', 'Sombrero', 'Dile que no', 'Setenta', 'Vacilala', 'Enchufla']\r\n          },\r\n          manos: {\r\n            name: 'MANOS/TÉCNICA DE AGARRE',\r\n            color: 'blue',\r\n            tags: ['Una mano', 'Dos manos paralelas', 'Cruzadas', 'Entrelazadas', 'Cambio de manos', 'Manos abiertas', 'Sin contacto']\r\n          }\r\n        }\r\n      },\r\n      bachata: {\r\n        name: 'BACHATA',\r\n        icon: 'Heart',\r\n        color: 'bachata',\r\n        categories: {\r\n          estilo: {\r\n            name: 'ESTILO',\r\n            color: 'red',\r\n            tags: ['Bachata dominicana', 'Bachata moderna', 'Bachata sensual', 'Bachata urbana']\r\n          },\r\n          subestilo: {\r\n            name: 'SUBESTILO/TÉCNICA',\r\n            color: 'orange',\r\n            tags: ['Body rolls', 'Hip movement', 'Footwork básico', 'Turns']\r\n          },\r\n          tipo: {\r\n            name: 'TIPO DE FIGURA',\r\n            color: 'green',\r\n            tags: ['Dile que no', 'Setenta', 'Vacilala', 'Sombrero', 'Copa']\r\n          },\r\n          manos: {\r\n            name: 'MANOS/TÉCNICA DE AGARRE',\r\n            color: 'blue',\r\n            tags: ['Una mano', 'Dos manos', 'Cruzadas', 'Entrelazadas']\r\n          }\r\n        }\r\n      },\r\n      kizomba: {\r\n        name: 'KIZOMBA',\r\n        icon: 'Zap',\r\n        color: 'kizomba',\r\n        categories: {\r\n          estilo: {\r\n            name: 'ESTILO',\r\n            color: 'yellow',\r\n            tags: ['Kizomba tradicional', 'Kizomba urbana', 'Tarraxinha', 'Semba']\r\n          },\r\n          subestilo: {\r\n            name: 'SUBESTILO/TÉCNICA',\r\n            color: 'orange',\r\n            tags: ['Body movement', 'Hip rolls', 'Footwork', 'Turns']\r\n          },\r\n          tipo: {\r\n            name: 'TIPO DE FIGURA',\r\n            color: 'green',\r\n            tags: ['Saída', 'Volta', 'Tarraxinha', 'Semba step']\r\n          },\r\n          manos: {\r\n            name: 'MANOS/TÉCNICA DE AGARRE',\r\n            color: 'blue',\r\n            tags: ['Una mano', 'Dos manos', 'Cruzadas', 'Sin contacto']\r\n          }\r\n        }\r\n      },\r\n      zouk: {\r\n        name: 'ZOUK',\r\n        icon: 'Star',\r\n        color: 'zouk',\r\n        categories: {\r\n          estilo: {\r\n            name: 'ESTILO',\r\n            color: 'purple',\r\n            tags: ['Zouk brasileño', 'Zouk flow', 'Zouk neofusion', 'Zouk tradicional']\r\n          },\r\n          subestilo: {\r\n            name: 'SUBESTILO/TÉCNICA',\r\n            color: 'orange',\r\n            tags: ['Body rolls', 'Head movement', 'Footwork', 'Turns']\r\n          },\r\n          tipo: {\r\n            name: 'TIPO DE FIGURA',\r\n            color: 'green',\r\n            tags: ['Lateral', 'Tranca', 'Pião', 'Balanço']\r\n          },\r\n          manos: {\r\n            name: 'MANOS/TÉCNICA DE AGARRE',\r\n            color: 'blue',\r\n            tags: ['Una mano', 'Dos manos', 'Cruzadas', 'Entrelazadas']\r\n          }\r\n        }\r\n      },\r\n      merengue: {\r\n        name: 'MERENGUE',\r\n        icon: 'Sun',\r\n        color: 'merengue',\r\n        categories: {\r\n          estilo: {\r\n            name: 'ESTILO',\r\n            color: 'orange',\r\n            tags: ['Merengue dominicano', 'Merengue tradicional', 'Merengue moderno']\r\n          },\r\n          subestilo: {\r\n            name: 'SUBESTILO/TÉCNICA',\r\n            color: 'orange',\r\n            tags: ['Hip movement', 'Footwork básico', 'Turns simples']\r\n          },\r\n          tipo: {\r\n            name: 'TIPO DE FIGURA',\r\n            color: 'green',\r\n            tags: ['Giros simples', 'Cambios de dirección', 'Pasos básicos']\r\n          },\r\n          manos: {\r\n            name: 'MANOS/TÉCNICA DE AGARRE',\r\n            color: 'blue',\r\n            tags: ['Una mano', 'Dos manos', 'Sin contacto']\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  escuela: {\r\n    name: 'ESCUELA',\r\n    icon: 'GraduationCap',\r\n    styles: {\r\n      salsa: {\r\n        name: 'SALSA',\r\n        icon: 'Music',\r\n        color: 'pink',\r\n        categories: {\r\n          nivel: {\r\n            name: 'NIVEL',\r\n            color: 'green',\r\n            tags: ['Principiante', 'Intermedio', 'Avanzado', 'Experto']\r\n          },\r\n          tipo: {\r\n            name: 'TIPO DE CURSO',\r\n            color: 'blue',\r\n            tags: ['Básico', 'Técnica', 'Coreografía', 'Ritmo', 'Musicalidad']\r\n          },\r\n          duracion: {\r\n            name: 'DURACIÓN',\r\n            color: 'orange',\r\n            tags: ['5-15 min', '10-25 min', '15-45 min', '20-60 min']\r\n          },\r\n          instructor: {\r\n            name: 'INSTRUCTOR',\r\n            color: 'purple',\r\n            tags: ['Carlos Rodríguez', 'María González', 'Juan Pérez', 'Ana López']\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  eventos: {\r\n    name: 'EVENTOS',\r\n    icon: 'Calendar',\r\n    styles: {\r\n      salsa: {\r\n        name: 'SALSA',\r\n        icon: 'Music',\r\n        color: 'pink',\r\n        categories: {\r\n          tipo: {\r\n            name: 'TIPO DE EVENTO',\r\n            color: 'green',\r\n            tags: ['Competición', 'Encuentro', 'Congreso', 'Workshop', 'Fiesta']\r\n          },\r\n          ubicacion: {\r\n            name: 'UBICACIÓN',\r\n            color: 'blue',\r\n            tags: ['Madrid', 'Barcelona', 'Valencia', 'Sevilla', 'Bilbao']\r\n          },\r\n          nivel: {\r\n            name: 'NIVEL',\r\n            color: 'orange',\r\n            tags: ['Todos los niveles', 'Intermedio-Avanzado', 'Solo avanzado']\r\n          },\r\n          fecha: {\r\n            name: 'FECHA',\r\n            color: 'purple',\r\n            tags: ['Este mes', 'Próximo mes', 'Este trimestre', 'Este año']\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport const useCategories = (page = 'figuras', style = 'salsa') => {\r\n  const [selectedPage, setSelectedPage] = useState(page)\r\n  const [selectedStyle, setSelectedStyle] = useState(style)\r\n\r\n  // Actualizar el estilo cuando cambie el parámetro\r\n  useEffect(() => {\r\n    setSelectedStyle(style)\r\n  }, [style])\r\n\r\n  // Actualizar la página cuando cambie el parámetro\r\n  useEffect(() => {\r\n    setSelectedPage(page)\r\n  }, [page])\r\n\r\n  // Obtener categorías para la página y estilo actual\r\n  const currentCategories = useMemo(() => {\r\n    const pageData = categoryStructure[selectedPage]\r\n    if (!pageData) return null\r\n\r\n    const styleData = pageData.styles[selectedStyle]\r\n    if (!styleData) return null\r\n\r\n    return styleData.categories\r\n  }, [selectedPage, selectedStyle])\r\n\r\n  // Obtener todos los tags disponibles para la página y estilo actual\r\n  const availableTags = useMemo(() => {\r\n    if (!currentCategories) return []\r\n\r\n    const allTags = []\r\n    Object.entries(currentCategories).forEach(([categoryKey, categoryData]) => {\r\n      categoryData.tags.forEach(tag => {\r\n        allTags.push({\r\n          tag,\r\n          category: categoryKey,\r\n          categoryName: categoryData.name,\r\n          color: categoryData.color\r\n        })\r\n      })\r\n    })\r\n\r\n    return allTags\r\n  }, [currentCategories])\r\n\r\n  // Obtener categorías organizadas\r\n  const categoriesList = useMemo(() => {\r\n    if (!currentCategories) return []\r\n\r\n    return Object.entries(currentCategories).map(([key, data]) => ({\r\n      key,\r\n      name: data.name,\r\n      color: data.color,\r\n      tags: data.tags\r\n    }))\r\n  }, [currentCategories])\r\n\r\n  // Obtener estilos disponibles para la página actual\r\n  const availableStyles = useMemo(() => {\r\n    const pageData = categoryStructure[selectedPage]\r\n    if (!pageData) return []\r\n\r\n    return Object.entries(pageData.styles).map(([key, data]) => ({\r\n      key,\r\n      name: data.name,\r\n      color: data.color,\r\n      icon: data.icon\r\n    }))\r\n  }, [selectedPage])\r\n\r\n  // Obtener páginas disponibles\r\n  const availablePages = useMemo(() => {\r\n    return Object.entries(categoryStructure).map(([key, data]) => ({\r\n      key,\r\n      name: data.name,\r\n      icon: data.icon\r\n    }))\r\n  }, [])\r\n\r\n  // Función para obtener colores de categorías\r\n  const getColorClasses = (color) => {\r\n    const colorMap = {\r\n             // Colores específicos de estilos de baile\r\n       salsa: 'bg-orange-100 text-orange-800 border-orange-200',\r\n       bachata: 'bg-emerald-100 text-emerald-800 border-emerald-200',\r\n       merengue: 'bg-cyan-100 text-cyan-800 border-cyan-200',\r\n       zouk: 'bg-violet-100 text-violet-800 border-violet-200',\r\n       kizomba: 'bg-amber-100 text-amber-800 border-amber-200',\r\n      \r\n      // Colores genéricos para categorías\r\n      pink: 'bg-pink-100 text-pink-800 border-pink-200',\r\n      red: 'bg-red-100 text-red-800 border-red-200',\r\n      orange: 'bg-orange-100 text-orange-800 border-orange-200',\r\n      yellow: 'bg-yellow-100 text-yellow-800 border-yellow-200',\r\n      green: 'bg-green-100 text-green-800 border-green-200',\r\n      blue: 'bg-blue-100 text-blue-800 border-blue-200',\r\n      purple: 'bg-purple-100 text-purple-800 border-purple-200'\r\n    }\r\n    return colorMap[color] || 'bg-gray-100 text-gray-800 border-gray-200'\r\n  }\r\n\r\n  // Función para obtener gradientes de categorías\r\n  const getGradientClasses = (color) => {\r\n    const gradientMap = {\r\n             // Gradientes específicos de estilos de baile\r\n       salsa: 'from-orange-400 to-pink-500',      // Naranja suave a rosa\r\n       bachata: 'from-emerald-400 to-teal-600',   // Verde esmeralda suave a verde azulado intenso\r\n       merengue: 'from-cyan-400 to-blue-600',     // Cian suave a azul intenso\r\n       zouk: 'from-violet-400 to-indigo-600',     // Violeta suave a índigo intenso\r\n       kizomba: 'from-amber-400 to-orange-600',   // Ámbar suave a naranja intenso\r\n      \r\n      // Gradientes genéricos para categorías\r\n      pink: 'from-pink-500 to-rose-500',\r\n      red: 'from-red-500 to-pink-500',\r\n      orange: 'from-orange-500 to-red-500',\r\n      yellow: 'from-yellow-500 to-orange-500',\r\n      green: 'from-green-500 to-emerald-500',\r\n      blue: 'from-blue-500 to-cyan-500',\r\n      purple: 'from-purple-500 to-pink-500'\r\n    }\r\n    return gradientMap[color] || 'from-gray-500 to-gray-600'\r\n  }\r\n\r\n  return {\r\n    // Estado\r\n    selectedPage,\r\n    selectedStyle,\r\n    setSelectedPage,\r\n    setSelectedStyle,\r\n\r\n    // Datos\r\n    currentCategories,\r\n    availableTags,\r\n    categoriesList,\r\n    availableStyles,\r\n    availablePages,\r\n    categoryStructure,\r\n\r\n    // Utilidades\r\n    getColorClasses,\r\n    getGradientClasses\r\n  }\r\n} ","import { useState, useEffect } from 'react'\r\nimport { CheckCircle, XCircle, AlertCircle, X } from 'lucide-react'\r\n\r\nconst Toast = ({ message, type = 'success', duration = 5000, onClose }) => {\r\n  const [isVisible, setIsVisible] = useState(true)\r\n\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      setIsVisible(false)\r\n      setTimeout(() => {\r\n        onClose?.()\r\n      }, 300) // Tiempo para la animación de salida\r\n    }, duration)\r\n\r\n    return () => clearTimeout(timer)\r\n  }, [duration, onClose])\r\n\r\n  const getIcon = () => {\r\n    switch (type) {\r\n      case 'success':\r\n        return <CheckCircle className=\"w-5 h-5\" />\r\n      case 'error':\r\n        return <XCircle className=\"w-5 h-5\" />\r\n      case 'warning':\r\n        return <AlertCircle className=\"w-5 h-5\" />\r\n      default:\r\n        return <CheckCircle className=\"w-5 h-5\" />\r\n    }\r\n  }\r\n\r\n  const getStyles = () => {\r\n    switch (type) {\r\n      case 'success':\r\n        return 'bg-gradient-to-r from-green-500 to-emerald-500 text-white border-green-400'\r\n      case 'error':\r\n        return 'bg-gradient-to-r from-red-500 to-pink-500 text-white border-red-400'\r\n      case 'warning':\r\n        return 'bg-gradient-to-r from-orange-500 to-red-500 text-white border-orange-400'\r\n      default:\r\n        return 'bg-gradient-to-r from-green-500 to-emerald-500 text-white border-green-400'\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className={`\r\n        fixed top-4 right-4 z-50 max-w-sm w-full\r\n        transform transition-all duration-300 ease-in-out\r\n        ${isVisible ? 'translate-x-0 opacity-100' : 'translate-x-full opacity-0'}\r\n      `}\r\n    >\r\n      <div className={`\r\n        flex items-center justify-between p-4 rounded-lg shadow-lg border\r\n        ${getStyles()}\r\n      `}>\r\n        <div className=\"flex items-center space-x-3\">\r\n          {getIcon()}\r\n          <span className=\"font-medium\">{message}</span>\r\n        </div>\r\n        <button\r\n          onClick={() => {\r\n            setIsVisible(false)\r\n            setTimeout(() => onClose?.(), 300)\r\n          }}\r\n          className=\"ml-4 text-white hover:text-gray-200 transition-colors\"\r\n        >\r\n          <X className=\"w-4 h-4\" />\r\n        </button>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Toast ","import { useState, useRef, useEffect } from 'react'\r\nimport { \r\n  Play, \r\n  Pause, \r\n  Volume2, \r\n  VolumeX, \r\n  RotateCcw, \r\n  RotateCw,\r\n  Maximize,\r\n  Minimize,\r\n  SkipBack,\r\n  SkipForward,\r\n  Settings,\r\n  Minus,\r\n  Zap,\r\n  Download\r\n} from 'lucide-react'\r\nimport { getFileURL } from '../../services/firebase/storage'\r\n\r\nconst VideoPlayer = ({ \r\n  src, \r\n  size = 'medium', \r\n  loop = false, \r\n  loopSegment = null, // { start: number, end: number }\r\n  showControls: initialShowControls = true, \r\n  autoplay = false, \r\n  muted = false,\r\n  onTimeUpdate = null,\r\n  onEnded = null,\r\n  className = '',\r\n  resolutions = null, // Array de resoluciones disponibles\r\n  currentResolution = null, // Resolución actual seleccionada\r\n  onResolutionChange = null, // Callback para cambio de resolución\r\n  videoTitle = 'video' // Título del video para la descarga\r\n}) => {\r\n  const videoRef = useRef(null)\r\n  const containerRef = useRef(null)\r\n  const [isPlaying, setIsPlaying] = useState(false)\r\n  const [currentTime, setCurrentTime] = useState(0)\r\n  const [duration, setDuration] = useState(0)\r\n  const [volume, setVolume] = useState(1)\r\n  const [isMuted, setIsMuted] = useState(muted)\r\n  const [showVolumeSlider, setShowVolumeSlider] = useState(false)\r\n  const [volumeSliderTimeout, setVolumeSliderTimeout] = useState(null)\r\n  const [isFullscreen, setIsFullscreen] = useState(false)\r\n  const [isLoopEnabled, setIsLoopEnabled] = useState(false)\r\n  const [loopStart, setLoopStart] = useState(loopSegment?.start || 0)\r\n  const [loopEnd, setLoopEnd] = useState(loopSegment?.end || 0)\r\n  const [isLoopSegmentMode, setIsLoopSegmentMode] = useState(!!loopSegment)\r\n  const [hasPointA, setHasPointA] = useState(false)\r\n  const [hasPointB, setHasPointB] = useState(false)\r\n  const [savedPointA, setSavedPointA] = useState(0)\r\n  const [savedPointB, setSavedPointB] = useState(0)\r\n  const [showControls, setShowControls] = useState(initialShowControls)\r\n  const [controlsTimeout, setControlsTimeout] = useState(null)\r\n  const [showResolutionMenu, setShowResolutionMenu] = useState(false)\r\n  const [selectedResolution, setSelectedResolution] = useState(currentResolution || 'auto')\r\n  const [videoMaxResolution, setVideoMaxResolution] = useState(null)\r\n  const [currentAutoResolution, setCurrentAutoResolution] = useState(null)\r\n  const [showSpeedMenu, setShowSpeedMenu] = useState(false)\r\n  const [playbackSpeed, setPlaybackSpeed] = useState(1)\r\n  const [videoOrientation, setVideoOrientation] = useState('horizontal') // 'horizontal' o 'vertical'\r\n\r\n  // Velocidades disponibles\r\n  const availableSpeeds = [0.25, 0.5, 0.75, 1, 1.25, 1.5, 2]\r\n\r\n  // Manejar bucle de segmento\r\n  useEffect(() => {\r\n    if (videoRef.current && isLoopSegmentMode && isPlaying && hasPointA && hasPointB) {\r\n      const video = videoRef.current\r\n      const checkLoopSegment = () => {\r\n        if (video.currentTime >= loopEnd) {\r\n          video.currentTime = loopStart\r\n        }\r\n      }\r\n      \r\n      video.addEventListener('timeupdate', checkLoopSegment)\r\n      return () => video.removeEventListener('timeupdate', checkLoopSegment)\r\n    }\r\n  }, [isLoopSegmentMode, loopStart, loopEnd, isPlaying, hasPointA, hasPointB])\r\n\r\n  // Controles de teclado\r\n  useEffect(() => {\r\n    const handleKeyDown = (e) => {\r\n      if (!videoRef.current) return\r\n      \r\n      // No procesar eventos de teclado si el foco está en un campo de entrada\r\n      const activeElement = document.activeElement\r\n      if (activeElement && (\r\n        activeElement.tagName === 'INPUT' || \r\n        activeElement.tagName === 'TEXTAREA' || \r\n        activeElement.contentEditable === 'true' ||\r\n        activeElement.classList.contains('ql-editor') // Para editores de texto enriquecido\r\n      )) {\r\n        return\r\n      }\r\n      \r\n      switch (e.code) {\r\n        case 'Space':\r\n          e.preventDefault()\r\n          togglePlay()\r\n          break\r\n        case 'ArrowLeft':\r\n          e.preventDefault()\r\n          skip(-10)\r\n          break\r\n        case 'ArrowRight':\r\n          e.preventDefault()\r\n          skip(10)\r\n          break\r\n        case 'KeyA':\r\n          e.preventDefault()\r\n          setLoopStart(currentTime)\r\n          break\r\n        case 'KeyB':\r\n          e.preventDefault()\r\n          setLoopEnd(currentTime)\r\n          break\r\n        case 'KeyL':\r\n          e.preventDefault()\r\n          setIsLoopEnabled(!isLoopEnabled)\r\n          break\r\n        case 'KeyS': {\r\n          e.preventDefault()\r\n          // Ciclar entre velocidades: 0.5x -> 1x -> 1.5x -> 2x -> 0.5x\r\n          const currentIndex = availableSpeeds.indexOf(playbackSpeed)\r\n          const nextIndex = (currentIndex + 1) % availableSpeeds.length\r\n          handleSpeedChange(availableSpeeds[nextIndex])\r\n          break\r\n        }\r\n      }\r\n    }\r\n\r\n    document.addEventListener('keydown', handleKeyDown)\r\n    return () => document.removeEventListener('keydown', handleKeyDown)\r\n  }, [currentTime, isLoopEnabled, playbackSpeed])\r\n\r\n  // Auto-hide controles\r\n  useEffect(() => {\r\n    if (showControls && isPlaying) {\r\n      const timeout = setTimeout(() => {\r\n        setShowControls(false)\r\n      }, 4000) // Cambiado a 4 segundos\r\n      setControlsTimeout(timeout)\r\n      return () => clearTimeout(timeout)\r\n    }\r\n  }, [showControls, isPlaying])\r\n\r\n  // Cleanup timeouts al desmontar\r\n  useEffect(() => {\r\n    return () => {\r\n      if (controlsTimeout) clearTimeout(controlsTimeout)\r\n      if (volumeSliderTimeout) clearTimeout(volumeSliderTimeout)\r\n    }\r\n  }, [])\r\n\r\n  // Inicializar volumen y velocidad cuando el video se carga\r\n  useEffect(() => {\r\n    if (videoRef.current) {\r\n      videoRef.current.volume = volume\r\n      videoRef.current.muted = isMuted\r\n      videoRef.current.playbackRate = playbackSpeed\r\n    }\r\n  }, [volume, isMuted, playbackSpeed])\r\n\r\n  // Detectar resolución actual cuando se selecciona Auto\r\n  useEffect(() => {\r\n    if (selectedResolution === 'auto' && videoMaxResolution) {\r\n      setCurrentAutoResolution(videoMaxResolution)\r\n    }\r\n  }, [selectedResolution, videoMaxResolution])\r\n\r\n  // Cerrar menús al hacer clic fuera\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (showResolutionMenu) {\r\n        setShowResolutionMenu(false)\r\n      }\r\n      if (showSpeedMenu) {\r\n        setShowSpeedMenu(false)\r\n      }\r\n    }\r\n\r\n    document.addEventListener('click', handleClickOutside)\r\n    return () => document.removeEventListener('click', handleClickOutside)\r\n  }, [showResolutionMenu, showSpeedMenu])\r\n\r\n  // Función helper para activar controles\r\n  const activateControls = () => {\r\n    setShowControls(true)\r\n    if (controlsTimeout) {\r\n      clearTimeout(controlsTimeout)\r\n    }\r\n  }\r\n\r\n  // Mostrar controles al hacer clic en el video\r\n  const handleVideoClick = () => {\r\n    activateControls()\r\n  }\r\n\r\n  // Manejar doble clic para adelantar/retroceder\r\n  const [lastClickTime, setLastClickTime] = useState(0)\r\n  const [clickCount, setClickCount] = useState(0)\r\n\r\n  const handleVideoDoubleClick = (e) => {\r\n    const currentTime = Date.now()\r\n    const timeDiff = currentTime - lastClickTime\r\n    \r\n    if (timeDiff < 300) { // Doble clic detectado\r\n      const rect = e.currentTarget.getBoundingClientRect()\r\n      const clickX = e.clientX - rect.left\r\n      const videoWidth = rect.width\r\n      \r\n      // Si el clic es en la mitad izquierda, retroceder 10s\r\n      // Si el clic es en la mitad derecha, adelantar 10s\r\n      if (clickX < videoWidth / 2) {\r\n        skip(-10)\r\n      } else {\r\n        skip(10)\r\n      }\r\n      \r\n      setClickCount(0)\r\n      setLastClickTime(0)\r\n    } else {\r\n      setClickCount(1)\r\n      setLastClickTime(currentTime)\r\n    }\r\n  }\r\n\r\n  const togglePlay = () => {\r\n    if (videoRef.current) {\r\n      if (isPlaying) {\r\n        videoRef.current.pause()\r\n      } else {\r\n        videoRef.current.play()\r\n      }\r\n      setIsPlaying(!isPlaying)\r\n    }\r\n  }\r\n\r\n  const skip = (seconds) => {\r\n    if (videoRef.current) {\r\n      const newTime = Math.max(0, Math.min(duration, currentTime + seconds))\r\n      videoRef.current.currentTime = newTime\r\n      setCurrentTime(newTime)\r\n    }\r\n  }\r\n\r\n  const handleTimeUpdate = () => {\r\n    if (videoRef.current) {\r\n      setCurrentTime(videoRef.current.currentTime)\r\n      onTimeUpdate?.(videoRef.current.currentTime)\r\n    }\r\n  }\r\n\r\n  const handleLoadedMetadata = () => {\r\n    if (videoRef.current) {\r\n      setDuration(videoRef.current.duration)\r\n      \r\n      // Detectar resolución máxima del video\r\n      const video = videoRef.current\r\n      const width = video.videoWidth\r\n      const height = video.videoHeight\r\n      \r\n      if (width && height) {\r\n        // Detectar orientación del video\r\n        const isVertical = height > width\r\n        setVideoOrientation(isVertical ? 'vertical' : 'horizontal')\r\n        \r\n        const maxDimension = Math.max(width, height)\r\n        let maxRes = '480p'\r\n        \r\n        if (maxDimension >= 3840) maxRes = '4k'\r\n        else if (maxDimension >= 1920) maxRes = '1080p'\r\n        else if (maxDimension >= 1280) maxRes = '720p'\r\n        else if (maxDimension >= 854) maxRes = '480p'\r\n        else maxRes = '360p'\r\n        \r\n        setVideoMaxResolution(maxRes)\r\n      }\r\n      \r\n      if (autoplay) {\r\n        video.play()\r\n        setIsPlaying(true)\r\n      }\r\n    }\r\n  }\r\n\r\n  const handleEnded = () => {\r\n    if (isLoopEnabled && !isLoopSegmentMode) {\r\n      if (videoRef.current) {\r\n        videoRef.current.currentTime = 0\r\n        videoRef.current.play()\r\n      }\r\n    } else if (isLoopSegmentMode) {\r\n      if (videoRef.current) {\r\n        videoRef.current.currentTime = loopStart\r\n        videoRef.current.play()\r\n      }\r\n    } else {\r\n      setIsPlaying(false)\r\n    }\r\n    onEnded?.()\r\n  }\r\n\r\n  const handleSeek = (e) => {\r\n    if (videoRef.current) {\r\n      const rect = e.currentTarget.getBoundingClientRect()\r\n      const percent = (e.clientX - rect.left) / rect.width\r\n      const newTime = percent * duration\r\n      videoRef.current.currentTime = newTime\r\n      setCurrentTime(newTime)\r\n      \r\n      // No actualizar los puntos A-B al hacer clic en la barra de progreso\r\n      // Los puntos solo se actualizan cuando se hace clic en los botones A y B\r\n    }\r\n  }\r\n\r\n  const toggleMute = () => {\r\n    if (videoRef.current) {\r\n      const newMutedState = !isMuted\r\n      videoRef.current.muted = newMutedState\r\n      setIsMuted(newMutedState)\r\n      \r\n      if (newMutedState) {\r\n        // Al mutear, guardar el volumen actual y ponerlo en 0\r\n        videoRef.current.volume = 0\r\n      } else {\r\n        // Al desmutear, restaurar el volumen\r\n        videoRef.current.volume = volume\r\n      }\r\n    }\r\n  }\r\n\r\n  const handleVolumeChange = (e) => {\r\n    const newVolume = parseFloat(e.target.value)\r\n    \r\n    if (videoRef.current) {\r\n      videoRef.current.volume = newVolume\r\n      setVolume(newVolume)\r\n      \r\n      // Si el volumen es 0, mutear. Si no, desmutear\r\n      if (newVolume === 0) {\r\n        videoRef.current.muted = true\r\n        setIsMuted(true)\r\n      } else {\r\n        videoRef.current.muted = false\r\n        setIsMuted(false)\r\n      }\r\n    }\r\n  }\r\n\r\n  const toggleFullscreen = () => {\r\n    try {\r\n      if (!document.fullscreenElement) {\r\n        if (containerRef.current.requestFullscreen) {\r\n          containerRef.current.requestFullscreen()\r\n        } else if (containerRef.current.webkitRequestFullscreen) {\r\n          containerRef.current.webkitRequestFullscreen()\r\n        } else if (containerRef.current.msRequestFullscreen) {\r\n          containerRef.current.msRequestFullscreen()\r\n        }\r\n        setIsFullscreen(true)\r\n      } else {\r\n        if (document.exitFullscreen) {\r\n          document.exitFullscreen()\r\n        } else if (document.webkitExitFullscreen) {\r\n          document.webkitExitFullscreen()\r\n        } else if (document.msExitFullscreen) {\r\n          document.msExitFullscreen()\r\n        }\r\n        setIsFullscreen(false)\r\n      }\r\n    } catch (error) {\r\n      console.error('Error toggling fullscreen:', error)\r\n    }\r\n  }\r\n\r\n  const setLoopPoint = (type) => {\r\n    if (type === 'start') {\r\n      if (hasPointA) {\r\n        // Si ya existe el punto A, lo quitamos\r\n        setHasPointA(false)\r\n        setLoopStart(0)\r\n      } else {\r\n        // Establecer punto A\r\n        setHasPointA(true)\r\n        setLoopStart(currentTime)\r\n        setSavedPointA(currentTime)\r\n      }\r\n    } else {\r\n      if (hasPointB) {\r\n        // Si ya existe el punto B, lo quitamos\r\n        setHasPointB(false)\r\n        setLoopEnd(0)\r\n      } else {\r\n        // Establecer punto B\r\n        setHasPointB(true)\r\n        setLoopEnd(currentTime)\r\n        setSavedPointB(currentTime)\r\n      }\r\n    }\r\n  }\r\n\r\n  const formatTime = (time) => {\r\n    const minutes = Math.floor(time / 60)\r\n    const seconds = Math.floor(time % 60)\r\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`\r\n  }\r\n\r\n  const handleResolutionChange = (resolution) => {\r\n    setSelectedResolution(resolution)\r\n    setShowResolutionMenu(false)\r\n    \r\n    // Si se selecciona Auto, simular la detección de resolución actual\r\n    if (resolution === 'auto' && videoMaxResolution) {\r\n      setCurrentAutoResolution(videoMaxResolution)\r\n    } else if (resolution !== 'auto') {\r\n      setCurrentAutoResolution(null)\r\n    }\r\n    \r\n    onResolutionChange?.(resolution)\r\n  }\r\n\r\n  const handleSpeedChange = (speed) => {\r\n    if (videoRef.current) {\r\n      videoRef.current.playbackRate = speed\r\n      setPlaybackSpeed(speed)\r\n    }\r\n    setShowSpeedMenu(false)\r\n  }\r\n\r\n  const getSpeedLabel = (speed) => {\r\n    if (speed === 1) return 'Normal'\r\n    return `${speed}x`\r\n  }\r\n\r\n  const getResolutionLabel = (resolution) => {\r\n    switch (resolution) {\r\n      case 'auto':\r\n        return currentAutoResolution ? `Auto (${currentAutoResolution})` : 'Auto'\r\n      case '4k':\r\n        return '4K'\r\n      case '1080p':\r\n        return '1080p'\r\n      case '720p':\r\n        return '720p'\r\n      case '480p':\r\n        return '480p'\r\n      case '360p':\r\n        return '360p'\r\n      default:\r\n        return resolution\r\n    }\r\n  }\r\n\r\n  const isResolutionAvailable = (resolution) => {\r\n    if (!videoMaxResolution) return true // Si no sabemos la resolución máxima, mostrar todas\r\n    \r\n    const resolutionOrder = ['360p', '480p', '720p', '1080p', '4k']\r\n    const maxIndex = resolutionOrder.indexOf(videoMaxResolution)\r\n    const resIndex = resolutionOrder.indexOf(resolution)\r\n    \r\n    return resIndex <= maxIndex\r\n  }\r\n\r\n  const getSizeClasses = () => {\r\n    let sizeClass = ''\r\n    switch (size) {\r\n      case 'small':\r\n        sizeClass = 'max-w-xs'\r\n        break\r\n      case 'medium':\r\n        sizeClass = 'max-w-md'\r\n        break\r\n      case 'large':\r\n        sizeClass = 'max-w-2xl'\r\n        break\r\n      case 'fullscreen':\r\n        return 'w-full h-full' // Sin aspect ratio forzado para fullscreen\r\n      default:\r\n        sizeClass = 'max-w-md'\r\n    }\r\n    \r\n    // Ajustar el aspect ratio según la orientación del video (solo para tamaños no-fullscreen)\r\n    if (size === 'fullscreen') {\r\n      return sizeClass\r\n    }\r\n    \r\n    const aspectClass = videoOrientation === 'vertical' ? 'aspect-[9/16]' : 'aspect-video'\r\n    \r\n    return `${sizeClass} ${aspectClass}`\r\n  }\r\n\r\n  // Función para descargar video usando Firebase Storage\r\n  const downloadVideo = async () => {\r\n    try {\r\n      // Si tenemos una URL de Firebase Storage, descargar directamente\r\n      if (src && (src.includes('firebase') || src.includes('googleapis'))) {\r\n        // Descargar el archivo como blob para evitar ventanas del navegador\r\n        const response = await fetch(src)\r\n        if (!response.ok) {\r\n          throw new Error(`HTTP error! status: ${response.status}`)\r\n        }\r\n        \r\n        const blob = await response.blob()\r\n        \r\n        // Crear URL local del blob\r\n        const blobUrl = URL.createObjectURL(blob)\r\n        \r\n        // Crear enlace de descarga\r\n        const link = document.createElement('a')\r\n        link.href = blobUrl\r\n        link.download = videoTitle || 'video.mp4'\r\n        link.style.display = 'none'\r\n        \r\n        // Agregar al DOM y hacer clic\r\n        document.body.appendChild(link)\r\n        link.click()\r\n        document.body.removeChild(link)\r\n        \r\n        // Limpiar la URL del blob después de un momento\r\n        setTimeout(() => {\r\n          URL.revokeObjectURL(blobUrl)\r\n        }, 1000)\r\n      } else {\r\n        // Para URLs que no son de Firebase, usar el método original\r\n        const link = document.createElement('a')\r\n        link.href = src\r\n        link.download = videoTitle || 'video.mp4'\r\n        link.style.display = 'none'\r\n        document.body.appendChild(link)\r\n        link.click()\r\n        document.body.removeChild(link)\r\n      }\r\n    } catch (error) {\r\n      console.error('Error en descarga:', error)\r\n      alert(`Error al descargar el video: ${error.message}`)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div \r\n      ref={containerRef}\r\n      className={`relative bg-black rounded-lg overflow-hidden video-player-container ${getSizeClasses()} ${className} ${videoOrientation === 'vertical' ? 'video-player-vertical' : ''}`}\r\n      onMouseMove={activateControls}\r\n      onMouseLeave={() => {\r\n        if (isPlaying) {\r\n          const timeout = setTimeout(() => {\r\n            setShowControls(false)\r\n          }, 4000)\r\n          setControlsTimeout(timeout)\r\n        }\r\n      }}\r\n      onTouchStart={activateControls}\r\n      onTouchMove={activateControls}\r\n      onClick={handleVideoClick}\r\n      onDoubleClick={handleVideoDoubleClick}\r\n    >\r\n      <video\r\n        ref={videoRef}\r\n        src={src}\r\n        className={`w-full h-full cursor-pointer ${size === 'fullscreen' ? 'object-contain' : 'object-cover'}`}\r\n        muted={isMuted}\r\n        loop={isLoopEnabled && !isLoopSegmentMode}\r\n        onTimeUpdate={handleTimeUpdate}\r\n        onLoadedMetadata={handleLoadedMetadata}\r\n        onEnded={handleEnded}\r\n        onPlay={() => setIsPlaying(true)}\r\n        onPause={() => setIsPlaying(false)}\r\n        onClick={handleVideoClick}\r\n        onDoubleClick={handleVideoDoubleClick}\r\n        onTouchStart={activateControls}\r\n        onTouchMove={activateControls}\r\n      />\r\n\r\n\r\n\r\n      {/* Overlay de controles */}\r\n      {showControls && (\r\n        <div \r\n          className=\"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent\"\r\n          onMouseMove={activateControls}\r\n          onTouchStart={activateControls}\r\n          onTouchMove={activateControls}\r\n        >\r\n          {/* Controles superiores - solo pantalla completa */}\r\n          <div className=\"absolute top-0 left-0 right-0 p-4 flex justify-end items-center\">\r\n            <div className=\"flex items-center space-x-2\">\r\n              {/* Botón de pantalla completa */}\r\n              <button\r\n                onClick={toggleFullscreen}\r\n                onTouchStart={activateControls}\r\n                className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\r\n              >\r\n                {isFullscreen ? <Minimize className=\"w-4 h-4\" /> : <Maximize className=\"w-4 h-4\" />}\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Controles centrales - solo play/pause para móviles */}\r\n          <div className=\"absolute inset-0 flex items-center justify-center\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              {/* Botón de retroceder 10s - estilo Disney+/YouTube */}\r\n              <button\r\n                onClick={() => skip(-10)}\r\n                onTouchStart={activateControls}\r\n                className=\"p-3 rounded-full bg-black/60 text-white hover:bg-black/80 transition-colors z-10 hidden md:flex items-center justify-center\"\r\n              >\r\n                <div className=\"flex items-center space-x-1\">\r\n                  <div className=\"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center\">\r\n                    <SkipBack className=\"w-3 h-3\" />\r\n                  </div>\r\n                  <span className=\"text-sm font-medium\">10</span>\r\n                </div>\r\n              </button>\r\n\r\n              <button\r\n                onClick={togglePlay}\r\n                onTouchStart={activateControls}\r\n                className=\"p-4 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\r\n              >\r\n                {isPlaying ? <Pause className=\"w-8 h-8\" /> : <Play className=\"w-8 h-8\" />}\r\n              </button>\r\n\r\n              {/* Botón de adelantar 10s - estilo Disney+/YouTube */}\r\n              <button\r\n                onClick={() => skip(10)}\r\n                onTouchStart={activateControls}\r\n                className=\"p-3 rounded-full bg-black/60 text-white hover:bg-black/80 transition-colors z-10 hidden md:flex items-center justify-center\"\r\n              >\r\n                <div className=\"flex items-center space-x-1\">\r\n                  <span className=\"text-sm font-medium\">10</span>\r\n                  <div className=\"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center\">\r\n                    <SkipForward className=\"w-3 h-3\" />\r\n                  </div>\r\n                </div>\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Controles inferiores */}\r\n          <div className=\"absolute bottom-0 left-0 right-0 p-4\">\r\n            {/* Controles de volumen, bucle, A-B y resoluciones - por encima de la barra de progreso */}\r\n            <div className=\"flex justify-end mb-2 space-x-2\">\r\n              {/* Botón de bucle */}\r\n              <button\r\n                onClick={() => setIsLoopEnabled(!isLoopEnabled)}\r\n                onTouchStart={activateControls}\r\n                className={`p-2 rounded-full transition-colors z-10 ${\r\n                  isLoopEnabled ? 'bg-blue-500 text-white' : 'bg-white/20 text-white hover:bg-white/30'\r\n                }`}\r\n                title=\"Bucle\"\r\n              >\r\n                <RotateCcw className=\"w-4 h-4\" />\r\n              </button>\r\n\r\n              {/* Botón de segmento A-B */}\r\n              <button\r\n                onClick={() => {\r\n                  const newMode = !isLoopSegmentMode\r\n                  setIsLoopSegmentMode(newMode)\r\n                  if (!newMode) {\r\n                    // Al desactivar, limpiar todos los puntos\r\n                    setHasPointA(false)\r\n                    setHasPointB(false)\r\n                    setLoopStart(0)\r\n                    setLoopEnd(0)\r\n                  } else {\r\n                    // Al reactivar, restaurar los puntos guardados si existen\r\n                    if (savedPointA > 0) {\r\n                      setHasPointA(true)\r\n                      setLoopStart(savedPointA)\r\n                    }\r\n                    if (savedPointB > 0) {\r\n                      setHasPointB(true)\r\n                      setLoopEnd(savedPointB)\r\n                    }\r\n                  }\r\n                }}\r\n                onTouchStart={activateControls}\r\n                className={`p-2 rounded-full transition-colors z-10 ${\r\n                  isLoopSegmentMode ? 'bg-green-500 text-white' : 'bg-white/20 text-white hover:bg-white/30'\r\n                }`}\r\n                title=\"Segmento A-B\"\r\n              >\r\n                <div className=\"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none\">\r\n                  A-B\r\n                </div>\r\n              </button>\r\n\r\n              {/* Botón de resoluciones */}\r\n              {resolutions && resolutions.length > 0 && (\r\n                <div className=\"relative\">\r\n                  <button\r\n                    onClick={() => setShowResolutionMenu(!showResolutionMenu)}\r\n                    onTouchStart={activateControls}\r\n                    className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\r\n                    title=\"Resolución\"\r\n                  >\r\n                    <div className=\"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none\">\r\n                      {getResolutionLabel(selectedResolution)}\r\n                    </div>\r\n                  </button>\r\n                  \r\n                                                       {showResolutionMenu && (\r\n                    <div \r\n                      className=\"absolute bottom-full right-0 mb-2 bg-black/90 rounded-lg p-2 z-20 min-w-[80px]\"\r\n                      onTouchStart={activateControls}\r\n                      onTouchMove={activateControls}\r\n                    >\r\n                       {resolutions.map((resolution) => {\r\n                         const isAvailable = isResolutionAvailable(resolution)\r\n                         return (\r\n                           <button\r\n                             key={resolution}\r\n                             onClick={() => isAvailable && handleResolutionChange(resolution)}\r\n                             className={`w-full text-left px-3 py-1 rounded text-xs transition-colors ${\r\n                               !isAvailable \r\n                                 ? 'text-gray-500 cursor-not-allowed opacity-50'\r\n                                 : selectedResolution === resolution \r\n                                   ? 'bg-blue-500 text-white' \r\n                                   : 'text-white hover:bg-white/20'\r\n                             }`}\r\n                             disabled={!isAvailable}\r\n                           >\r\n                             {getResolutionLabel(resolution)}\r\n                             {!isAvailable && (\r\n                               <span className=\"ml-1 text-[10px] opacity-75\">\r\n                                 (no disponible)\r\n                               </span>\r\n                             )}\r\n                           </button>\r\n                         )\r\n                       })}\r\n                     </div>\r\n                   )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Botón de velocidades */}\r\n              <div className=\"relative\">\r\n                <button\r\n                  onClick={() => setShowSpeedMenu(!showSpeedMenu)}\r\n                  onTouchStart={activateControls}\r\n                  className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\r\n                  title=\"Velocidad de reproducción\"\r\n                >\r\n                  <div className=\"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none\">\r\n                    {playbackSpeed === 1 ? '1x' : `${playbackSpeed}x`}\r\n                  </div>\r\n                </button>\r\n                \r\n                {showSpeedMenu && (\r\n                  <div \r\n                    className=\"absolute bottom-full right-0 mb-2 bg-black/90 rounded-lg p-2 z-20 min-w-[80px]\"\r\n                    onTouchStart={activateControls}\r\n                    onTouchMove={activateControls}\r\n                  >\r\n                    {availableSpeeds.map((speed) => (\r\n                      <button\r\n                        key={speed}\r\n                        onClick={() => handleSpeedChange(speed)}\r\n                        className={`w-full text-left px-3 py-1 rounded text-xs transition-colors ${\r\n                          playbackSpeed === speed \r\n                            ? 'bg-blue-500 text-white' \r\n                            : 'text-white hover:bg-white/20'\r\n                        }`}\r\n                      >\r\n                        {getSpeedLabel(speed)}\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Botón de descarga */}\r\n              <button\r\n                onClick={downloadVideo}\r\n                onTouchStart={activateControls}\r\n                className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\r\n                title=\"Descargar video\"\r\n              >\r\n                <Download className=\"w-4 h-4\" />\r\n              </button>\r\n\r\n              {/* Controles de volumen */}\r\n              <div className=\"relative\">\r\n                <button\r\n                  onClick={toggleMute}\r\n                  onTouchStart={activateControls}\r\n                  className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\r\n                  onMouseEnter={() => setShowVolumeSlider(true)}\r\n                  onMouseLeave={() => {\r\n                    const timeout = setTimeout(() => setShowVolumeSlider(false), 1000)\r\n                    setVolumeSliderTimeout(timeout)\r\n                  }}\r\n                >\r\n                  {isMuted ? <VolumeX className=\"w-4 h-4\" /> : <Volume2 className=\"w-4 h-4\" />}\r\n                </button>\r\n                \r\n                                 {showVolumeSlider && (\r\n                   <div \r\n                     className=\"absolute bottom-full right-0 mb-2 bg-black/80 rounded-lg p-3 z-20\"\r\n                     onMouseEnter={() => {\r\n                       if (volumeSliderTimeout) {\r\n                         clearTimeout(volumeSliderTimeout)\r\n                         setVolumeSliderTimeout(null)\r\n                       }\r\n                     }}\r\n                     onMouseLeave={() => {\r\n                       const timeout = setTimeout(() => setShowVolumeSlider(false), 1000)\r\n                       setVolumeSliderTimeout(timeout)\r\n                     }}\r\n                     onTouchStart={activateControls}\r\n                     onTouchMove={activateControls}\r\n                   >\r\n                    <div className=\"flex flex-col items-center space-y-2\">\r\n                                             <input\r\n                         type=\"range\"\r\n                         min=\"0\"\r\n                         max=\"1\"\r\n                         step=\"0.01\"\r\n                         value={volume}\r\n                         onChange={handleVolumeChange}\r\n                         onTouchStart={activateControls}\r\n                         onTouchMove={activateControls}\r\n                         className=\"w-2 h-20 bg-gray-600 rounded-lg appearance-none cursor-pointer slider-vertical\"\r\n                         style={{\r\n                           background: `linear-gradient(to top, #3b82f6 0%, #3b82f6 ${volume * 100}%, #4b5563 ${volume * 100}%, #4b5563 100%)`\r\n                         }}\r\n                         orient=\"vertical\"\r\n                       />\r\n                      <span className=\"text-white text-xs\">{Math.round(volume * 100)}%</span>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Barra de progreso */}\r\n            <div className=\"relative mb-4\">\r\n              <div\r\n                className=\"w-full h-2 bg-white/20 rounded-full cursor-pointer relative\"\r\n                onClick={handleSeek}\r\n                onTouchStart={activateControls}\r\n                onTouchMove={activateControls}\r\n              >\r\n                <div\r\n                  className=\"h-full bg-blue-500 rounded-full\"\r\n                  style={{ width: `${(currentTime / duration) * 100}%` }}\r\n                />\r\n                \r\n                {/* Marcadores de bucle A-B - fuera del progreso para que siempre sean visibles */}\r\n                {isLoopSegmentMode && hasPointA && (\r\n                  <div\r\n                    className=\"absolute top-0 w-1 h-full bg-green-500 z-10\"\r\n                    style={{ left: `${(loopStart / duration) * 100}%` }}\r\n                  />\r\n                )}\r\n                {isLoopSegmentMode && hasPointB && (\r\n                  <div\r\n                    className=\"absolute top-0 w-1 h-full bg-red-500 z-10\"\r\n                    style={{ left: `${(loopEnd / duration) * 100}%` }}\r\n                  />\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Información de tiempo y controles de bucle */}\r\n            <div className=\"flex items-center justify-between text-white text-sm\">\r\n              <div className=\"flex items-center space-x-4\">\r\n                <span>{formatTime(currentTime)} / {formatTime(duration)}</span>\r\n                {playbackSpeed !== 1 && (\r\n                  <span className=\"text-blue-400 font-medium\">\r\n                    {playbackSpeed}x\r\n                  </span>\r\n                )}\r\n                \r\n                {isLoopSegmentMode && (\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <button\r\n                      onClick={() => setLoopPoint('start')}\r\n                      onTouchStart={activateControls}\r\n                      className={`px-2 py-1 rounded text-xs transition-colors ${\r\n                        hasPointA ? 'bg-green-500 text-white' : 'bg-gray-600 text-gray-300 hover:bg-gray-500'\r\n                      }`}\r\n                    >\r\n                      A: {hasPointA ? formatTime(loopStart) : '--:--'}\r\n                    </button>\r\n                    <button\r\n                      onClick={() => setLoopPoint('end')}\r\n                      onTouchStart={activateControls}\r\n                      className={`px-2 py-1 rounded text-xs transition-colors ${\r\n                        hasPointB ? 'bg-red-500 text-white' : 'bg-gray-600 text-gray-300 hover:bg-gray-500'\r\n                      }`}\r\n                    >\r\n                      B: {hasPointB ? formatTime(loopEnd) : '--:--'}\r\n                    </button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              <div className=\"flex items-center space-x-2\">\r\n                <div className=\"text-xs opacity-75\">\r\n                  {isLoopEnabled && (isLoopSegmentMode && hasPointA && hasPointB ? 'Bucle A-B' : 'Bucle completo')}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default VideoPlayer ","// Servicio para detección de BPM usando Web Audio API\r\n// Implementación simplificada sin dependencias externas\r\n\r\nexport const extractBPMFromVideo = async (videoFile) => {\r\n  try {\r\n    console.log('🎵 Iniciando detección de BPM para:', videoFile.name)\r\n    \r\n    // Crear contexto de audio\r\n    const audioContext = new (window.AudioContext || window.webkitAudioContext)()\r\n    \r\n    // Convertir video a ArrayBuffer\r\n    const arrayBuffer = await videoFile.arrayBuffer()\r\n    \r\n    // Decodificar audio del video\r\n    const audioBuffer = await audioContext.decodeAudioData(arrayBuffer)\r\n    \r\n    // Verificar si el video tiene audio significativo\r\n    const hasAudio = checkAudioLevel(audioBuffer)\r\n    if (!hasAudio) {\r\n      console.log('🎵 Video sin audio significativo, usando BPM por defecto')\r\n      return {\r\n        success: false,\r\n        bpm: null,\r\n        originalBPM: null,\r\n        error: 'Video sin audio significativo'\r\n      }\r\n    }\r\n    \r\n    console.log('🎵 Audio decodificado, detectando BPM...')\r\n    \r\n    // Detectar BPM usando análisis de frecuencia\r\n    const bpm = await detectBPMFromAudioBuffer(audioBuffer)\r\n    \r\n    // Redondear a entero\r\n    const roundedBPM = Math.round(bpm)\r\n    \r\n    console.log(`✅ BPM detectado: ${roundedBPM} para ${videoFile.name}`)\r\n    \r\n    return {\r\n      success: true,\r\n      bpm: roundedBPM,\r\n      originalBPM: bpm,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error al detectar BPM:', error)\r\n    return {\r\n      success: false,\r\n      bpm: null,\r\n      originalBPM: null,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Función para verificar si el video tiene audio significativo\r\nconst checkAudioLevel = (audioBuffer) => {\r\n  const channelData = audioBuffer.getChannelData(0)\r\n  const sampleRate = audioBuffer.sampleRate\r\n  \r\n  // Analizar los primeros 5 segundos\r\n  const analysisLength = Math.min(5 * sampleRate, channelData.length)\r\n  const data = channelData.slice(0, analysisLength)\r\n  \r\n  // Calcular RMS (Root Mean Square) para medir el nivel de audio\r\n  const rms = Math.sqrt(data.reduce((sum, sample) => sum + sample * sample, 0) / data.length)\r\n  \r\n  console.log(`🎵 Nivel de audio RMS: ${rms.toFixed(4)}`)\r\n  \r\n  // Considerar que hay audio si RMS > 0.01 (umbral muy bajo)\r\n  return rms > 0.01\r\n}\r\n\r\n// Función para detectar BPM usando análisis de frecuencia\r\nconst detectBPMFromAudioBuffer = async (audioBuffer) => {\r\n  const sampleRate = audioBuffer.sampleRate\r\n  const channelData = audioBuffer.getChannelData(0) // Usar primer canal\r\n  \r\n  // Analizar los primeros 10 segundos para detectar ritmo\r\n  const analysisLength = Math.min(10 * sampleRate, channelData.length)\r\n  const data = channelData.slice(0, analysisLength)\r\n  \r\n  // Detectar picos de energía (beats)\r\n  const peaks = detectPeaks(data, sampleRate)\r\n  \r\n  // Calcular intervalos entre picos\r\n  const intervals = []\r\n  for (let i = 1; i < peaks.length; i++) {\r\n    intervals.push(peaks[i] - peaks[i - 1])\r\n  }\r\n  \r\n  // Calcular BPM promedio\r\n  if (intervals.length > 0) {\r\n    const avgInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length\r\n    const bpm = (60 * sampleRate) / avgInterval\r\n    \r\n    console.log(`🎵 BPM calculado: ${bpm}, intervalos: ${intervals.length}, promedio: ${avgInterval}`)\r\n    \r\n    // Si el BPM calculado es muy alto (>300), probablemente es un error de detección\r\n    if (bpm > 300) {\r\n      console.log(`🎵 BPM demasiado alto (${bpm}), probablemente error de detección`)\r\n      return 120 // Usar BPM por defecto\r\n    }\r\n    \r\n    // Aplicar límites más realistas para salsa (80-180 BPM)\r\n    const limitedBPM = Math.max(80, Math.min(180, bpm))\r\n    \r\n    if (bpm !== limitedBPM) {\r\n      console.log(`🎵 BPM ajustado de ${bpm} a ${limitedBPM}`)\r\n    }\r\n    \r\n    // Si el BPM está muy cerca del límite máximo, verificar si es real\r\n    if (limitedBPM >= 175) {\r\n      console.log(`🎵 BPM muy alto (${limitedBPM}), verificando si es real...`)\r\n      // Verificar si hay suficientes intervalos consistentes\r\n      const consistentIntervals = intervals.filter(interval => \r\n        Math.abs(interval - avgInterval) < avgInterval * 0.3\r\n      )\r\n      \r\n      if (consistentIntervals.length < intervals.length * 0.7) {\r\n        console.log(`🎵 BPM alto pero intervalos inconsistentes, usando BPM por defecto`)\r\n        return 120\r\n      }\r\n    }\r\n    \r\n    return limitedBPM\r\n  }\r\n  \r\n  // BPM por defecto si no se detecta (BPM típico de salsa)\r\n  console.log('🎵 No se detectaron intervalos, usando BPM por defecto: 120')\r\n  return 120\r\n}\r\n\r\n// Función para detectar picos de energía\r\nconst detectPeaks = (data, sampleRate) => {\r\n  const peaks = []\r\n  \r\n  // Calcular umbral dinámico basado en la energía promedio\r\n  const energy = data.map(sample => sample * sample)\r\n  const avgEnergy = energy.reduce((a, b) => a + b, 0) / energy.length\r\n  \r\n  // Umbral más sensible para detectar mejor los beats\r\n  const threshold = Math.max(0.01, Math.min(0.5, avgEnergy * 3))\r\n  \r\n  // Distancia mínima entre picos (0.5 segundos para BPM más realistas)\r\n  const minDistance = sampleRate * 0.5\r\n  \r\n  console.log(`🎵 Detectando picos con umbral: ${threshold.toFixed(4)}, energía promedio: ${avgEnergy.toFixed(4)}`)\r\n  \r\n  // Usar ventana deslizante para detectar picos más precisos\r\n  const windowSize = Math.floor(sampleRate * 0.1) // Ventana de 0.1 segundos\r\n  \r\n  for (let i = windowSize; i < data.length - windowSize; i++) {\r\n    const windowData = data.slice(i - windowSize, i + windowSize)\r\n    const maxInWindow = Math.max(...windowData)\r\n    \r\n    if (data[i] === maxInWindow && data[i] > threshold) {\r\n      if (peaks.length === 0 || i - peaks[peaks.length - 1] > minDistance) {\r\n        peaks.push(i)\r\n      }\r\n    }\r\n  }\r\n  \r\n  console.log(`🎵 Picos detectados: ${peaks.length}`)\r\n  \r\n  // Si no se detectan suficientes picos, reducir el umbral\r\n  if (peaks.length < 3) {\r\n    console.log('🎵 Pocos picos detectados, reduciendo umbral...')\r\n    const lowerThreshold = threshold * 0.5\r\n    peaks.length = 0 // Limpiar array\r\n    \r\n    for (let i = windowSize; i < data.length - windowSize; i++) {\r\n      const windowData = data.slice(i - windowSize, i + windowSize)\r\n      const maxInWindow = Math.max(...windowData)\r\n      \r\n      if (data[i] === maxInWindow && data[i] > lowerThreshold) {\r\n        if (peaks.length === 0 || i - peaks[peaks.length - 1] > minDistance) {\r\n          peaks.push(i)\r\n        }\r\n      }\r\n    }\r\n    console.log(`🎵 Picos detectados con umbral reducido: ${peaks.length}`)\r\n  }\r\n  \r\n  return peaks\r\n}\r\n\r\nexport const validateBPM = (bpm) => {\r\n  // Validar que el BPM esté en un rango razonable para salsa (80-180 BPM)\r\n  if (bpm < 80 || bpm > 180) {\r\n    console.warn(`⚠️ BPM fuera de rango para salsa: ${bpm} (rango esperado: 80-180)`)\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport const getBPMDescription = (bpm) => {\r\n  if (bpm < 60) return 'Muy lento'\r\n  if (bpm < 80) return 'Lento'\r\n  if (bpm < 100) return 'Moderado'\r\n  if (bpm < 120) return 'Medio'\r\n  if (bpm < 140) return 'Rápido'\r\n  if (bpm < 160) return 'Muy rápido'\r\n  return 'Extremadamente rápido'\r\n} ","import React, { useState, useRef, useEffect } from 'react'\r\nimport { X, Upload, Tag, Trash2, CheckCircle, AlertCircle, ChevronDown, ChevronUp, ChevronsDown, ChevronsUp, Music } from 'lucide-react'\r\nimport { uploadVideo, uploadFile, generateVideoThumbnail, generateBestVideoThumbnail } from '../../services/firebase/storage'\r\nimport { createVideoDocument, checkVideoDuplicate } from '../../services/firebase/firestore'\r\nimport { useAuth } from '../../contexts/AuthContext'\r\nimport { useCategories } from '../../hooks/useCategories'\r\nimport Toast from '../common/Toast'\r\nimport VideoPlayer from './VideoPlayer'\r\nimport { extractBPMFromVideo, validateBPM, getBPMDescription } from '../../services/audio/bpmDetection'\r\n\r\nconst VideoUploadModal = ({ isOpen, onClose, onVideoUploaded, page = 'figuras', style = 'salsa' }) => {\r\n  const { user } = useAuth()\r\n  const { currentCategories, categoriesList, getColorClasses } = useCategories(page, style)\r\n  const fileInputRef = useRef(null)\r\n  const [selectedFiles, setSelectedFiles] = useState([])\r\n  const [uploading, setUploading] = useState(false)\r\n  const [uploadProgress, setUploadProgress] = useState({})\r\n  const [currentStep, setCurrentStep] = useState(1)\r\n  const [videoData, setVideoData] = useState({})\r\n  const [toasts, setToasts] = useState([])\r\n\r\n  // Estados para tags organizados por categorías\r\n  const [selectedTags, setSelectedTags] = useState({})\r\n  \r\n  // Refs para mantener los valores de los campos\r\n  const fieldRefs = useRef({})\r\n  \r\n  // Estado para videos plegados/desplegados - TODOS PLEGADOS POR DEFECTO\r\n  const [collapsedVideos, setCollapsedVideos] = useState(new Set())\r\n\r\n  useEffect(() => {\r\n    if (!isOpen) {\r\n      resetForm()\r\n    } else {\r\n      // Resetear el paso cuando se abre el modal\r\n      setCurrentStep(1)\r\n    }\r\n  }, [isOpen])\r\n\r\n  useEffect(() => {\r\n    // Inicializar selectedTags con las categorías disponibles\r\n    if (currentCategories) {\r\n      const initialTags = {}\r\n      Object.keys(currentCategories).forEach(categoryKey => {\r\n        initialTags[categoryKey] = []\r\n      })\r\n      setSelectedTags(initialTags)\r\n    }\r\n  }, [currentCategories])\r\n\r\n  const resetForm = () => {\r\n    // Limpiar URLs de vista previa antes de resetear\r\n    Object.values(videoData).forEach(data => {\r\n      if (data.videoPreview) {\r\n        URL.revokeObjectURL(data.videoPreview)\r\n      }\r\n      if (data.thumbnailPreview) {\r\n        URL.revokeObjectURL(data.thumbnailPreview)\r\n      }\r\n    })\r\n    \r\n    setSelectedFiles([])\r\n    setVideoData({})\r\n    setCollapsedVideos(new Set())\r\n    setUploadProgress({})\r\n    setUploading(false)\r\n    setCurrentStep(1)\r\n    \r\n    // Limpiar el input de archivos\r\n    if (fileInputRef.current) {\r\n      fileInputRef.current.value = ''\r\n    }\r\n  }\r\n\r\n  const addToast = (message, type = 'success') => {\r\n    const id = Date.now()\r\n    setToasts(prev => [...prev, { id, message, type }])\r\n  }\r\n\r\n  const removeToast = (id) => {\r\n    setToasts(prev => prev.filter(toast => toast.id !== id))\r\n  }\r\n\r\n  // Función para alternar el estado plegado/desplegado de un video\r\n  const toggleVideoCollapse = (fileName) => {\r\n    setCollapsedVideos(prev => {\r\n      const newSet = new Set(prev)\r\n      if (newSet.has(fileName)) {\r\n        newSet.delete(fileName)\r\n      } else {\r\n        newSet.add(fileName)\r\n      }\r\n      return newSet\r\n    })\r\n  }\r\n\r\n  // Función para plegar/desplegar todos los videos\r\n  const toggleAllVideos = (collapse) => {\r\n    if (collapse) {\r\n      setCollapsedVideos(new Set(selectedFiles.map(file => file.name)))\r\n    } else {\r\n      setCollapsedVideos(new Set())\r\n    }\r\n  }\r\n\r\n  const handleFileSelect = (event) => {\r\n    const files = Array.from(event.target.files)\r\n    const videoFiles = files.filter(file => file.type.startsWith('video/'))\r\n    \r\n    if (videoFiles.length === 0) {\r\n      addToast('Por favor selecciona archivos de video válidos', 'error')\r\n      return\r\n    }\r\n\r\n    // Filtrar archivos que ya están seleccionados\r\n    const newFiles = videoFiles.filter(file => \r\n      !selectedFiles.some(existingFile => existingFile.name === file.name)\r\n    )\r\n\r\n    if (newFiles.length === 0) {\r\n      addToast('Algunos archivos ya están seleccionados', 'warning')\r\n      return\r\n    }\r\n\r\n    // Actualizar archivos seleccionados\r\n    setSelectedFiles(prev => [...prev, ...newFiles])\r\n\r\n    // Generar vistas previas y thumbnails para los nuevos archivos\r\n    newFiles.forEach(async (file) => {\r\n      const videoPreview = URL.createObjectURL(file)\r\n      \r\n      // Generar thumbnail para la vista previa del modal\r\n      try {\r\n        const thumbnailBlob = await generateDefaultThumbnail(file)\r\n        const thumbnailURL = URL.createObjectURL(thumbnailBlob)\r\n        \r\n        setVideoData(prev => ({\r\n          ...prev,\r\n          [file.name]: {\r\n            ...prev[file.name],\r\n            videoPreview,\r\n            thumbnailPreview: thumbnailURL\r\n          }\r\n        }))\r\n      } catch (error) {\r\n        console.warn('Error generando thumbnail para vista previa:', error)\r\n        setVideoData(prev => ({\r\n          ...prev,\r\n          [file.name]: {\r\n            ...prev[file.name],\r\n            videoPreview\r\n          }\r\n        }))\r\n      }\r\n    })\r\n\r\n    addToast(`${newFiles.length} video(s) agregado(s)`, 'success')\r\n  }\r\n\r\n  const removeFile = (index) => {\r\n    const fileToRemove = selectedFiles[index]\r\n    if (fileToRemove && videoData[fileToRemove.name]) {\r\n      if (videoData[fileToRemove.name].videoPreview) {\r\n        URL.revokeObjectURL(videoData[fileToRemove.name].videoPreview)\r\n      }\r\n      if (videoData[fileToRemove.name].thumbnailPreview) {\r\n        URL.revokeObjectURL(videoData[fileToRemove.name].thumbnailPreview)\r\n      }\r\n    }\r\n    \r\n    setSelectedFiles(prev => prev.filter((_, i) => i !== index))\r\n    setVideoData(prev => {\r\n      const newData = { ...prev }\r\n      delete newData[fileToRemove.name]\r\n      return newData\r\n    })\r\n    setCollapsedVideos(prev => {\r\n      const newSet = new Set(prev)\r\n      newSet.delete(fileToRemove.name)\r\n      return newSet\r\n    })\r\n  }\r\n\r\n  const handleTagToggle = (category, tag) => {\r\n    setSelectedTags(prev => {\r\n      const currentTags = prev[category] || []\r\n      const isSelected = currentTags.includes(tag)\r\n      \r\n      if (isSelected) {\r\n        return {\r\n          ...prev,\r\n          [category]: currentTags.filter(t => t !== tag)\r\n        }\r\n      } else {\r\n        // Usar Set para evitar duplicados automáticamente\r\n        const newTags = [...new Set([...currentTags, tag])]\r\n        return {\r\n          ...prev,\r\n          [category]: newTags\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n\r\n\r\n  const generateThumbnail = async (file) => {\r\n    try {\r\n      // Si hay un thumbnail personalizado, usarlo\r\n      if (videoData[file.name]?.customThumbnailFile) {\r\n        const customThumbnailFile = videoData[file.name].customThumbnailFile\r\n        const thumbnailPath = `thumbnails/${page}/${style}/${Date.now()}_${file.name.replace(/\\.[^/.]+$/, '.jpg')}`\r\n        const uploadResult = await uploadFile(customThumbnailFile, thumbnailPath)\r\n        \r\n        if (uploadResult.success) {\r\n          return { url: uploadResult.url, path: uploadResult.path }\r\n        }\r\n      }\r\n      \r\n      // Intentar generar thumbnail de ALTA CALIDAD automáticamente con timeout\r\n      try {\r\n        const result = await Promise.race([\r\n          generateBestVideoThumbnail(file), // Usar la función de alta calidad\r\n          new Promise((_, reject) => \r\n            setTimeout(() => reject(new Error('Timeout')), 15000) // Aumentar timeout para mejor calidad\r\n          )\r\n        ])\r\n        \r\n        if (result.success && result.blob) {\r\n          // Subir thumbnail a Firebase Storage\r\n          const thumbnailPath = `thumbnails/${page}/${style}/${Date.now()}_${file.name.replace(/\\.[^/.]+$/, '.jpg')}`\r\n          const uploadResult = await uploadFile(result.blob, thumbnailPath)\r\n          \r\n          if (uploadResult.success) {\r\n            // Limpiar blob URL temporal\r\n            if (result.thumbnailURL) {\r\n              URL.revokeObjectURL(result.thumbnailURL)\r\n            }\r\n            return { url: uploadResult.url, path: uploadResult.path }\r\n          }\r\n        }\r\n      } catch (thumbnailError) {\r\n        console.warn('Error generando thumbnail automático:', thumbnailError)\r\n        // Continuar sin thumbnail\r\n      }\r\n      \r\n      // Fallback: usar thumbnail por defecto de Windows o generar uno simple\r\n      try {\r\n        // Intentar usar el thumbnail nativo del archivo (si está disponible)\r\n        const defaultThumbnail = await generateDefaultThumbnail(file)\r\n        if (defaultThumbnail) {\r\n          const thumbnailPath = `thumbnails/${page}/${style}/${Date.now()}_${file.name.replace(/\\.[^/.]+$/, '.jpg')}`\r\n          const uploadResult = await uploadFile(defaultThumbnail, thumbnailPath)\r\n          \r\n          if (uploadResult.success) {\r\n            return { url: uploadResult.url, path: uploadResult.path }\r\n          }\r\n        }\r\n      } catch (defaultError) {\r\n        console.warn('Error generando thumbnail por defecto:', defaultError)\r\n      }\r\n      \r\n      // Fallback final: no thumbnail, se mostrará el placeholder en la UI\r\n      return { url: null, path: null }\r\n    } catch (error) {\r\n      console.error('Error en generateThumbnail:', error)\r\n      return { url: null, path: null }\r\n    }\r\n  }\r\n\r\n  // Función para generar thumbnail por defecto usando el video\r\n  const generateDefaultThumbnail = async (file) => {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        const videoURL = URL.createObjectURL(file)\r\n        const video = document.createElement('video')\r\n        video.crossOrigin = 'anonymous'\r\n        video.muted = true\r\n        video.playsInline = true\r\n        \r\n        const canvas = document.createElement('canvas')\r\n        const ctx = canvas.getContext('2d')\r\n        \r\n        // Configurar canvas con ALTA CALIDAD para thumbnail\r\n        canvas.width = 1280 // Aumentar de 400 a 1280 para mejor calidad\r\n        canvas.height = 720 // Aumentar de 225 a 720 para mejor calidad (16:9)\r\n        \r\n        video.onloadedmetadata = () => {\r\n          try {\r\n            // Intentar capturar frame al inicio del video (0.1 segundos)\r\n            video.currentTime = 0.1\r\n            \r\n            video.onseeked = () => {\r\n              try {\r\n                // Dibujar el frame en el canvas\r\n                ctx.drawImage(video, 0, 0, canvas.width, canvas.height)\r\n                \r\n                // Convertir a blob\r\n                canvas.toBlob((blob) => {\r\n                  if (blob) {\r\n                    // Limpiar recursos\r\n                    URL.revokeObjectURL(videoURL)\r\n                    video.remove()\r\n                    canvas.remove()\r\n                    \r\n                    resolve(blob)\r\n                  } else {\r\n                    reject(new Error('No se pudo generar el thumbnail por defecto'))\r\n                  }\r\n                }, 'image/jpeg', 0.95) // Aumentar calidad de 0.8 a 0.95\r\n                \r\n              } catch (error) {\r\n                reject(new Error(`Error al capturar frame por defecto: ${error.message}`))\r\n              }\r\n            }\r\n            \r\n            video.onerror = () => {\r\n              reject(new Error('Error al cargar el video para thumbnail por defecto'))\r\n            }\r\n            \r\n          } catch (error) {\r\n            reject(new Error(`Error al procesar metadata por defecto: ${error.message}`))\r\n          }\r\n        }\r\n        \r\n        video.onerror = () => {\r\n          URL.revokeObjectURL(videoURL)\r\n          video.remove()\r\n          canvas.remove()\r\n          reject(new Error('Error al cargar el video por defecto'))\r\n        }\r\n        \r\n        // Cargar el video\r\n        video.src = videoURL\r\n        \r\n      } catch (error) {\r\n        reject(new Error(`Error al generar thumbnail por defecto: ${error.message}`))\r\n      }\r\n    })\r\n  }\r\n\r\n  const uploadVideoFile = async (file, index) => {\r\n    try {\r\n      // Verificar duplicado en base de datos\r\n      const duplicateCheck = await checkVideoDuplicate(file.name)\r\n      if (duplicateCheck.isDuplicate) {\r\n        addToast(`Video \"${file.name}\" ya existe en la base de datos`, 'warning')\r\n        return null\r\n      }\r\n\r\n      // Generar thumbnail\r\n      const thumbnailResult = await generateThumbnail(file)\r\n\r\n      // Subir video con estructura organizada por página y estilo\r\n      const videoPath = `videos/${page}/${style}/${Date.now()}_${file.name}`\r\n      const uploadResult = await uploadVideo(file, videoPath, (progress) => {\r\n        setUploadProgress(prev => ({ ...prev, [index]: progress }))\r\n      })\r\n\r\n      if (!uploadResult.success) {\r\n        addToast(`Error al subir ${file.name}: ${uploadResult.error}`, 'error')\r\n        return null\r\n      }\r\n\r\n      // Usar solo los tags seleccionados por el usuario, sin agregar automáticamente el style\r\n      const tagsWithStyle = {\r\n        ...selectedTags,\r\n        estilo: selectedTags.estilo || []\r\n      }\r\n\r\n      // Obtener los valores actuales de los campos de entrada usando refs\r\n      const titleInput = fieldRefs.current[`${file.name}-title`]\r\n      const descriptionInput = fieldRefs.current[`${file.name}-description`]\r\n      \r\n      const currentTitle = titleInput?.value?.trim() || videoData[file.name]?.title || file.name.replace(/\\.[^/.]+$/, '')\r\n      const currentDescription = descriptionInput?.value?.trim() || videoData[file.name]?.description || ''\r\n     \r\n      // Detectar resolución del video\r\n      let videoResolution = null\r\n      let videoWidth = null\r\n      let videoHeight = null\r\n      try {\r\n        const video = document.createElement('video')\r\n        video.src = URL.createObjectURL(file)\r\n        await new Promise((resolve, reject) => {\r\n          video.onloadedmetadata = () => {\r\n            videoWidth = video.videoWidth\r\n            videoHeight = video.videoHeight\r\n            const maxDimension = Math.max(videoWidth, videoHeight)\r\n            \r\n            if (maxDimension >= 3840) videoResolution = '4K'\r\n            else if (maxDimension >= 1920) videoResolution = '1080p'\r\n            else if (maxDimension >= 1280) videoResolution = '720p'\r\n            else if (maxDimension >= 854) videoResolution = '480p'\r\n            else videoResolution = '360p'\r\n            \r\n            URL.revokeObjectURL(video.src)\r\n            resolve()\r\n          }\r\n          video.onerror = reject\r\n        })\r\n      } catch (error) {\r\n        console.warn('No se pudo detectar la resolución del video:', error)\r\n        videoResolution = 'Unknown'\r\n      }\r\n\r\n      // Detectar BPM del video\r\n      let bpm = null\r\n      let bpmDetected = false\r\n      try {\r\n        const bpmResult = await extractBPMFromVideo(file)\r\n        if (bpmResult.success && validateBPM(bpmResult.bpm)) {\r\n          bpm = bpmResult.bpm\r\n          bpmDetected = true\r\n        }\r\n      } catch (error) {\r\n        console.error('❌ Error al detectar BPM:', error)\r\n      }\r\n\r\n      // Crear documento en Firestore\r\n      const videoDoc = {\r\n        title: currentTitle,\r\n        originalTitle: file.name,\r\n        description: currentDescription,\r\n        videoUrl: uploadResult.url,\r\n        thumbnailUrl: thumbnailResult.url || null,\r\n        videoPath: uploadResult.path,\r\n        thumbnailPath: thumbnailResult.path || null,\r\n        fileSize: file.size,\r\n        fileType: file.type,\r\n        duration: 0, // Se puede calcular después\r\n        resolution: videoResolution, // Resolución detectada\r\n        videoWidth, // Dimensiones del video\r\n        videoHeight,\r\n        style: style, // Agregar el estilo del video\r\n        tags: tagsWithStyle,\r\n        uploadedBy: user?.uid || 'anonymous',\r\n        uploadedAt: new Date().toISOString(),\r\n        views: 0,\r\n        likes: 0,\r\n        likedBy: [],\r\n        bpm: bpm, // BPM detectado\r\n        bpmDetected: bpmDetected // Indicar si se detectó BPM\r\n      }\r\n\r\n      const docResult = await createVideoDocument(videoDoc)\r\n      if (!docResult.success) {\r\n        addToast(`Error al guardar metadatos de ${file.name}`, 'error')\r\n        return null\r\n      }\r\n\r\n      addToast(`${file.name} subido exitosamente`, 'success')\r\n      return { ...videoDoc, id: docResult.id }\r\n    } catch (error) {\r\n      console.error('Error uploading video:', error)\r\n      addToast(`Error inesperado al subir ${file.name}`, 'error')\r\n      return null\r\n    }\r\n  }\r\n\r\n  const handleUpload = async () => {\r\n    if (selectedFiles.length === 0) {\r\n      addToast('Selecciona al menos un video', 'error')\r\n      return\r\n    }\r\n\r\n    setUploading(true)\r\n    const uploadedVideos = []\r\n\r\n    for (let i = 0; i < selectedFiles.length; i++) {\r\n      const file = selectedFiles[i]\r\n      const result = await uploadVideoFile(file, i)\r\n      if (result) {\r\n        uploadedVideos.push(result)\r\n      }\r\n    }\r\n\r\n    setUploading(false)\r\n    \r\n    if (uploadedVideos.length > 0) {\r\n      addToast(`${uploadedVideos.length} video(s) subido(s) correctamente`, 'success')\r\n      uploadedVideos.forEach(video => onVideoUploaded(video))\r\n      onClose()\r\n    }\r\n  }\r\n\r\n  const FileSelectionStep = () => (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"text-center\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Seleccionar Videos</h3>\r\n        <p className=\"text-gray-600\">Selecciona uno o varios videos para subir</p>\r\n      </div>\r\n\r\n      <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-6 hover:border-pink-400 transition-colors duration-200\">\r\n        <input\r\n          ref={fileInputRef}\r\n          type=\"file\"\r\n          multiple\r\n          accept=\"video/*\"\r\n          onChange={handleFileSelect}\r\n          className=\"hidden\"\r\n        />\r\n        <button\r\n          onClick={() => fileInputRef.current?.click()}\r\n          className=\"w-full flex flex-col items-center justify-center space-y-2 text-gray-600 hover:text-pink-500 transition-colors duration-200\"\r\n        >\r\n          <Upload className=\"h-12 w-12\" />\r\n          <span className=\"font-medium text-center\">Haz clic para seleccionar videos</span>\r\n          <span className=\"text-sm text-center\">MP4, AVI, MOV, etc. (máx. 100MB cada uno)</span>\r\n        </button>\r\n      </div>\r\n\r\n      {selectedFiles.length > 0 && (\r\n        <div className=\"space-y-2\">\r\n          <h4 className=\"font-medium text-gray-900\">Videos seleccionados ({selectedFiles.length})</h4>\r\n          {selectedFiles.map((file, index) => (\r\n            <div key={index} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n              <div className=\"flex-1\">\r\n                <p className=\"font-medium text-gray-900\">{file.name}</p>\r\n                <p className=\"text-sm text-gray-500\">{(file.size / (1024 * 1024)).toFixed(2)} MB</p>\r\n              </div>\r\n              <button\r\n                onClick={() => removeFile(index)}\r\n                className=\"p-1 text-red-500 hover:text-red-700 transition-colors duration-200\"\r\n              >\r\n                <Trash2 className=\"h-4 w-4\" />\r\n              </button>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n\r\n  const TagsStep = () => (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"text-center\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Configurar Videos</h3>\r\n        <p className=\"text-gray-600\">Personaliza la información de tus videos antes de subirlos</p>\r\n      </div>\r\n\r\n      {/* Controles globales para plegar/desplegar */}\r\n      {selectedFiles.length > 1 && (\r\n        <div className=\"flex justify-center space-x-2\">\r\n          <button\r\n            onClick={() => toggleAllVideos(true)}\r\n            className=\"flex items-center space-x-1 px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors\"\r\n          >\r\n            <ChevronsDown className=\"h-4 w-4\" />\r\n            <span>Plegar Todo</span>\r\n          </button>\r\n          <button\r\n            onClick={() => toggleAllVideos(false)}\r\n            className=\"flex items-center space-x-1 px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors\"\r\n          >\r\n            <ChevronsUp className=\"h-4 w-4\" />\r\n            <span>Desplegar Todo</span>\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      {/* Configuración por video */}\r\n      {selectedFiles.map((file, fileIndex) => {\r\n        const isCollapsed = collapsedVideos.has(file.name)\r\n        return (\r\n          <div key={fileIndex} className=\"border border-gray-200 rounded-lg overflow-hidden\">\r\n            {/* Header del video con botón de plegado */}\r\n            <div className=\"flex items-center justify-between p-4 bg-gray-50 border-b border-gray-200\">\r\n              <div className=\"flex items-center space-x-3\">\r\n                <div className=\"w-12 h-9 bg-gray-100 rounded flex items-center justify-center relative overflow-hidden\">\r\n                  {videoData[file.name]?.thumbnailPreview ? (\r\n                    <img \r\n                      src={videoData[file.name].thumbnailPreview} \r\n                      alt=\"Vista previa del video\"\r\n                      className=\"w-full h-full object-cover\"\r\n                      onError={(e) => {\r\n                        e.target.style.display = 'none'\r\n                        e.target.nextSibling.style.display = 'flex'\r\n                      }}\r\n                    />\r\n                  ) : null}\r\n                  <span className=\"text-xs text-gray-500\" style={{ display: videoData[file.name]?.thumbnailPreview ? 'none' : 'flex' }}>\r\n                    VIDEO\r\n                  </span>\r\n                </div>\r\n                <div>\r\n                  <h4 className=\"font-medium text-gray-900\">{file.name}</h4>\r\n                  <p className=\"text-sm text-gray-500\">{(file.size / (1024 * 1024)).toFixed(2)} MB</p>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex items-center space-x-2\">\r\n                <button\r\n                  onClick={() => toggleVideoCollapse(file.name)}\r\n                  className=\"p-1 text-gray-500 hover:text-gray-700 transition-colors\"\r\n                  title={isCollapsed ? \"Desplegar\" : \"Plegar\"}\r\n                >\r\n                  {isCollapsed ? <ChevronDown className=\"h-4 w-4\" /> : <ChevronUp className=\"h-4 w-4\" />}\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Contenido del video (condicionalmente visible) */}\r\n            {!isCollapsed && (\r\n              <div className=\"p-4 space-y-4\">\r\n                {/* Reproductor de video */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"font-medium text-gray-900\">Vista previa del video</h4>\r\n                  <div className=\"flex justify-center\">\r\n                    <VideoPlayer\r\n                      src={videoData[file.name]?.videoPreview || URL.createObjectURL(file)}\r\n                      size=\"medium\"\r\n                      loop={true}\r\n                      showControls={true}\r\n                      autoplay={false}\r\n                      muted={false}\r\n                      className=\"w-full max-w-2xl\"\r\n                      resolutions={['auto', '4k', '1080p', '720p', '480p', '360p']}\r\n                      currentResolution=\"auto\"\r\n                      videoTitle={videoData[file.name]?.title || file.name.replace(/\\.[^/.]+$/, '')}\r\n                      onResolutionChange={(resolution) => {\r\n                        // Aquí se implementaría la lógica para cambiar la resolución del video\r\n                      }}\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex items-center justify-between text-sm text-gray-600\">\r\n                    <span>{file.name}</span>\r\n                    <span>{(file.size / (1024 * 1024)).toFixed(2)} MB</span>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Nombre personalizado */}\r\n                <div className=\"space-y-2\">\r\n                  <label className=\"block text-sm font-medium text-gray-700\">\r\n                    Nombre del video\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    data-file={file.name}\r\n                    data-field=\"title\"\r\n                    ref={(el) => {\r\n                      if (el) {\r\n                        fieldRefs.current[`${file.name}-title`] = el\r\n                        if (!el.value) {\r\n                          el.value = videoData[file.name]?.title || file.name.replace(/\\.[^/.]+$/, '')\r\n                        }\r\n                      }\r\n                    }}\r\n                    onBlur={(e) => {\r\n                      const newTitle = e.target.value.trim()\r\n                      if (newTitle !== (videoData[file.name]?.title || file.name.replace(/\\.[^/.]+$/, ''))) {\r\n                        setVideoData(prev => ({\r\n                          ...prev,\r\n                          [file.name]: {\r\n                            ...prev[file.name],\r\n                            title: newTitle\r\n                          }\r\n                        }))\r\n                      }\r\n                    }}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent\"\r\n                    placeholder=\"Ingresa un nombre para el video\"\r\n                  />\r\n                </div>\r\n\r\n                {/* Descripción */}\r\n                <div className=\"space-y-2\">\r\n                  <label className=\"block text-sm font-medium text-gray-700\">\r\n                    Descripción (opcional)\r\n                  </label>\r\n                  <textarea\r\n                    data-file={file.name}\r\n                    data-field=\"description\"\r\n                    ref={(el) => {\r\n                      if (el) {\r\n                        fieldRefs.current[`${file.name}-description`] = el\r\n                        if (!el.value) {\r\n                          el.value = videoData[file.name]?.description || ''\r\n                        }\r\n                      }\r\n                    }}\r\n                    onBlur={(e) => {\r\n                      const newDescription = e.target.value.trim()\r\n                      if (newDescription !== (videoData[file.name]?.description || '')) {\r\n                        setVideoData(prev => ({\r\n                          ...prev,\r\n                          [file.name]: {\r\n                            ...prev[file.name],\r\n                            description: newDescription\r\n                          }\r\n                        }))\r\n                      }\r\n                    }}\r\n                    rows={2}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent\"\r\n                    placeholder=\"Describe brevemente el contenido del video...\"\r\n                  />\r\n                </div>\r\n\r\n                                 {/* Thumbnail personalizado - TAMBIÉN DOBLE DE GRANDE */}\r\n                 <div className=\"space-y-2\">\r\n                   <label className=\"block text-sm font-medium text-gray-700\">\r\n                     Thumbnail personalizado (opcional)\r\n                   </label>\r\n                   <div className=\"flex items-center space-x-3\">\r\n                     <div className=\"w-40 h-24 bg-gray-100 rounded border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden\">\r\n                       {videoData[file.name]?.customThumbnail ? (\r\n                         <img \r\n                           src={videoData[file.name].customThumbnail} \r\n                           alt=\"Thumbnail personalizado\" \r\n                           className=\"w-full h-full object-cover rounded\"\r\n                         />\r\n                       ) : (\r\n                         <span className=\"text-xs text-gray-500\">IMG</span>\r\n                       )}\r\n                     </div>\r\n                     <input\r\n                       type=\"file\"\r\n                       accept=\"image/*\"\r\n                       onChange={(e) => {\r\n                         const thumbnailFile = e.target.files[0]\r\n                         if (thumbnailFile) {\r\n                           const reader = new FileReader()\r\n                           reader.onload = (e) => {\r\n                             setVideoData(prev => ({\r\n                               ...prev,\r\n                               [file.name]: {\r\n                                 ...prev[file.name],\r\n                                 customThumbnail: e.target.result,\r\n                                 customThumbnailFile: thumbnailFile\r\n                               }\r\n                             }))\r\n                           }\r\n                           reader.readAsDataURL(thumbnailFile)\r\n                         }\r\n                       }}\r\n                       className=\"flex-1 text-sm text-gray-500 file:mr-4 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-sm file:font-medium file:bg-pink-50 file:text-pink-700 hover:file:bg-pink-100\"\r\n                     />\r\n                   </div>\r\n                 </div>\r\n\r\n                 \r\n              </div>\r\n            )}\r\n          </div>\r\n        )\r\n      })}\r\n\r\n      {/* Etiquetas globales */}\r\n      <div className=\"border-t pt-6\">\r\n        <h4 className=\"font-medium text-gray-900 mb-4\">Etiquetas para todos los videos</h4>\r\n        \r\n        {categoriesList.map((category) => (\r\n          <div key={category.key} className=\"space-y-3 mb-4\">\r\n            <h5 className=\"font-medium text-gray-700 capitalize\">{category.name}</h5>\r\n            <div className=\"flex flex-wrap gap-2\">\r\n              {category.tags.map(tag => (\r\n                <button\r\n                  key={tag}\r\n                  onClick={() => handleTagToggle(category.key, tag)}\r\n                  className={`px-3 py-1 rounded-full text-sm font-medium transition-all duration-200 ${\r\n                    selectedTags[category.key]?.includes(tag)\r\n                       ? 'bg-gradient-to-r from-pink-500 to-orange-500 text-white shadow-lg'\r\n                       : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\r\n                  }`}\r\n                >\r\n                  {tag}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n             <div className=\"bg-blue-50 p-4 rounded-lg\">\r\n         <div className=\"flex items-start space-x-2\">\r\n           <AlertCircle className=\"h-5 w-5 text-blue-500 mt-0.5\" />\r\n           <div>\r\n             <p className=\"text-sm text-blue-800 font-medium\">Información</p>\r\n                           <p className=\"text-sm text-blue-700\">Personaliza cada video individualmente y aplica etiquetas que se usarán para todos los videos seleccionados.</p>\r\n           </div>\r\n         </div>\r\n       </div>\r\n    </div>\r\n  )\r\n\r\n  const UploadStep = () => (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"text-center\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Subiendo Videos</h3>\r\n        <p className=\"text-gray-600\">Procesando {selectedFiles.length} video(s)...</p>\r\n      </div>\r\n\r\n      {selectedFiles.map((file, index) => (\r\n        <div key={index} className=\"space-y-2\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <span className=\"font-medium text-gray-900\">{file.name}</span>\r\n            <span className=\"text-sm text-gray-500\">{uploadProgress[index] || 0}%</span>\r\n          </div>\r\n          <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n            <div\r\n              className=\"bg-gradient-to-r from-pink-500 to-orange-500 h-2 rounded-full transition-all duration-300\"\r\n              style={{ width: `${uploadProgress[index] || 0}%` }}\r\n            />\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  )\r\n\r\n  const renderStep = () => {\r\n    switch (currentStep) {\r\n      case 1:\r\n        return <FileSelectionStep />\r\n      case 2:\r\n        return <TagsStep />\r\n      case 3:\r\n        return <UploadStep />\r\n      default:\r\n        return <FileSelectionStep />\r\n    }\r\n  }\r\n\r\n  const canProceed = () => {\r\n    switch (currentStep) {\r\n      case 1:\r\n        return selectedFiles.length > 0\r\n      case 2:\r\n        return true // Siempre se puede proceder desde tags\r\n      case 3:\r\n        return false // No se puede proceder durante upload\r\n      default:\r\n        return false\r\n    }\r\n  }\r\n\r\n  const handleNext = () => {\r\n    if (currentStep === 2) {\r\n      handleUpload()\r\n    } else {\r\n      setCurrentStep(prev => prev + 1)\r\n      // Cuando se avanza al paso 2, plegar todos los videos\r\n      if (currentStep === 1) {\r\n        setCollapsedVideos(new Set(selectedFiles.map(file => file.name)))\r\n      }\r\n    }\r\n  }\r\n\r\n  const handleBack = () => {\r\n    setCurrentStep(prev => Math.max(1, prev - 1))\r\n  }\r\n\r\n  if (!isOpen) return null\r\n\r\n  return (\r\n    <>\r\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n        <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\r\n            <div className=\"flex items-center space-x-3\">\r\n              <div className=\"p-2 bg-gradient-to-r from-pink-500 to-orange-500 rounded-full\">\r\n                <Upload className=\"h-6 w-6 text-white\" />\r\n              </div>\r\n              <div>\r\n                <h2 className=\"text-xl font-semibold text-gray-900\">Subir Videos</h2>\r\n                <p className=\"text-sm text-gray-500\">Paso {currentStep} de 3</p>\r\n              </div>\r\n            </div>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"text-gray-400 hover:text-gray-600 transition-colors duration-200\"\r\n            >\r\n              <X className=\"h-6 w-6\" />\r\n            </button>\r\n          </div>\r\n\r\n          {/* Content */}\r\n          <div className=\"p-6 overflow-y-auto max-h-[60vh]\">\r\n            {renderStep()}\r\n          </div>\r\n\r\n          {/* Footer */}\r\n          <div className=\"flex items-center justify-between p-6 border-t border-gray-200\">\r\n            <button\r\n              onClick={handleBack}\r\n              disabled={currentStep === 1 || uploading}\r\n              className=\"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              Atrás\r\n            </button>\r\n            \r\n            <div className=\"flex space-x-3\">\r\n              <button\r\n                onClick={onClose}\r\n                disabled={uploading}\r\n                className=\"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n              >\r\n                Cancelar\r\n              </button>\r\n              \r\n              {currentStep < 3 && (\r\n                <button\r\n                  onClick={handleNext}\r\n                  disabled={!canProceed() || uploading}\r\n                  className=\"px-6 py-2 bg-gradient-to-r from-pink-500 to-orange-500 text-white rounded-lg font-medium hover:shadow-lg transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none\"\r\n                >\r\n                  {currentStep === 2 ? 'Subir Videos' : 'Siguiente'}\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Toasts */}\r\n      {toasts.map(toast => (\r\n        <Toast\r\n          key={toast.id}\r\n          message={toast.message}\r\n          type={toast.type}\r\n          onClose={() => removeToast(toast.id)}\r\n        />\r\n      ))}\r\n    </>\r\n  )\r\n}\r\n\r\nexport default VideoUploadModal ","import { useState, useRef, useEffect } from 'react'\r\nimport { X, Edit, Tag, Save, AlertCircle, ChevronDown, ChevronUp, ChevronsDown, ChevronsUp } from 'lucide-react'\r\nimport { updateVideoDocument } from '../../services/firebase/firestore'\r\nimport { uploadFile } from '../../services/firebase/storage'\r\nimport { useAuth } from '../../contexts/AuthContext'\r\nimport { useCategories } from '../../hooks/useCategories'\r\nimport Toast from '../common/Toast'\r\nimport VideoPlayer from './VideoPlayer'\r\n\r\nconst VideoEditModal = ({ isOpen, onClose, video, onVideoUpdated, page = 'figuras', style = 'salsa' }) => {\r\n  const { user } = useAuth()\r\n  const { currentCategories, categoriesList, getColorClasses } = useCategories(page, style)\r\n  const [loading, setLoading] = useState(false)\r\n  const [toasts, setToasts] = useState([])\r\n  \r\n  // Estados para el formulario\r\n  const [title, setTitle] = useState('')\r\n  const [description, setDescription] = useState('')\r\n  const [customThumbnail, setCustomThumbnail] = useState(null)\r\n  const [customThumbnailFile, setCustomThumbnailFile] = useState(null)\r\n  \r\n  // Estados para tags organizados por categorías\r\n  const [selectedTags, setSelectedTags] = useState({})\r\n  const [tagsIniciales, setTagsIniciales] = useState({})\r\n  const [tagsFinales, setTagsFinales] = useState({})\r\n  \r\n  // Estado para secciones plegadas/desplegadas\r\n  const [collapsedSections, setCollapsedSections] = useState(new Set(['tags-iniciales', 'tags-finales']))\r\n\r\n     useEffect(() => {\r\n     if (!isOpen || !video) return\r\n     \r\n     // Inicializar datos del video\r\n     setTitle(video.title || '')\r\n     setDescription(video.description || '')\r\n     setCustomThumbnail(video.thumbnailUrl || null)\r\n     setCustomThumbnailFile(null) // Resetear archivo de thumbnail\r\n     \r\n     // Inicializar tags\r\n     if (currentCategories) {\r\n       const initialTags = {}\r\n       const initialTagsIniciales = {}\r\n       const initialTagsFinales = {}\r\n       \r\n       Object.keys(currentCategories).forEach(categoryKey => {\r\n         initialTags[categoryKey] = video.tags?.[categoryKey] || []\r\n         initialTagsIniciales[categoryKey] = video.tagsIniciales?.[categoryKey] || []\r\n         initialTagsFinales[categoryKey] = video.tagsFinales?.[categoryKey] || []\r\n       })\r\n       \r\n       setSelectedTags(initialTags)\r\n       setTagsIniciales(initialTagsIniciales)\r\n       setTagsFinales(initialTagsFinales)\r\n     }\r\n   }, [isOpen, video, currentCategories])\r\n\r\n   // Resetear estados cuando se cierra el modal\r\n   useEffect(() => {\r\n     if (!isOpen) {\r\n       setTitle('')\r\n       setDescription('')\r\n       setCustomThumbnail(null)\r\n       setCustomThumbnailFile(null)\r\n       setSelectedTags({})\r\n       setTagsIniciales({})\r\n       setTagsFinales({})\r\n     }\r\n   }, [isOpen])\r\n\r\n  const addToast = (message, type = 'success') => {\r\n    const id = Date.now()\r\n    setToasts(prev => [...prev, { id, message, type }])\r\n  }\r\n\r\n  const removeToast = (id) => {\r\n    setToasts(prev => prev.filter(toast => toast.id !== id))\r\n  }\r\n\r\n  // Función para alternar el estado plegado/desplegado de una sección\r\n  const toggleSectionCollapse = (sectionName) => {\r\n    setCollapsedSections(prev => {\r\n      const newSet = new Set(prev)\r\n      if (newSet.has(sectionName)) {\r\n        newSet.delete(sectionName)\r\n      } else {\r\n        newSet.add(sectionName)\r\n      }\r\n      return newSet\r\n    })\r\n  }\r\n\r\n  const handleTagToggle = (category, tag) => {\r\n    setSelectedTags(prev => {\r\n      const currentTags = prev[category] || []\r\n      const isSelected = currentTags.includes(tag)\r\n      \r\n      if (isSelected) {\r\n        return {\r\n          ...prev,\r\n          [category]: currentTags.filter(t => t !== tag)\r\n        }\r\n      } else {\r\n        // Usar Set para evitar duplicados automáticamente\r\n        const newTags = [...new Set([...currentTags, tag])]\r\n        return {\r\n          ...prev,\r\n          [category]: newTags\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  const handleTagInicialToggle = (category, tag) => {\r\n    setTagsIniciales(prev => {\r\n      const currentTags = prev[category] || []\r\n      const isSelected = currentTags.includes(tag)\r\n      \r\n      if (isSelected) {\r\n        return {\r\n          ...prev,\r\n          [category]: currentTags.filter(t => t !== tag)\r\n        }\r\n      } else {\r\n        // Usar Set para evitar duplicados automáticamente\r\n        const newTags = [...new Set([...currentTags, tag])]\r\n        return {\r\n          ...prev,\r\n          [category]: newTags\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  const handleTagFinalToggle = (category, tag) => {\r\n    setTagsFinales(prev => {\r\n      const currentTags = prev[category] || []\r\n      const isSelected = currentTags.includes(tag)\r\n      \r\n      if (isSelected) {\r\n        return {\r\n          ...prev,\r\n          [category]: currentTags.filter(t => t !== tag)\r\n        }\r\n      } else {\r\n        // Usar Set para evitar duplicados automáticamente\r\n        const newTags = [...new Set([...currentTags, tag])]\r\n        return {\r\n          ...prev,\r\n          [category]: newTags\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  const handleThumbnailChange = (e) => {\r\n    const file = e.target.files[0]\r\n    if (file) {\r\n      const reader = new FileReader()\r\n      reader.onload = (e) => {\r\n        setCustomThumbnail(e.target.result)\r\n        setCustomThumbnailFile(file)\r\n      }\r\n      reader.readAsDataURL(file)\r\n    }\r\n  }\r\n\r\n  // Función para detectar resolución del video\r\n  const detectVideoResolution = async (videoUrl) => {\r\n    try {\r\n      const video = document.createElement('video')\r\n      video.src = videoUrl\r\n      await new Promise((resolve, reject) => {\r\n        video.onloadedmetadata = () => {\r\n          const width = video.videoWidth\r\n          const height = video.videoHeight\r\n          const maxDimension = Math.max(width, height)\r\n          \r\n          let resolution = 'Unknown'\r\n          if (maxDimension >= 3840) resolution = '4K'\r\n          else if (maxDimension >= 1920) resolution = '1080p'\r\n          else if (maxDimension >= 1280) resolution = '720p'\r\n          else if (maxDimension >= 854) resolution = '480p'\r\n          else resolution = '360p'\r\n          \r\n          resolve({ resolution, videoWidth: width, videoHeight: height })\r\n        }\r\n        video.onerror = reject\r\n        // Timeout por si el video no carga\r\n        setTimeout(() => reject(new Error('Timeout')), 10000)\r\n      })\r\n    } catch (error) {\r\n      console.warn('No se pudo detectar la resolución del video:', error)\r\n      return { resolution: 'Unknown', videoWidth: null, videoHeight: null }\r\n    }\r\n  }\r\n\r\n  const handleSave = async () => {\r\n    if (!video) return\r\n    \r\n    setLoading(true)\r\n    \r\n    try {\r\n             // Subir nuevo thumbnail si se seleccionó uno\r\n       let thumbnailUrl = video.thumbnailUrl\r\n       let thumbnailPath = video.thumbnailPath\r\n       \r\n       if (customThumbnailFile) {\r\n         const newThumbnailPath = `thumbnails/${Date.now()}_${video.originalTitle.replace(/\\.[^/.]+$/, '.jpg')}`\r\n         const uploadResult = await uploadFile(customThumbnailFile, newThumbnailPath)\r\n         \r\n         if (uploadResult.success) {\r\n           thumbnailUrl = uploadResult.url\r\n           thumbnailPath = uploadResult.path\r\n         } else {\r\n           addToast('Error al subir el nuevo thumbnail', 'error')\r\n           setLoading(false)\r\n           return\r\n         }\r\n       }\r\n\r\n      // Usar solo los tags seleccionados por el usuario, sin agregar automáticamente el style\r\n      const tagsWithStyle = {\r\n        ...selectedTags,\r\n        estilo: selectedTags.estilo || []\r\n      }\r\n\r\n      // Detectar resolución si no existe\r\n      let resolution = video.resolution\r\n      let videoWidth = video.videoWidth\r\n      let videoHeight = video.videoHeight\r\n      \r\n      if (!resolution || resolution === 'Unknown') {\r\n        try {\r\n          const resolutionData = await detectVideoResolution(video.videoUrl)\r\n          resolution = resolutionData.resolution\r\n          videoWidth = resolutionData.videoWidth\r\n          videoHeight = resolutionData.videoHeight\r\n          // Resolución detectada\r\n        } catch (error) {\r\n          console.warn('No se pudo detectar la resolución:', error)\r\n          resolution = 'Unknown'\r\n        }\r\n      }\r\n\r\n      // Preparar datos actualizados\r\n      const updatedData = {\r\n        title: title.trim(),\r\n        description: description.trim(),\r\n        thumbnailUrl,\r\n        thumbnailPath,\r\n        resolution, // Incluir la resolución detectada\r\n        videoWidth, // Incluir dimensiones del video\r\n        videoHeight,\r\n        tags: tagsWithStyle,\r\n        tagsIniciales,\r\n        tagsFinales,\r\n        updatedBy: user?.uid || 'anonymous',\r\n        updatedAt: new Date().toISOString()\r\n      }\r\n\r\n      // Actualizar en Firestore\r\n      const result = await updateVideoDocument(video.id, updatedData)\r\n      \r\n      if (result.success) {\r\n        addToast('Video actualizado exitosamente', 'success')\r\n        onVideoUpdated({ ...video, ...updatedData })\r\n        onClose()\r\n      } else {\r\n        addToast(`Error al actualizar video: ${result.error}`, 'error')\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating video:', error)\r\n      addToast('Error inesperado al actualizar video', 'error')\r\n    }\r\n    \r\n    setLoading(false)\r\n  }\r\n\r\n  if (!isOpen || !video) return null\r\n\r\n  return (\r\n    <>\r\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n        <div className=\"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\r\n            <div className=\"flex items-center space-x-3\">\r\n              <div className=\"p-2 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full\">\r\n                <Edit className=\"h-6 w-6 text-white\" />\r\n              </div>\r\n              <div>\r\n                <h2 className=\"text-xl font-semibold text-gray-900\">Editar Video</h2>\r\n                <p className=\"text-sm text-gray-500\">{video.title}</p>\r\n              </div>\r\n            </div>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"text-gray-400 hover:text-gray-600 transition-colors duration-200\"\r\n            >\r\n              <X className=\"h-6 w-6\" />\r\n            </button>\r\n          </div>\r\n\r\n          {/* Content */}\r\n          <div className=\"p-6 overflow-y-auto max-h-[60vh]\">\r\n            <div className=\"space-y-6\">\r\n                             {/* Reproductor de video */}\r\n               <div className=\"space-y-4\">\r\n                 <h4 className=\"font-medium text-gray-900\">Vista previa del video</h4>\r\n                 <div className=\"flex justify-center\">\r\n                   <VideoPlayer\r\n                     src={video.videoUrl}\r\n                     size=\"medium\"\r\n                     loop={true}\r\n                     showControls={true}\r\n                     autoplay={false}\r\n                     muted={false}\r\n                     className=\"w-full max-w-2xl\"\r\n                     resolutions={['auto', '4k', '1080p', '720p', '480p', '360p']}\r\n                     currentResolution=\"auto\"\r\n                     videoTitle={video.title || 'video'}\r\n                                           onResolutionChange={(resolution) => {\r\n                        // Aquí se implementaría la lógica para cambiar la resolución del video\r\n                      }}\r\n                   />\r\n                 </div>\r\n                 <div className=\"flex items-center justify-between text-sm text-gray-600\">\r\n                   <div className=\"flex items-center space-x-2\">\r\n                     <span>{video.originalTitle}</span>\r\n                     <span className=\"text-gray-400\">•</span>\r\n                     <span>{(video.fileSize / (1024 * 1024)).toFixed(2)} MB</span>\r\n                     {video.resolution && video.resolution !== 'Unknown' && (\r\n                       <>\r\n                         <span className=\"text-gray-400\">•</span>\r\n                         <span>{video.resolution}</span>\r\n                       </>\r\n                     )}\r\n                   </div>\r\n                 </div>\r\n               </div>\r\n\r\n              {/* Título */}\r\n              <div className=\"space-y-2\">\r\n                <label className=\"block text-sm font-medium text-gray-700\">\r\n                  Título del video\r\n                </label>\r\n                                 <input\r\n                   type=\"text\"\r\n                   value={title}\r\n                   onChange={(e) => setTitle(e.target.value)}\r\n                   className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-500\"\r\n                   placeholder=\"Ingresa un título para el video\"\r\n                 />\r\n              </div>\r\n\r\n              {/* Descripción */}\r\n              <div className=\"space-y-2\">\r\n                <label className=\"block text-sm font-medium text-gray-700\">\r\n                  Descripción\r\n                </label>\r\n                                 <textarea\r\n                   value={description}\r\n                   onChange={(e) => setDescription(e.target.value)}\r\n                   rows={3}\r\n                   className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-500\"\r\n                   placeholder=\"Describe brevemente el contenido del video...\"\r\n                 />\r\n              </div>\r\n\r\n              {/* Thumbnail personalizado */}\r\n              <div className=\"space-y-2\">\r\n                <label className=\"block text-sm font-medium text-gray-700\">\r\n                  Thumbnail personalizado\r\n                </label>\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className=\"w-40 h-24 bg-gray-100 rounded border-2 border-dashed border-gray-300 flex items-center justify-center\">\r\n                    {customThumbnail ? (\r\n                      <img \r\n                        src={customThumbnail} \r\n                        alt=\"Thumbnail\" \r\n                        className=\"w-full h-full object-cover rounded\"\r\n                      />\r\n                    ) : (\r\n                      <span className=\"text-xs text-gray-500\">IMG</span>\r\n                    )}\r\n                  </div>\r\n                  <input\r\n                    type=\"file\"\r\n                    accept=\"image/*\"\r\n                    onChange={handleThumbnailChange}\r\n                    className=\"flex-1 text-sm text-gray-500 file:mr-4 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Tags Normales */}\r\n              <div className=\"space-y-4\">\r\n                <h4 className=\"font-medium text-gray-900\">Tags Normales</h4>\r\n                {categoriesList.map((category) => (\r\n                  <div key={category.key} className=\"space-y-3\">\r\n                    <h5 className=\"font-medium text-gray-700 capitalize\">{category.name}</h5>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                      {category.tags.map(tag => (\r\n                        <button\r\n                          key={tag}\r\n                          onClick={() => handleTagToggle(category.key, tag)}\r\n                          className={`px-3 py-1 rounded-full text-sm font-medium transition-all duration-200 ${\r\n                            selectedTags[category.key]?.includes(tag)\r\n                              ? 'bg-gradient-to-r from-pink-500 to-orange-500 text-white shadow-lg'\r\n                              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\r\n                          }`}\r\n                        >\r\n                          {tag}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n\r\n              {/* Tags Iniciales */}\r\n              <div className=\"border-t pt-6\">\r\n                <button\r\n                  onClick={() => toggleSectionCollapse('tags-iniciales')}\r\n                  className=\"flex items-center justify-between w-full p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg hover:from-blue-100 hover:to-purple-100 transition-all duration-200\"\r\n                >\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <Tag className=\"h-5 w-5 text-blue-600\" />\r\n                    <h4 className=\"font-medium text-gray-900\">Tags Iniciales (cómo empieza la figura)</h4>\r\n                  </div>\r\n                  {collapsedSections.has('tags-iniciales') ? (\r\n                    <ChevronDown className=\"h-5 w-5 text-gray-500\" />\r\n                  ) : (\r\n                    <ChevronUp className=\"h-5 w-5 text-gray-500\" />\r\n                  )}\r\n                </button>\r\n                \r\n                <div className={`mt-4 transition-all duration-300 ease-in-out overflow-hidden ${\r\n                  collapsedSections.has('tags-iniciales') ? 'max-h-0 opacity-0' : 'max-h-96 opacity-100'\r\n                }`}>\r\n                  <div className=\"space-y-4 bg-blue-50 rounded-lg p-4\">\r\n                    {categoriesList.map((category) => (\r\n                      <div key={`inicial-${category.key}`} className=\"space-y-2\">\r\n                        <h6 className=\"text-xs font-medium text-gray-600 uppercase tracking-wide\">{category.name}</h6>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                          {category.tags.map(tag => (\r\n                            <button\r\n                              key={`inicial-${tag}`}\r\n                              onClick={() => handleTagInicialToggle(category.key, tag)}\r\n                              className={`px-2 py-1 rounded-full text-xs font-medium transition-all duration-200 ${\r\n                                tagsIniciales[category.key]?.includes(tag)\r\n                                  ? 'bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg'\r\n                                  : 'bg-white text-gray-700 hover:bg-blue-100'\r\n                              }`}\r\n                            >\r\n                              {tag}\r\n                            </button>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Tags Finales */}\r\n              <div className=\"border-t pt-6\">\r\n                <button\r\n                  onClick={() => toggleSectionCollapse('tags-finales')}\r\n                  className=\"flex items-center justify-between w-full p-4 bg-gradient-to-r from-green-50 to-teal-50 rounded-lg hover:from-green-100 hover:to-teal-100 transition-all duration-200\"\r\n                >\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <Tag className=\"h-5 w-5 text-green-600\" />\r\n                    <h4 className=\"font-medium text-gray-900\">Tags Finales (cómo termina la figura)</h4>\r\n                  </div>\r\n                  {collapsedSections.has('tags-finales') ? (\r\n                    <ChevronDown className=\"h-5 w-5 text-gray-500\" />\r\n                  ) : (\r\n                    <ChevronUp className=\"h-5 w-5 text-gray-500\" />\r\n                  )}\r\n                </button>\r\n                \r\n                <div className={`mt-4 transition-all duration-300 ease-in-out overflow-hidden ${\r\n                  collapsedSections.has('tags-finales') ? 'max-h-0 opacity-0' : 'max-h-96 opacity-100'\r\n                }`}>\r\n                  <div className=\"space-y-4 bg-green-50 rounded-lg p-4\">\r\n                    {categoriesList.map((category) => (\r\n                      <div key={`final-${category.key}`} className=\"space-y-2\">\r\n                        <h6 className=\"text-xs font-medium text-gray-600 uppercase tracking-wide\">{category.name}</h6>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                          {category.tags.map(tag => (\r\n                            <button\r\n                              key={`final-${tag}`}\r\n                              onClick={() => handleTagFinalToggle(category.key, tag)}\r\n                              className={`px-2 py-1 rounded-full text-xs font-medium transition-all duration-200 ${\r\n                                tagsFinales[category.key]?.includes(tag)\r\n                                  ? 'bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-lg'\r\n                                  : 'bg-white text-gray-700 hover:bg-green-100'\r\n                              }`}\r\n                            >\r\n                              {tag}\r\n                            </button>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Información */}\r\n              <div className=\"bg-blue-50 p-4 rounded-lg\">\r\n                <div className=\"flex items-start space-x-2\">\r\n                  <AlertCircle className=\"h-5 w-5 text-blue-500 mt-0.5\" />\r\n                  <div>\r\n                    <p className=\"text-sm text-blue-800 font-medium\">Información</p>\r\n                    <p className=\"text-sm text-blue-700\">Los tags iniciales y finales ayudarán a crear secuencias lógicas conectando figuras.</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Footer */}\r\n          <div className=\"flex items-center justify-between p-6 border-t border-gray-200\">\r\n            <button\r\n              onClick={onClose}\r\n              disabled={loading}\r\n              className=\"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              Cancelar\r\n            </button>\r\n            \r\n            <button\r\n              onClick={handleSave}\r\n              disabled={loading || !title.trim()}\r\n              className=\"px-6 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg font-medium hover:shadow-lg transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none\"\r\n            >\r\n              {loading ? 'Guardando...' : 'Guardar Cambios'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Toasts */}\r\n      {toasts.map(toast => (\r\n        <Toast\r\n          key={toast.id}\r\n          message={toast.message}\r\n          type={toast.type}\r\n          onClose={() => removeToast(toast.id)}\r\n        />\r\n      ))}\r\n    </>\r\n  )\r\n}\r\n\r\nexport default VideoEditModal ","// Servicio para procesamiento de video usando FFmpeg.wasm\r\nimport { FFmpeg } from '@ffmpeg/ffmpeg'\r\nimport { fetchFile } from '@ffmpeg/util'\r\n\r\nlet ffmpeg = null\r\n\r\n// Inicializar FFmpeg\r\nexport const initFFmpeg = async () => {\r\n  if (ffmpeg && ffmpeg.FS) {\r\n    console.log('✅ FFmpeg ya inicializado, reutilizando instancia')\r\n    return ffmpeg\r\n  }\r\n  \r\n  console.log('🎬 Inicializando FFmpeg...')\r\n  ffmpeg = new FFmpeg()\r\n  \r\n  try {\r\n    await ffmpeg.load()\r\n    console.log('✅ FFmpeg inicializado correctamente')\r\n    return ffmpeg\r\n  } catch (error) {\r\n    console.error('❌ Error al inicializar FFmpeg:', error)\r\n    ffmpeg = null\r\n    throw new Error('No se pudo inicializar FFmpeg')\r\n  }\r\n}\r\n\r\n// Ajustar velocidad de un video\r\nexport const adjustVideoSpeed = async (videoFile, speedFactor, outputName = 'output.mp4') => {\r\n  try {\r\n    console.log(`🎬 Ajustando velocidad del video: factor ${speedFactor}`)\r\n    \r\n    const ffmpegInstance = await initFFmpeg()\r\n    \r\n    // Verificar que FFmpeg esté correctamente inicializado\r\n    if (!ffmpegInstance || !ffmpegInstance.FS) {\r\n      throw new Error('FFmpeg no está correctamente inicializado')\r\n    }\r\n    \r\n    // Escribir archivo de entrada\r\n    ffmpegInstance.FS('writeFile', 'input.mp4', await fetchFile(videoFile))\r\n    \r\n    // Intentar primero con audio, si falla, procesar solo video\r\n    try {\r\n      // Ajustar velocidad manteniendo pitch del audio\r\n      await ffmpegInstance.run(\r\n        '-i', 'input.mp4',\r\n        '-filter:v', `setpts=${1/speedFactor}*PTS`,\r\n        '-filter:a', `atempo=${speedFactor}`,\r\n        '-c:v', 'libx264',\r\n        '-c:a', 'aac',\r\n        '-preset', 'fast',\r\n        outputName\r\n      )\r\n    } catch (audioError) {\r\n      console.log('⚠️ Error con audio, procesando solo video:', audioError.message)\r\n      \r\n      // Procesar solo video sin audio\r\n      await ffmpegInstance.run(\r\n        '-i', 'input.mp4',\r\n        '-filter:v', `setpts=${1/speedFactor}*PTS`,\r\n        '-c:v', 'libx264',\r\n        '-an', // Sin audio\r\n        '-preset', 'fast',\r\n        outputName\r\n      )\r\n    }\r\n    \r\n    // Leer archivo de salida\r\n    const data = ffmpegInstance.FS('readFile', outputName)\r\n    \r\n    // Limpiar archivos temporales\r\n    try {\r\n      ffmpegInstance.FS('unlink', 'input.mp4')\r\n      ffmpegInstance.FS('unlink', outputName)\r\n    } catch (e) {\r\n      console.warn('⚠️ No se pudieron limpiar archivos temporales')\r\n    }\r\n    \r\n    console.log('✅ Velocidad ajustada correctamente')\r\n    \r\n    return {\r\n      success: true,\r\n      data: data,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error al ajustar velocidad:', error)\r\n    return {\r\n      success: false,\r\n      data: null,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Concatenar múltiples videos\r\nexport const concatenateVideos = async (videoFiles, outputName = 'concatenated.mp4') => {\r\n  try {\r\n    console.log(`🎬 Concatenando ${videoFiles.length} videos...`)\r\n    \r\n    const ffmpegInstance = await initFFmpeg()\r\n    \r\n    // Verificar que FFmpeg esté correctamente inicializado\r\n    if (!ffmpegInstance || !ffmpegInstance.FS) {\r\n      throw new Error('FFmpeg no está correctamente inicializado')\r\n    }\r\n    \r\n    // Escribir archivos de entrada\r\n    for (let i = 0; i < videoFiles.length; i++) {\r\n      const fileName = `input${i}.mp4`\r\n      ffmpegInstance.FS('writeFile', fileName, await fetchFile(videoFiles[i]))\r\n    }\r\n    \r\n    // Crear archivo de lista para concatenación\r\n    const fileList = videoFiles.map((_, i) => `file input${i}.mp4`).join('\\n')\r\n    ffmpegInstance.FS('writeFile', 'filelist.txt', fileList)\r\n    \r\n    // Concatenar videos\r\n    await ffmpegInstance.run(\r\n      '-f', 'concat',\r\n      '-safe', '0',\r\n      '-i', 'filelist.txt',\r\n      '-c', 'copy',\r\n      outputName\r\n    )\r\n    \r\n    // Leer archivo de salida\r\n    const data = ffmpegInstance.FS('readFile', outputName)\r\n    \r\n    // Limpiar archivos temporales\r\n    for (let i = 0; i < videoFiles.length; i++) {\r\n      ffmpegInstance.FS('unlink', `input${i}.mp4`)\r\n    }\r\n    ffmpegInstance.FS('unlink', 'filelist.txt')\r\n    ffmpegInstance.FS('unlink', outputName)\r\n    \r\n    console.log('✅ Videos concatenados correctamente')\r\n    \r\n    return {\r\n      success: true,\r\n      data: data,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error al concatenar videos:', error)\r\n    return {\r\n      success: false,\r\n      data: null,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Procesar secuencia completa con ajuste de BPM\r\nexport const processVideoSequence = async (videos, targetBPM) => {\r\n  try {\r\n    console.log(`🎬 Procesando secuencia de ${videos.length} videos a ${targetBPM} BPM...`)\r\n    \r\n    const ffmpegInstance = await initFFmpeg()\r\n    const processedVideos = []\r\n    \r\n         // Procesar cada video individualmente\r\n     for (let i = 0; i < videos.length; i++) {\r\n       const video = videos[i]\r\n       const speedFactor = targetBPM / video.bpm\r\n       \r\n               console.log(`🎬 Procesando video ${i + 1}/${videos.length}: ${video.title} (BPM: ${video.bpm} → ${targetBPM}, factor: ${speedFactor.toFixed(2)}x)`)\r\n        \r\n        // Descargar video desde Firebase Storage si no tiene file\r\n        let videoBlob\r\n        if (video.file) {\r\n          videoBlob = video.file\r\n        } else if (video.videoUrl) {\r\n          console.log(`📥 Descargando video ${i + 1}/${videos.length} desde URL: ${video.videoUrl}`)\r\n          \r\n          try {\r\n            // Intentar descarga directa primero\r\n            const response = await fetch(video.videoUrl, {\r\n              mode: 'cors',\r\n              credentials: 'omit'\r\n            })\r\n            \r\n            if (!response.ok) {\r\n              throw new Error(`HTTP ${response.status}: ${response.statusText}`)\r\n            }\r\n            \r\n            videoBlob = await response.blob()\r\n            console.log(`✅ Video descargado exitosamente: ${videoBlob.size} bytes`)\r\n          } catch (fetchError) {\r\n            console.warn(`⚠️ Error en fetch directo: ${fetchError.message}`)\r\n            \r\n            // Si falla, intentar con Firebase Storage SDK\r\n            try {\r\n              const { getStorage, ref, getDownloadURL } = await import('firebase/storage')\r\n              const storage = getStorage()\r\n              \r\n              // Si videoUrl es una URL completa, extraer la ruta\r\n              let storagePath = video.videoUrl\r\n              if (video.videoUrl.includes('firebasestorage.googleapis.com')) {\r\n                // Extraer la ruta del bucket de la URL\r\n                const urlParts = video.videoUrl.split('/o/')\r\n                if (urlParts.length > 1) {\r\n                  storagePath = decodeURIComponent(urlParts[1].split('?')[0])\r\n                }\r\n              }\r\n              \r\n              const videoRef = ref(storage, storagePath)\r\n              const downloadURL = await getDownloadURL(videoRef)\r\n              \r\n              const response = await fetch(downloadURL)\r\n              if (!response.ok) {\r\n                throw new Error(`HTTP ${response.status}: ${response.statusText}`)\r\n              }\r\n              \r\n              videoBlob = await response.blob()\r\n              console.log(`✅ Video descargado via Firebase SDK: ${videoBlob.size} bytes`)\r\n            } catch (storageError) {\r\n              throw new Error(`Error descargando video ${i + 1} (${video.title}): ${storageError.message}`)\r\n            }\r\n          }\r\n        } else {\r\n          throw new Error(`Video ${i + 1} (${video.title}) no tiene archivo ni URL asociada`)\r\n        }\r\n        \r\n        // Ajustar velocidad del video\r\n       const result = await adjustVideoSpeed(videoBlob, speedFactor, `adjusted${i}.mp4`)\r\n       \r\n       if (!result.success) {\r\n         throw new Error(`Error al procesar video ${i + 1} (${video.title}): ${result.error}`)\r\n       }\r\n       \r\n       processedVideos.push(result.data)\r\n       console.log(`✅ Video ${i + 1} procesado correctamente`)\r\n     }\r\n    \r\n    // Concatenar todos los videos ajustados\r\n    console.log('🎬 Concatenando videos procesados...')\r\n    \r\n    // Escribir videos procesados\r\n    for (let i = 0; i < processedVideos.length; i++) {\r\n      ffmpegInstance.FS('writeFile', `processed${i}.mp4`, processedVideos[i])\r\n    }\r\n    \r\n    // Crear archivo de lista\r\n    const fileList = processedVideos.map((_, i) => `file processed${i}.mp4`).join('\\n')\r\n    ffmpegInstance.FS('writeFile', 'filelist.txt', fileList)\r\n    \r\n    // Concatenar\r\n    await ffmpegInstance.run(\r\n      '-f', 'concat',\r\n      '-safe', '0',\r\n      '-i', 'filelist.txt',\r\n      '-c', 'copy',\r\n      'final_sequence.mp4'\r\n    )\r\n    \r\n    // Leer resultado final\r\n    const finalData = ffmpegInstance.FS('readFile', 'final_sequence.mp4')\r\n    \r\n    // Limpiar archivos temporales\r\n    for (let i = 0; i < processedVideos.length; i++) {\r\n      try {\r\n        ffmpegInstance.FS('unlink', `processed${i}.mp4`)\r\n      } catch (e) {\r\n        console.warn(`⚠️ No se pudo limpiar archivo temporal processed${i}.mp4`)\r\n      }\r\n    }\r\n    try {\r\n      ffmpegInstance.FS('unlink', 'filelist.txt')\r\n      ffmpegInstance.FS('unlink', 'final_sequence.mp4')\r\n    } catch (e) {\r\n      console.warn('⚠️ No se pudieron limpiar algunos archivos temporales')\r\n    }\r\n    \r\n    console.log('✅ Secuencia procesada correctamente')\r\n    \r\n    return {\r\n      success: true,\r\n      data: finalData,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error al procesar secuencia:', error)\r\n    return {\r\n      success: false,\r\n      data: null,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Crear preview de secuencia (con o sin ajuste de BPM)\r\nexport const createSequencePreview = async (videos, useBPMControl = false, targetBPM = null) => {\r\n  try {\r\n    console.log(`🎬 Creando preview de secuencia con ${videos.length} videos...`)\r\n    console.log(`🎬 Control BPM: ${useBPMControl ? 'Activado' : 'Desactivado'}`)\r\n    if (useBPMControl && targetBPM) {\r\n      console.log(`🎬 BPM objetivo: ${targetBPM}`)\r\n    }\r\n    \r\n    const ffmpegInstance = await initFFmpeg()\r\n    const processedVideos = []\r\n    \r\n    // Optimización: Si no hay control BPM, procesar más rápido\r\n    const needsProcessing = useBPMControl && targetBPM\r\n    \r\n    // Procesar cada video según el estado del control BPM\r\n    for (let i = 0; i < videos.length; i++) {\r\n      const video = videos[i]\r\n      \r\n      // Descargar video desde Firebase Storage si no tiene file\r\n      let videoBlob\r\n      if (video.file) {\r\n        videoBlob = video.file\r\n        console.log(`✅ Video ${i + 1}/${videos.length}: ${video.title} (archivo local)`)\r\n      } else if (video.videoUrl) {\r\n        console.log(`📥 Descargando video ${i + 1}/${videos.length} desde URL...`)\r\n        \r\n        try {\r\n          // Intentar descarga directa primero\r\n          const response = await fetch(video.videoUrl, {\r\n            mode: 'cors',\r\n            credentials: 'omit',\r\n            headers: {\r\n              'Accept': 'video/*,*/*;q=0.9',\r\n              'Cache-Control': 'no-cache'\r\n            }\r\n          })\r\n          \r\n          if (!response.ok) {\r\n            throw new Error(`HTTP ${response.status}: ${response.statusText}`)\r\n          }\r\n          \r\n          videoBlob = await response.blob()\r\n          console.log(`✅ Video ${i + 1}/${videos.length}: ${video.title} descargado (${videoBlob.size} bytes)`)\r\n        } catch (fetchError) {\r\n          console.warn(`⚠️ Error en fetch directo: ${fetchError.message}`)\r\n          \r\n          // Si falla, intentar con Firebase Storage SDK\r\n          try {\r\n            const { getStorage, ref, getDownloadURL } = await import('firebase/storage')\r\n            const storage = getStorage()\r\n            \r\n            // Si videoUrl es una URL completa, extraer la ruta\r\n            let storagePath = video.videoUrl\r\n            if (video.videoUrl.includes('firebasestorage.googleapis.com')) {\r\n              // Extraer la ruta del bucket de la URL\r\n              const urlParts = video.videoUrl.split('/o/')\r\n              if (urlParts.length > 1) {\r\n                storagePath = decodeURIComponent(urlParts[1].split('?')[0])\r\n              }\r\n            }\r\n            \r\n            const videoRef = ref(storage, storagePath)\r\n            const downloadURL = await getDownloadURL(videoRef)\r\n            \r\n            const response = await fetch(downloadURL)\r\n            if (!response.ok) {\r\n              throw new Error(`HTTP ${response.status}: ${response.statusText}`)\r\n            }\r\n            \r\n            videoBlob = await response.blob()\r\n            console.log(`✅ Video ${i + 1}/${videos.length}: ${video.title} descargado via Firebase (${videoBlob.size} bytes)`)\r\n          } catch (storageError) {\r\n            throw new Error(`Error descargando video ${i + 1} (${video.title}): ${storageError.message}`)\r\n          }\r\n        }\r\n      } else {\r\n        throw new Error(`Video ${i + 1} (${video.title}) no tiene archivo ni URL asociada`)\r\n      }\r\n      \r\n      if (needsProcessing && video.bpm) {\r\n        // Ajustar velocidad según BPM\r\n        const speedFactor = targetBPM / video.bpm\r\n        console.log(`🎬 Procesando video ${i + 1}/${videos.length}: ${video.title} (BPM: ${video.bpm} → ${targetBPM}, factor: ${speedFactor.toFixed(2)}x)`)\r\n        \r\n        const result = await adjustVideoSpeed(videoBlob, speedFactor, `preview${i}.mp4`)\r\n        if (!result.success) {\r\n          throw new Error(`Error al procesar video ${i + 1} (${video.title}): ${result.error}`)\r\n        }\r\n        processedVideos.push(result.data)\r\n      } else {\r\n        // Usar video original sin ajuste (más rápido)\r\n        console.log(`🎬 Usando video ${i + 1}/${videos.length}: ${video.title} (sin procesamiento)`)\r\n        processedVideos.push(videoBlob)\r\n      }\r\n    }\r\n    \r\n         // Concatenar videos\r\n     console.log('🎬 Concatenando videos para preview...')\r\n     \r\n     // Escribir videos procesados\r\n     for (let i = 0; i < processedVideos.length; i++) {\r\n       const videoData = processedVideos[i]\r\n       // Si es un blob, convertirlo a Uint8Array, si ya es Uint8Array, usarlo directamente\r\n       const dataToWrite = videoData instanceof Blob ? await fetchFile(videoData) : videoData\r\n       ffmpegInstance.FS('writeFile', `preview${i}.mp4`, dataToWrite)\r\n       console.log(`📝 Video ${i + 1}/${processedVideos.length} escrito al sistema de archivos`)\r\n     }\r\n     \r\n     // Crear archivo de lista\r\n     const fileList = processedVideos.map((_, i) => `file preview${i}.mp4`).join('\\n')\r\n     ffmpegInstance.FS('writeFile', 'filelist.txt', fileList)\r\n     console.log('📋 Lista de archivos creada')\r\n     \r\n     // Concatenar (optimizado para velocidad)\r\n     console.log('🔗 Iniciando concatenación...')\r\n     await ffmpegInstance.run(\r\n       '-f', 'concat',\r\n       '-safe', '0',\r\n       '-i', 'filelist.txt',\r\n       '-c', 'copy',\r\n       '-avoid_negative_ts', 'make_zero',\r\n       'sequence_preview.mp4'\r\n     )\r\n     console.log('✅ Concatenación completada')\r\n    \r\n    // Leer resultado final\r\n    const finalData = ffmpegInstance.FS('readFile', 'sequence_preview.mp4')\r\n    \r\n    // Limpiar archivos temporales\r\n    for (let i = 0; i < processedVideos.length; i++) {\r\n      try {\r\n        ffmpegInstance.FS('unlink', `preview${i}.mp4`)\r\n      } catch (e) {\r\n        console.warn(`⚠️ No se pudo limpiar archivo temporal preview${i}.mp4`)\r\n      }\r\n    }\r\n    try {\r\n      ffmpegInstance.FS('unlink', 'filelist.txt')\r\n      ffmpegInstance.FS('unlink', 'sequence_preview.mp4')\r\n    } catch (e) {\r\n      console.warn('⚠️ No se pudieron limpiar algunos archivos temporales')\r\n    }\r\n    \r\n    console.log('✅ Preview de secuencia creado correctamente')\r\n    \r\n    return {\r\n      success: true,\r\n      data: finalData,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error al crear preview de secuencia:', error)\r\n    return {\r\n      success: false,\r\n      data: null,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Convertir video a diferentes formatos y resoluciones\r\nexport const convertVideoFormat = async (videoFile, format = 'mp4', resolution = '720p') => {\r\n  try {\r\n    console.log(`🎬 Convirtiendo video a formato ${format} con resolución ${resolution}...`)\r\n    \r\n    const ffmpegInstance = await initFFmpeg()\r\n    \r\n    // Escribir archivo de entrada\r\n    ffmpegInstance.FS('writeFile', 'input.mp4', await fetchFile(videoFile))\r\n    \r\n    // Configurar resolución y calidad\r\n    let resolutionSettings = []\r\n    let qualitySettings = []\r\n    \r\n    // Configurar resolución\r\n    switch (resolution) {\r\n      case '360p':\r\n        resolutionSettings = ['-vf', 'scale=-1:360']\r\n        qualitySettings = ['-crf', '28', '-preset', 'ultrafast']\r\n        break\r\n      case '480p':\r\n        resolutionSettings = ['-vf', 'scale=-1:480']\r\n        qualitySettings = ['-crf', '25', '-preset', 'fast']\r\n        break\r\n      case '720p':\r\n        resolutionSettings = ['-vf', 'scale=-1:720']\r\n        qualitySettings = ['-crf', '23', '-preset', 'fast']\r\n        break\r\n      case '1080p':\r\n        resolutionSettings = ['-vf', 'scale=-1:1080']\r\n        qualitySettings = ['-crf', '20', '-preset', 'medium']\r\n        break\r\n      case '4k':\r\n        resolutionSettings = ['-vf', 'scale=-1:2160']\r\n        qualitySettings = ['-crf', '18', '-preset', 'medium']\r\n        break\r\n      default:\r\n        resolutionSettings = ['-vf', 'scale=-1:720']\r\n        qualitySettings = ['-crf', '23', '-preset', 'fast']\r\n    }\r\n    \r\n    // Convertir formato\r\n    await ffmpegInstance.run(\r\n      '-i', 'input.mp4',\r\n      ...resolutionSettings,\r\n      ...qualitySettings,\r\n      `output.${format}`\r\n    )\r\n    \r\n    // Leer archivo de salida\r\n    const data = ffmpegInstance.FS('readFile', `output.${format}`)\r\n    \r\n    // Limpiar archivos temporales\r\n    ffmpegInstance.FS('unlink', 'input.mp4')\r\n    ffmpegInstance.FS('unlink', `output.${format}`)\r\n    \r\n    console.log('✅ Video convertido correctamente')\r\n    \r\n    return {\r\n      success: true,\r\n      data: data,\r\n      format: format,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error al convertir video:', error)\r\n    return {\r\n      success: false,\r\n      data: null,\r\n      format: null,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Descarga directa de secuencia sin FFmpeg (más rápida)\r\nexport const downloadSequenceDirect = async (sequence) => {\r\n  try {\r\n    console.log(`📥 Descarga directa de secuencia: ${sequence.name}`)\r\n    \r\n    if (!sequence.videos || sequence.videos.length === 0) {\r\n      throw new Error('La secuencia no tiene videos')\r\n    }\r\n    \r\n    // Si solo hay un video, descargarlo directamente\r\n    if (sequence.videos.length === 1) {\r\n      const video = sequence.videos[0]\r\n      if (video.file) {\r\n        return {\r\n          success: true,\r\n          data: video.file,\r\n          format: 'mp4',\r\n          error: null\r\n        }\r\n      } else if (video.videoUrl) {\r\n        const response = await fetch(video.videoUrl)\r\n        if (!response.ok) throw new Error('Error descargando video')\r\n        const blob = await response.blob()\r\n        return {\r\n          success: true,\r\n          data: blob,\r\n          format: 'mp4',\r\n          error: null\r\n        }\r\n      }\r\n    }\r\n    \r\n         // Para múltiples videos, crear un archivo ZIP con todos los videos\r\n     const JSZip = await import('jszip')\r\n     const zip = new JSZip.default()\r\n     \r\n     // Obtener nombre base de la secuencia (limpio para nombres de archivo)\r\n     const sequenceName = (sequence.name || sequence.title || 'secuencia')\r\n       .replace(/[^a-zA-Z0-9\\s]/g, '') // Remover caracteres especiales\r\n       .replace(/\\s+/g, '_') // Reemplazar espacios con guiones bajos\r\n       .toLowerCase()\r\n     \r\n     for (let i = 0; i < sequence.videos.length; i++) {\r\n       const video = sequence.videos[i]\r\n       let videoBlob\r\n       \r\n       if (video.file) {\r\n         videoBlob = video.file\r\n       } else if (video.videoUrl) {\r\n         const response = await fetch(video.videoUrl)\r\n         if (!response.ok) throw new Error(`Error descargando video ${i + 1}`)\r\n         videoBlob = await response.blob()\r\n       } else {\r\n         throw new Error(`Video ${i + 1} no tiene archivo ni URL`)\r\n       }\r\n       \r\n       // Nombrar archivo con formato: secuencia_1.mp4, secuencia_2.mp4, etc.\r\n       const fileName = `${sequenceName}_${i + 1}.mp4`\r\n       zip.file(fileName, videoBlob)\r\n       console.log(`📁 Agregando al ZIP: ${fileName}`)\r\n     }\r\n    \r\n    const zipBlob = await zip.generateAsync({ type: 'blob' })\r\n    return {\r\n      success: true,\r\n      data: zipBlob,\r\n      format: 'zip',\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error en descarga directa:', error)\r\n    return {\r\n      success: false,\r\n      data: null,\r\n      format: null,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Generar video final de secuencia para descarga\r\nexport const generateSequenceVideo = async (sequence, format = 'mp4', resolution = '720p') => {\r\n  try {\r\n    console.log(`🎬 Generando video de secuencia: ${sequence.name}`)\r\n    console.log(`📹 Formato: ${format}, Resolución: ${resolution}`)\r\n    \r\n    if (!sequence.videos || sequence.videos.length === 0) {\r\n      throw new Error('La secuencia no tiene videos')\r\n    }\r\n    \r\n    // Usar la configuración de BPM guardada en la secuencia\r\n    const useBPMControl = sequence.useBPMControl || false\r\n    const targetBPM = sequence.targetBPM || null\r\n    \r\n    console.log(`🎵 Configuración BPM: ${useBPMControl ? 'Activado' : 'Desactivado'}, BPM: ${targetBPM}`)\r\n    \r\n    // Si no hay control BPM, usar descarga directa (más rápida)\r\n    if (!useBPMControl || !targetBPM) {\r\n      console.log('🚀 Usando descarga directa (sin FFmpeg)')\r\n      return await downloadSequenceDirect(sequence)\r\n    }\r\n    \r\n    // Intentar inicializar FFmpeg con timeout\r\n    console.log('🎬 Intentando inicializar FFmpeg...')\r\n    const ffmpegPromise = initFFmpeg()\r\n    const timeoutPromise = new Promise((_, reject) => \r\n      setTimeout(() => reject(new Error('Timeout inicializando FFmpeg')), 10000)\r\n    )\r\n    \r\n    try {\r\n      await Promise.race([ffmpegPromise, timeoutPromise])\r\n    } catch (error) {\r\n      console.warn('⚠️ FFmpeg no pudo inicializarse, usando descarga directa')\r\n      return await downloadSequenceDirect(sequence)\r\n    }\r\n    \r\n    // Generar el video combinado con FFmpeg\r\n    const result = await createSequencePreview(sequence.videos, useBPMControl, targetBPM)\r\n    \r\n    if (!result.success) {\r\n      throw new Error(`Error generando video: ${result.error}`)\r\n    }\r\n    \r\n    // Si se requiere un formato específico o resolución diferente, convertir\r\n    if (format !== 'mp4' || resolution !== '720p') {\r\n      console.log(`🔄 Convirtiendo a formato ${format} con resolución ${resolution}...`)\r\n      const convertResult = await convertVideoFormat(\r\n        new Blob([result.data], { type: 'video/mp4' }), \r\n        format, \r\n        resolution\r\n      )\r\n      \r\n      if (!convertResult.success) {\r\n        throw new Error(`Error convirtiendo formato: ${convertResult.error}`)\r\n      }\r\n      \r\n      return {\r\n        success: true,\r\n        data: convertResult.data,\r\n        format: format,\r\n        error: null\r\n      }\r\n    }\r\n    \r\n    return {\r\n      success: true,\r\n      data: result.data,\r\n      format: 'mp4',\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error generando video de secuencia:', error)\r\n    return {\r\n      success: false,\r\n      data: null,\r\n      format: null,\r\n      error: error.message\r\n    }\r\n  }\r\n} ","import React, { useState } from 'react'\r\nimport { X, Download, Video, Settings, Check } from 'lucide-react'\r\nimport { convertVideoFormat, generateSequenceVideo } from '../../services/video/videoProcessor'\r\n\r\nconst DownloadModal = ({ isOpen, onClose, video, onDownloadComplete }) => {\r\n  const [format, setFormat] = useState('mp4')\r\n  const [resolution, setResolution] = useState('720p')\r\n  const [isProcessing, setIsProcessing] = useState(false)\r\n  const [progress, setProgress] = useState(0)\r\n  \r\n  // Opciones de formato\r\n  const formatOptions = [\r\n    { value: 'mp4', label: 'MP4', description: 'Formato estándar, compatible con todo' },\r\n    { value: 'avi', label: 'AVI', description: 'Formato clásico, buena calidad' },\r\n    { value: 'mov', label: 'MOV', description: 'Formato Apple, alta calidad' },\r\n    { value: 'webm', label: 'WebM', description: 'Formato web, archivos pequeños' }\r\n  ]\r\n  \r\n  // Opciones de resolución\r\n  const resolutionOptions = [\r\n    { value: '360p', label: '360p', description: 'Calidad baja, archivo pequeño' },\r\n    { value: '480p', label: '480p', description: 'Calidad estándar, balance' },\r\n    { value: '720p', label: '720p', description: 'HD, buena calidad' },\r\n    { value: '1080p', label: '1080p', description: 'Full HD, alta calidad' },\r\n    { value: '4k', label: '4K', description: 'Ultra HD, máxima calidad' }\r\n  ]\r\n  \r\n  // Obtener descripción del formato\r\n  const getFormatDescription = (formatValue) => {\r\n    const option = formatOptions.find(opt => opt.value === formatValue)\r\n    return option ? option.description : ''\r\n  }\r\n  \r\n  // Obtener descripción de la resolución\r\n  const getResolutionDescription = (resolutionValue) => {\r\n    const option = resolutionOptions.find(opt => opt.value === resolutionValue)\r\n    return option ? option.description : ''\r\n  }\r\n  \r\n  // Manejar descarga\r\n  const handleDownload = async () => {\r\n    if (!video) {\r\n      console.error('No hay video para descargar')\r\n      return\r\n    }\r\n    \r\n    setIsProcessing(true)\r\n    setProgress(0)\r\n    \r\n         try {\r\n       // Iniciando descarga\r\n      \r\n      // Simular progreso\r\n      const progressInterval = setInterval(() => {\r\n        setProgress(prev => {\r\n          if (prev >= 90) {\r\n            clearInterval(progressInterval)\r\n            return 90\r\n          }\r\n          return prev + 10\r\n        })\r\n      }, 500)\r\n      \r\n      let result\r\n      \r\n      try {\r\n        // Verificar si es una secuencia o un video individual\r\n        if (video.videos && Array.isArray(video.videos)) {\r\n          // Es una secuencia\r\n          // Procesando secuencia\r\n          result = await generateSequenceVideo(video, format, resolution)\r\n        } else if (video.file) {\r\n          // Es un video individual\r\n                      // Procesando video individual\r\n          result = await convertVideoFormat(video.file, format, resolution)\r\n        } else {\r\n          throw new Error('Formato de video no válido')\r\n        }\r\n        \r\n        // Limpiar intervalo y establecer progreso al 100%\r\n        clearInterval(progressInterval)\r\n        setProgress(100)\r\n        \r\n        // Pequeña pausa para mostrar el 100%\r\n        await new Promise(resolve => setTimeout(resolve, 200))\r\n      } catch (error) {\r\n        clearInterval(progressInterval)\r\n        throw error\r\n      }\r\n      \r\n                          if (result.success) {\r\n          // Crear blob y descargar\r\n          const mimeType = result.format === 'zip' ? 'application/zip' : `video/${result.format || format}`\r\n          const blob = new Blob([result.data], { type: mimeType })\r\n          \r\n          try {\r\n            const dirHandle = await selectDownloadFolder()\r\n            \r\n            if (dirHandle) {\r\n              // Usar File System Access API\r\n              const extension = result.format === 'zip' ? 'zip' : (result.format || format)\r\n              const fileName = `${video.title || video.name}_${resolution}.${extension}`\r\n              const fileHandle = await dirHandle.getFileHandle(fileName, { create: true })\r\n              const writable = await fileHandle.createWritable()\r\n              await writable.write(blob)\r\n              await writable.close()\r\n              // Archivo guardado exitosamente\r\n            } else {\r\n              // Descarga normal\r\n              const url = URL.createObjectURL(blob)\r\n              const a = document.createElement('a')\r\n              a.href = url\r\n              const extension = result.format === 'zip' ? 'zip' : (result.format || format)\r\n              a.download = `${video.title || video.name}_${resolution}.${extension}`\r\n              document.body.appendChild(a)\r\n              a.click()\r\n              document.body.removeChild(a)\r\n              URL.revokeObjectURL(url)\r\n              // Archivo descargado exitosamente\r\n            }\r\n            \r\n            onDownloadComplete && onDownloadComplete()\r\n            onClose()\r\n          } catch (error) {\r\n            console.error('Error al guardar archivo:', error)\r\n            throw new Error('Error al guardar el archivo')\r\n          }\r\n        } else {\r\n          throw new Error(result.error)\r\n        }\r\n    } catch (error) {\r\n      console.error('❌ Error al descargar video:', error)\r\n      alert(`Error al procesar video: ${error.message}`)\r\n    } finally {\r\n      setIsProcessing(false)\r\n      setProgress(0)\r\n    }\r\n  }\r\n  \r\n  // Función para elegir carpeta de descarga\r\n  const selectDownloadFolder = async () => {\r\n    try {\r\n      // Verificar si la API de File System Access está disponible\r\n      if ('showDirectoryPicker' in window) {\r\n        const dirHandle = await window.showDirectoryPicker()\r\n        return dirHandle\r\n      } else {\r\n        // Fallback: usar descarga normal\r\n        // API de File System Access no disponible, usando descarga normal\r\n        return null\r\n      }\r\n    } catch (error) {\r\n              // Usuario canceló la selección de carpeta o error\r\n      return null\r\n    }\r\n  }\r\n\r\n  // Descarga directa (sin conversión)\r\n  const handleDirectDownload = async () => {\r\n    if (!video || !video.file) {\r\n      console.error('No hay video para descargar')\r\n      return\r\n    }\r\n    \r\n    try {\r\n      const dirHandle = await selectDownloadFolder()\r\n      \r\n      if (dirHandle) {\r\n        // Usar File System Access API\r\n        const fileName = `${video.title || video.name}.mp4`\r\n        const fileHandle = await dirHandle.getFileHandle(fileName, { create: true })\r\n        const writable = await fileHandle.createWritable()\r\n        await writable.write(video.file)\r\n        await writable.close()\r\n                    // Archivo guardado exitosamente\r\n      } else {\r\n        // Descarga normal\r\n        const url = URL.createObjectURL(video.file)\r\n        const a = document.createElement('a')\r\n        a.href = url\r\n        a.download = video.title || 'video'\r\n        document.body.appendChild(a)\r\n        a.click()\r\n        document.body.removeChild(a)\r\n        URL.revokeObjectURL(url)\r\n      }\r\n      \r\n      onClose()\r\n    } catch (error) {\r\n      console.error('Error en descarga directa:', error)\r\n      alert('Error al descargar el archivo')\r\n    }\r\n  }\r\n  \r\n  if (!isOpen) return null\r\n  \r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\r\n          <div className=\"flex items-center space-x-2\">\r\n            <Download className=\"h-5 w-5 text-blue-600\" />\r\n            <h2 className=\"text-lg font-semibold text-gray-800\">\r\n              {video?.videos ? 'Descargar Secuencia' : 'Descargar Video'}\r\n            </h2>\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-gray-600 transition-colors\"\r\n          >\r\n            <X className=\"h-5 w-5\" />\r\n          </button>\r\n        </div>\r\n        \r\n        {/* Content */}\r\n        <div className=\"p-6 space-y-6\">\r\n          {/* Video/Sequence Info */}\r\n          <div className=\"bg-gray-50 rounded-lg p-4\">\r\n            <div className=\"flex items-center space-x-3\">\r\n              <Video className=\"h-8 w-8 text-gray-400\" />\r\n              <div className=\"flex-1 min-w-0\">\r\n                <h3 className=\"font-medium text-gray-800 truncate\">\r\n                  {video?.title || video?.name || 'Sin título'}\r\n                </h3>\r\n                {video?.videos ? (\r\n                  // Información de secuencia\r\n                  <div className=\"space-y-1\">\r\n                    <p className=\"text-sm text-gray-500\">\r\n                      {video.videos.length} videos • Duración aproximada: {Math.floor(video.videos.length * 30 / 60)}:{(video.videos.length * 30 % 60).toString().padStart(2, '0')}\r\n                    </p>\r\n                    {video.useBPMControl && video.targetBPM && (\r\n                      <p className=\"text-sm text-purple-600\">\r\n                        BPM ajustado: {video.targetBPM}\r\n                      </p>\r\n                    )}\r\n                    {video.description && (\r\n                      <p className=\"text-sm text-gray-600\">\r\n                        {video.description}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                ) : (\r\n                  // Información de video individual\r\n                  <div className=\"space-y-1\">\r\n                    <p className=\"text-sm text-gray-500\">\r\n                      {video?.fileSize ? `${(video.fileSize / (1024 * 1024)).toFixed(2)} MB` : 'Tamaño desconocido'}\r\n                    </p>\r\n                    {video?.bpm && (\r\n                      <p className=\"text-sm text-purple-600\">\r\n                        BPM: {video.bpm}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Format Selection */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-3\">\r\n              Formato de salida\r\n            </label>\r\n            <div className=\"space-y-2\">\r\n              {formatOptions.map(option => (\r\n                <label\r\n                  key={option.value}\r\n                  className={`flex items-center p-3 border rounded-lg cursor-pointer transition-colors ${\r\n                    format === option.value\r\n                      ? 'border-blue-500 bg-blue-50'\r\n                      : 'border-gray-200 hover:border-gray-300'\r\n                  }`}\r\n                >\r\n                  <input\r\n                    type=\"radio\"\r\n                    name=\"format\"\r\n                    value={option.value}\r\n                    checked={format === option.value}\r\n                    onChange={(e) => setFormat(e.target.value)}\r\n                    className=\"sr-only\"\r\n                  />\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <div className={`w-4 h-4 rounded-full border-2 flex items-center justify-center ${\r\n                      format === option.value\r\n                        ? 'border-blue-500 bg-blue-500'\r\n                        : 'border-gray-300'\r\n                    }`}>\r\n                      {format === option.value && (\r\n                        <div className=\"w-2 h-2 rounded-full bg-white\"></div>\r\n                      )}\r\n                    </div>\r\n                    <div>\r\n                      <div className=\"font-medium text-gray-800\">{option.label}</div>\r\n                      <div className=\"text-sm text-gray-500\">{option.description}</div>\r\n                    </div>\r\n                  </div>\r\n                </label>\r\n              ))}\r\n            </div>\r\n          </div>\r\n          \r\n                     {/* Resolution Selection */}\r\n           <div>\r\n             <label className=\"block text-sm font-medium text-gray-700 mb-3\">\r\n               Resolución\r\n             </label>\r\n             <div className=\"space-y-2\">\r\n               {resolutionOptions.map(option => (\r\n                 <label\r\n                   key={option.value}\r\n                   className={`flex items-center p-3 border rounded-lg cursor-pointer transition-colors ${\r\n                     resolution === option.value\r\n                       ? 'border-blue-500 bg-blue-50'\r\n                       : 'border-gray-200 hover:border-gray-300'\r\n                   }`}\r\n                 >\r\n                   <input\r\n                     type=\"radio\"\r\n                     name=\"resolution\"\r\n                     value={option.value}\r\n                     checked={resolution === option.value}\r\n                     onChange={(e) => setResolution(e.target.value)}\r\n                     className=\"sr-only\"\r\n                   />\r\n                   <div className=\"flex items-center space-x-3\">\r\n                     <div className={`w-4 h-4 rounded-full border-2 flex items-center justify-center ${\r\n                       resolution === option.value\r\n                         ? 'border-blue-500 bg-blue-500'\r\n                         : 'border-gray-300'\r\n                     }`}>\r\n                       {resolution === option.value && (\r\n                         <div className=\"w-2 h-2 rounded-full bg-white\"></div>\r\n                       )}\r\n                     </div>\r\n                     <div>\r\n                       <div className=\"font-medium text-gray-800\">{option.label}</div>\r\n                       <div className=\"text-sm text-gray-500\">{option.description}</div>\r\n                     </div>\r\n                   </div>\r\n                 </label>\r\n               ))}\r\n             </div>\r\n           </div>\r\n          \r\n          {/* Progress Bar */}\r\n          {isProcessing && (\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex justify-between text-sm text-gray-600\">\r\n                <span>Procesando video...</span>\r\n                <span>{progress}%</span>\r\n              </div>\r\n              <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n                <div\r\n                  className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\r\n                  style={{ width: `${progress}%` }}\r\n                ></div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Footer */}\r\n        <div className=\"flex items-center justify-between p-6 border-t border-gray-200\">\r\n          <button\r\n            onClick={handleDirectDownload}\r\n            disabled={isProcessing}\r\n            className=\"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors\"\r\n          >\r\n            Descargar original\r\n          </button>\r\n          \r\n          <div className=\"flex space-x-3\">\r\n            <button\r\n              onClick={onClose}\r\n              disabled={isProcessing}\r\n              className=\"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors\"\r\n            >\r\n              Cancelar\r\n            </button>\r\n            <button\r\n              onClick={handleDownload}\r\n              disabled={isProcessing}\r\n              className={`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${\r\n                isProcessing\r\n                  ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\r\n                  : 'bg-blue-600 text-white hover:bg-blue-700'\r\n              }`}\r\n            >\r\n              {isProcessing ? 'Procesando...' : 'Descargar'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default DownloadModal ","import { X, AlertTriangle } from 'lucide-react'\r\n\r\nconst ConfirmModal = ({ \r\n  isOpen, \r\n  onClose, \r\n  onConfirm, \r\n  title = 'Confirmar acción', \r\n  message = '¿Estás seguro de que quieres realizar esta acción?',\r\n  confirmText = 'Confirmar',\r\n  cancelText = 'Cancelar',\r\n  type = 'warning'\r\n}) => {\r\n  if (!isOpen) return null\r\n\r\n  const getIcon = () => {\r\n    switch (type) {\r\n      case 'danger':\r\n        return <AlertTriangle className=\"w-8 h-8 text-red-500\" />\r\n      case 'warning':\r\n        return <AlertTriangle className=\"w-8 h-8 text-orange-500\" />\r\n      case 'info':\r\n        return <AlertTriangle className=\"w-8 h-8 text-blue-500\" />\r\n      default:\r\n        return <AlertTriangle className=\"w-8 h-8 text-orange-500\" />\r\n    }\r\n  }\r\n\r\n  const getConfirmButtonStyle = () => {\r\n    switch (type) {\r\n      case 'danger':\r\n        return 'bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600'\r\n      case 'warning':\r\n        return 'bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600'\r\n      case 'info':\r\n        return 'bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600'\r\n      default:\r\n        return 'bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600'\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\r\n      {/* Overlay */}\r\n      <div \r\n        className=\"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm\"\r\n        onClick={onClose}\r\n      />\r\n      \r\n      {/* Modal */}\r\n      <div className=\"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\r\n          <div className=\"flex items-center space-x-3\">\r\n            {getIcon()}\r\n            <h3 className=\"text-lg font-semibold text-gray-900\">{title}</h3>\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-gray-600 transition-colors\"\r\n          >\r\n            <X className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <div className=\"p-6\">\r\n          <div className=\"text-gray-600 leading-relaxed whitespace-pre-line\">{message}</div>\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"flex items-center justify-end space-x-3 p-6 border-t border-gray-200\">\r\n          <button\r\n            onClick={onClose}\r\n            className=\"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors font-medium\"\r\n          >\r\n            {cancelText}\r\n          </button>\r\n          <button\r\n            onClick={() => {\r\n              onConfirm()\r\n              onClose()\r\n            }}\r\n            className={`px-4 py-2 text-white rounded-lg transition-all font-medium ${getConfirmButtonStyle()}`}\r\n          >\r\n            {confirmText}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ConfirmModal ","// 🎬 SERVICIOS DE FIREBASE PARA SECUENCIAS - SALSAHACKS V2.0\r\n\r\nimport { \r\n  collection, \r\n  addDoc, \r\n  updateDoc, \r\n  deleteDoc, \r\n  doc, \r\n  getDocs, \r\n  query, \r\n  where, \r\n  orderBy,\r\n  onSnapshot,\r\n  serverTimestamp \r\n} from 'firebase/firestore'\r\nimport { db } from './config'\r\n\r\nconst SEQUENCES_COLLECTION = 'sequences'\r\n\r\n// Crear una nueva secuencia\r\nexport const createSequence = async (sequenceData) => {\r\n  console.log('🔥 Firebase: Creando secuencia...')\r\n  console.log('📦 Datos de secuencia:', sequenceData)\r\n  \r\n  try {\r\n    const sequenceWithTimestamp = {\r\n      ...sequenceData,\r\n      createdAt: serverTimestamp(),\r\n      updatedAt: serverTimestamp()\r\n    }\r\n    \r\n    console.log('⏰ Secuencia con timestamps:', sequenceWithTimestamp)\r\n    const docRef = await addDoc(collection(db, SEQUENCES_COLLECTION), sequenceWithTimestamp)\r\n    console.log('📄 Documento creado con ID:', docRef.id)\r\n    \r\n    const result = {\r\n      id: docRef.id,\r\n      ...sequenceData,\r\n      createdAt: new Date().toISOString(),\r\n      updatedAt: new Date().toISOString()\r\n    }\r\n    \r\n    console.log('✅ Secuencia creada exitosamente:', result)\r\n    return result\r\n  } catch (error) {\r\n    console.error('❌ Error al crear secuencia:', error)\r\n    throw new Error('No se pudo crear la secuencia')\r\n  }\r\n}\r\n\r\n// Obtener todas las secuencias\r\nexport const getSequences = async () => {\r\n  try {\r\n    const q = query(\r\n      collection(db, SEQUENCES_COLLECTION),\r\n      orderBy('createdAt', 'desc')\r\n    )\r\n    \r\n    const querySnapshot = await getDocs(q)\r\n    const sequences = []\r\n    \r\n    querySnapshot.forEach((doc) => {\r\n      const data = doc.data()\r\n      sequences.push({\r\n        id: doc.id,\r\n        ...data,\r\n        createdAt: data.createdAt?.toDate?.()?.toISOString() || data.createdAt,\r\n        updatedAt: data.updatedAt?.toDate?.()?.toISOString() || data.updatedAt\r\n      })\r\n    })\r\n    \r\n    return sequences\r\n  } catch (error) {\r\n    console.error('Error al obtener secuencias:', error)\r\n    throw new Error('No se pudieron obtener las secuencias')\r\n  }\r\n}\r\n\r\n// Obtener secuencias por estilo\r\nexport const getSequencesByStyle = async (style) => {\r\n  try {\r\n    const q = query(\r\n      collection(db, SEQUENCES_COLLECTION),\r\n      where('style', '==', style),\r\n      orderBy('createdAt', 'desc')\r\n    )\r\n    \r\n    const querySnapshot = await getDocs(q)\r\n    const sequences = []\r\n    \r\n    querySnapshot.forEach((doc) => {\r\n      const data = doc.data()\r\n      sequences.push({\r\n        id: doc.id,\r\n        ...data,\r\n        createdAt: data.createdAt?.toDate?.()?.toISOString() || data.createdAt,\r\n        updatedAt: data.updatedAt?.toDate?.()?.toISOString() || data.updatedAt\r\n      })\r\n    })\r\n    \r\n    return sequences\r\n  } catch (error) {\r\n    console.error('Error al obtener secuencias por estilo:', error)\r\n    throw new Error('No se pudieron obtener las secuencias')\r\n  }\r\n}\r\n\r\n// Actualizar una secuencia\r\nexport const updateSequence = async (sequenceId, updateData) => {\r\n  try {\r\n    const sequenceRef = doc(db, SEQUENCES_COLLECTION, sequenceId)\r\n    const updateWithTimestamp = {\r\n      ...updateData,\r\n      updatedAt: serverTimestamp()\r\n    }\r\n    \r\n    await updateDoc(sequenceRef, updateWithTimestamp)\r\n    \r\n    return {\r\n      id: sequenceId,\r\n      ...updateData,\r\n      updatedAt: new Date().toISOString()\r\n    }\r\n  } catch (error) {\r\n    console.error('Error al actualizar secuencia:', error)\r\n    throw new Error('No se pudo actualizar la secuencia')\r\n  }\r\n}\r\n\r\n// Eliminar una secuencia\r\nexport const deleteSequence = async (sequenceId) => {\r\n  try {\r\n    const sequenceRef = doc(db, SEQUENCES_COLLECTION, sequenceId)\r\n    await deleteDoc(sequenceRef)\r\n    \r\n    return { success: true }\r\n  } catch (error) {\r\n    console.error('Error al eliminar secuencia:', error)\r\n    throw new Error('No se pudo eliminar la secuencia')\r\n  }\r\n}\r\n\r\n// Suscribirse a cambios en tiempo real de secuencias\r\nexport const subscribeToSequences = (callback) => {\r\n  try {\r\n    const q = query(\r\n      collection(db, SEQUENCES_COLLECTION),\r\n      orderBy('createdAt', 'desc')\r\n    )\r\n    \r\n    return onSnapshot(q, (querySnapshot) => {\r\n      const sequences = []\r\n      \r\n      querySnapshot.forEach((doc) => {\r\n        const data = doc.data()\r\n        sequences.push({\r\n          id: doc.id,\r\n          ...data,\r\n          createdAt: data.createdAt?.toDate?.()?.toISOString() || data.createdAt,\r\n          updatedAt: data.updatedAt?.toDate?.()?.toISOString() || data.updatedAt\r\n        })\r\n      })\r\n      \r\n      callback(sequences)\r\n    })\r\n  } catch (error) {\r\n    console.error('Error al suscribirse a secuencias:', error)\r\n    throw new Error('No se pudo suscribir a las secuencias')\r\n  }\r\n}\r\n\r\n// Suscribirse a cambios en tiempo real de secuencias por estilo\r\nexport const subscribeToSequencesByStyle = (style, callback) => {\r\n  console.log('🎬 Firebase: Suscribiéndose a secuencias para estilo:', style)\r\n  \r\n  try {\r\n    const q = query(\r\n      collection(db, SEQUENCES_COLLECTION),\r\n      where('style', '==', style),\r\n      orderBy('createdAt', 'desc')\r\n    )\r\n    \r\n    return onSnapshot(q, (querySnapshot) => {\r\n      console.log(`🎬 Firebase: Actualización recibida - ${querySnapshot.size} secuencias para ${style}`)\r\n      \r\n      const sequences = []\r\n      \r\n      querySnapshot.forEach((doc) => {\r\n        const data = doc.data()\r\n        const sequence = {\r\n          id: doc.id,\r\n          ...data,\r\n          createdAt: data.createdAt?.toDate?.()?.toISOString() || data.createdAt,\r\n          updatedAt: data.updatedAt?.toDate?.()?.toISOString() || data.updatedAt\r\n        }\r\n        sequences.push(sequence)\r\n        console.log(`📋 Secuencia cargada: ${sequence.name} (${sequence.videos?.length || 0} videos)`)\r\n      })\r\n      \r\n      console.log(`🎉 Total de secuencias cargadas: ${sequences.length}`)\r\n      callback(sequences)\r\n    })\r\n  } catch (error) {\r\n    console.error('❌ Error al suscribirse a secuencias por estilo:', error)\r\n    throw new Error('No se pudo suscribir a las secuencias')\r\n  }\r\n}\r\n\r\n// Buscar secuencias por nombre o descripción\r\nexport const searchSequences = async (searchTerm) => {\r\n  try {\r\n    const allSequences = await getSequences()\r\n    \r\n    const normalizedSearchTerm = searchTerm.toLowerCase().trim()\r\n    \r\n    return allSequences.filter(sequence => {\r\n      const name = sequence.name?.toLowerCase() || ''\r\n      const description = sequence.description?.toLowerCase() || ''\r\n      \r\n      return name.includes(normalizedSearchTerm) || \r\n             description.includes(normalizedSearchTerm)\r\n    })\r\n  } catch (error) {\r\n    console.error('Error al buscar secuencias:', error)\r\n    throw new Error('No se pudo buscar las secuencias')\r\n  }\r\n}\r\n\r\n// Obtener estadísticas de secuencias\r\nexport const getSequenceStats = async () => {\r\n  try {\r\n    const sequences = await getSequences()\r\n    \r\n    const stats = {\r\n      total: sequences.length,\r\n      byStyle: {},\r\n      averageVideosPerSequence: 0,\r\n      totalVideos: 0\r\n    }\r\n    \r\n    sequences.forEach(sequence => {\r\n      // Contar por estilo\r\n      const style = sequence.style || 'unknown'\r\n      stats.byStyle[style] = (stats.byStyle[style] || 0) + 1\r\n      \r\n      // Contar videos totales\r\n      stats.totalVideos += sequence.videos?.length || 0\r\n    })\r\n    \r\n    // Calcular promedio\r\n    if (stats.total > 0) {\r\n      stats.averageVideosPerSequence = Math.round(stats.totalVideos / stats.total)\r\n    }\r\n    \r\n    return stats\r\n  } catch (error) {\r\n    console.error('Error al obtener estadísticas de secuencias:', error)\r\n    throw new Error('No se pudieron obtener las estadísticas')\r\n  }\r\n} ","// 🎬 HOOK PARA DRAG AND DROP - SALSAHACKS V2.0\r\n\r\nimport { useState, useCallback } from 'react'\r\n\r\nexport const useDragAndDrop = (onReorder) => {\r\n  const [draggedIndex, setDraggedIndex] = useState(null)\r\n  const [dragOverIndex, setDragOverIndex] = useState(null)\r\n\r\n  const handleDragStart = useCallback((index) => {\r\n    setDraggedIndex(index)\r\n  }, [])\r\n\r\n  const handleDragOver = useCallback((e, index) => {\r\n    e.preventDefault()\r\n    setDragOverIndex(index)\r\n  }, [])\r\n\r\n  const handleDragEnter = useCallback((e, index) => {\r\n    e.preventDefault()\r\n    setDragOverIndex(index)\r\n  }, [])\r\n\r\n  const handleDragLeave = useCallback((e) => {\r\n    e.preventDefault()\r\n    setDragOverIndex(null)\r\n  }, [])\r\n\r\n  const handleDrop = useCallback((e, dropIndex) => {\r\n    e.preventDefault()\r\n    \r\n    if (draggedIndex !== null && draggedIndex !== dropIndex) {\r\n      onReorder(draggedIndex, dropIndex)\r\n    }\r\n    \r\n    setDraggedIndex(null)\r\n    setDragOverIndex(null)\r\n  }, [draggedIndex, onReorder])\r\n\r\n  const handleDragEnd = useCallback(() => {\r\n    setDraggedIndex(null)\r\n    setDragOverIndex(null)\r\n  }, [])\r\n\r\n  const getDragStyles = useCallback((index) => {\r\n    const styles = {\r\n      cursor: 'grab',\r\n      transition: 'all 0.2s ease',\r\n      transform: 'scale(1)',\r\n      opacity: 1\r\n    }\r\n\r\n    if (draggedIndex === index) {\r\n      styles.cursor = 'grabbing'\r\n      styles.transform = 'scale(1.05) rotate(2deg)'\r\n      styles.opacity = 0.7\r\n      styles.zIndex = 1000\r\n    }\r\n\r\n    if (dragOverIndex === index && draggedIndex !== index) {\r\n      styles.transform = 'scale(1.02)'\r\n      styles.borderLeft = '4px solid #3b82f6'\r\n      styles.backgroundColor = '#f0f9ff'\r\n    }\r\n\r\n    return styles\r\n  }, [draggedIndex, dragOverIndex])\r\n\r\n  return {\r\n    draggedIndex,\r\n    dragOverIndex,\r\n    handleDragStart,\r\n    handleDragOver,\r\n    handleDragEnter,\r\n    handleDragLeave,\r\n    handleDrop,\r\n    handleDragEnd,\r\n    getDragStyles\r\n  }\r\n} ","import React, { useState, useRef, useEffect } from 'react'\nimport { \n  Play, \n  Pause, \n  Volume2, \n  VolumeX, \n  RotateCcw, \n  RotateCw, \n  Maximize, \n  Minimize, \n  SkipBack, \n  SkipForward,\n  Download,\n  Settings\n} from 'lucide-react'\n\nconst SequenceVideoPlayer = ({ \n  videos, \n  currentBPM = null,\n  className = '',\n  showControls = true,\n  autoplay = false,\n  loop = false,\n  muted = false\n}) => {\n  const [currentVideoIndex, setCurrentVideoIndex] = useState(0)\n  const [isPlaying, setIsPlaying] = useState(false)\n  const [isMuted, setIsMuted] = useState(muted)\n  const [isFullscreen, setIsFullscreen] = useState(false)\n  const [showControlsUI, setShowControlsUI] = useState(showControls)\n  const [currentTime, setCurrentTime] = useState(0)\n  const [duration, setDuration] = useState(0)\n  const [playbackRate, setPlaybackRate] = useState(1)\n  const [volume, setVolume] = useState(1)\n  const [showVolumeSlider, setShowVolumeSlider] = useState(false)\n  const [volumeSliderTimeout, setVolumeSliderTimeout] = useState(null)\n  const [isLoopEnabled, setIsLoopEnabled] = useState(false)\n  const [loopStart, setLoopStart] = useState(0)\n  const [loopEnd, setLoopEnd] = useState(0)\n  const [isLoopSegmentMode, setIsLoopSegmentMode] = useState(false)\n  const [hasPointA, setHasPointA] = useState(false)\n  const [hasPointB, setHasPointB] = useState(false)\n  const [savedPointA, setSavedPointA] = useState(0)\n  const [savedPointB, setSavedPointB] = useState(0)\n  const [controlsTimeout, setControlsTimeout] = useState(null)\n  const [showSpeedMenu, setShowSpeedMenu] = useState(false)\n  const [manualPlaybackSpeed, setManualPlaybackSpeed] = useState(1)\n  const [useManualSpeed, setUseManualSpeed] = useState(true)\n  \n  const videoRef = useRef(null)\n  const containerRef = useRef(null)\n  \n  const currentVideo = videos[currentVideoIndex]\n  \n  // Velocidades disponibles\n  const availableSpeeds = [0.25, 0.5, 0.75, 1, 1.25, 1.5, 2]\n\n  // Velocidad fija en 1x (sin ajuste automático de BPM)\n  useEffect(() => {\n    setPlaybackRate(1)\n    if (videoRef.current) {\n      videoRef.current.playbackRate = 1\n    }\n  }, [currentVideoIndex])\n\n\n\n  // Manejar bucle de segmento\n  useEffect(() => {\n    if (videoRef.current && isLoopSegmentMode && isPlaying && hasPointA && hasPointB) {\n      const video = videoRef.current\n      const checkLoopSegment = () => {\n        if (video.currentTime >= loopEnd) {\n          video.currentTime = loopStart\n        }\n      }\n      \n      video.addEventListener('timeupdate', checkLoopSegment)\n      return () => video.removeEventListener('timeupdate', checkLoopSegment)\n    }\n  }, [isLoopSegmentMode, loopStart, loopEnd, isPlaying, hasPointA, hasPointB])\n\n  // Auto-hide controls\n  useEffect(() => {\n    if (showControls && isPlaying) {\n      if (controlsTimeout) {\n        clearTimeout(controlsTimeout)\n      }\n      const timeout = setTimeout(() => {\n        setShowControlsUI(false)\n      }, 4000)\n      setControlsTimeout(timeout)\n    }\n    return () => {\n      if (controlsTimeout) {\n        clearTimeout(controlsTimeout)\n      }\n    }\n  }, [isPlaying, showControls])\n\n  // Cleanup timeouts al desmontar\n  useEffect(() => {\n    return () => {\n      if (controlsTimeout) clearTimeout(controlsTimeout)\n      if (volumeSliderTimeout) clearTimeout(volumeSliderTimeout)\n    }\n  }, [])\n\n  // Cerrar menús al hacer clic fuera\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (showSpeedMenu) {\n        setShowSpeedMenu(false)\n      }\n    }\n\n    document.addEventListener('click', handleClickOutside)\n    return () => document.removeEventListener('click', handleClickOutside)\n  }, [showSpeedMenu])\n\n  // Función helper para activar controles\n  const activateControls = () => {\n    setShowControlsUI(true)\n    if (controlsTimeout) {\n      clearTimeout(controlsTimeout)\n    }\n  }\n\n  // Handle video end\n  const handleVideoEnd = () => {\n    if (isLoopEnabled && !isLoopSegmentMode) {\n      // Loop completo\n      if (videoRef.current) {\n        videoRef.current.currentTime = 0\n        videoRef.current.play()\n      }\n    } else if (isLoopSegmentMode && hasPointA && hasPointB) {\n      // Loop de segmento\n      if (videoRef.current) {\n        videoRef.current.currentTime = loopStart\n        videoRef.current.play()\n      }\n    } else {\n      // No cambiar automáticamente al siguiente video\n      // Solo pausar el video actual\n      setIsPlaying(false)\n    }\n  }\n  \n  // Handle time update\n  const handleTimeUpdate = () => {\n    if (videoRef.current) {\n      setCurrentTime(videoRef.current.currentTime)\n    }\n  }\n  \n  // Handle loaded metadata\n  const handleLoadedMetadata = () => {\n    if (videoRef.current) {\n      setDuration(videoRef.current.duration)\n      // Aplicar velocidad manual\n      videoRef.current.playbackRate = manualPlaybackSpeed\n      setPlaybackRate(manualPlaybackSpeed)\n    }\n  }\n  \n  // Toggle play/pause\n  const togglePlay = () => {\n    if (videoRef.current) {\n      if (isPlaying) {\n        videoRef.current.pause()\n      } else {\n        videoRef.current.play()\n      }\n      setIsPlaying(!isPlaying)\n    }\n  }\n  \n  // Navigate to previous video\n  const goToPreviousVideo = () => {\n    if (currentVideoIndex > 0) {\n      setCurrentVideoIndex(prev => prev - 1)\n      setCurrentTime(0)\n      if (videoRef.current) {\n        videoRef.current.currentTime = 0\n      }\n    }\n  }\n  \n  // Navigate to next video\n  const goToNextVideo = () => {\n    if (currentVideoIndex < videos.length - 1) {\n      setCurrentVideoIndex(prev => prev + 1)\n      setCurrentTime(0)\n      if (videoRef.current) {\n        videoRef.current.currentTime = 0\n      }\n    }\n  }\n\n  // Skip function\n  const skip = (seconds) => {\n    if (videoRef.current) {\n      const newTime = Math.max(0, Math.min(duration, currentTime + seconds))\n      videoRef.current.currentTime = newTime\n      setCurrentTime(newTime)\n    }\n  }\n  \n  // Toggle mute\n  const toggleMute = () => {\n    if (videoRef.current) {\n      const newMutedState = !isMuted\n      videoRef.current.muted = newMutedState\n      setIsMuted(newMutedState)\n      \n      if (newMutedState) {\n        // Al mutear, guardar el volumen actual y ponerlo en 0\n        videoRef.current.volume = 0\n      } else {\n        // Al desmutear, restaurar el volumen\n        videoRef.current.volume = volume\n      }\n    }\n  }\n\n  const handleVolumeChange = (e) => {\n    const newVolume = parseFloat(e.target.value)\n    \n    if (videoRef.current) {\n      videoRef.current.volume = newVolume\n      setVolume(newVolume)\n      \n      // Si el volumen es 0, mutear. Si no, desmutear\n      if (newVolume === 0) {\n        videoRef.current.muted = true\n        setIsMuted(true)\n      } else {\n        videoRef.current.muted = false\n        setIsMuted(false)\n      }\n    }\n  }\n  \n  // Toggle fullscreen\n  const toggleFullscreen = () => {\n    try {\n      if (!document.fullscreenElement) {\n        if (containerRef.current.requestFullscreen) {\n          containerRef.current.requestFullscreen()\n        } else if (containerRef.current.webkitRequestFullscreen) {\n          containerRef.current.webkitRequestFullscreen()\n        } else if (containerRef.current.msRequestFullscreen) {\n          containerRef.current.msRequestFullscreen()\n        }\n        setIsFullscreen(true)\n      } else {\n        if (document.exitFullscreen) {\n          document.exitFullscreen()\n        } else if (document.webkitExitFullscreen) {\n          document.webkitExitFullscreen()\n        } else if (document.msExitFullscreen) {\n          document.msExitFullscreen()\n        }\n        setIsFullscreen(false)\n      }\n    } catch (error) {\n      console.error('Error toggling fullscreen:', error)\n    }\n  }\n  \n  // Handle progress bar click\n  const handleProgressClick = (e) => {\n    if (videoRef.current) {\n      const rect = e.currentTarget.getBoundingClientRect()\n      const clickX = e.clientX - rect.left\n      const percentage = clickX / rect.width\n      const newTime = percentage * duration\n      videoRef.current.currentTime = newTime\n      setCurrentTime(newTime)\n    }\n  }\n\n  const setLoopPoint = (type) => {\n    if (type === 'start') {\n      if (hasPointA) {\n        // Si ya existe el punto A, lo quitamos\n        setHasPointA(false)\n        setLoopStart(0)\n        // Punto A eliminado\n      } else {\n        // Establecer punto A\n        setHasPointA(true)\n        setLoopStart(currentTime)\n        setSavedPointA(currentTime)\n                  // Punto A establecido\n      }\n    } else {\n      if (hasPointB) {\n        // Si ya existe el punto B, lo quitamos\n        setHasPointB(false)\n        setLoopEnd(0)\n                  // Punto B eliminado\n      } else {\n        // Establecer punto B\n        setHasPointB(true)\n        setLoopEnd(currentTime)\n        setSavedPointB(currentTime)\n                  // Punto B establecido\n      }\n    }\n  }\n\n  const formatTime = (time) => {\n    const minutes = Math.floor(time / 60)\n    const seconds = Math.floor(time % 60)\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`\n  }\n\n  const handleSpeedChange = (speed) => {\n    setManualPlaybackSpeed(speed)\n    if (videoRef.current) {\n      videoRef.current.playbackRate = speed\n      setPlaybackRate(speed)\n    }\n    setShowSpeedMenu(false)\n  }\n\n  const getSpeedLabel = (speed) => {\n    if (speed === 1) return 'Normal'\n    return `${speed}x`\n  }\n\n  // Función para descargar video\n  const downloadVideo = async () => {\n    try {\n      if (currentVideo.videoUrl && (currentVideo.videoUrl.includes('firebase') || currentVideo.videoUrl.includes('googleapis'))) {\n        \n        const response = await fetch(currentVideo.videoUrl)\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`)\n        }\n        \n        const blob = await response.blob()\n        \n        const blobUrl = URL.createObjectURL(blob)\n        \n        const link = document.createElement('a')\n        link.href = blobUrl\n        link.download = currentVideo.title || 'video.mp4'\n        link.style.display = 'none'\n        \n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n        \n        setTimeout(() => {\n          URL.revokeObjectURL(blobUrl)\n        }, 1000)\n        \n        // Descarga completada exitosamente\n      } else {\n        const link = document.createElement('a')\n        link.href = currentVideo.videoUrl\n        link.download = currentVideo.title || 'video.mp4'\n        link.style.display = 'none'\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      }\n    } catch (error) {\n      console.error('Error en descarga:', error)\n      alert(`Error al descargar el video: ${error.message}`)\n    }\n  }\n  \n  // Keyboard shortcuts\n  useEffect(() => {\n    const handleKeyPress = (e) => {\n      if (e.target.tagName === 'INPUT') return\n      \n      switch (e.code) {\n        case 'Space':\n          e.preventDefault()\n          togglePlay()\n          break\n        case 'KeyF':\n          e.preventDefault()\n          toggleFullscreen()\n          break\n        case 'KeyM':\n          e.preventDefault()\n          toggleMute()\n          break\n        case 'ArrowLeft':\n          e.preventDefault()\n          if (e.ctrlKey || e.metaKey) {\n            goToPreviousVideo()\n          } else {\n            skip(-10)\n          }\n          break\n        case 'ArrowRight':\n          e.preventDefault()\n          if (e.ctrlKey || e.metaKey) {\n            goToNextVideo()\n          } else {\n            skip(10)\n          }\n          break\n        case 'KeyA':\n          e.preventDefault()\n          setLoopPoint('start')\n          break\n        case 'KeyB':\n          e.preventDefault()\n          setLoopPoint('end')\n          break\n        case 'KeyL':\n          e.preventDefault()\n          setIsLoopEnabled(!isLoopEnabled)\n          break\n        case 'KeyS': {\n          e.preventDefault()\n          // Ciclar entre velocidades\n          const currentIndex = availableSpeeds.indexOf(manualPlaybackSpeed)\n          const nextIndex = (currentIndex + 1) % availableSpeeds.length\n          handleSpeedChange(availableSpeeds[nextIndex])\n          break\n        }\n      }\n    }\n    \n    document.addEventListener('keydown', handleKeyPress)\n    return () => document.removeEventListener('keydown', handleKeyPress)\n  }, [currentTime, duration, currentVideoIndex, isLoopEnabled, manualPlaybackSpeed])\n  \n  if (!currentVideo) {\n    return (\n      <div className={`bg-black rounded-lg flex items-center justify-center ${className}`}>\n        <div className=\"text-white text-center\">\n          <p>No hay videos en la secuencia</p>\n        </div>\n      </div>\n    )\n  }\n  \n  return (\n    <div \n      ref={containerRef}\n      className={`relative bg-black rounded-lg overflow-hidden ${className}`}\n      onMouseEnter={activateControls}\n      onMouseLeave={() => {\n        if (isPlaying) {\n          const timeout = setTimeout(() => {\n            setShowControlsUI(false)\n          }, 4000)\n          setControlsTimeout(timeout)\n        }\n      }}\n      onTouchStart={activateControls}\n      onTouchMove={activateControls}\n    >\n      {/* Video Element */}\n      <video\n        ref={videoRef}\n        src={currentVideo.videoUrl}\n        className=\"w-full h-full object-contain cursor-pointer\"\n        onEnded={handleVideoEnd}\n        onTimeUpdate={handleTimeUpdate}\n        onLoadedMetadata={handleLoadedMetadata}\n        onPlay={() => setIsPlaying(true)}\n        onPause={() => setIsPlaying(false)}\n        muted={isMuted}\n        autoPlay={autoplay}\n        loop={false} // We handle looping manually\n        onClick={activateControls}\n      />\n      \n             {/* Video Info Overlay */}\n       <div className=\"absolute top-2 left-2 bg-black bg-opacity-75 text-white px-3 py-2 rounded-lg text-sm\">\n         <div className=\"flex items-center space-x-2\">\n           <span className=\"font-medium\">\n             {currentVideoIndex + 1} / {videos.length}\n           </span>\n           <span className=\"text-gray-300\">|</span>\n           <span className=\"max-w-xs truncate\">{currentVideo.title}</span>\n           {playbackRate !== 1 && (\n             <>\n               <span className=\"text-gray-300\">|</span>\n               <span className=\"text-blue-400 font-medium\">\n                 {playbackRate.toFixed(2)}x\n               </span>\n             </>\n           )}\n         </div>\n         {videos.length > 1 && (\n           <div className=\"text-xs text-gray-400 mt-1\">\n             Usa Ctrl+←/→ para cambiar de video\n           </div>\n         )}\n       </div>\n      \n      {/* Controls Overlay */}\n      {showControlsUI && (\n        <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent flex flex-col justify-end\">\n          {/* Controles superiores */}\n          <div className=\"absolute top-0 left-0 right-0 p-4 flex justify-end items-center\">\n            <div className=\"flex items-center space-x-2\">\n              <button\n                onClick={toggleFullscreen}\n                className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\n              >\n                {isFullscreen ? <Minimize className=\"w-4 h-4\" /> : <Maximize className=\"w-4 h-4\" />}\n              </button>\n            </div>\n          </div>\n\n          {/* Controles centrales */}\n          <div className=\"absolute inset-0 flex items-center justify-center\">\n            <div className=\"flex items-center space-x-4\">\n              {/* Botón de video anterior */}\n              <button\n                onClick={goToPreviousVideo}\n                disabled={currentVideoIndex === 0}\n                className={`p-2 rounded-full transition-colors z-10 ${\n                  currentVideoIndex === 0 \n                    ? 'bg-gray-600 text-gray-400 cursor-not-allowed' \n                    : 'bg-black/60 text-white hover:bg-black/80'\n                }`}\n                title=\"Video anterior (Ctrl+←)\"\n              >\n                <div className=\"flex items-center space-x-1\">\n                  <div className=\"w-3 h-3 rounded-full border-2 border-current flex items-center justify-center\">\n                    <SkipBack className=\"w-1.5 h-1.5\" />\n                  </div>\n                  <span className=\"text-xs font-medium\">Anterior</span>\n                </div>\n              </button>\n\n              {/* Botón de retroceder 10s */}\n              <button\n                onClick={() => skip(-10)}\n                className=\"p-3 rounded-full bg-black/60 text-white hover:bg-black/80 transition-colors z-10 hidden md:flex items-center justify-center\"\n                title=\"Retroceder 10s (←)\"\n              >\n                <div className=\"flex items-center space-x-1\">\n                  <div className=\"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center\">\n                    <SkipBack className=\"w-3 h-3\" />\n                  </div>\n                  <span className=\"text-sm font-medium\">10</span>\n                </div>\n              </button>\n\n              <button\n                onClick={togglePlay}\n                className=\"p-4 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\n                title=\"Play/Pause (Espacio)\"\n              >\n                {isPlaying ? <Pause className=\"w-8 h-8\" /> : <Play className=\"w-8 h-8\" />}\n              </button>\n\n              {/* Botón de adelantar 10s */}\n              <button\n                onClick={() => skip(10)}\n                className=\"p-3 rounded-full bg-black/60 text-white hover:bg-black/80 transition-colors z-10 hidden md:flex items-center justify-center\"\n                title=\"Adelantar 10s (→)\"\n              >\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"text-sm font-medium\">10</span>\n                  <div className=\"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center\">\n                    <SkipForward className=\"w-3 h-3\" />\n                  </div>\n                </div>\n              </button>\n\n              {/* Botón de siguiente video */}\n              <button\n                onClick={goToNextVideo}\n                disabled={currentVideoIndex === videos.length - 1}\n                className={`p-2 rounded-full transition-colors z-10 ${\n                  currentVideoIndex === videos.length - 1 \n                    ? 'bg-gray-600 text-gray-400 cursor-not-allowed' \n                    : 'bg-black/60 text-white hover:bg-black/80'\n                }`}\n                title=\"Siguiente video (Ctrl+→)\"\n              >\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"text-xs font-medium\">Siguiente</span>\n                  <div className=\"w-3 h-3 rounded-full border-2 border-current flex items-center justify-center\">\n                    <SkipForward className=\"w-1.5 h-1.5\" />\n                  </div>\n                </div>\n              </button>\n            </div>\n          </div>\n\n          {/* Controles inferiores */}\n          <div className=\"absolute bottom-0 left-0 right-0 p-4\">\n            {/* Controles de volumen, bucle, A-B y velocidades */}\n            <div className=\"flex justify-end mb-2 space-x-2\">\n              {/* Botón de bucle */}\n              <button\n                onClick={() => setIsLoopEnabled(!isLoopEnabled)}\n                className={`p-2 rounded-full transition-colors z-10 ${\n                  isLoopEnabled ? 'bg-blue-500 text-white' : 'bg-white/20 text-white hover:bg-white/30'\n                }`}\n                title=\"Bucle\"\n              >\n                <RotateCcw className=\"w-4 h-4\" />\n              </button>\n\n              {/* Botón de segmento A-B */}\n              <button\n                onClick={() => {\n                  const newMode = !isLoopSegmentMode\n                  setIsLoopSegmentMode(newMode)\n                  if (!newMode) {\n                    setHasPointA(false)\n                    setHasPointB(false)\n                    setLoopStart(0)\n                    setLoopEnd(0)\n                  } else {\n                    if (savedPointA > 0) {\n                      setHasPointA(true)\n                      setLoopStart(savedPointA)\n                    }\n                    if (savedPointB > 0) {\n                      setHasPointB(true)\n                      setLoopEnd(savedPointB)\n                    }\n                  }\n                }}\n                className={`p-2 rounded-full transition-colors z-10 ${\n                  isLoopSegmentMode ? 'bg-green-500 text-white' : 'bg-white/20 text-white hover:bg-white/30'\n                }`}\n                title=\"Segmento A-B\"\n              >\n                <div className=\"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none\">\n                  A-B\n                </div>\n              </button>\n\n              {/* Botón de velocidades */}\n              <div className=\"relative\">\n                <button\n                  onClick={() => setShowSpeedMenu(!showSpeedMenu)}\n                  className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\n                  title=\"Velocidad de reproducción\"\n                >\n                                     <div className=\"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none\">\n                     {manualPlaybackSpeed === 1 ? '1x' : `${manualPlaybackSpeed}x`}\n                   </div>\n                </button>\n                \n                                 {showSpeedMenu && (\n                   <div className=\"absolute bottom-full right-0 mb-2 bg-black/90 rounded-lg p-2 z-20 min-w-[80px]\">\n                     {availableSpeeds.map((speed) => (\n                       <button\n                         key={speed}\n                         onClick={() => handleSpeedChange(speed)}\n                         className={`w-full text-left px-3 py-1 rounded text-xs transition-colors ${\n                           manualPlaybackSpeed === speed \n                             ? 'bg-blue-500 text-white' \n                             : 'text-white hover:bg-white/20'\n                         }`}\n                       >\n                         {getSpeedLabel(speed)}\n                       </button>\n                     ))}\n                   </div>\n                 )}\n              </div>\n\n              {/* Botón de descarga */}\n              <button\n                onClick={downloadVideo}\n                className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\n                title=\"Descargar video\"\n              >\n                <Download className=\"w-4 h-4\" />\n              </button>\n\n              {/* Controles de volumen */}\n              <div className=\"relative\">\n                <button\n                  onClick={toggleMute}\n                  className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\n                  onMouseEnter={() => setShowVolumeSlider(true)}\n                  onMouseLeave={() => {\n                    const timeout = setTimeout(() => setShowVolumeSlider(false), 1000)\n                    setVolumeSliderTimeout(timeout)\n                  }}\n                >\n                  {isMuted ? <VolumeX className=\"w-4 h-4\" /> : <Volume2 className=\"w-4 h-4\" />}\n                </button>\n                \n                {showVolumeSlider && (\n                  <div \n                    className=\"absolute bottom-full right-0 mb-2 bg-black/80 rounded-lg p-3 z-20\"\n                    onMouseEnter={() => {\n                      if (volumeSliderTimeout) {\n                        clearTimeout(volumeSliderTimeout)\n                        setVolumeSliderTimeout(null)\n                      }\n                    }}\n                    onMouseLeave={() => {\n                      const timeout = setTimeout(() => setShowVolumeSlider(false), 1000)\n                      setVolumeSliderTimeout(timeout)\n                    }}\n                  >\n                    <div className=\"flex flex-col items-center space-y-2\">\n                      <input\n                        type=\"range\"\n                        min=\"0\"\n                        max=\"1\"\n                        step=\"0.01\"\n                        value={volume}\n                        onChange={handleVolumeChange}\n                        className=\"w-2 h-20 bg-gray-600 rounded-lg appearance-none cursor-pointer slider-vertical\"\n                        style={{\n                          background: `linear-gradient(to top, #3b82f6 0%, #3b82f6 ${volume * 100}%, #4b5563 ${volume * 100}%, #4b5563 100%)`\n                        }}\n                        orient=\"vertical\"\n                      />\n                      <span className=\"text-white text-xs\">{Math.round(volume * 100)}%</span>\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Barra de progreso */}\n            <div className=\"relative mb-4\">\n              <div\n                className=\"w-full h-2 bg-white/20 rounded-full cursor-pointer relative\"\n                onClick={handleProgressClick}\n              >\n                <div\n                  className=\"h-full bg-blue-500 rounded-full\"\n                  style={{ width: `${(currentTime / duration) * 100}%` }}\n                />\n                \n                {/* Marcadores de bucle A-B */}\n                {isLoopSegmentMode && hasPointA && (\n                  <div\n                    className=\"absolute top-0 w-1 h-full bg-green-500 z-10\"\n                    style={{ left: `${(loopStart / duration) * 100}%` }}\n                  />\n                )}\n                {isLoopSegmentMode && hasPointB && (\n                  <div\n                    className=\"absolute top-0 w-1 h-full bg-red-500 z-10\"\n                    style={{ left: `${(loopEnd / duration) * 100}%` }}\n                  />\n                )}\n              </div>\n            </div>\n\n            {/* Información de tiempo y controles de bucle */}\n            <div className=\"flex items-center justify-between text-white text-sm\">\n              <div className=\"flex items-center space-x-4\">\n                <span>{formatTime(currentTime)} / {formatTime(duration)}</span>\n                {playbackRate !== 1 && (\n                  <span className=\"text-blue-400 font-medium\">\n                    {playbackRate.toFixed(2)}x\n                  </span>\n                )}\n                \n                {isLoopSegmentMode && (\n                  <div className=\"flex items-center space-x-2\">\n                    <button\n                      onClick={() => setLoopPoint('start')}\n                      className={`px-2 py-1 rounded text-xs transition-colors ${\n                        hasPointA ? 'bg-green-500 text-white' : 'bg-gray-600 text-gray-300 hover:bg-gray-500'\n                      }`}\n                    >\n                      A: {hasPointA ? formatTime(loopStart) : '--:--'}\n                    </button>\n                    <button\n                      onClick={() => setLoopPoint('end')}\n                      className={`px-2 py-1 rounded text-xs transition-colors ${\n                        hasPointB ? 'bg-red-500 text-white' : 'bg-gray-600 text-gray-300 hover:bg-gray-500'\n                      }`}\n                    >\n                      B: {hasPointB ? formatTime(loopEnd) : '--:--'}\n                    </button>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"text-xs opacity-75\">\n                  {isLoopEnabled && (isLoopSegmentMode && hasPointA && hasPointB ? 'Bucle A-B' : 'Bucle completo')}\n                </div>\n              </div>\n            </div>\n\n            {/* Indicador de progreso de la secuencia */}\n            {videos.length > 1 && (\n              <div className=\"mt-2\">\n                <div className=\"flex items-center justify-between text-xs text-gray-300 mb-1\">\n                  <span>Progreso de la secuencia</span>\n                  <span>{currentVideoIndex + 1} de {videos.length}</span>\n                </div>\n                <div className=\"w-full h-1 bg-gray-600 rounded-full\">\n                  <div \n                    className=\"h-full bg-blue-500 rounded-full transition-all duration-300\"\n                    style={{ width: `${((currentVideoIndex + 1) / videos.length) * 100}%` }}\n                  />\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default SequenceVideoPlayer\n","class VideoCombiner {\r\n  constructor() {\r\n    this.isLoaded = true // No necesitamos cargar nada\r\n  }\r\n\r\n  async load() {\r\n    // No necesitamos cargar nada\r\n    return Promise.resolve()\r\n  }\r\n\r\n  // Método principal que usa MediaRecorder optimizado para capturar todos los frames\r\n  async combineVideos(videos, onProgress) {\r\n    try {\r\n      console.log('Iniciando combinación con MediaRecorder optimizado...')\r\n      \r\n      if (onProgress) {\r\n        onProgress({\r\n          stage: 'init',\r\n          current: 0,\r\n          total: 100,\r\n          message: 'Iniciando MediaRecorder...'\r\n        })\r\n      }\r\n\r\n      // Descargar todos los videos\r\n      const videoBlobs = []\r\n      \r\n      for (let i = 0; i < videos.length; i++) {\r\n        const video = videos[i]\r\n        console.log(`Descargando video ${i + 1}/${videos.length}: ${video.title}`)\r\n        \r\n        if (onProgress) {\r\n          onProgress({\r\n            stage: 'download',\r\n            current: ((i + 1) / videos.length) * 50,\r\n            total: 100,\r\n            message: `Descargando: ${video.title}`\r\n          })\r\n        }\r\n\r\n        try {\r\n          // Usar Firebase SDK para obtener URL de descarga\r\n          const { ref, getDownloadURL } = await import('firebase/storage')\r\n          const { storage } = await import('../firebase/config')\r\n          \r\n          const videoRef = ref(storage, video.videoPath)\r\n          const downloadURL = await getDownloadURL(videoRef)\r\n          \r\n          console.log(`URL de descarga obtenida para ${video.title}:`, downloadURL)\r\n\r\n          // Descargar video para combinación\r\n          const response = await fetch(downloadURL)\r\n          if (!response.ok) {\r\n            throw new Error(`Error descargando video: ${response.statusText}`)\r\n          }\r\n          \r\n          const videoBlob = await response.blob()\r\n          videoBlobs.push(videoBlob)\r\n          \r\n          console.log(`Video ${i + 1} descargado: ${video.title}`)\r\n          \r\n        } catch (error) {\r\n          console.error(`Error con video ${video.title}:`, error)\r\n          throw new Error(`Error procesando video ${video.title}: ${error.message}`)\r\n        }\r\n      }\r\n\r\n      if (onProgress) {\r\n        onProgress({\r\n          stage: 'combine',\r\n          current: 50,\r\n          total: 100,\r\n          message: 'Combinando videos...'\r\n        })\r\n      }\r\n\r\n      // Crear un video combinado usando MediaRecorder optimizado\r\n      const combinedBlob = await this.combineVideoBlobs(videoBlobs)\r\n\r\n      if (onProgress) {\r\n        onProgress({\r\n          stage: 'complete',\r\n          current: 100,\r\n          total: 100,\r\n          message: '¡Combinación completada!'\r\n        })\r\n      }\r\n\r\n      console.log('Combinación completada, archivo creado')\r\n      return combinedBlob\r\n\r\n    } catch (error) {\r\n      console.error('Error combinando videos:', error)\r\n      throw new Error(`Error combinando videos: ${error.message}`)\r\n    }\r\n  }\r\n\r\n  // Método para combinar blobs de video con calidad optimizada\r\n  async combineVideoBlobs(videoBlobs) {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        // Crear un canvas para combinar los videos\r\n        const canvas = document.createElement('canvas')\r\n        const ctx = canvas.getContext('2d')\r\n        \r\n        // Configurar canvas con resolución alta\r\n        canvas.width = 1920\r\n        canvas.height = 1080\r\n        \r\n        // Crear MediaRecorder con máxima calidad y FPS alto\r\n        const stream = canvas.captureStream(60) // 60 FPS para suavidad\r\n        const mediaRecorder = new MediaRecorder(stream, {\r\n          mimeType: 'video/webm;codecs=vp9',\r\n          videoBitsPerSecond: 30000000 // 30 Mbps para máxima calidad\r\n        })\r\n        \r\n        const chunks = []\r\n        \r\n        mediaRecorder.ondataavailable = (event) => {\r\n          if (event.data.size > 0) {\r\n            chunks.push(event.data)\r\n          }\r\n        }\r\n        \r\n        mediaRecorder.onstop = () => {\r\n          const combinedBlob = new Blob(chunks, { type: 'video/webm' })\r\n          resolve(combinedBlob)\r\n        }\r\n        \r\n        mediaRecorder.onerror = (error) => {\r\n          reject(error)\r\n        }\r\n        \r\n        // Iniciar grabación\r\n        mediaRecorder.start()\r\n        \r\n        // Procesar cada video\r\n        let currentVideoIndex = 0\r\n        \r\n        const processNextVideo = () => {\r\n          if (currentVideoIndex >= videoBlobs.length) {\r\n            mediaRecorder.stop()\r\n            return\r\n          }\r\n          \r\n          const videoBlob = videoBlobs[currentVideoIndex]\r\n          const videoUrl = URL.createObjectURL(videoBlob)\r\n          const video = document.createElement('video')\r\n          \r\n          video.onloadedmetadata = () => {\r\n            video.currentTime = 0\r\n            video.muted = false\r\n            video.volume = 1.0\r\n            video.play()\r\n          }\r\n          \r\n          video.ontimeupdate = () => {\r\n            // Dibujar el frame actual en el canvas con máxima calidad\r\n            ctx.imageSmoothingEnabled = true\r\n            ctx.imageSmoothingQuality = 'high'\r\n            \r\n            // Limpiar canvas antes de dibujar\r\n            ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n            \r\n            // Calcular dimensiones para mantener proporción\r\n            const videoAspect = video.videoWidth / video.videoHeight\r\n            const canvasAspect = canvas.width / canvas.height\r\n            \r\n            let drawWidth, drawHeight, offsetX, offsetY\r\n            \r\n            if (videoAspect > canvasAspect) {\r\n              // Video más ancho que canvas\r\n              drawWidth = canvas.width\r\n              drawHeight = canvas.width / videoAspect\r\n              offsetX = 0\r\n              offsetY = (canvas.height - drawHeight) / 2\r\n            } else {\r\n              // Video más alto que canvas\r\n              drawHeight = canvas.height\r\n              drawWidth = canvas.height * videoAspect\r\n              offsetX = (canvas.width - drawWidth) / 2\r\n              offsetY = 0\r\n            }\r\n            \r\n            // Dibujar video centrado y escalado\r\n            ctx.drawImage(video, offsetX, offsetY, drawWidth, drawHeight)\r\n          }\r\n          \r\n          // Usar requestAnimationFrame para capturar TODOS los frames\r\n          video.onplay = () => {\r\n            const renderFrame = () => {\r\n              if (!video.paused && !video.ended) {\r\n                ctx.imageSmoothingEnabled = true\r\n                ctx.imageSmoothingQuality = 'high'\r\n                \r\n                // Limpiar canvas antes de dibujar\r\n                ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n                \r\n                // Calcular dimensiones para mantener proporción\r\n                const videoAspect = video.videoWidth / video.videoHeight\r\n                const canvasAspect = canvas.width / canvas.height\r\n                \r\n                let drawWidth, drawHeight, offsetX, offsetY\r\n                \r\n                if (videoAspect > canvasAspect) {\r\n                  drawWidth = canvas.width\r\n                  drawHeight = canvas.width / videoAspect\r\n                  offsetX = 0\r\n                  offsetY = (canvas.height - drawHeight) / 2\r\n                } else {\r\n                  drawHeight = canvas.height\r\n                  drawWidth = canvas.height * videoAspect\r\n                  offsetX = (canvas.width - drawWidth) / 2\r\n                  offsetY = 0\r\n                }\r\n                \r\n                // Dibujar video centrado y escalado\r\n                ctx.drawImage(video, offsetX, offsetY, drawWidth, drawHeight)\r\n                \r\n                // Continuar renderizando inmediatamente para capturar todos los frames\r\n                requestAnimationFrame(renderFrame)\r\n              }\r\n            }\r\n            \r\n            // Iniciar renderizado inmediato\r\n            requestAnimationFrame(renderFrame)\r\n          }\r\n          \r\n          video.onended = () => {\r\n            URL.revokeObjectURL(videoUrl)\r\n            currentVideoIndex++\r\n            setTimeout(processNextVideo, 100) // Pausa para transición suave\r\n          }\r\n          \r\n          video.src = videoUrl\r\n        }\r\n        \r\n        processNextVideo()\r\n        \r\n      } catch (error) {\r\n        reject(error)\r\n      }\r\n    })\r\n  }\r\n\r\n  // Método simple (igual que el principal)\r\n  async combineVideosSimple(videos, onProgress) {\r\n    return this.combineVideos(videos, onProgress)\r\n  }\r\n\r\n  // Limpiar archivos temporales\r\n  async cleanup(videoFiles) {\r\n    try {\r\n      console.log('Limpiando archivos temporales...')\r\n      \r\n      // Eliminar archivos de video\r\n      for (const file of videoFiles) {\r\n        await this.ffmpeg.deleteFile(file)\r\n      }\r\n      \r\n      // Eliminar archivos del sistema\r\n      await this.ffmpeg.deleteFile('filelist.txt')\r\n      await this.ffmpeg.deleteFile('output.mp4')\r\n      \r\n      console.log('Archivos temporales eliminados')\r\n    } catch (error) {\r\n      console.warn('Error limpiando archivos temporales:', error)\r\n    }\r\n  }\r\n\r\n  // Método para obtener información del video\r\n  async getVideoInfo(videoUrl) {\r\n    try {\r\n      const response = await fetch(videoUrl)\r\n      const blob = await response.blob()\r\n      \r\n      return {\r\n        size: blob.size,\r\n        type: blob.type,\r\n        duration: null // No podemos obtener duración sin procesar el video\r\n      }\r\n    } catch (error) {\r\n      console.error('Error obteniendo información del video:', error)\r\n      return null\r\n    }\r\n  }\r\n}\r\n\r\nexport default VideoCombiner\r\n","import React, { useState, useEffect } from 'react'\r\nimport { X, Download, AlertCircle, CheckCircle, Loader } from 'lucide-react'\r\nimport VideoCombiner from '../../services/video/videoCombiner'\r\n\r\nconst VideoDownloadModal = ({ \r\n  isOpen, \r\n  onClose, \r\n  videos, \r\n  sequenceName = 'Secuencia' \r\n}) => {\r\n  const [progress, setProgress] = useState(null)\r\n  const [isProcessing, setIsProcessing] = useState(false)\r\n  const [error, setError] = useState(null)\r\n  const [downloadUrl, setDownloadUrl] = useState(null)\r\n  const [quality, setQuality] = useState('fast') // 'fast' o 'professional'\r\n\r\n  const videoCombiner = new VideoCombiner()\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setProgress(null)\r\n      setError(null)\r\n      setDownloadUrl(null)\r\n      setIsProcessing(false)\r\n    }\r\n  }, [isOpen])\r\n\r\n  const handleDownload = async () => {\r\n    if (!videos || videos.length === 0) {\r\n      setError('No hay videos para combinar')\r\n      return\r\n    }\r\n\r\n    setIsProcessing(true)\r\n    setError(null)\r\n    setProgress({\r\n      stage: 'init',\r\n      current: 0,\r\n      total: 100,\r\n      message: 'Iniciando FFmpeg.wasm...'\r\n    })\r\n\r\n    try {\r\n      // Iniciando combinación con FFmpeg.wasm\r\n      const combinedBlob = await videoCombiner.combineVideos(videos, setProgress)\r\n\r\n      // Crear URL para descarga\r\n      const url = URL.createObjectURL(combinedBlob)\r\n      setDownloadUrl(url)\r\n\r\n      setProgress({\r\n        stage: 'complete',\r\n        current: 100,\r\n        total: 100,\r\n        message: '¡Videos combinados exitosamente!'\r\n      })\r\n\r\n    } catch (error) {\r\n      console.error('Error en descarga:', error)\r\n      setError(`Error combinando videos: ${error.message}`)\r\n      setProgress(null)\r\n    } finally {\r\n      setIsProcessing(false)\r\n    }\r\n  }\r\n\r\n  const handleDownloadFile = () => {\r\n    if (downloadUrl) {\r\n      const link = document.createElement('a')\r\n      link.href = downloadUrl\r\n      link.download = `${sequenceName}.webm`\r\n      document.body.appendChild(link)\r\n      link.click()\r\n      document.body.removeChild(link)\r\n    }\r\n  }\r\n\r\n  const getProgressColor = () => {\r\n    if (error) return 'text-red-500'\r\n    if (progress?.stage === 'complete') return 'text-green-500'\r\n    return 'text-blue-500'\r\n  }\r\n\r\n  const getProgressIcon = () => {\r\n    if (error) return <AlertCircle className=\"h-5 w-5\" />\r\n    if (progress?.stage === 'complete') return <CheckCircle className=\"h-5 w-5\" />\r\n    return <Loader className=\"h-5 w-5 animate-spin\" />\r\n  }\r\n\r\n  const getProgressBarColor = () => {\r\n    if (error) return 'bg-red-500'\r\n    if (progress?.stage === 'complete') return 'bg-green-500'\r\n    return 'bg-blue-500'\r\n  }\r\n\r\n  const getStageDescription = () => {\r\n    switch (progress?.stage) {\r\n      case 'init':\r\n        return 'Inicializando FFmpeg.wasm...'\r\n      case 'download':\r\n        return 'Descargando videos...'\r\n      case 'combine':\r\n        return 'Combinando videos con FFmpeg...'\r\n      case 'finalize':\r\n        return 'Finalizando archivo...'\r\n      case 'complete':\r\n        return '¡Proceso completado!'\r\n      default:\r\n        return 'Preparando...'\r\n    }\r\n  }\r\n\r\n  if (!isOpen) return null\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n      <div className=\"bg-white rounded-lg p-6 w-full max-w-md mx-4\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h2 className=\"text-xl font-semibold text-gray-800\">\r\n            Descargar Secuencia\r\n          </h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-gray-600 transition-colors\"\r\n            disabled={isProcessing}\r\n          >\r\n            <X className=\"h-5 w-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <div className=\"space-y-4\">\r\n          {/* Video Info */}\r\n          <div className=\"bg-gray-50 rounded-lg p-3\">\r\n            <p className=\"text-sm text-gray-600\">\r\n              <strong>{videos?.length || 0} videos</strong> serán combinados en uno solo\r\n            </p>\r\n            <p className=\"text-xs text-gray-500 mt-1\">\r\n              Duración total: {videos?.reduce((sum, v) => sum + (v.duration || 0), 0).toFixed(1)}s\r\n              {videos?.some(v => !v.duration) && ' (calculando...)'}\r\n            </p>\r\n            <p className=\"text-xs text-blue-600 mt-1\">\r\n              Formato: WebM (calidad optimizada con MediaRecorder)\r\n            </p>\r\n          </div>\r\n\r\n          {/* Progress */}\r\n          {progress && (\r\n            <div className=\"space-y-3\">\r\n              <div className=\"flex items-center space-x-2\">\r\n                {getProgressIcon()}\r\n                <span className={`text-sm font-medium ${getProgressColor()}`}>\r\n                  {progress.message}\r\n                </span>\r\n              </div>\r\n              \r\n              <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n                <div\r\n                  className={`h-2 rounded-full transition-all duration-300 ${getProgressBarColor()}`}\r\n                  style={{ width: `${progress.current}%` }}\r\n                />\r\n              </div>\r\n              \r\n              <p className=\"text-xs text-gray-500\">\r\n                {getStageDescription()}\r\n              </p>\r\n            </div>\r\n          )}\r\n\r\n          {/* Error */}\r\n          {error && (\r\n            <div className=\"bg-red-50 border border-red-200 rounded-lg p-3\">\r\n              <div className=\"flex items-center space-x-2\">\r\n                <AlertCircle className=\"h-5 w-5 text-red-500\" />\r\n                <span className=\"text-sm text-red-700\">{error}</span>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Success */}\r\n          {downloadUrl && (\r\n            <div className=\"bg-green-50 border border-green-200 rounded-lg p-3\">\r\n              <div className=\"flex items-center space-x-2\">\r\n                <CheckCircle className=\"h-5 w-5 text-green-500\" />\r\n                <span className=\"text-sm text-green-700\">\r\n                  ¡Videos combinados exitosamente!\r\n                </span>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Actions */}\r\n        <div className=\"flex space-x-3 mt-6\">\r\n          {!isProcessing && !downloadUrl && (\r\n            <button\r\n              onClick={handleDownload}\r\n              className=\"flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2\"\r\n            >\r\n              <Download className=\"h-4 w-4\" />\r\n              <span>Combinar Videos</span>\r\n            </button>\r\n          )}\r\n\r\n          {downloadUrl && (\r\n            <button\r\n              onClick={handleDownloadFile}\r\n              className=\"flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center space-x-2\"\r\n            >\r\n              <Download className=\"h-4 w-4\" />\r\n              <span>Descargar WebM</span>\r\n            </button>\r\n          )}\r\n\r\n          <button\r\n            onClick={onClose}\r\n            className=\"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\r\n            disabled={isProcessing}\r\n          >\r\n            {downloadUrl ? 'Cerrar' : 'Cancelar'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default VideoDownloadModal\r\n","// 🎬 COMPONENTE CONSTRUCTOR DE SECUENCIAS - SALSAHACKS V2.0\r\n\r\nimport React, { useState, useEffect } from 'react'\r\nimport { \r\n  Plus, \r\n  Trash2, \r\n  Play, \r\n  Save, \r\n  Edit, \r\n  X, \r\n  ChevronDown, \r\n  ChevronUp,\r\n  Heart, \r\n  Music,\r\n  Shuffle,\r\n  GripVertical\r\n} from 'lucide-react'\r\nimport { useSequenceBuilderContext } from '../../contexts/SequenceBuilderContext'\r\nimport { createSequence, getSequencesByStyle, deleteSequence, subscribeToSequencesByStyle } from '../../services/firebase/sequences'\r\nimport { getVideos, toggleVideoLike } from '../../services/firebase/firestore'\r\nimport { useAuth } from '../../contexts/AuthContext'\r\nimport { useTheme } from '../../contexts/ThemeContext'\r\nimport { useCategories } from '../../hooks/useCategories'\r\nimport { useDragAndDrop } from '../../hooks/useDragAndDrop'\r\nimport Toast from '../common/Toast'\r\nimport ConfirmModal from '../common/ConfirmModal'\r\nimport VideoPlayer from '../video/VideoPlayer.jsx'\r\nimport SequenceTimeline from './SequenceTimeline.jsx'\r\nimport SequenceVideoPlayer from './SequenceVideoPlayer.jsx'\r\nimport BPMController from './BPMController'\r\nimport VideoDownloadModal from '../video/VideoDownloadModal'\r\nimport { processVideoSequence, createSequencePreview } from '../../services/video/videoProcessor'\r\n\r\nconst SequenceBuilder = ({ \r\n  isOpen, \r\n  onClose, \r\n  videos, \r\n  onSaveSequence,\r\n  onToggleShowAll,\r\n  showAllVideos,\r\n  style = 'salsa',\r\n  isIntegrated = false,\r\n  onToggleBuilder\r\n}) => {\r\n  // Usar el hook de categorías para obtener categoriesList y getColorClasses\r\n  const { categoriesList, getColorClasses } = useCategories('figuras', style)\r\n  const { user } = useAuth()\r\n  \r\n  // Estados para procesamiento\r\n\r\n  \r\n  // Estados para reproducción de video individual\r\n  const [selectedVideo, setSelectedVideo] = useState(null)\r\n  const [showVideoModal, setShowVideoModal] = useState(false)\r\n  \r\n  // Estados para preview en tiempo real\r\n  const [isCreatingPreview, setIsCreatingPreview] = useState(false)\r\n  const [previewVideoUrl, setPreviewVideoUrl] = useState(null)\r\n  const [previewError, setPreviewError] = useState(null)\r\n  const [lastPreviewData, setLastPreviewData] = useState(null) // Para cache\r\n\r\n  // Estados para tags de secuencia\r\n  const [sequenceTags, setSequenceTags] = useState({})\r\n  const [isTagsSectionCollapsed, setIsTagsSectionCollapsed] = useState(true)\r\n\r\n  // Estados para modal de descarga\r\n  const [showDownloadModal, setShowDownloadModal] = useState(false)\r\n\r\n  // Estado para BPM actual\r\n  const [currentBPM, setCurrentBPM] = useState(null)\r\n\r\n  // Funciones auxiliares para tags (actualizadas para usar categoriesList)\r\n  const getOrderedTags = (video) => {\r\n    if (!video.tags || Object.keys(video.tags).length === 0) {\r\n      return []\r\n    }\r\n    \r\n    const orderedTags = []\r\n    \r\n    categoriesList.forEach(category => {\r\n      const categoryTags = video.tags[category.key]\r\n      if (Array.isArray(categoryTags)) {\r\n        categoryTags.forEach(tag => {\r\n          orderedTags.push({\r\n            tag,\r\n            categoryKey: category.key,\r\n            color: category.color\r\n          })\r\n        })\r\n      }\r\n    })\r\n    \r\n    return orderedTags\r\n  }\r\n\r\n  const getOrderedTagsIniciales = (video) => {\r\n    if (!video.tagsIniciales || Object.keys(video.tagsIniciales).length === 0) {\r\n      return []\r\n    }\r\n    \r\n    const orderedTags = []\r\n    \r\n    categoriesList.forEach(category => {\r\n      const categoryTags = video.tagsIniciales[category.key]\r\n      if (Array.isArray(categoryTags)) {\r\n        categoryTags.forEach(tag => {\r\n          orderedTags.push({\r\n            tag,\r\n            categoryKey: category.key,\r\n            color: category.color,\r\n            type: 'inicial'\r\n          })\r\n        })\r\n      }\r\n    })\r\n    \r\n    return orderedTags\r\n  }\r\n\r\n  const getOrderedTagsFinales = (video) => {\r\n    if (!video.tagsFinales || Object.keys(video.tagsFinales).length === 0) {\r\n      return []\r\n    }\r\n    \r\n    const orderedTags = []\r\n    \r\n    categoriesList.forEach(category => {\r\n      const categoryTags = video.tagsFinales[category.key]\r\n      if (Array.isArray(categoryTags)) {\r\n        categoryTags.forEach(tag => {\r\n          orderedTags.push({\r\n            tag,\r\n            categoryKey: category.key,\r\n            color: category.color,\r\n            type: 'final'\r\n          })\r\n        })\r\n      }\r\n    })\r\n    \r\n    return orderedTags\r\n  }\r\n\r\n  const {\r\n    sequence,\r\n    sequenceName,\r\n    sequenceDescription,\r\n    editingSequenceId, // Obtener el ID de la secuencia que se está editando\r\n    addVideoToSequence,\r\n    removeVideoFromSequence,\r\n    reorderSequence,\r\n    generateRandomSequence,\r\n    clearSequence,\r\n    setSequenceName,\r\n    setSequenceDescription,\r\n    isVideoCompatible,\r\n    isVideoInSequence,\r\n    toggleBuilder,\r\n    checkCompatibility\r\n  } = useSequenceBuilderContext()\r\n\r\n  // Calcular BPM promedio de la secuencia\r\n  useEffect(() => {\r\n    const videosWithBPM = sequence.filter(video => video.bpm)\r\n    if (videosWithBPM.length > 0) {\r\n      const bpmValues = videosWithBPM.map(video => video.bpm)\r\n      const averageBPM = bpmValues.reduce((sum, bpm) => sum + bpm, 0) / bpmValues.length\r\n      setCurrentBPM(Math.round(averageBPM))\r\n    } else {\r\n      setCurrentBPM(null)\r\n    }\r\n  }, [sequence])\r\n\r\n  const {\r\n    handleDragStart,\r\n    handleDragOver,\r\n    handleDragEnter,\r\n    handleDragLeave,\r\n    handleDrop,\r\n    handleDragEnd,\r\n    getDragStyles\r\n  } = useDragAndDrop(reorderSequence)\r\n\r\n  const [toasts, setToasts] = useState([])\r\n  const [confirmModal, setConfirmModal] = useState({ isOpen: false, type: null })\r\n  const [randomCount, setRandomCount] = useState(5) // Estado para el número de videos aleatorios\r\n\r\n  const addToast = (message, type = 'success') => {\r\n    const id = Date.now()\r\n    setToasts(prev => [...prev, { id, message, type }])\r\n  }\r\n\r\n  const removeToast = (id) => {\r\n    setToasts(prev => prev.filter(toast => toast.id !== id))\r\n  }\r\n\r\n  // Función para manejar likes\r\n  const handleVideoLike = async (video) => {\r\n    if (!user) {\r\n      addToast('Debes iniciar sesión para dar like', 'error')\r\n      return\r\n    }\r\n\r\n    try {\r\n      const result = await toggleVideoLike(video.id, user.uid)\r\n      \r\n      if (result.success) {\r\n        addToast(`Has ${result.userLiked ? 'dado like a' : 'quitado like de'} \"${video.title}\"`, 'success')\r\n      } else {\r\n        addToast('Error al actualizar like', 'error')\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al manejar like:', error)\r\n      addToast('Error al actualizar like', 'error')\r\n    }\r\n  }\r\n\r\n  const handleGenerateRandom = () => {\r\n    const videosNeeded = randomCount - sequence.length\r\n    \r\n    if (videosNeeded <= 0) {\r\n      addToast('La secuencia ya tiene suficientes videos', 'info')\r\n      return\r\n    }\r\n    \r\n    // Verificar cuántos videos compatibles hay disponibles\r\n    if (sequence.length > 0) {\r\n      const lastVideo = sequence[sequence.length - 1]\r\n      const compatibleVideos = videos.filter(video => \r\n        !sequence.some(seqVideo => seqVideo.id === video.id) && // No incluir ya añadidos\r\n        checkCompatibility(lastVideo, video)\r\n      )\r\n      \r\n      if (compatibleVideos.length === 0) {\r\n        addToast('No hay videos compatibles disponibles para continuar la secuencia', 'warning')\r\n        return\r\n      }\r\n      \r\n      if (compatibleVideos.length < videosNeeded) {\r\n        addToast(`Solo hay ${compatibleVideos.length} videos compatibles disponibles de los ${videosNeeded} necesarios`, 'info')\r\n        // Completar con los disponibles\r\n        generateRandomSequence(videos, sequence.length + compatibleVideos.length)\r\n        addToast(`Secuencia completada con ${compatibleVideos.length} videos adicionales`)\r\n        return\r\n      }\r\n    }\r\n    \r\n    // Generar la secuencia completa\r\n    generateRandomSequence(videos, randomCount)\r\n    addToast(`Secuencia completada hasta ${randomCount} videos`)\r\n  }\r\n\r\n  const handleSaveSequence = async () => {\r\n    console.log('💾 Intentando guardar secuencia...')\r\n    console.log('📝 Nombre:', sequenceName)\r\n    console.log('📋 Videos en secuencia:', sequence.length)\r\n    console.log('🎨 Estilo:', style)\r\n    console.log('🔄 Editando secuencia ID:', editingSequenceId)\r\n    \r\n    if (!sequenceName.trim()) {\r\n      addToast('Por favor, añade un nombre a la secuencia', 'error')\r\n      return\r\n    }\r\n\r\n    if (sequence.length === 0) {\r\n      addToast('La secuencia debe tener al menos un video', 'error')\r\n      return\r\n    }\r\n\r\n    try {\r\n      // Generar thumbnail de la secuencia\r\n      const thumbnailUrl = await generateSequenceThumbnail()\r\n      \r\n      const sequenceData = {\r\n        name: sequenceName,\r\n        description: sequenceDescription,\r\n        videos: sequence,\r\n        style: style,\r\n        tags: sequenceTags, // Agregar tags de secuencia\r\n        thumbnailUrl: thumbnailUrl, // Agregar thumbnail\r\n        resolution: sequence.length > 0 ? sequence[0].resolution : 'HD', // Usar resolución del primer video\r\n        createdAt: new Date().toISOString()\r\n      }\r\n      \r\n      // Si estamos editando una secuencia existente, incluir el ID\r\n      if (editingSequenceId) {\r\n        sequenceData.id = editingSequenceId\r\n      }\r\n      await onSaveSequence(sequenceData)\r\n      \r\n      const message = editingSequenceId \r\n        ? '✅ Secuencia actualizada exitosamente'\r\n        : '✅ Secuencia guardada exitosamente. Ve a \"GALERÍA DE SECUENCIAS\" para verla.'\r\n      \r\n      addToast(message)\r\n      clearSequence()\r\n      if (onToggleBuilder) {\r\n        onToggleBuilder()\r\n      }\r\n    } catch (error) {\r\n      console.error('❌ Error al guardar secuencia:', error)\r\n      addToast('Error al guardar la secuencia', 'error')\r\n    }\r\n  }\r\n\r\n  const handleCancel = () => {\r\n    if (sequence.length > 0 || sequenceName.trim() || sequenceDescription.trim()) {\r\n      setConfirmModal({ isOpen: true, type: 'cancel' })\r\n    } else {\r\n      if (onToggleBuilder) {\r\n        onToggleBuilder()\r\n      }\r\n    }\r\n  }\r\n\r\n  const handleClearSequence = () => {\r\n    setConfirmModal({ isOpen: true, type: 'clear' })\r\n  }\r\n\r\n  const handleConfirmAction = () => {\r\n    if (confirmModal.type === 'cancel') {\r\n      clearSequence()\r\n      if (onToggleBuilder) {\r\n        onToggleBuilder()\r\n      }\r\n    } else if (confirmModal.type === 'clear') {\r\n      clearSequence()\r\n    }\r\n    setConfirmModal({ isOpen: false, type: null })\r\n  }\r\n  \r\n  // Efecto para generar preview en tiempo real cuando cambie la secuencia\r\n  useEffect(() => {\r\n    const timeoutId = setTimeout(() => {\r\n      generateRealtimePreview()\r\n    }, 500) // Debounce de 500ms para evitar demasiadas regeneraciones\r\n\r\n    return () => clearTimeout(timeoutId)\r\n  }, [sequence]) // Se ejecuta cuando cambia la secuencia\r\n\r\n  // Cleanup de URLs cuando se desmonte el componente\r\n  useEffect(() => {\r\n    return () => {\r\n      if (previewVideoUrl) {\r\n        URL.revokeObjectURL(previewVideoUrl)\r\n      }\r\n    }\r\n  }, [previewVideoUrl])\r\n  \r\n  // Función para obtener resoluciones disponibles basadas en la resolución del video\r\n  const getAvailableResolutions = (video) => {\r\n    if (!video || !video.resolution) {\r\n      return ['auto', '360p', '480p', '720p', '1080p']\r\n    }\r\n    \r\n    const resolution = video.resolution.toLowerCase()\r\n    const resolutions = ['auto']\r\n    \r\n    // Agregar resoluciones hasta la máxima disponible\r\n    if (resolution.includes('4k') || resolution.includes('2160p')) {\r\n      resolutions.push('360p', '480p', '720p', '1080p', '4k')\r\n    } else if (resolution.includes('1080p') || resolution.includes('1920')) {\r\n      resolutions.push('360p', '480p', '720p', '1080p')\r\n    } else if (resolution.includes('720p') || resolution.includes('1280')) {\r\n      resolutions.push('360p', '480p', '720p')\r\n    } else if (resolution.includes('480p') || resolution.includes('854')) {\r\n      resolutions.push('360p', '480p')\r\n    } else {\r\n      resolutions.push('360p')\r\n    }\r\n    \r\n    return resolutions\r\n  }\r\n\r\n  // Función para reproducir video individual\r\n  const handlePlayVideo = (video) => {\r\n    console.log('🎬 Reproduciendo video individual:', video.title)\r\n    setSelectedVideo(video)\r\n    setShowVideoModal(true)\r\n    addToast(`🎬 Reproduciendo: ${video.title}`, 'info')\r\n  }\r\n\r\n  // Función para generar preview en tiempo real\r\n  const generateRealtimePreview = async () => {\r\n    if (!sequence || sequence.length === 0) {\r\n      setPreviewVideoUrl(null)\r\n      setPreviewError(null)\r\n      return\r\n    }\r\n    \r\n    // Crear clave de cache para verificar si necesitamos regenerar\r\n    const previewKey = JSON.stringify({\r\n      videos: sequence.map(v => v.id),\r\n      sequenceLength: sequence.length\r\n    })\r\n    \r\n    // Si ya tenemos el mismo preview, no regenerar\r\n    if (lastPreviewData === previewKey && previewVideoUrl) {\r\n      return\r\n    }\r\n    \r\n    setIsCreatingPreview(true)\r\n    setPreviewError(null)\r\n    \r\n    try {\r\n      console.log('🎬 Generando preview en tiempo real...')\r\n      \r\n      // Verificar que todos los videos tengan URLs válidas\r\n      const validVideos = sequence.filter(video => video.videoUrl)\r\n      \r\n      if (validVideos.length === 0) {\r\n        throw new Error('No hay videos válidos en la secuencia')\r\n      }\r\n      \r\n      // Para el preview en tiempo real, usaremos el SequenceTimeline\r\n      // que muestra los videos en una línea de tiempo como CapCut\r\n      setPreviewVideoUrl('sequence-timeline') // Marcador especial para indicar que usamos el timeline\r\n      setLastPreviewData(previewKey)\r\n      \r\n      console.log('✅ Preview en tiempo real generado (modo timeline)')\r\n      \r\n    } catch (error) {\r\n      console.error('❌ Error al generar preview en tiempo real:', error)\r\n      setPreviewError(error.message)\r\n    } finally {\r\n      setIsCreatingPreview(false)\r\n    }\r\n  }\r\n\r\n\r\n\r\n  // Funciones para manejar tags de secuencia\r\n  const handleTagToggle = (categoryKey, tag) => {\r\n    setSequenceTags(prevTags => {\r\n      const currentTags = prevTags[categoryKey] || []\r\n      const isSelected = currentTags.includes(tag)\r\n      \r\n      if (isSelected) {\r\n        // Remover tag\r\n        const newTags = currentTags.filter(t => t !== tag)\r\n        if (newTags.length === 0) {\r\n          const { [categoryKey]: removed, ...rest } = prevTags\r\n          return rest\r\n        } else {\r\n          return { ...prevTags, [categoryKey]: newTags }\r\n        }\r\n      } else {\r\n        // Agregar tag\r\n        return { ...prevTags, [categoryKey]: [...currentTags, tag] }\r\n      }\r\n    })\r\n  }\r\n\r\n  const isTagSelected = (categoryKey, tag) => {\r\n    return sequenceTags[categoryKey]?.includes(tag) || false\r\n  }\r\n\r\n  const getOrderedSequenceTags = () => {\r\n    const orderedTags = []\r\n    \r\n    categoriesList.forEach(category => {\r\n      const categoryTags = sequenceTags[category.key]\r\n      if (Array.isArray(categoryTags)) {\r\n        categoryTags.forEach(tag => {\r\n          orderedTags.push({\r\n            tag,\r\n            categoryKey: category.key,\r\n            color: category.color\r\n          })\r\n        })\r\n      }\r\n    })\r\n    \r\n    return orderedTags\r\n  }\r\n\r\n  // Función para generar thumbnail de la secuencia\r\n  const generateSequenceThumbnail = async () => {\r\n    if (sequence.length === 0) return null\r\n    \r\n    try {\r\n      // Usar el primer video como base para el thumbnail\r\n      const firstVideo = sequence[0]\r\n      \r\n      // Si el primer video tiene thumbnail, usarlo como base\r\n      if (firstVideo.thumbnailUrl) {\r\n        return firstVideo.thumbnailUrl\r\n      }\r\n      \r\n      // Si no, generar un thumbnail del video\r\n      const { getStorage, ref, getDownloadURL } = await import('firebase/storage')\r\n      const storage = getStorage()\r\n      const videoRef = ref(storage, firstVideo.videoUrl)\r\n      const downloadURL = await getDownloadURL(videoRef)\r\n      \r\n      // Por ahora, usar la URL del video como thumbnail\r\n      // En el futuro, se podría generar un thumbnail real del video\r\n      return downloadURL\r\n    } catch (error) {\r\n      console.error('Error al generar thumbnail:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  // Si no está abierto, no renderizar\r\n  if (!isOpen) return null\r\n\r\n  return (\r\n    <>\r\n      <div className=\"bg-white rounded-lg border border-gray-200 shadow-sm mb-6\">\r\n        {/* Header del constructor */}\r\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-200\">\r\n          <div className=\"flex items-center space-x-4\">\r\n            <h2 className=\"text-xl font-bold text-gray-800\">Constructor de Secuencias</h2>\r\n            <span className=\"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium\">\r\n              {sequence.length} videos\r\n            </span>\r\n          </div>\r\n          <div className=\"flex items-center space-x-2\">\r\n            <button\r\n              onClick={onToggleBuilder}\r\n              className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\r\n            >\r\n              <X className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Contenido del constructor */}\r\n        <div className=\"p-4\">\r\n          {/* Controles superiores */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\r\n            {/* Nombre y descripción */}\r\n            <div className=\"md:col-span-2 space-y-3\">\r\n              <div className=\"space-y-1\">\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Nombre de la secuencia...\"\r\n                  value={sequenceName}\r\n                  onChange={(e) => setSequenceName(e.target.value)}\r\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                />\r\n                {!sequenceName.trim() && sequence.length > 0 && (\r\n                  <p className=\"text-xs text-orange-600\">\r\n                    ⚠️ Añade un nombre para poder guardar la secuencia\r\n                  </p>\r\n                )}\r\n              </div>\r\n              <textarea\r\n                placeholder=\"Descripción (opcional)...\"\r\n                value={sequenceDescription}\r\n                onChange={(e) => setSequenceDescription(e.target.value)}\r\n                rows=\"2\"\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\r\n              />\r\n            </div>\r\n\r\n            {/* Botones de acción */}\r\n            <div className=\"flex flex-col space-y-3\">\r\n              <div className=\"space-y-2\">\r\n                <label className=\"block text-sm font-medium text-gray-700 text-center\">\r\n                  Número de videos:\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  value={randomCount}\r\n                  onChange={(e) => setRandomCount(Math.max(1, parseInt(e.target.value) || 5))}\r\n                  min=\"1\"\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-center text-sm\"\r\n                  placeholder=\"5\"\r\n                />\r\n                {sequence.length > 0 && (\r\n                  <div className=\"text-xs text-gray-500 text-center\">\r\n                    {(() => {\r\n                      const lastVideo = sequence[sequence.length - 1]\r\n                      const compatibleVideos = videos.filter(video => \r\n                        !sequence.some(seqVideo => seqVideo.id === video.id) &&\r\n                        checkCompatibility(lastVideo, video)\r\n                      )\r\n                      const videosNeeded = randomCount - sequence.length\r\n                      return `${compatibleVideos.length} compatibles disponibles (necesitas ${videosNeeded})`\r\n                    })()}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              <button\r\n                onClick={handleGenerateRandom}\r\n                className=\"flex items-center justify-center space-x-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-colors\"\r\n              >\r\n                <Shuffle className=\"w-4 h-4\" />\r\n                <span>Completar hasta {randomCount}</span>\r\n              </button>\r\n              <button\r\n                onClick={handleClearSequence}\r\n                className=\"flex items-center justify-center space-x-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors\"\r\n              >\r\n                <Trash2 className=\"w-4 h-4\" />\r\n                <span>Limpiar</span>\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Preview en tiempo real */}\r\n          <div className=\"mb-6\">\r\n            <div className=\"bg-gray-50 rounded-lg p-4 border border-gray-200\">\r\n              <h3 className=\"text-lg font-semibold text-gray-800 mb-3 flex items-center\">\r\n                <Play className=\"h-5 w-5 text-blue-600 mr-2\" />\r\n                Preview en Tiempo Real\r\n              </h3>\r\n              \r\n              {isCreatingPreview && (\r\n                <div className=\"flex items-center justify-center py-8\">\r\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3\"></div>\r\n                  <span className=\"text-gray-600\">Generando preview...</span>\r\n                </div>\r\n              )}\r\n              \r\n              {previewError && (\r\n                <div className=\"flex items-center justify-center py-8 text-red-600\">\r\n                  <span>❌ Error: {previewError}</span>\r\n                </div>\r\n              )}\r\n              \r\n              {!isCreatingPreview && !previewError && previewVideoUrl && (\r\n                <div className=\"space-y-4\">\r\n                  {/* Video Player Principal */}\r\n                  {previewVideoUrl === 'sequence-timeline' ? (\r\n                    <SequenceVideoPlayer\r\n                      videos={sequence}\r\n                      currentBPM={currentBPM}\r\n                      className=\"w-full h-96\"\r\n                      showControls={true}\r\n                      autoplay={false}\r\n                      loop={false}\r\n                      muted={false}\r\n                    />\r\n                  ) : (\r\n                    <div className=\"bg-black rounded-lg overflow-hidden\">\r\n                      <VideoPlayer\r\n                        src={previewVideoUrl}\r\n                        className=\"w-full h-96 object-contain\"\r\n                        showControls={true}\r\n                        autoplay={false}\r\n                        loop={false}\r\n                        muted={false}\r\n                        size=\"medium\"\r\n                        videoTitle=\"Preview de Secuencia\"\r\n                      />\r\n                    </div>\r\n                  )}\r\n                  \r\n\r\n                </div>\r\n              )}\r\n              \r\n              {!isCreatingPreview && !previewError && sequence.length === 0 && (\r\n                <div className=\"flex items-center justify-center py-8 text-gray-500\">\r\n                  <span>Añade videos a la secuencia para ver el preview</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n          \r\n\r\n\r\n          {/* Secuencia actual */}\r\n          <div className=\"mb-6\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <h3 className=\"text-lg font-semibold text-gray-700\">Secuencia Actual ({sequence.length} videos)</h3>\r\n              \r\n              {/* Botón de descarga prominente */}\r\n\r\n            </div>\r\n            \r\n            {sequence.length === 0 ? (\r\n              <div className=\"text-center py-8 text-gray-500 bg-gray-50 rounded-lg\">\r\n                <Plus className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\r\n                <p>No hay videos en la secuencia</p>\r\n                <p className=\"text-sm\">Selecciona videos de la galería para comenzar</p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                {sequence.map((video, index) => (\r\n                  <div\r\n                    key={`${video.id}-${index}`}\r\n                    draggable\r\n                    onDragStart={() => handleDragStart(index)}\r\n                    onDragOver={(e) => handleDragOver(e, index)}\r\n                    onDragEnter={(e) => handleDragEnter(e, index)}\r\n                    onDragLeave={handleDragLeave}\r\n                    onDrop={(e) => handleDrop(e, index)}\r\n                    onDragEnd={handleDragEnd}\r\n                    style={getDragStyles(index)}\r\n                    className=\"bg-white rounded-lg shadow-md overflow-hidden border border-gray-100 hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02] relative\"\r\n                  >\r\n                    {/* Header con número de orden y botón eliminar */}\r\n                    <div className=\"absolute top-2 left-2 z-10 flex items-center space-x-2\">\r\n                      <div className=\"bg-purple-500 text-white px-2 py-1 rounded-full text-sm font-bold shadow-lg\">\r\n                        #{index + 1}\r\n                      </div>\r\n                      <button\r\n                        onClick={() => removeVideoFromSequence(index)}\r\n                        className=\"bg-red-500 text-white p-1 rounded-full hover:bg-red-600 transition-colors shadow-lg\"\r\n                        title=\"Eliminar de la secuencia\"\r\n                      >\r\n                        <Trash2 className=\"w-3 h-3\" />\r\n                      </button>\r\n                    </div>\r\n\r\n                    {/* Grip handle para arrastrar */}\r\n                    <div className=\"absolute top-2 right-2 z-10\">\r\n                      <GripVertical className=\"w-5 h-5 text-gray-400 cursor-grab hover:text-gray-600 transition-colors\" />\r\n                    </div>\r\n\r\n                    {/* Thumbnail */}\r\n                    <div className=\"relative group\">\r\n                      <div className=\"w-full aspect-video bg-gradient-to-br from-gray-100 to-gray-200 relative overflow-hidden flex items-center justify-center\">\r\n                        {video.thumbnailUrl && video.thumbnailUrl !== 'https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO' ? (\r\n                          <img\r\n                            src={video.thumbnailUrl}\r\n                            alt={video.title}\r\n                            className=\"w-full h-full object-cover\"\r\n                            loading=\"lazy\"\r\n                            onError={(e) => {\r\n                              e.target.style.display = 'none';\r\n                              e.target.nextSibling.style.display = 'flex';\r\n                            }}\r\n                          />\r\n                        ) : null}\r\n                        <div className={`flex flex-col items-center justify-center text-gray-500 ${video.thumbnailUrl && video.thumbnailUrl !== 'https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO' ? 'hidden' : 'flex'}`}>\r\n                          <svg className=\"w-12 h-12 mb-2 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\" />\r\n                          </svg>\r\n                          <span className=\"text-sm font-medium\">{video.title}</span>\r\n                        </div>\r\n                        <div className=\"absolute bottom-2 left-2 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-sm font-medium\">\r\n                          {video.resolution && video.resolution !== 'Unknown' ? video.resolution : 'HD'}\r\n                        </div>\r\n                        \r\n                        {/* Botón de play */}\r\n                        <button\r\n                          onClick={() => handlePlayVideo(video)}\r\n                          className=\"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-200\"\r\n                        >\r\n                          <svg className=\"w-12 h-12 text-white\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path d=\"M8 5v14l11-7z\"/>\r\n                          </svg>\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    {/* Contenido del card */}\r\n                    <div className=\"p-4\">\r\n                      {/* Título y rating */}\r\n                      <div className=\"flex items-center justify-between mb-2\">\r\n                        <h3 className=\"font-semibold text-gray-800 text-lg truncate\">{video.title}</h3>\r\n                        <div className=\"flex items-center space-x-1\">\r\n                          {[1, 2, 3, 4, 5].map(star => {\r\n                            const isFilled = (video.rating || 0) >= star\r\n                            return (\r\n                              <svg \r\n                                key={star}\r\n                                className={`h-4 w-4 ${isFilled ? 'text-yellow-400 fill-current' : 'text-gray-300'}`} \r\n                                fill=\"currentColor\" \r\n                                viewBox=\"0 0 24 24\"\r\n                              >\r\n                                <path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\"/>\r\n                              </svg>\r\n                            )\r\n                          })}\r\n                          <span className=\"text-xs font-medium text-gray-500 ml-1\">({video.rating || 0})</span>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Descripción */}\r\n                      <p className=\"text-gray-600 text-sm mb-3 line-clamp-2\">{video.description || 'Sin descripción'}</p>\r\n                      \r\n                      {/* Tags Normales */}\r\n                      <div className=\"flex flex-wrap gap-2 mb-3\">\r\n                        {(() => {\r\n                          const orderedTags = getOrderedTags(video)\r\n                          if (orderedTags.length > 0) {\r\n                            return orderedTags.map(({ tag, categoryKey, color }) => (\r\n                              <span\r\n                                key={`${categoryKey}-${tag}`}\r\n                                className={`px-2 py-1 rounded-full text-xs font-medium ${getColorClasses(color)}`}\r\n                              >\r\n                                {tag}\r\n                              </span>\r\n                            ))\r\n                          } else {\r\n                            return <span className=\"text-gray-400 text-sm\">Sin etiquetas</span>\r\n                          }\r\n                        })()}\r\n                      </div>\r\n\r\n                      {/* Tags Iniciales */}\r\n                      {(() => {\r\n                        const tagsIniciales = getOrderedTagsIniciales(video)\r\n                        if (tagsIniciales.length > 0) {\r\n                          return (\r\n                            <div className=\"mb-3\">\r\n                              <div className=\"flex items-center space-x-2 mb-2\">\r\n                                <span className=\"text-xs font-medium text-blue-600 uppercase tracking-wide\">Iniciales:</span>\r\n                              </div>\r\n                              <div className=\"flex flex-wrap gap-2\">\r\n                                {tagsIniciales.map(({ tag, categoryKey, color }) => (\r\n                                  <span\r\n                                    key={`inicial-${categoryKey}-${tag}`}\r\n                                    className=\"px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-sm\"\r\n                                  >\r\n                                    {tag}\r\n                                  </span>\r\n                                ))}\r\n                              </div>\r\n                            </div>\r\n                          )\r\n                        }\r\n                        return null\r\n                      })()}\r\n\r\n                      {/* Tags Finales */}\r\n                      {(() => {\r\n                        const tagsFinales = getOrderedTagsFinales(video)\r\n                        if (tagsFinales.length > 0) {\r\n                          return (\r\n                            <div className=\"mb-3\">\r\n                              <div className=\"flex items-center space-x-2 mb-2\">\r\n                                <span className=\"text-xs font-medium text-green-600 uppercase tracking-wide\">Finales:</span>\r\n                              </div>\r\n                              <div className=\"flex flex-wrap gap-2\">\r\n                                {tagsFinales.map(({ tag, categoryKey, color }) => (\r\n                                  <span\r\n                                    key={`final-${categoryKey}-${tag}`}\r\n                                    className=\"px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-sm\"\r\n                                  >\r\n                                    {tag}\r\n                                  </span>\r\n                                ))}\r\n                              </div>\r\n                            </div>\r\n                          )\r\n                        }\r\n                        return null\r\n                      })()}\r\n                      \r\n                      {/* Stats del video */}\r\n                      <div className=\"flex items-center justify-between text-sm text-gray-500 pt-2 border-t border-gray-100\">\r\n                        <div className=\"flex items-center space-x-2\">\r\n                          <span className=\"font-medium\">\r\n                            {(video.fileSize / (1024 * 1024)).toFixed(2)} MB\r\n                          </span>\r\n                          <span className=\"text-gray-400\">•</span>\r\n                          <span className=\"text-gray-600\">\r\n                            {video.resolution && video.resolution !== 'Unknown' ? \r\n                              video.resolution : \r\n                              'HD'\r\n                            }\r\n                          </span>\r\n                          <span className=\"text-gray-400\">•</span>\r\n                          <div className=\"flex items-center space-x-1\">\r\n                            <Music className=\"h-3 w-3 text-purple-500\" />\r\n                            <span className=\"font-medium text-purple-600\">{video.bpm || 'N/A'} BPM</span>\r\n                          </div>\r\n                        </div>\r\n                        <button \r\n                          onClick={() => handleVideoLike(video)}\r\n                          className={`flex items-center space-x-1 transition-colors duration-200 p-1 rounded hover:bg-red-50 ${\r\n                            video.userLiked ? 'text-red-500' : 'text-gray-400 hover:text-red-500'\r\n                          }`}\r\n                          title={video.userLiked ? 'Quitar like' : 'Dar like'}\r\n                        >\r\n                          <Heart className={`h-4 w-4 ${video.userLiked ? 'fill-current' : ''}`} />\r\n                          <span className=\"font-medium\">{video.likes || 0}</span>\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Tags de Secuencia */}\r\n          <div className=\"mb-6\">\r\n            <div className=\"bg-white rounded-lg shadow-md p-4 border border-gray-200\">\r\n              {/* Header con toggle */}\r\n              <div className=\"flex items-center justify-between mb-3\">\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <svg className=\"h-5 w-5 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\" />\r\n                  </svg>\r\n                  <h3 className=\"text-lg font-semibold text-gray-800\">Tags de Secuencia</h3>\r\n                </div>\r\n                <button\r\n                  onClick={() => setIsTagsSectionCollapsed(!isTagsSectionCollapsed)}\r\n                  className=\"p-1 text-gray-500 hover:text-gray-700 transition-colors\"\r\n                  title={isTagsSectionCollapsed ? \"Expandir tags\" : \"Colapsar tags\"}\r\n                >\r\n                  <svg \r\n                    className={`w-4 h-4 transform transition-transform ${isTagsSectionCollapsed ? 'rotate-90' : ''}`}\r\n                    fill=\"none\" \r\n                    stroke=\"currentColor\" \r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n\r\n              {/* Tags seleccionados */}\r\n              {(() => {\r\n                const orderedTags = getOrderedSequenceTags()\r\n                if (orderedTags.length > 0) {\r\n                  return (\r\n                    <div className=\"mb-3\">\r\n                      <div className=\"flex flex-wrap gap-2\">\r\n                        {orderedTags.map(({ tag, categoryKey, color }) => (\r\n                          <span\r\n                            key={`${categoryKey}-${tag}`}\r\n                            className={`px-3 py-1 rounded-full text-sm font-medium ${getColorClasses(color)} flex items-center space-x-1`}\r\n                          >\r\n                            <span>{tag}</span>\r\n                            <button\r\n                              onClick={() => handleTagToggle(categoryKey, tag)}\r\n                              className=\"ml-1 hover:bg-black hover:bg-opacity-20 rounded-full p-0.5\"\r\n                            >\r\n                              <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                              </svg>\r\n                            </button>\r\n                          </span>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  )\r\n                }\r\n                return null\r\n              })()}\r\n\r\n              {/* Categorías de tags - Sección colapsable */}\r\n              <div className={`overflow-hidden transition-all duration-300 ease-in-out ${\r\n                isTagsSectionCollapsed ? 'max-h-0 opacity-0' : 'max-h-96 opacity-100'\r\n              }`}>\r\n                <div className=\"space-y-4\">\r\n                  {categoriesList.map(category => (\r\n                    <div key={category.key} className=\"border-t border-gray-100 pt-3\">\r\n                      <h4 className=\"text-sm font-medium text-gray-700 mb-2 flex items-center space-x-2\">\r\n                        <span className={`w-3 h-3 rounded-full ${getColorClasses(category.color).replace('text-', 'bg-')}`}></span>\r\n                        <span>{category.name}</span>\r\n                      </h4>\r\n                      <div className=\"flex flex-wrap gap-2\">\r\n                        {category.tags.map(tag => (\r\n                          <button\r\n                            key={tag}\r\n                            onClick={() => handleTagToggle(category.key, tag)}\r\n                            className={`px-3 py-1 rounded-full text-sm font-medium transition-colors ${\r\n                              isTagSelected(category.key, tag)\r\n                                ? getColorClasses(category.color)\r\n                                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\r\n                            }`}\r\n                          >\r\n                            {tag}\r\n                          </button>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Botones de guardar/cancelar */}\r\n          <div className=\"flex space-x-3 pt-4 border-t\">\r\n            <button\r\n              onClick={handleSaveSequence}\r\n              disabled={sequence.length === 0 || !sequenceName.trim()}\r\n              className=\"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-lg transition-colors\"\r\n            >\r\n              <Save className=\"w-4 h-4\" />\r\n              <span>{editingSequenceId ? 'Actualizar Secuencia' : 'Guardar Secuencia'}</span>\r\n            </button>\r\n            <button\r\n              onClick={handleCancel}\r\n              className=\"px-6 py-2 border border-gray-300 hover:bg-gray-50 rounded-lg transition-colors\"\r\n            >\r\n              Cancelar\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Modal de video individual */}\r\n      {showVideoModal && selectedVideo && (\r\n                <div\r\n          className=\"fixed inset-0 bg-black bg-opacity-95 flex items-center justify-center z-50 p-4\"\r\n          onClick={() => setShowVideoModal(false)}\r\n        >\r\n          <div\r\n            className=\"bg-black rounded-lg overflow-hidden w-full max-w-6xl max-h-[95vh] flex flex-col\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between p-4 border-b border-gray-700 bg-gray-900\">\r\n              <h3 className=\"text-xl font-semibold text-white\">{selectedVideo.title}</h3>\r\n              <button \r\n                onClick={() => setShowVideoModal(false)}\r\n                className=\"text-gray-400 hover:text-white text-2xl font-bold p-2 hover:bg-gray-800 rounded transition-colors\"\r\n              >\r\n                &times;\r\n              </button>\r\n            </div>\r\n            \r\n            {/* Video Player */}\r\n            <div className=\"flex-1 bg-black flex items-center justify-center p-4\">\r\n              <div className=\"w-full h-full flex items-center justify-center\">\r\n                <VideoPlayer\r\n                  src={selectedVideo.videoUrl}\r\n                  className=\"max-w-full max-h-full object-contain\"\r\n                  showControls={true}\r\n                  autoplay={false}\r\n                  loop={false}\r\n                  muted={false}\r\n                  resolutions={getAvailableResolutions(selectedVideo)}\r\n                  currentResolution=\"auto\"\r\n                  videoTitle={selectedVideo.title}\r\n                  size=\"fullscreen\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n\r\n\r\n      {/* Modales */}\r\n      <ConfirmModal\r\n        isOpen={confirmModal.isOpen}\r\n        onClose={() => setConfirmModal({ isOpen: false, type: null })}\r\n        onConfirm={handleConfirmAction}\r\n        title={\r\n          confirmModal.type === 'cancel' \r\n            ? '¿Cancelar secuencia?' \r\n            : '¿Limpiar secuencia?'\r\n        }\r\n        message={\r\n          confirmModal.type === 'cancel'\r\n            ? '¿Estás seguro de que quieres cancelar? Se perderán todos los cambios.'\r\n            : '¿Estás seguro de que quieres limpiar la secuencia actual?'\r\n        }\r\n        confirmText=\"Confirmar\"\r\n        cancelText=\"Cancelar\"\r\n      />\r\n\r\n      {/* Toasts */}\r\n      {toasts.map(toast => (\r\n        <Toast\r\n          key={toast.id}\r\n          message={toast.message}\r\n          type={toast.type}\r\n          onClose={() => removeToast(toast.id)}\r\n        />\r\n      ))}\r\n\r\n      {/* Modal de descarga */}\r\n      <VideoDownloadModal\r\n        isOpen={showDownloadModal}\r\n        onClose={() => setShowDownloadModal(false)}\r\n        videos={sequence}\r\n        sequenceName={sequenceName || 'Secuencia'}\r\n      />\r\n    </>\r\n  )\r\n}\r\n\r\nexport default SequenceBuilder ","// 🖼️ COMPONENTE SMART THUMBNAIL - SALSAHACKS V2.0\r\n\r\nimport React, { useState } from 'react'\r\nimport { Image, Play } from 'lucide-react'\r\n\r\nconst SmartThumbnail = ({ \r\n  src, \r\n  alt, \r\n  className = '', \r\n  fallbackSrc = '/placeholder-video.svg',\r\n  showPlayIcon = false,\r\n  ...props \r\n}) => {\r\n  const [imageError, setImageError] = useState(false)\r\n  const [isLoading, setIsLoading] = useState(true)\r\n\r\n  const handleImageLoad = () => {\r\n    setIsLoading(false)\r\n    setImageError(false)\r\n  }\r\n\r\n  const handleImageError = () => {\r\n    setIsLoading(false)\r\n    setImageError(true)\r\n  }\r\n\r\n  // Si no hay src o es una URL placeholder, mostrar fallback directamente\r\n  const shouldShowFallback = !src || \r\n    src === null ||\r\n    src === undefined ||\r\n    src === 'https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO' ||\r\n    src === 'https://via.placeholder.com/300x200/1a1a1a/ffffff?text=EVENTO'\r\n  \r\n  const imageSrc = shouldShowFallback || imageError ? fallbackSrc : src\r\n\r\n  return (\r\n    <div className={`relative ${className}`} {...props}>\r\n      {/* Estado de carga mejorado */}\r\n      {isLoading && (\r\n        <div className=\"absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-200 animate-pulse flex items-center justify-center\">\r\n          <div className=\"relative\">\r\n            <div className=\"w-8 h-8 border-3 border-gray-300 border-t-pink-500 rounded-full animate-spin\"></div>\r\n            <div className=\"absolute inset-0 w-8 h-8 border-3 border-transparent border-t-pink-300 rounded-full animate-spin\" style={{animationDelay: '-0.5s'}}></div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Imagen */}\r\n      <img\r\n        src={imageSrc}\r\n        alt={alt}\r\n        className={`w-full h-full object-cover transition-all duration-300 ${\r\n          isLoading ? 'opacity-0 scale-95' : 'opacity-100 scale-100'\r\n        }`}\r\n        onLoad={handleImageLoad}\r\n        onError={handleImageError}\r\n        loading=\"lazy\"\r\n        decoding=\"async\"\r\n        fetchPriority=\"high\"\r\n      />\r\n\r\n      {/* Icono de reproducción (opcional) */}\r\n      {showPlayIcon && !isLoading && (\r\n        <div className=\"absolute inset-0 bg-black bg-opacity-20 flex items-center justify-center\">\r\n          <div className=\"w-8 h-8 bg-white bg-opacity-90 rounded-full flex items-center justify-center\">\r\n            <Play className=\"w-4 h-4 text-gray-800 fill-current\" />\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Fallback cuando no hay imagen */}\r\n      {(imageError || shouldShowFallback) && !isLoading && (\r\n        <div className=\"absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center\">\r\n          <div className=\"text-center\">\r\n            <Image className=\"w-8 h-8 text-gray-400 mx-auto mb-2\" />\r\n            <p className=\"text-xs text-gray-500 font-medium\">Sin miniatura</p>\r\n            {showPlayIcon && (\r\n              <div className=\"mt-2 w-6 h-6 bg-white bg-opacity-90 rounded-full flex items-center justify-center mx-auto\">\r\n                <Play className=\"w-3 h-3 text-gray-600 fill-current\" />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default SmartThumbnail ","// 🎬 COMPONENTE GALERÍA DE SECUENCIAS - SALSAHACKS V2.0\r\n\r\nimport React, { useState } from 'react'\r\nimport { \r\n  Play, \r\n  Edit3, \r\n  Trash2, \r\n  Download, \r\n  Clock,\r\n  Users,\r\n  Calendar,\r\n  Tag,\r\n  Image\r\n} from 'lucide-react'\r\nimport ConfirmModal from '../common/ConfirmModal'\r\nimport Toast from '../common/Toast'\r\nimport SmartThumbnail from '../common/SmartThumbnail.jsx'\r\nimport { useCategories } from '../../hooks/useCategories'\r\nimport { useCardSize } from '../../contexts/CardSizeContext'\r\n\r\nconst SequenceGallery = ({ \r\n  sequences, \r\n  onDeleteSequence, \r\n  onPlaySequence,\r\n  onEditSequence,\r\n  onEditThumbnail,\r\n  onDownloadSequence \r\n}) => {\r\n  const [toasts, setToasts] = useState([])\r\n  const [deleteModal, setDeleteModal] = useState({ isOpen: false, sequence: null })\r\n  \r\n  // Usar el hook de categorías para obtener getColorClasses\r\n  const { getColorClasses } = useCategories('figuras', 'salsa')\r\n  const { getSequenceConfig } = useCardSize()\r\n\r\n  const addToast = (message, type = 'success') => {\r\n    const id = Date.now()\r\n    setToasts(prev => [...prev, { id, message, type }])\r\n  }\r\n\r\n  const removeToast = (id) => {\r\n    setToasts(prev => prev.filter(toast => toast.id !== id))\r\n  }\r\n\r\n  const handleDeleteClick = (sequence) => {\r\n    setDeleteModal({ isOpen: true, sequence })\r\n  }\r\n\r\n  const handleConfirmDelete = async () => {\r\n    try {\r\n      await onDeleteSequence(deleteModal.sequence.id)\r\n      addToast('Secuencia eliminada exitosamente')\r\n    } catch (error) {\r\n      addToast('Error al eliminar la secuencia', 'error')\r\n    }\r\n    setDeleteModal({ isOpen: false, sequence: null })\r\n  }\r\n\r\n  const handlePlaySequence = (sequence) => {\r\n    try {\r\n      onPlaySequence(sequence)\r\n      addToast('Reproduciendo secuencia')\r\n    } catch (error) {\r\n      addToast('Error al reproducir la secuencia', 'error')\r\n    }\r\n  }\r\n\r\n  const handleDownloadSequence = (sequence) => {\r\n    try {\r\n      if (onDownloadSequence) {\r\n        onDownloadSequence(sequence)\r\n        addToast('Abriendo opciones de descarga')\r\n      } else {\r\n        addToast('Funcionalidad de descarga no disponible', 'warning')\r\n      }\r\n    } catch (error) {\r\n      addToast('Error al abrir descarga', 'error')\r\n    }\r\n  }\r\n\r\n  const formatDate = (dateString) => {\r\n    const date = new Date(dateString)\r\n    return date.toLocaleDateString('es-ES', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    })\r\n  }\r\n\r\n  const getTotalDuration = (videos) => {\r\n    // Calcular duración total aproximada (asumiendo 30 segundos por video)\r\n    const totalSeconds = videos.length * 30\r\n    const minutes = Math.floor(totalSeconds / 60)\r\n    const seconds = totalSeconds % 60\r\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`\r\n  }\r\n\r\n  const getOrderedSequenceTags = (sequence) => {\r\n    if (!sequence.tags || Object.keys(sequence.tags).length === 0) {\r\n      return []\r\n    }\r\n    \r\n    const orderedTags = []\r\n    const categoriesList = [\r\n      { key: 'dificultad', color: 'red' },\r\n      { key: 'estilo', color: 'blue' },\r\n      { key: 'nivel', color: 'green' },\r\n      { key: 'figura', color: 'purple' },\r\n      { key: 'posicion', color: 'orange' },\r\n      { key: 'transicion', color: 'teal' }\r\n    ]\r\n    \r\n    categoriesList.forEach(category => {\r\n      const categoryTags = sequence.tags[category.key]\r\n      if (Array.isArray(categoryTags)) {\r\n        categoryTags.forEach(tag => {\r\n          orderedTags.push({\r\n            tag,\r\n            categoryKey: category.key,\r\n            color: category.color\r\n          })\r\n        })\r\n      }\r\n    })\r\n    \r\n    return orderedTags\r\n  }\r\n\r\n  if (sequences.length === 0) {\r\n    return (\r\n      <div className=\"text-center py-12\">\r\n        <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n          <Play className=\"w-8 h-8 text-gray-400\" />\r\n        </div>\r\n        <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No hay secuencias guardadas</h3>\r\n        <p className=\"text-gray-500 mb-4\">Crea tu primera secuencia usando el constructor de secuencias</p>\r\n        <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto\">\r\n          <h4 className=\"font-medium text-blue-900 mb-2\">¿Cómo crear una secuencia?</h4>\r\n          <ol className=\"text-sm text-blue-800 space-y-1 text-left\">\r\n            <li>1. Haz clic en \"CREAR SECUENCIA\"</li>\r\n            <li>2. Añade videos con el botón \"+\" de la galería</li>\r\n            <li>3. Escribe un nombre para la secuencia</li>\r\n            <li>4. Haz clic en \"Guardar Secuencia\"</li>\r\n            <li>5. ¡Listo! Aparecerá aquí automáticamente</li>\r\n          </ol>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Grid de secuencias */}\r\n      <div className={`grid gap-6 ${getSequenceConfig().grid}`}>\r\n        {sequences.map((sequence) => (\r\n          <div\r\n            key={sequence.id}\r\n            className=\"bg-white rounded-lg shadow-md overflow-hidden border border-gray-100 hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02]\"\r\n          >\r\n            {/* Thumbnail */}\r\n            <div className=\"relative group\">\r\n              <div className={`w-full ${getSequenceConfig().aspect} bg-gradient-to-br from-gray-100 to-gray-200 relative overflow-hidden flex items-center justify-center`}>\r\n                {sequence.thumbnailUrl ? (\r\n                  <SmartThumbnail\r\n                    src={sequence.thumbnailUrl}\r\n                    alt={sequence.name}\r\n                    className=\"w-full h-full object-cover\"\r\n                  />\r\n                ) : (\r\n                  <div className=\"flex flex-col items-center justify-center text-gray-500\">\r\n                    <Play className=\"w-12 h-12 mb-2 text-gray-400\" />\r\n                    <span className=\"text-sm font-medium\">{sequence.name}</span>\r\n                  </div>\r\n                )}\r\n                \r\n                {/* Badge de resolución */}\r\n                <div className=\"absolute bottom-2 left-2 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-sm font-medium\">\r\n                  {sequence.resolution && sequence.resolution !== 'Unknown' ? sequence.resolution : 'HD'}\r\n                </div>\r\n                \r\n                {/* Botón de editar thumbnail */}\r\n                <button\r\n                  onClick={(e) => {\r\n                    e.stopPropagation()\r\n                    onEditThumbnail && onEditThumbnail(sequence)\r\n                  }}\r\n                  className=\"absolute top-2 right-2 bg-black bg-opacity-75 text-white p-1 rounded hover:bg-opacity-90 transition-colors\"\r\n                  title=\"Editar thumbnail\"\r\n                >\r\n                  <Image className=\"w-3 h-3\" />\r\n                </button>\r\n                \r\n                {/* Botón de reproducción */}\r\n                <button\r\n                  onClick={() => handlePlaySequence(sequence)}\r\n                  className=\"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-200\"\r\n                >\r\n                  <Play className=\"w-12 h-12 text-white\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Contenido del card */}\r\n            <div className={`${getSequenceConfig().compact ? 'p-2' : 'p-4'}`}>\r\n              {/* Título y rating */}\r\n              <div className={`flex items-center justify-between ${getSequenceConfig().compact ? 'mb-1' : 'mb-2'}`}>\r\n                <h3 className={`font-semibold text-gray-800 ${getSequenceConfig().titleSize} truncate`}>{sequence.name}</h3>\r\n                <div className=\"flex items-center space-x-1\">\r\n                  <span className={`bg-blue-100 text-blue-800 px-2 py-1 rounded-full ${getSequenceConfig().compact ? 'text-xs' : 'text-xs'} font-medium`}>\r\n                    {sequence.videos.length} videos\r\n                  </span>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Descripción o Iconos */}\r\n              {getSequenceConfig().showIcons ? (\r\n                // Mostrar solo número de videos en tamaños pequeños y medianos\r\n                <div className=\"flex items-center justify-center text-gray-500 mb-2\">\r\n                  <div className=\"flex items-center space-x-1\">\r\n                    <Users className=\"w-3 h-3\" />\r\n                    <span className=\"text-xs font-medium\">{sequence.videos.length} videos</span>\r\n                  </div>\r\n                </div>\r\n              ) : (\r\n                // Mostrar descripción en tamaños grandes\r\n                <p className={`text-gray-600 text-sm ${getSequenceConfig().compact ? 'mb-2' : 'mb-3'} ${getSequenceConfig().descriptionLines === 1 ? 'line-clamp-1' : getSequenceConfig().descriptionLines === 2 ? 'line-clamp-2' : getSequenceConfig().descriptionLines === 3 ? 'line-clamp-3' : 'line-clamp-4'}`}>{sequence.description || 'Sin descripción'}</p>\r\n              )}\r\n              \r\n              {/* Tags de la secuencia */}\r\n              {getSequenceConfig().showTags && (\r\n                <div className=\"flex flex-wrap gap-2 mb-3\">\r\n                  {(() => {\r\n                    const orderedTags = getOrderedSequenceTags(sequence)\r\n                    if (orderedTags.length > 0) {\r\n                      return orderedTags.map(({ tag, categoryKey, color }) => (\r\n                        <span\r\n                          key={`${categoryKey}-${tag}`}\r\n                          className={`px-2 py-1 rounded-full text-xs font-medium ${getColorClasses(color)}`}\r\n                        >\r\n                          {tag}\r\n                        </span>\r\n                      ))\r\n                    } else {\r\n                      return <span className=\"text-gray-400 text-sm\">Sin etiquetas</span>\r\n                    }\r\n                  })()}\r\n                </div>\r\n              )}\r\n              \r\n              {/* Stats del video */}\r\n              {getSequenceConfig().showStats && (\r\n                <div className=\"flex items-center justify-between text-sm text-gray-500 pt-2 border-t border-gray-100\">\r\n                  {/* Información de stats - solo en tamaños grandes */}\r\n                  {!getSequenceConfig().compact && (\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <Users className=\"w-4 h-4\" />\r\n                      <span className=\"font-medium\">\r\n                        {sequence.videos.length} videos\r\n                      </span>\r\n                      <span className=\"text-gray-400\">•</span>\r\n                      <span className=\"text-gray-600\">\r\n                        {sequence.resolution && sequence.resolution !== 'Unknown' ? \r\n                          sequence.resolution : \r\n                          'HD'\r\n                        }\r\n                      </span>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* Botones de acción - siempre visibles */}\r\n                  <div className={`flex items-center space-x-2 ${getSequenceConfig().compact ? 'w-full justify-center' : ''}`}>\r\n                    <button\r\n                      onClick={() => handleDownloadSequence(sequence)}\r\n                      className=\"text-gray-400 hover:text-green-500 transition-colors duration-200 p-1 rounded hover:bg-green-50\"\r\n                      title=\"Descargar secuencia\"\r\n                    >\r\n                      <Download className={`${getSequenceConfig().compact ? 'h-3 w-3' : 'h-4 w-4'}`} />\r\n                    </button>\r\n                    <button\r\n                      onClick={() => onEditSequence(sequence)}\r\n                      className=\"text-gray-400 hover:text-blue-500 transition-colors duration-200 p-1 rounded hover:bg-blue-50\"\r\n                      title=\"Editar secuencia\"\r\n                    >\r\n                      <Edit3 className={`${getSequenceConfig().compact ? 'h-3 w-3' : 'h-4 w-4'}`} />\r\n                    </button>\r\n                    <button\r\n                      onClick={() => handleDeleteClick(sequence)}\r\n                      className=\"text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 rounded hover:bg-red-50\"\r\n                      title=\"Eliminar secuencia\"\r\n                    >\r\n                      <Trash2 className={`${getSequenceConfig().compact ? 'h-3 w-3' : 'h-4 w-4'}`} />\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n           </div>\r\n         </div>\r\n       ))}\r\n     </div>\r\n\r\n      {/* Modal de confirmación de eliminación */}\r\n      <ConfirmModal\r\n        isOpen={deleteModal.isOpen}\r\n        onClose={() => setDeleteModal({ isOpen: false, sequence: null })}\r\n        onConfirm={handleConfirmDelete}\r\n        title=\"¿Eliminar secuencia?\"\r\n        message={`¿Estás seguro de que quieres eliminar la secuencia \"${deleteModal.sequence?.name}\"? Esta acción no se puede deshacer.`}\r\n        confirmText=\"Eliminar\"\r\n        cancelText=\"Cancelar\"\r\n        confirmClassName=\"bg-red-500 hover:bg-red-600\"\r\n      />\r\n\r\n      {/* Toasts */}\r\n      {toasts.map(toast => (\r\n        <Toast\r\n          key={toast.id}\r\n          message={toast.message}\r\n          type={toast.type}\r\n          onClose={() => removeToast(toast.id)}\r\n        />\r\n      ))}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default SequenceGallery ","// 🎴 SELECTOR DE TAMAÑOS DE CARDS - SALSAHACKS V2.0\r\n\r\nimport React from 'react'\r\nimport { Grid, Grid3X3, Square, LayoutGrid } from 'lucide-react'\r\nimport { useCardSize } from '../../contexts/CardSizeContext'\r\n\r\nconst CardSizeSelector = ({ type = 'video' }) => {\r\n  const {\r\n    videoCardSize,\r\n    sequenceCardSize,\r\n    setVideoCardSize,\r\n    setSequenceCardSize,\r\n    availableSizes,\r\n    sizeLabels\r\n  } = useCardSize()\r\n\r\n  const currentSize = type === 'video' ? videoCardSize : sequenceCardSize\r\n  const setSize = type === 'video' ? setVideoCardSize : setSequenceCardSize\r\n\r\n  // Iconos para cada tamaño\r\n  const sizeIcons = {\r\n    small: <LayoutGrid className=\"h-4 w-4\" />,\r\n    medium: <Grid3X3 className=\"h-4 w-4\" />,\r\n    large: <Grid className=\"h-4 w-4\" />,\r\n    'extra-large': <Square className=\"h-4 w-4\" />\r\n  }\r\n\r\n  // Colores para cada tamaño\r\n  const sizeColors = {\r\n    small: 'from-gray-400 to-gray-500',\r\n    medium: 'from-blue-400 to-blue-500',\r\n    large: 'from-purple-400 to-purple-500',\r\n    'extra-large': 'from-pink-400 to-pink-500'\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex items-center space-x-2\">\r\n      <span className=\"text-sm font-medium text-gray-700 mr-2\">\r\n        Tamaño:\r\n      </span>\r\n      <div className=\"flex bg-gray-100 rounded-lg p-1\">\r\n        {availableSizes.map((size) => (\r\n          <button\r\n            key={size}\r\n            onClick={() => setSize(size)}\r\n            className={`flex items-center space-x-1 px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 ${\r\n              currentSize === size\r\n                ? `bg-gradient-to-r ${sizeColors[size]} text-white shadow-lg transform scale-105`\r\n                : 'text-gray-600 hover:text-gray-800 hover:bg-white'\r\n            }`}\r\n            title={`${sizeLabels[size]} - ${size} cards`}\r\n          >\r\n            {sizeIcons[size]}\r\n            <span className=\"hidden sm:inline\">{sizeLabels[size]}</span>\r\n          </button>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default CardSizeSelector\r\n\r\n","// 🎴 ACCIONES COMPACTAS PARA CARDS - SALSAHACKS V2.0\r\n\r\nimport React from 'react'\r\nimport { Heart, Edit, Trash2, Plus, Download, Play } from 'lucide-react'\r\n\r\nconst CompactCardActions = ({ \r\n  video, \r\n  onLike, \r\n  onEdit, \r\n  onDelete, \r\n  onAddToSequence, \r\n  onDownload, \r\n  onPlay,\r\n  isVideoInSequence,\r\n  isBuilderOpen,\r\n  isVideoCompatible,\r\n  type = 'video' // 'video' o 'sequence'\r\n}) => {\r\n  if (type === 'video') {\r\n    return (\r\n      <div className=\"flex items-center justify-center space-x-1 mt-2\">\r\n        {/* Botón de reproducción */}\r\n        <button\r\n          onClick={onPlay}\r\n          className=\"p-1 text-gray-400 hover:text-blue-500 transition-colors rounded\"\r\n          title=\"Reproducir\"\r\n        >\r\n          <Play className=\"h-3 w-3\" />\r\n        </button>\r\n        \r\n        {/* Botón de like */}\r\n        <button\r\n          onClick={onLike}\r\n          className={`p-1 transition-colors rounded ${\r\n            video.userLiked ? 'text-red-500' : 'text-gray-400 hover:text-red-500'\r\n          }`}\r\n          title={video.userLiked ? 'Quitar like' : 'Dar like'}\r\n        >\r\n          <Heart className={`h-3 w-3 ${video.userLiked ? 'fill-current' : ''}`} />\r\n        </button>\r\n        \r\n        {/* Botón de añadir a secuencia */}\r\n        <button\r\n          onClick={onAddToSequence}\r\n          disabled={isVideoInSequence}\r\n          className={`p-1 transition-colors rounded ${\r\n            isVideoInSequence\r\n              ? 'text-gray-300 cursor-not-allowed'\r\n              : isBuilderOpen && !isVideoCompatible\r\n              ? 'text-red-400 hover:text-red-500'\r\n              : 'text-gray-400 hover:text-purple-500'\r\n          }`}\r\n          title={\r\n            isVideoInSequence \r\n              ? 'Ya en secuencia' \r\n              : isBuilderOpen && !isVideoCompatible\r\n              ? 'Añadir forzadamente'\r\n              : 'Añadir a secuencia'\r\n          }\r\n        >\r\n          <Plus className=\"h-3 w-3\" />\r\n        </button>\r\n        \r\n        {/* Botón de descargar */}\r\n        <button\r\n          onClick={onDownload}\r\n          className=\"p-1 text-gray-400 hover:text-green-500 transition-colors rounded\"\r\n          title=\"Descargar\"\r\n        >\r\n          <Download className=\"h-3 w-3\" />\r\n        </button>\r\n        \r\n        {/* Botón de editar */}\r\n        <button\r\n          onClick={onEdit}\r\n          className=\"p-1 text-gray-400 hover:text-blue-500 transition-colors rounded\"\r\n          title=\"Editar\"\r\n        >\r\n          <Edit className=\"h-3 w-3\" />\r\n        </button>\r\n        \r\n        {/* Botón de eliminar */}\r\n        <button\r\n          onClick={onDelete}\r\n          className=\"p-1 text-gray-400 hover:text-red-500 transition-colors rounded\"\r\n          title=\"Eliminar\"\r\n        >\r\n          <Trash2 className=\"h-3 w-3\" />\r\n        </button>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Para secuencias\r\n  return (\r\n    <div className=\"flex items-center justify-center space-x-1 mt-2\">\r\n      {/* Botón de reproducción */}\r\n      <button\r\n        onClick={onPlay}\r\n        className=\"p-1 text-gray-400 hover:text-blue-500 transition-colors rounded\"\r\n        title=\"Reproducir secuencia\"\r\n      >\r\n        <Play className=\"h-3 w-3\" />\r\n      </button>\r\n      \r\n      {/* Botón de descargar */}\r\n      <button\r\n        onClick={onDownload}\r\n        className=\"p-1 text-gray-400 hover:text-green-500 transition-colors rounded\"\r\n        title=\"Descargar secuencia\"\r\n      >\r\n        <Download className=\"h-3 w-3\" />\r\n      </button>\r\n      \r\n      {/* Botón de editar */}\r\n      <button\r\n        onClick={onEdit}\r\n        className=\"p-1 text-gray-400 hover:text-blue-500 transition-colors rounded\"\r\n        title=\"Editar secuencia\"\r\n      >\r\n        <Edit className=\"h-3 w-3\" />\r\n      </button>\r\n      \r\n      {/* Botón de eliminar */}\r\n      <button\r\n        onClick={onDelete}\r\n        className=\"p-1 text-gray-400 hover:text-red-500 transition-colors rounded\"\r\n        title=\"Eliminar secuencia\"\r\n      >\r\n        <Trash2 className=\"h-3 w-3\" />\r\n      </button>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default CompactCardActions\r\n","import React, { useState, useEffect } from 'react'\nimport { \n  Search, \n  Upload, \n  Plus, \n  Heart, \n  Music,\n  Trash2,\n  Filter,\n  X,\n  ChevronDown,\n  ChevronUp,\n  Star,\n  Zap,\n  Edit,\n  Download,\n  Maximize2,\n  Minimize2,\n  Play,\n  Shuffle,\n  Eye,\n  EyeOff\n} from 'lucide-react'\nimport { useCategories } from '../hooks/useCategories'\nimport CategoryBadge from '../components/common/CategoryBadge'\nimport VideoUploadModal from '../components/video/VideoUploadModal'\nimport VideoEditModal from '../components/video/VideoEditModal'\nimport VideoPlayer from '../components/video/VideoPlayer'\nimport DownloadModal from '../components/video/DownloadModal'\nimport ConfirmModal from '../components/common/ConfirmModal'\nimport Toast from '../components/common/Toast'\nimport SequenceBuilder from '../components/sequence/SequenceBuilder'\nimport SequenceGallery from '../components/sequence/SequenceGallery'\nimport SequenceVideoPlayer from '../components/sequence/SequenceVideoPlayer'\nimport CardSizeSelector from '../components/common/CardSizeSelector'\nimport CompactCardActions from '../components/common/CompactCardActions'\nimport CategoryChips from '../components/common/CategoryChips'\nimport { useSequenceBuilderContext } from '../contexts/SequenceBuilderContext'\n\nimport { \n  getVideos, \n  deleteVideoDocument, \n  subscribeToVideosByStyle,\n  deleteAllVideos,\n  updateVideoThumbnailPaths,\n  diagnoseVideos,\n  updateVideoDocument,\n  cleanupDuplicateTags,\n  toggleVideoLike,\n  checkUserLikedVideo,\n  checkUserFavorite\n} from '../services/firebase/firestore'\nimport {\n  createSequence,\n  getSequencesByStyle,\n  deleteSequence,\n  subscribeToSequencesByStyle,\n  updateSequence\n} from '../services/firebase/sequences'\nimport { \n  deleteVideo, \n  deleteAllVideoFiles, \n  cleanupOrphanedFiles,\n  getFileURL,\n  migrateVideosToOrganizedStructure\n} from '../services/firebase/storage'\nimport { useAuth } from '../contexts/AuthContext'\nimport { useTheme } from '../contexts/ThemeContext'\nimport { useCardSize } from '../contexts/CardSizeContext'\n\nconst FigurasPage = () => {\n  const [isUploadModalOpen, setIsUploadModalOpen] = useState(false)\n  const [editModal, setEditModal] = useState({ isOpen: false, video: null })\n  const [videos, setVideos] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [toasts, setToasts] = useState([])\n  const [deleteModal, setDeleteModal] = useState({ isOpen: false, video: null })\n  const [selectedTags, setSelectedTags] = useState([])\n  const [searchTerm, setSearchTerm] = useState('')\n  const [showFilters, setShowFilters] = useState(false)\n  const [activeTab, setActiveTab] = useState('videos')\n  const [syncStatus, setSyncStatus] = useState('idle') // idle, syncing, error\n  const [cleanupModal, setCleanupModal] = useState({ isOpen: false, type: null })\n  const [editSequenceModal, setEditSequenceModal] = useState({ isOpen: false, sequence: null })\n  const [downloadSequenceModal, setDownloadSequenceModal] = useState({ isOpen: false, sequence: null })\n  const [migrationModal, setMigrationModal] = useState({ isOpen: false })\n  const [isFullWidth, setIsFullWidth] = useState(false) // Modo ancho completo\n  \n  // Estados para reproductor de video individual\n  const [selectedVideo, setSelectedVideo] = useState(null)\n  const [showVideoPlayer, setShowVideoPlayer] = useState(false)\n  \n  // Estados para reproductor de secuencias\n  const [selectedSequence, setSelectedSequence] = useState(null)\n  const [showSequencePlayer, setShowSequencePlayer] = useState(false)\n  \n  // Estados para el sistema de chips y filtros\n  const [activeCategoryChips, setActiveCategoryChips] = useState([])\n  const [sortBy, setSortBy] = useState('none')\n  const [showFavorites, setShowFavorites] = useState(false)\n  \n  // Estados para secuencias\n  const [sequences, setSequences] = useState([])\n  const [sequencesLoading, setSequencesLoading] = useState(true)\n  \n  const { user } = useAuth()\n  const { getVideoConfig, getSequenceConfig } = useCardSize()\n  \n  // Usar el contexto de constructor de secuencias\n  const {\n    addVideoToSequence,\n    removeVideoFromSequence,\n    sequence,\n    sequenceName,\n    clearSequence,\n    isBuilderOpen,\n    toggleBuilder,\n    showAllVideos,\n    toggleShowAllVideos,\n    getFilteredVideos,\n    isVideoInSequence,\n    isVideoCompatible,\n    checkCompatibility,\n    loadSequence\n  } = useSequenceBuilderContext()\n\n  // Estado local para el estilo seleccionado\n  const [selectedStyle, setSelectedStyle] = useState('salsa')\n  \n  // Usar el sistema de categorías con estilo dinámico\n  const { \n    availableStyles,\n    getGradientClasses,\n    categoriesList, \n    getColorClasses\n  } = useCategories('figuras', selectedStyle)\n  \n  // Función para manejar click en título de categoría\n  const handleCategoryTitleClick = (categoryKey) => {\n    setActiveCategoryChips(prev => {\n      // Si ya está activa, la removemos\n      if (prev.includes(categoryKey)) {\n        return prev.filter(chip => chip !== categoryKey)\n      }\n      // Si no está activa, la agregamos\n      return [...prev, categoryKey]\n    })\n  }\n\n  // Función auxiliar para filtrar videos por estilo\n  const filterVideosByStyle = (videos, style) => {\n    return videos.filter(video => \n      video.style === style || video.tags?.estilo?.includes(style)\n    )\n  }\n\n  // Función para añadir video al constructor\n  const handleAddVideoToSequence = (video) => {\n    addVideoToSequence(video)\n    if (!isBuilderOpen) {\n      toggleBuilder()\n    }\n  }\n\n  // Mapeo de iconos para los estilos\n  const iconMap = {\n    Music: Music,\n    Heart: Heart,\n    Star: Star,\n    Zap: Zap\n  }\n\n  // Sincronización en tiempo real con Firebase\n  useEffect(() => {\n    setSyncStatus('syncing')\n    \n    // Suscribirse a cambios en tiempo real para el estilo seleccionado\n    const unsubscribe = subscribeToVideosByStyle(selectedStyle, (videosData) => {\n      setVideos(videosData)\n      setLoading(false)\n      setSyncStatus('idle')\n    })\n    \n    // Cleanup al desmontar o cambiar estilo\n    return () => {\n      unsubscribe()\n    }\n  }, [selectedStyle])\n\n  // Verificar estado de likes del usuario cuando se cargan videos\n  useEffect(() => {\n    if (videos.length > 0 && user) {\n      const checkUserLikesAndFavorites = async () => {\n        const updatedVideos = await Promise.all(\n          videos.map(async (video) => {\n            try {\n              const [likeResult, favoriteResult] = await Promise.all([\n                checkUserLikedVideo(video.id, user.uid),\n                checkUserFavorite(video.id, user.uid)\n              ])\n              return { \n                ...video, \n                userLiked: likeResult.userLiked,\n                isFavorite: favoriteResult.isFavorite\n              }\n            } catch (error) {\n              console.error('Error al verificar like/favorito para video:', video.id, error)\n              return { ...video, userLiked: false, isFavorite: false }\n            }\n          })\n        )\n        \n        setVideos(updatedVideos)\n      }\n      \n      checkUserLikesAndFavorites()\n    }\n  }, [videos.length, user])\n\n  // Sincronización en tiempo real para secuencias\n  useEffect(() => {\n    if (!selectedStyle) {\n      return\n    }\n    \n    setSequencesLoading(true)\n    \n    try {\n      // Suscribirse a cambios en tiempo real para las secuencias del estilo seleccionado\n      const unsubscribe = subscribeToSequencesByStyle(selectedStyle, (sequencesData) => {\n        setSequences(sequencesData)\n        setSequencesLoading(false)\n      })\n      \n      // Cleanup al desmontar o cambiar estilo\n      return () => {\n        unsubscribe()\n      }\n    } catch (error) {\n      console.error('❌ Error al suscribirse a secuencias:', error)\n      setSequencesLoading(false)\n    }\n  }, [selectedStyle])\n\n\n\n  // Función para actualizar la lista de videos después de subir uno nuevo\n  const handleVideoUploaded = async (video) => {\n    addToast(`${video.title} subido exitosamente`, 'success')\n    // La sincronización en tiempo real se encargará de actualizar la lista automáticamente\n  }\n\n  // Función para abrir modal de edición\n  const openEditModal = (video) => {\n    setEditModal({ isOpen: true, video })\n  }\n\n  // Función para cerrar modal de edición\n  const closeEditModal = () => {\n    setEditModal({ isOpen: false, video: null })\n  }\n\n  // Función para manejar video actualizado\n  const handleVideoUpdated = (updatedVideo) => {\n    setVideos(prev => prev.map(v => v.id === updatedVideo.id ? updatedVideo : v))\n    addToast(`${updatedVideo.title} actualizado exitosamente`, 'success')\n  }\n\n  // Función para manejar likes\n  const handleVideoLike = async (video) => {\n    if (!user) {\n      addToast('Debes iniciar sesión para dar like', 'error')\n      return\n    }\n\n    try {\n      const result = await toggleVideoLike(video.id, user.uid)\n      \n      if (result.success) {\n        // Actualizar el video en el estado local\n        setVideos(prevVideos => \n          prevVideos.map(v => \n            v.id === video.id \n              ? { \n                  ...v, \n                  likes: result.likes, \n                  likedBy: result.likedBy,\n                  userLiked: result.userLiked,\n                  isFavorite: result.isFavorite\n                }\n              : v\n          )\n        )\n        \n        const action = result.userLiked ? 'dado like a' : 'quitado like de'\n        const favoriteAction = result.isFavorite ? 'y agregado a favoritos' : 'y removido de favoritos'\n        addToast(`Has ${action} \"${video.title}\" ${favoriteAction}`, 'success')\n      } else {\n        addToast('Error al actualizar like', 'error')\n      }\n    } catch (error) {\n      console.error('Error al manejar like:', error)\n      addToast('Error al actualizar like', 'error')\n    }\n  }\n\n  // Función para añadir notificaciones\n  const addToast = (message, type = 'success') => {\n    const id = Date.now()\n    setToasts(prev => [...prev, { id, message, type }])\n  }\n\n  // Función para eliminar notificaciones\n  const removeToast = (id) => {\n    setToasts(prev => prev.filter(toast => toast.id !== id))\n  }\n\n  // Funciones para manejar secuencias\n  const handleSaveSequence = async (sequenceData) => {\n    try {\n      const sequenceWithStyle = {\n        ...sequenceData,\n        style: selectedStyle\n      }\n      \n      // Verificar si es una edición o una nueva secuencia\n      if (sequenceData.id) {\n        // Es una edición - actualizar secuencia existente\n        const result = await updateSequence(sequenceData.id, sequenceWithStyle)\n        addToast('✅ Secuencia actualizada exitosamente')\n      } else {\n        // Es una nueva secuencia - crear nueva\n        const result = await createSequence(sequenceWithStyle)\n        addToast('✅ Secuencia guardada exitosamente. Ve a \"GALERÍA DE SECUENCIAS\" para verla.')\n      }\n    } catch (error) {\n      console.error('❌ Error al guardar secuencia:', error)\n      addToast('Error al guardar la secuencia', 'error')\n      throw error\n    }\n  }\n\n  const handleDeleteSequence = async (sequenceId) => {\n    try {\n      await deleteSequence(sequenceId)\n      addToast('Secuencia eliminada exitosamente')\n    } catch (error) {\n      console.error('Error al eliminar secuencia:', error)\n      addToast('Error al eliminar la secuencia', 'error')\n      throw error\n    }\n  }\n\n  const handlePlaySequence = (sequence) => {\n    setSelectedSequence(sequence)\n    setShowSequencePlayer(true)\n    addToast(`🎬 Reproduciendo secuencia: ${sequence.name}`, 'info')\n  }\n\n  const handleEditSequence = (sequenceToEdit) => {\n    // Verificar si hay una secuencia en construcción\n    if (sequence.length > 0 || sequenceName.trim()) {\n      // Abrir modal de confirmación\n      setEditSequenceModal({ isOpen: true, sequence: sequenceToEdit })\n    } else {\n      // Cargar directamente la secuencia\n      loadSequence(sequenceToEdit)\n      addToast(`Secuencia \"${sequenceToEdit.name}\" cargada para edición`)\n    }\n  }\n\n  const handleConfirmEditSequence = () => {\n    const sequenceToEdit = editSequenceModal.sequence\n    if (sequenceToEdit) {\n      loadSequence(sequenceToEdit)\n      addToast(`Secuencia \"${sequenceToEdit.name}\" cargada para edición`)\n    }\n    setEditSequenceModal({ isOpen: false, sequence: null })\n  }\n\n  const handleCancelEditSequence = () => {\n    setEditSequenceModal({ isOpen: false, sequence: null })\n  }\n\n  const handleDownloadSequence = (sequence) => {\n    setDownloadSequenceModal({ isOpen: true, sequence })\n  }\n\n  const handleCloseDownloadSequence = () => {\n    setDownloadSequenceModal({ isOpen: false, sequence: null })\n  }\n  \n  // Función para reproducir video individual\n  const handlePlayVideo = (video) => {\n    setSelectedVideo(video)\n    setShowVideoPlayer(true)\n    addToast(`🎬 Reproduciendo: ${video.title}`, 'info')\n  }\n  \n  // Función para cerrar el reproductor\n  const handleCloseVideoPlayer = () => {\n    setShowVideoPlayer(false)\n    setSelectedVideo(null)\n  }\n  \n  // Función para cerrar el reproductor de secuencias\n  const handleCloseSequencePlayer = () => {\n    setShowSequencePlayer(false)\n    setSelectedSequence(null)\n  }\n\n\n\n  // Función para eliminar video\n  const handleDeleteVideo = async (video) => {\n    try {\n      // Eliminar de Firebase Storage\n      const storageResult = await deleteVideo(video.videoPath, video.thumbnailPath)\n      \n      // Si hay error al eliminar archivos, intentar solo eliminar el video\n      if (!storageResult.success) {\n        \n        // Intentar eliminar solo el video si el thumbnail falló\n        if (storageResult.error && storageResult.error.includes('thumbnails')) {\n          const videoOnlyResult = await deleteVideo(video.videoPath, null)\n          if (!videoOnlyResult.success) {\n            addToast(`Error al eliminar archivos: ${storageResult.error}`, 'error')\n            return\n          }\n        } else {\n          addToast(`Error al eliminar archivos: ${storageResult.error}`, 'error')\n          return\n        }\n      }\n\n      // Eliminar de Firestore\n      const firestoreResult = await deleteVideoDocument(video.id)\n      \n      if (!firestoreResult.success) {\n        addToast(`Error al eliminar metadatos: ${firestoreResult.error}`, 'error')\n        return\n      }\n\n      // Actualizar lista local\n      setVideos(prev => {\n        const newVideos = prev.filter(v => v.id !== video.id)\n        return newVideos\n      })\n      \n      addToast(`${video.title} eliminado correctamente`, 'success')\n    } catch (error) {\n      console.error('❌ Error deleting video:', error)\n      addToast('Error inesperado al eliminar video', 'error')\n    }\n  }\n\n  // Función para abrir modal de eliminación\n  const openDeleteModal = (video) => {\n    setDeleteModal({ isOpen: true, video })\n  }\n\n  // Función para cerrar modal de eliminación\n  const closeDeleteModal = () => {\n    setDeleteModal({ isOpen: false, video: null })\n  }\n\n  // Funciones de limpieza y sincronización\n  const handleCleanupData = async (type) => {\n    try {\n      setSyncStatus('syncing')\n      addToast('Iniciando limpieza de datos...', 'info')\n      \n      if (type === 'update') {\n        // Actualizar rutas de thumbnails existentes\n        const result = await updateVideoThumbnailPaths()\n        if (result.success) {\n          addToast(`✅ ${result.updatedCount} videos actualizados`, 'success')\n        } else {\n          addToast(`❌ Error: ${result.error}`, 'error')\n        }\n      } else if (type === 'cleanup') {\n        // Limpiar archivos huérfanos\n        const videosData = await getVideos()\n        const result = await cleanupOrphanedFiles(videosData)\n        if (result.success) {\n          addToast(`🧹 ${result.orphanedVideosDeleted} videos y ${result.orphanedThumbnailsDeleted} thumbnails huérfanos eliminados`, 'success')\n        } else {\n          addToast(`❌ Error: ${result.error}`, 'error')\n        }\n      } else if (type === 'cleanup-tags') {\n        // Limpiar tags duplicados\n        const result = await cleanupDuplicateTags()\n        if (result.success) {\n          addToast(`🏷️ ${result.updatedCount} videos actualizados con tags limpios`, 'success')\n        } else {\n          addToast(`❌ Error: ${result.error}`, 'error')\n        }\n      } else if (type === 'delete-all') {\n        // Eliminar todos los videos (confirmar primero)\n        const confirmed = window.confirm('¿Estás seguro de que quieres eliminar TODOS los videos? Esta acción no se puede deshacer.')\n        if (!confirmed) {\n          setSyncStatus('idle')\n          return\n        }\n        \n        // Eliminar de Firestore\n        const firestoreResult = await deleteAllVideos()\n        if (!firestoreResult.success) {\n          addToast(`❌ Error eliminando documentos: ${firestoreResult.error}`, 'error')\n          setSyncStatus('idle')\n          return\n        }\n        \n        // Eliminar archivos de Storage\n        const storageResult = await deleteAllVideoFiles()\n        if (!storageResult.success) {\n          addToast(`❌ Error eliminando archivos: ${storageResult.error}`, 'error')\n          setSyncStatus('idle')\n          return\n        }\n        \n        addToast(`🗑️ ${firestoreResult.deletedCount} videos eliminados completamente`, 'success')\n      }\n      \n      setSyncStatus('idle')\n      setCleanupModal({ isOpen: false, type: null })\n    } catch (error) {\n      console.error('Error en limpieza:', error)\n      addToast(`❌ Error inesperado: ${error.message}`, 'error')\n      setSyncStatus('idle')\n    }\n  }\n\n  const openCleanupModal = (type) => {\n    setCleanupModal({ isOpen: true, type })\n  }\n\n  const closeCleanupModal = () => {\n    setCleanupModal({ isOpen: false, type: null })\n  }\n\n  // Función para ejecutar diagnóstico de videos\n  const handleDiagnoseVideos = async () => {\n    try {\n      addToast('Ejecutando diagnóstico de videos...', 'info')\n      const result = await diagnoseVideos()\n      \n      if (result.success) {\n        let message = `Diagnóstico: ${result.totalVideos} videos total, ${result.salsaVideos} de salsa`\n        if (result.fig003Found) {\n          message += ` ✅ Fig003 encontrado`\n        } else {\n          message += ` ❌ Fig003 NO encontrado`\n        }\n        if (result.videosWithoutResolution > 0) {\n          message += ` ⚠️ ${result.videosWithoutResolution} sin resolución`\n        }\n        \n        addToast(message, 'success')\n      } else {\n        addToast(`Error en diagnóstico: ${result.error}`, 'error')\n      }\n    } catch (error) {\n      console.error('Error ejecutando diagnóstico:', error)\n      addToast('Error al ejecutar diagnóstico', 'error')\n    }\n  }\n\n  // Función para actualizar resoluciones de todos los videos\n  const handleUpdateAllResolutions = async () => {\n    try {\n      addToast('🔄 Actualizando resoluciones de videos...', 'info')\n      \n      // Obtener todos los videos\n      const allVideos = await getVideos()\n      const videosToUpdate = allVideos.filter(video => \n        !video.resolution || video.resolution === 'Unknown'\n      )\n      \n      if (videosToUpdate.length === 0) {\n        addToast('✅ Todos los videos ya tienen resolución detectada', 'success')\n        return\n      }\n      \n      let updatedCount = 0\n      \n      for (const video of videosToUpdate) {\n        try {\n          // Detectar resolución del video\n          const videoElement = document.createElement('video')\n          videoElement.crossOrigin = 'anonymous'\n          \n                     await new Promise((resolve, reject) => {\n             videoElement.onloadedmetadata = () => {\n               const videoWidth = videoElement.videoWidth\n               const videoHeight = videoElement.videoHeight\n               const maxDimension = Math.max(videoWidth, videoHeight)\n               \n               let resolution = 'Unknown'\n               if (maxDimension >= 3840) resolution = '4K'\n               else if (maxDimension >= 1920) resolution = '1080p'\n               else if (maxDimension >= 1280) resolution = '720p'\n               else if (maxDimension >= 854) resolution = '480p'\n               else resolution = '360p'\n               \n               // Actualizar en Firestore con resolución y dimensiones\n               updateVideoDocument(video.id, { \n                 resolution,\n                 videoWidth,\n                 videoHeight\n               })\n               updatedCount++\n               resolve()\n             }\n            \n            videoElement.onerror = reject\n            videoElement.src = video.videoUrl\n          })\n          \n          // Limpiar el elemento de video\n          videoElement.remove()\n          \n        } catch (error) {\n          console.error(`Error actualizando resolución para video ${video.id}:`, error)\n        }\n      }\n      \n      addToast(`✅ Resoluciones actualizadas: ${updatedCount} videos`, 'success')\n      \n    } catch (error) {\n      console.error('Error al actualizar resoluciones:', error)\n      addToast('Error al actualizar resoluciones', 'error')\n    }\n  }\n\n  // Función para migrar videos a estructura organizada\n  const handleMigrateVideos = async () => {\n    try {\n      addToast('🔄 Iniciando migración REAL de videos a estructura organizada...', 'info')\n      \n      const result = await migrateVideosToOrganizedStructure(videos)\n      \n      if (result.success) {\n        let message = `✅ Migración REAL completada: ${result.successfulMigrations} videos movidos físicamente`\n        if (result.alreadyOrganized > 0) {\n          message += `, ${result.alreadyOrganized} ya organizados`\n        }\n        if (result.failedMigrations > 0) {\n          message += `, ${result.failedMigrations} fallidos`\n        }\n        \n        addToast(message, 'success')\n        \n        // Recargar videos para reflejar los cambios\n        window.location.reload()\n      } else {\n        addToast(`❌ Error en migración: ${result.error}`, 'error')\n      }\n    } catch (error) {\n      console.error('Error ejecutando migración:', error)\n      addToast('❌ Error al ejecutar migración', 'error')\n    }\n  }\n\n  // Función para manejar filtros por tags\n  const handleTagFilter = (tag) => {\n    setSelectedTags(prev => {\n      const isSelected = prev.includes(tag)\n      if (isSelected) {\n        return prev.filter(t => t !== tag)\n      } else {\n        return [...prev, tag]\n      }\n    })\n  }\n\n  // Función para limpiar filtros\n  const clearFilters = () => {\n    setSelectedTags([])\n    setSearchTerm('')\n  }\n\n  // Funciones para el sistema de chips y filtros\n  const handleCategoryChipFilter = (chips) => {\n    setActiveCategoryChips(chips)\n  }\n\n  const handleSortChange = (sortKey) => {\n    setSortBy(sortKey)\n  }\n\n  const handleShowFavorites = (show) => {\n    setShowFavorites(show)\n  }\n\n  // Función para verificar si un video tiene tags de categoría específica\n  const hasCategoryTags = (video, categoryKey) => {\n    if (!video.tags) return false\n    \n    // Buscar en las categorías dinámicas del hook useCategories\n    const category = categoriesList.find(cat => cat.key === categoryKey)\n    if (!category) return false\n    \n    // Verificar si el video tiene tags para esta categoría\n    const categoryTags = video.tags[categoryKey]\n    return categoryTags && Array.isArray(categoryTags) && categoryTags.length > 0\n  }\n\n  // Función para ordenar videos\n  const sortVideos = (videosToSort) => {\n    if (sortBy === 'none') return videosToSort\n\n    const sortedVideos = [...videosToSort]\n    \n    switch (sortBy) {\n      case 'name':\n        return sortedVideos.sort((a, b) => a.title.localeCompare(b.title))\n      case 'name-desc':\n        return sortedVideos.sort((a, b) => b.title.localeCompare(a.title))\n      case 'rating':\n        return sortedVideos.sort((a, b) => (b.rating || 0) - (a.rating || 0))\n      case 'rating-desc':\n        return sortedVideos.sort((a, b) => (a.rating || 0) - (b.rating || 0))\n      case 'likes':\n        return sortedVideos.sort((a, b) => (b.likes || 0) - (a.likes || 0))\n      case 'likes-desc':\n        return sortedVideos.sort((a, b) => (a.likes || 0) - (b.likes || 0))\n      default:\n        return sortedVideos\n    }\n  }\n\n  // Función para obtener tags ordenados según el orden de categorías\n  const getOrderedTags = (video) => {\n    if (!video.tags || Object.keys(video.tags).length === 0) {\n      return []\n    }\n\n\n\n    // Crear array de tags ordenados según el orden de categoriesList\n    const orderedTags = []\n    \n    categoriesList.forEach(category => {\n      const categoryTags = video.tags[category.key]\n      if (Array.isArray(categoryTags)) {\n        categoryTags.forEach(tag => {\n          orderedTags.push({\n            tag,\n            categoryKey: category.key,\n            color: category.color\n          })\n        })\n      }\n    })\n\n\n    return orderedTags\n  }\n\n  // Función para obtener tags iniciales ordenados\n  const getOrderedTagsIniciales = (video) => {\n    if (!video.tagsIniciales || Object.keys(video.tagsIniciales).length === 0) {\n      return []\n    }\n\n    const orderedTags = []\n    \n    categoriesList.forEach(category => {\n      const categoryTags = video.tagsIniciales[category.key]\n      if (Array.isArray(categoryTags)) {\n        categoryTags.forEach(tag => {\n          orderedTags.push({\n            tag,\n            categoryKey: category.key,\n            color: category.color,\n            type: 'inicial'\n          })\n        })\n      }\n    })\n\n\n    return orderedTags\n  }\n\n  // Función para obtener tags finales ordenados\n  const getOrderedTagsFinales = (video) => {\n    if (!video.tagsFinales || Object.keys(video.tagsFinales).length === 0) {\n      return []\n    }\n\n    const orderedTags = []\n    \n    categoriesList.forEach(category => {\n      const categoryTags = video.tagsFinales[category.key]\n      if (Array.isArray(categoryTags)) {\n        categoryTags.forEach(tag => {\n          orderedTags.push({\n            tag,\n            categoryKey: category.key,\n            color: category.color,\n            type: 'final'\n          })\n        })\n      }\n    })\n\n\n    return orderedTags\n  }\n\n  // Función para normalizar texto (eliminar tildes y convertir a minúsculas)\n  const normalizeText = (text) => {\n    return text\n      .toLowerCase()\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '') // Eliminar diacríticos (tildes)\n      .trim()\n  }\n\n  // Función de búsqueda avanzada\n  const advancedSearch = (video, searchTerms) => {\n    if (!searchTerms || searchTerms.length === 0) return true\n\n    // Normalizar el texto del video\n    const normalizedTitle = normalizeText(video.title || '')\n    const normalizedDescription = normalizeText(video.description || '')\n    \n    // Normalizar tags del video\n    const normalizedTags = []\n    if (video.tags) {\n      Object.values(video.tags).forEach(categoryTags => {\n        if (Array.isArray(categoryTags)) {\n          categoryTags.forEach(tag => {\n            normalizedTags.push(normalizeText(tag))\n          })\n        }\n      })\n    }\n\n    // Verificar que TODAS las palabras de búsqueda estén presentes\n    return searchTerms.every(searchWord => {\n      const normalizedSearchWord = normalizeText(searchWord)\n      \n      // Buscar en título\n      if (normalizedTitle.includes(normalizedSearchWord)) return true\n      \n      // Buscar en descripción\n      if (normalizedDescription.includes(normalizedSearchWord)) return true\n      \n      // Buscar en tags\n      if (normalizedTags.some(tag => tag.includes(normalizedSearchWord))) return true\n      \n      return false\n    })\n  }\n\n  // Filtrar videos basado en tags seleccionados y búsqueda avanzada\n  const baseFilteredVideos = videos.filter(video => {\n    // Dividir términos de búsqueda por espacios y filtrar vacíos\n    const searchTerms = searchTerm\n      .split(' ')\n      .map(term => term.trim())\n      .filter(term => term.length > 0)\n\n    // Filtro por búsqueda avanzada\n    const searchMatch = advancedSearch(video, searchTerms)\n\n    // Filtro por tags - EXCLUYENTE (todos los tags seleccionados deben estar presentes)\n    const tagsMatch = selectedTags.length === 0 || \n      selectedTags.every(tag => {\n        // Buscar en todas las categorías de tags del video\n        if (video.tags) {\n          return Object.values(video.tags).some(categoryTags => \n            Array.isArray(categoryTags) && categoryTags.includes(tag)\n          )\n        }\n        return false\n      })\n\n      // Filtro por chips de categorías\n  const categoryMatch = activeCategoryChips.length === 0 || \n    activeCategoryChips.some(chip => hasCategoryTags(video, chip))\n\n  // Filtro por favoritos\n  const favoritesMatch = !showFavorites || video.isFavorite\n\n  return searchMatch && tagsMatch && categoryMatch && favoritesMatch\n  })\n\n  // Aplicar filtro de compatibilidad sobre los videos ya filtrados\n  const baseCompatibilityFiltered = getFilteredVideos(baseFilteredVideos)\n\n  // Aplicar ordenamiento final\n  const filteredVideos = sortVideos(baseCompatibilityFiltered)\n\n  // Función para descargar video usando Firebase Storage\n  const downloadVideo = async (video) => {\n    try {\n      // Usar Firebase SDK directamente para descargar\n      const { ref, getDownloadURL } = await import('firebase/storage')\n      const { storage } = await import('../services/firebase/config')\n      \n      const videoRef = ref(storage, video.videoPath)\n      \n      // Obtener la URL de descarga con token de acceso\n      const downloadURL = await getDownloadURL(videoRef)\n      \n      // Crear enlace de descarga directo\n      const link = document.createElement('a')\n      link.href = downloadURL\n      link.download = video.title || 'video'\n      link.target = '_blank'\n      link.rel = 'noopener noreferrer'\n      \n      // Agregar al DOM y hacer clic\n      document.body.appendChild(link)\n      link.click()\n      document.body.removeChild(link)\n      \n      addToast('Descarga iniciada', 'success')\n    } catch (error) {\n      console.error('Error en descarga:', error)\n      addToast('Error al descargar el video', 'error')\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-white\">\n      {/* Main Content */}\n      <div className={`${isFullWidth ? 'w-full px-0' : 'max-w-6xl mx-auto px-6'} py-8`}>\n        {/* Title */}\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-4xl font-bold mb-2\">\n            <span className=\"text-pink-500\">FIGURAS</span>\n            <span className={`bg-gradient-to-r ${getGradientClasses(selectedStyle)} bg-clip-text text-transparent`}> - {selectedStyle.toUpperCase()}</span>\n          </h1>\n          <p className=\"text-gray-600 text-lg\">Galería de videos de figuras de {selectedStyle.toLowerCase()}</p>\n        </div>\n\n        {/* Style Filters */}\n        <div className=\"flex flex-wrap justify-center gap-3 mb-8\">\n          {availableStyles.map((style) => {\n            const IconComponent = iconMap[style.icon]\n                                      const isSelected = selectedStyle === style.key\n             // Usar gradientes específicos para cada estilo\n             const gradientClass = getGradientClasses(style.color)\n            \n            return (\n                             <button\n                 key={style.name}\n                 onClick={() => setSelectedStyle(style.key)}\n                 className={`relative flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${\n                   isSelected\n                     ? `bg-gradient-to-r ${gradientClass} text-white shadow-lg transform scale-105`\n                     : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300'\n                 }`}\n               >\n                {IconComponent && <IconComponent className=\"h-4 w-4\" />}\n                <span>{style.name}</span>\n              </button>\n            )\n          })}\n        </div>\n\n        {/* Search Bar */}\n        <div className=\"max-w-2xl mx-auto mb-8\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5\" />\n            <input\n              type=\"text\"\n              placeholder={`Buscar en ${selectedStyle.toLowerCase()}... (múltiples palabras, sin tildes)`}\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200\"\n            />\n          </div>\n          \n          {/* Search Status Indicator */}\n          {searchTerm.trim() && (\n            <div className=\"mt-3 text-center\">\n              <div className=\"inline-flex items-center space-x-2 px-4 py-2 bg-blue-50 border border-blue-200 rounded-lg\">\n                <Search className=\"h-4 w-4 text-blue-500\" />\n                <span className=\"text-sm text-blue-700\">\n                  Buscando: <span className=\"font-medium\">\"{searchTerm}\"</span>\n                </span>\n                <span className=\"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded\">\n                  {filteredVideos.length} resultado{filteredVideos.length !== 1 ? 's' : ''}\n                </span>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Tag Filters - Collapsible con títulos clickeables */}\n        {categoriesList.length > 0 && (\n          <div className=\"mb-8\">\n            <button\n              onClick={() => setShowFilters(!showFilters)}\n              className=\"flex items-center justify-center space-x-2 mx-auto px-6 py-3 bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 rounded-lg font-medium shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105\"\n            >\n              <Filter className=\"h-5 w-5\" />\n              <span>Filtros Avanzados por Tags - {selectedStyle}</span>\n              {showFilters ? (\n                <ChevronUp className=\"h-5 w-5\" />\n              ) : (\n                <ChevronDown className=\"h-5 w-5\" />\n              )}\n            </button>\n            \n            {/* Collapsible Content */}\n            <div className={`mt-4 transition-all duration-300 ease-in-out overflow-hidden ${\n              showFilters ? 'max-h-96 opacity-100' : 'max-h-0 opacity-0'\n            }`}>\n              <div className=\"space-y-4 bg-gray-50 rounded-lg p-6 border border-gray-200\">\n                {categoriesList.map((category) => (\n                  <div key={category.key} className=\"space-y-2\">\n                    {/* Título clickeable de categoría */}\n                    <button\n                      onClick={() => handleCategoryTitleClick(category.key)}\n                      className={`w-full text-center font-medium py-2 px-4 rounded-lg transition-all duration-200 transform hover:scale-105 ${\n                        activeCategoryChips.includes(category.key)\n                          ? `bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white shadow-lg`\n                          : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300'\n                      }`}\n                    >\n                      <div className=\"flex items-center justify-center space-x-2\">\n                        <span>{category.name}</span>\n                        {activeCategoryChips.includes(category.key) && (\n                          <span className=\"text-xs bg-white bg-opacity-20 px-2 py-1 rounded\">\n                            ACTIVO\n                          </span>\n                        )}\n                      </div>\n                    </button>\n                    \n                    {/* Tags de la categoría */}\n                    <div className=\"flex flex-wrap justify-center gap-2\">\n                      {category.tags.map(tag => (\n                        <button\n                          key={tag}\n                          onClick={() => handleTagFilter(tag)}\n                          className={`px-3 py-1 rounded-full text-sm font-medium transition-all duration-200 ${\n                            selectedTags.includes(tag)\n                              ? `bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white shadow-lg`\n                              : `${getColorClasses(category.color)} hover:bg-opacity-80`\n                          }`}\n                        >\n                          {tag}\n                        </button>\n                      ))}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        )}\n\n\n\n\n\n        {/* Action Buttons - Main Level */}\n        <div className=\"flex flex-col sm:flex-row gap-4 justify-center mb-6\">\n          <button \n            onClick={() => setIsUploadModalOpen(true)}\n            className={`flex items-center justify-center space-x-2 px-6 py-3 bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white rounded-lg font-medium shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105`}\n          >\n            <Upload className=\"h-5 w-5\" />\n            <span>SUBIR VIDEO(S) A {selectedStyle.toUpperCase()}</span>\n          </button>\n          <button \n            onClick={toggleBuilder}\n            className={`flex items-center justify-center space-x-2 px-6 py-3 rounded-lg font-medium shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 ${\n              isBuilderOpen \n                ? 'bg-gradient-to-r from-red-500 to-pink-500 text-white' \n                : `bg-gradient-to-r ${getGradientClasses(selectedStyle)} hover:opacity-90 text-white`\n            }`}\n          >\n            <Shuffle className=\"h-5 w-5\" />\n            <span>{isBuilderOpen ? 'OCULTAR SECUENCIA' : 'CREAR SECUENCIA'}</span>\n          </button>\n        </div>\n\n        {/* Botones de ordenamiento y favoritos - Nueva ubicación */}\n        <div className=\"flex flex-wrap justify-center gap-3 mb-6\">\n          {/* Botón A-Z/Z-A combinado */}\n          <button\n            onClick={() => handleSortChange(sortBy === 'name' ? 'name-desc' : 'name')}\n            className={`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${\n              sortBy === 'name' || sortBy === 'name-desc'\n                ? `bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white shadow-lg`\n                : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50'\n            }`}\n          >\n            <span>{sortBy === 'name' ? 'A-Z' : sortBy === 'name-desc' ? 'Z-A' : 'A-Z'}</span>\n          </button>\n          \n          {/* Botón Puntuación */}\n          <button\n            onClick={() => handleSortChange(sortBy === 'rating' ? 'rating-desc' : 'rating')}\n            className={`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${\n              sortBy === 'rating' || sortBy === 'rating-desc'\n                ? `bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white shadow-lg`\n                : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50'\n            }`}\n          >\n            <Star className=\"h-4 w-4\" />\n            <span>{sortBy === 'rating' ? 'Puntuación ↓' : sortBy === 'rating-desc' ? 'Puntuación ↑' : 'Puntuación'}</span>\n          </button>\n          \n          {/* Botón Favoritos */}\n          <button\n            onClick={() => {\n              if (!showFavorites) {\n                // Si no está mostrando favoritos, activar y ordenar por likes descendente\n                setShowFavorites(true)\n                setSortBy('likes')\n              } else if (sortBy === 'likes') {\n                // Si está mostrando favoritos y ordenado por likes, cambiar a ascendente\n                setSortBy('likes-desc')\n              } else if (sortBy === 'likes-desc') {\n                // Si está en ascendente, volver a descendente\n                setSortBy('likes')\n              } else {\n                // Si está en otro ordenamiento, desactivar favoritos\n                setShowFavorites(false)\n                setSortBy('none')\n              }\n            }}\n            className={`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${\n              showFavorites\n                ? `bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white shadow-lg`\n                : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50'\n            }`}\n          >\n            <Heart className=\"h-4 w-4\" />\n            <span>\n              {!showFavorites ? 'Mostrar Favoritos' : \n               sortBy === 'likes' ? 'Favoritos ↓' : \n               sortBy === 'likes-desc' ? 'Favoritos ↑' : \n               'Ocultar Favoritos'}\n            </span>\n          </button>\n        </div>\n\n        {/* Sequence Builder - Collapsible */}\n        {isBuilderOpen && (\n          <SequenceBuilder\n            isOpen={true}\n            videos={videos}\n            onSaveSequence={handleSaveSequence}\n            onToggleShowAll={toggleShowAllVideos}\n            showAllVideos={showAllVideos}\n            style={selectedStyle}\n            onToggleBuilder={toggleBuilder}\n          />\n        )}\n\n        {/* Sync Status and Cleanup Controls */}\n        <div className=\"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200\">\n          <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4\">\n            {/* Sync Status */}\n            <div className=\"flex items-center space-x-2\">\n              <div className={`w-3 h-3 rounded-full ${\n                syncStatus === 'idle' ? 'bg-green-500' : \n                syncStatus === 'syncing' ? 'bg-yellow-500 animate-pulse' : \n                'bg-red-500'\n              }`}></div>\n              <span className=\"text-sm text-gray-600\">\n                {syncStatus === 'idle' ? '✅ Sincronizado con Firebase' : \n                 syncStatus === 'syncing' ? '🔄 Sincronizando...' : \n                 '❌ Error de sincronización'}\n              </span>\n            </div>\n            \n            {/* Cleanup Buttons */}\n            <div className=\"flex flex-wrap gap-2\">\n              <button\n                onClick={handleDiagnoseVideos}\n                disabled={syncStatus === 'syncing'}\n                className=\"px-3 py-1 text-xs bg-purple-500 text-white rounded hover:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                🔍 Diagnóstico\n              </button>\n              <button\n                onClick={handleUpdateAllResolutions}\n                disabled={syncStatus === 'syncing'}\n                className=\"px-3 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                📐 Actualizar Resoluciones\n              </button>\n              <button\n                onClick={() => openCleanupModal('update')}\n                disabled={syncStatus === 'syncing'}\n                className=\"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                🔧 Actualizar Rutas\n              </button>\n              <button\n                onClick={() => openCleanupModal('cleanup')}\n                disabled={syncStatus === 'syncing'}\n                className=\"px-3 py-1 text-xs bg-yellow-500 text-white rounded hover:bg-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                🧹 Limpiar Huérfanos\n              </button>\n              <button\n                onClick={() => openCleanupModal('cleanup-tags')}\n                disabled={syncStatus === 'syncing'}\n                className=\"px-3 py-1 text-xs bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                🏷️ Limpiar Tags\n              </button>\n              <button\n                onClick={handleMigrateVideos}\n                disabled={syncStatus === 'syncing'}\n                className=\"px-3 py-1 text-xs bg-indigo-500 text-white rounded hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n                title=\"Mover físicamente videos existentes a estructura organizada (videos/page/style/)\"\n              >\n                📁 Migrar Videos REAL\n              </button>\n              <button\n                onClick={() => openCleanupModal('delete-all')}\n                disabled={syncStatus === 'syncing'}\n                className=\"px-3 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                🗑️ Eliminar Todo\n              </button>\n            </div>\n          </div>\n        </div>\n\n        {/* Gallery Tabs */}\n        <div className=\"flex justify-center gap-4 mb-8\">\n          <button\n            onClick={() => setActiveTab('videos')}\n            className={`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${\n              activeTab === 'videos'\n                ? `bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white shadow-lg transform scale-105`\n                : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50'\n            }`}\n          >\n            <Music className=\"h-6 w-6\" />\n            <span>GALERÍA DE VIDEOS</span>\n          </button>\n          <button\n            onClick={() => setActiveTab('secuencias')}\n            className={`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${\n              activeTab === 'secuencias'\n                ? `bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white shadow-lg transform scale-105`\n                : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50'\n            }`}\n          >\n            <Plus className=\"h-6 w-6\" />\n            <span>GALERÍA DE SECUENCIAS ({sequences.length})</span>\n          </button>\n        </div>\n\n\n\n        {/* Videos Grid */}\n        {activeTab === 'videos' && (\n          <div className=\"mb-8\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <div>\n                <h2 className=\"text-2xl font-semibold text-gray-800\">\n                  Videos de {selectedStyle.toLowerCase()} ({filteredVideos.length})\n                </h2>\n                {(activeCategoryChips.length > 0 || sortBy !== 'none' || showFavorites) && (\n                  <p className=\"text-sm text-gray-600 mt-1\">\n                    {activeCategoryChips.length > 0 && `Filtrado por: ${activeCategoryChips.join(', ')} `}\n                    {sortBy !== 'none' && `• Ordenado por: ${sortBy} `}\n                    {showFavorites && '• Solo favoritos'}\n                  </p>\n                )}\n              </div>\n              <div className=\"flex items-center space-x-4\">\n                {/* Selector de tamaño de cards */}\n                <CardSizeSelector type=\"video\" />\n                \n                {/* Botón de modo ancho completo */}\n                <button\n                  onClick={() => setIsFullWidth(!isFullWidth)}\n                  className={`flex items-center space-x-2 px-3 py-2 rounded-lg font-medium transition-all duration-200 ${\n                    isFullWidth\n                      ? `bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white shadow-lg`\n                      : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300'\n                  }`}\n                  title={isFullWidth ? \"Modo compacto\" : \"Modo ancho completo\"}\n                >\n                  {isFullWidth ? (\n                    <Minimize2 className=\"h-4 w-4\" />\n                  ) : (\n                    <Maximize2 className=\"h-4 w-4\" />\n                  )}\n                  <span className=\"hidden sm:inline\">\n                    {isFullWidth ? \"Compacto\" : \"Ancho completo\"}\n                  </span>\n                </button>\n                \n                {/* Botón para mostrar todos los videos vs solo compatibles */}\n                {isBuilderOpen && (\n                  <button\n                    onClick={toggleShowAllVideos}\n                    className={`flex items-center space-x-2 px-3 py-1 rounded-lg text-sm font-medium transition-colors ${\n                      showAllVideos \n                        ? 'bg-blue-100 text-blue-800' \n                        : 'bg-green-100 text-green-800'\n                    }`}\n                    title={showAllVideos ? 'Mostrar solo videos compatibles' : 'Mostrar todos los videos'}\n                  >\n                    {showAllVideos ? (\n                      <>\n                        <EyeOff className=\"h-4 w-4\" />\n                        <span>Ocultar Incompatibles</span>\n                      </>\n                    ) : (\n                      <>\n                        <Eye className=\"h-4 w-4\" />\n                        <span>Mostrar Todos</span>\n                      </>\n                    )}\n                  </button>\n                )}\n                \n                {(selectedTags.length > 0 || activeCategoryChips.length > 0 || sortBy !== 'none' || showFavorites) && (\n                  <button\n                    onClick={() => {\n                      clearFilters()\n                      setActiveCategoryChips([])\n                      setSortBy('none')\n                      setShowFavorites(false)\n                    }}\n                    className=\"text-sm text-gray-500 hover:text-gray-700 transition-colors duration-200\"\n                  >\n                    Limpiar todos los filtros <X className=\"h-4 w-4 ml-1\" />\n                  </button>\n                )}\n              </div>\n            </div>\n          \n          {loading ? (\n            <div className=\"flex justify-center items-center py-12\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500\"></div>\n              <span className=\"ml-3 text-gray-600\">Cargando videos...</span>\n            </div>\n          ) : videos.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <p className=\"text-gray-500 text-lg\">No hay videos de {selectedStyle.toLowerCase()} aún</p>\n              <p className=\"text-gray-400 text-sm mt-2\">Sube tu primer video de {selectedStyle.toLowerCase()} usando el botón de arriba</p>\n            </div>\n                     ) : (\n             <div className={`grid gap-6 ${getVideoConfig().grid}`}>\n               {filteredVideos.map((video) => (\n                <div \n                  key={video.id} \n                  className={`bg-white rounded-lg shadow-md overflow-hidden border hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02] ${\n                    isBuilderOpen && !isVideoCompatible(video)\n                      ? 'border-red-200 opacity-75'\n                      : 'border-gray-100'\n                  }`}\n                >\n                  <div className=\"relative group\">\n                    <div className={`w-full ${getVideoConfig().aspect} bg-gradient-to-br from-gray-100 to-gray-200 relative overflow-hidden flex items-center justify-center`}>\n                      {video.thumbnailUrl && video.thumbnailUrl !== 'https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO' ? (\n                        <img\n                          src={video.thumbnailUrl}\n                          alt={video.title}\n                          className=\"w-full h-full object-cover\"\n                          loading=\"lazy\"\n                          onError={(e) => {\n                            e.target.style.display = 'none';\n                            e.target.nextSibling.style.display = 'flex';\n                          }}\n                        />\n                      ) : null}\n                      <div className={`flex flex-col items-center justify-center text-gray-500 ${video.thumbnailUrl && video.thumbnailUrl !== 'https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO' ? 'hidden' : 'flex'}`}>\n                        <svg className=\"w-12 h-12 mb-2 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\" />\n                        </svg>\n                        <span className=\"text-sm font-medium\">{video.title}</span>\n                      </div>\n                      <div className=\"absolute bottom-2 left-2 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-sm font-medium\">\n                        {video.resolution && video.resolution !== 'Unknown' ? video.resolution : 'HD'}\n                      </div>\n                      \n                      {/* Indicador de compatibilidad */}\n                      {isBuilderOpen && (\n                        <div className={`absolute top-2 right-2 p-1 rounded-full text-xs font-bold ${\n                          isVideoCompatible(video)\n                            ? 'bg-green-500 text-white' \n                            : 'bg-red-500 text-white'\n                        }`}>\n                          {isVideoCompatible(video) ? '✅' : '❌'}\n                        </div>\n                      )}\n                    </div>\n                    \n                                         {/* Botón de reproducción */}\n                     <button\n                       onClick={async () => {\n                         try {\n                           // Abrir modal de reproducción\n                           const modal = document.createElement('div')\n                           modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50'\n                           \n                           const videoContainer = document.createElement('div')\n                           videoContainer.className = 'bg-white rounded-lg p-6 max-w-5xl w-full mx-4 max-h-[95vh] overflow-y-auto'\n                           videoContainer.onclick = (e) => e.stopPropagation()\n                           \n                           const header = document.createElement('div')\n                           header.className = 'flex items-center justify-between mb-4'\n                           header.innerHTML = `\n                             <h3 class=\"text-xl font-semibold text-gray-900\">${video.title}</h3>\n                             <button class=\"text-gray-400 hover:text-gray-600 transition-colors\">\n                               <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                 <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n                               </svg>\n                             </button>\n                           `\n                           \n                           // Crear el VideoPlayer\n                           const videoPlayerContainer = document.createElement('div')\n                           videoPlayerContainer.id = 'video-player-container'\n                           videoPlayerContainer.className = 'w-full flex justify-center mb-6'\n                           \n                           // Crear contenedor para información del video\n                           const videoInfoContainer = document.createElement('div')\n                           videoInfoContainer.className = 'w-full max-w-3xl mx-auto'\n                           \n                           // Descripción\n                           const description = document.createElement('div')\n                           description.className = 'mb-4'\n                           description.innerHTML = `\n                             <p class=\"text-gray-600 text-sm\">${video.description || 'Sin descripción'}</p>\n                           `\n                           \n                                                       // Stats del video\n                            const stats = document.createElement('div')\n                            stats.className = 'flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg'\n                            stats.innerHTML = `\n                              <div class=\"flex items-center space-x-4 text-sm text-gray-600\">\n                                <span class=\"font-medium\">${(video.fileSize / (1024 * 1024)).toFixed(2)} MB</span>\n                                <span class=\"text-gray-400\">•</span>\n                                <span class=\"font-medium\">${video.resolution && video.resolution !== 'Unknown' ? video.resolution : 'HD'}</span>\n                                <span class=\"text-gray-400\">•</span>\n                                <span class=\"font-medium\">${video.duration ? Math.floor(video.duration / 60) + ':' + String(Math.floor(video.duration % 60)).padStart(2, '0') : 'N/A'}</span>\n                              </div>\n                              <div class=\"flex items-center space-x-2\">\n                                <div class=\"flex items-center space-x-1\">\n                                  <div class=\"flex items-center space-x-1\" title=\"Puntuación: ${video.rating || 0}/5\">\n                                    ${[1, 2, 3, 4, 5].map(star => {\n                                      const isFilled = (video.rating || 0) >= star\n                                      return `<svg class=\"w-4 h-4 ${isFilled ? 'text-yellow-400 fill-current' : 'text-gray-300'}\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\"/>\n                                      </svg>`\n                                    }).join('')}\n                                    <span class=\"text-sm font-medium text-gray-600\">${video.rating || 0}</span>\n                                  </div>\n                                </div>\n                                <button class=\"flex items-center space-x-1 ${video.userLiked ? 'text-red-500' : 'text-gray-400 hover:text-red-500'} transition-colors duration-200 p-2 rounded hover:bg-red-50\" title=\"${video.userLiked ? 'Quitar like' : 'Dar like'}\">\n                                  <svg class=\"w-5 h-5 ${video.userLiked ? 'fill-current' : ''}\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"></path>\n                                  </svg>\n                                  <span class=\"text-sm font-medium\">${video.likes || 0}</span>\n                                </button>\n                                <button class=\"text-gray-400 hover:text-green-500 transition-colors duration-200 p-2 rounded hover:bg-green-50\" title=\"Descargar video\">\n                                  <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"></path>\n                                  </svg>\n                                </button>\n                                <button class=\"text-gray-400 hover:text-blue-500 transition-colors duration-200 p-2 rounded hover:bg-blue-50\" title=\"Editar video\">\n                                  <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>\n                                  </svg>\n                                </button>\n                              </div>\n                            `\n                           \n                           // Tags normales\n                           const tagsContainer = document.createElement('div')\n                           tagsContainer.className = 'mb-4'\n                           const orderedTags = getOrderedTags(video)\n                           if (orderedTags.length > 0) {\n                             const tagsHTML = orderedTags.map(({ tag, categoryKey, color }) => {\n                               const colorClasses = getColorClasses(color)\n                               return `<span class=\"inline-block px-3 py-1 rounded-full text-sm font-medium ${colorClasses} mr-2 mb-2\">${tag}</span>`\n                             }).join('')\n                             tagsContainer.innerHTML = `\n                               <h4 class=\"text-sm font-medium text-gray-700 mb-2\">Etiquetas:</h4>\n                               <div class=\"flex flex-wrap\">${tagsHTML}</div>\n                             `\n                           } else {\n                             tagsContainer.innerHTML = `\n                               <h4 class=\"text-sm font-medium text-gray-700 mb-2\">Etiquetas:</h4>\n                               <span class=\"text-gray-400 text-sm\">Sin etiquetas</span>\n                             `\n                           }\n                           \n                           // Tags iniciales\n                           const tagsInicialesContainer = document.createElement('div')\n                           tagsInicialesContainer.className = 'mb-4'\n                           const tagsIniciales = getOrderedTagsIniciales(video)\n                           if (tagsIniciales.length > 0) {\n                             const tagsHTML = tagsIniciales.map(({ tag }) => \n                               `<span class=\"inline-block px-3 py-1 rounded-full text-sm font-medium bg-gradient-to-r from-blue-500 to-purple-500 text-white mr-2 mb-2\">${tag}</span>`\n                             ).join('')\n                             tagsInicialesContainer.innerHTML = `\n                               <h4 class=\"text-sm font-medium text-blue-600 uppercase tracking-wide mb-2\">Etiquetas Iniciales:</h4>\n                               <div class=\"flex flex-wrap\">${tagsHTML}</div>\n                             `\n                           }\n                           \n                           // Tags finales\n                           const tagsFinalesContainer = document.createElement('div')\n                           tagsFinalesContainer.className = 'mb-4'\n                           const tagsFinales = getOrderedTagsFinales(video)\n                           if (tagsFinales.length > 0) {\n                             const tagsHTML = tagsFinales.map(({ tag }) => \n                               `<span class=\"inline-block px-3 py-1 rounded-full text-sm font-medium bg-gradient-to-r from-green-500 to-teal-500 text-white mr-2 mb-2\">${tag}</span>`\n                             ).join('')\n                             tagsFinalesContainer.innerHTML = `\n                               <h4 class=\"text-sm font-medium text-green-600 uppercase tracking-wide mb-2\">Etiquetas Finales:</h4>\n                               <div class=\"flex flex-wrap\">${tagsHTML}</div>\n                             `\n                           }\n                           \n                           // Ensamblar todo\n                           videoInfoContainer.appendChild(description)\n                           videoInfoContainer.appendChild(stats)\n                           videoInfoContainer.appendChild(tagsContainer)\n                           if (tagsIniciales.length > 0) {\n                             videoInfoContainer.appendChild(tagsInicialesContainer)\n                           }\n                           if (tagsFinales.length > 0) {\n                             videoInfoContainer.appendChild(tagsFinalesContainer)\n                           }\n                           \n                           videoContainer.appendChild(header)\n                           videoContainer.appendChild(videoPlayerContainer)\n                           videoContainer.appendChild(videoInfoContainer)\n                           modal.appendChild(videoContainer)\n                           document.body.appendChild(modal)\n                           \n                           // Renderizar el VideoPlayer usando React\n                           const { createRoot } = await import('react-dom/client')\n                           const root = createRoot(videoPlayerContainer)\n                           root.render(React.createElement(VideoPlayer, {\n                             src: video.videoUrl,\n                             size: 'large',\n                             loop: true,\n                             initialShowControls: true,\n                             autoplay: true,\n                             muted: false,\n                             className: 'w-full max-w-3xl',\n                             resolutions: ['auto', '4k', '1080p', '720p', '480p', '360p'],\n                             currentResolution: 'auto',\n                             videoTitle: video.title || 'video',\n                             onResolutionChange: (resolution) => {\n                               // Aquí se implementaría la lógica para cambiar la resolución del video\n                             }\n                           }))\n                           \n                           // Guardar referencia del root para limpieza\n                           modal._root = root\n                           \n                           const closeModal = () => {\n                             if (modal._root) {\n                               modal._root.unmount()\n                             }\n                             if (document.body.contains(modal)) {\n                               document.body.removeChild(modal)\n                             }\n                           }\n                           \n                           header.querySelector('button').onclick = closeModal\n                           modal.onclick = (e) => {\n                             if (e.target === modal) {\n                               closeModal()\n                             }\n                           }\n                           \n                           // Añadir funcionalidad al botón de descarga\n                           stats.querySelector('button[title=\"Descargar video\"]').onclick = () => {\n                             downloadVideo(video)\n                           }\n                           \n                           // Añadir funcionalidad al botón de editar\n                           stats.querySelector('button[title=\"Editar video\"]').onclick = () => {\n                             closeModal()\n                             openEditModal(video)\n                           }\n                           \n                                                       // Añadir funcionalidad al sistema de rating\n                            const ratingContainer = stats.querySelector('div[title*=\"Puntuación\"]')\n                            const stars = ratingContainer.querySelectorAll('svg')\n                            const ratingText = ratingContainer.querySelector('span')\n                            \n                            stars.forEach((star, index) => {\n                              const starValue = index + 1\n                              \n                              // Hover effect\n                              star.addEventListener('mouseenter', () => {\n                                stars.forEach((s, i) => {\n                                  if (i <= index) {\n                                    s.classList.add('text-yellow-400', 'fill-current')\n                                    s.classList.remove('text-gray-300')\n                                  }\n                                })\n                              })\n                              \n                              star.addEventListener('mouseleave', () => {\n                                stars.forEach((s, i) => {\n                                  const currentRating = video.rating || 0\n                                  if (i < currentRating) {\n                                    s.classList.add('text-yellow-400', 'fill-current')\n                                    s.classList.remove('text-gray-300')\n                                  } else {\n                                    s.classList.remove('text-yellow-400', 'fill-current')\n                                    s.classList.add('text-gray-300')\n                                  }\n                                })\n                              })\n                              \n                              // Click to rate\n                              star.addEventListener('click', async () => {\n                                try {\n                                  const currentRating = video.rating || 0\n                                  // Si la estrella clickeada ya está marcada, quitar todas las estrellas (rating = 0)\n                                  // Si no está marcada, asignar el valor de la estrella\n                                  const newRating = currentRating >= starValue ? 0 : starValue\n                                  \n                                  // Actualizar en Firestore\n                                  await updateVideoDocument(video.id, { rating: newRating })\n                                  \n                                  // Actualizar estado local\n                                  video.rating = newRating\n                                  \n                                  // Actualizar visual\n                                  stars.forEach((s, i) => {\n                                    if (i < newRating) {\n                                      s.classList.add('text-yellow-400', 'fill-current')\n                                      s.classList.remove('text-gray-300')\n                                    } else {\n                                      s.classList.remove('text-yellow-400', 'fill-current')\n                                      s.classList.add('text-gray-300')\n                                    }\n                                  })\n                                  \n                                  ratingText.textContent = newRating\n                                  ratingContainer.title = `Puntuación: ${newRating}/5`\n                                  \n                                  // Video puntuado exitosamente\n                                } catch (error) {\n                                  console.error('Error al actualizar puntuación:', error)\n                                }\n                              })\n                            })\n                            \n                            // Añadir funcionalidad al botón de likes\n                            const likeButton = stats.querySelector('button[title*=\"like\"]')\n                            likeButton.onclick = async () => {\n                              if (!user) {\n                                alert('Debes iniciar sesión para dar like')\n                                return\n                              }\n                              \n                              try {\n                                const result = await toggleVideoLike(video.id, user.uid)\n                                \n                                if (result.success) {\n                                  // Actualizar el video en el estado local\n                                  video.likes = result.likes\n                                  video.likedBy = result.likedBy\n                                  video.userLiked = result.userLiked\n                                  \n                                  // Actualizar el estado global de videos\n                                  setVideos(prevVideos => \n                                    prevVideos.map(v => \n                                      v.id === video.id \n                                        ? { \n                                            ...v, \n                                            likes: result.likes, \n                                            likedBy: result.likedBy,\n                                            userLiked: result.userLiked \n                                          }\n                                        : v\n                                    )\n                                  )\n                                  \n                                  // Cambiar el estado visual del botón\n                                  const icon = likeButton.querySelector('svg')\n                                  const button = likeButton\n                                  const likesText = likeButton.querySelector('span')\n                                  \n                                  if (result.userLiked) {\n                                    icon.classList.add('fill-current', 'text-red-500')\n                                    icon.classList.remove('text-gray-400')\n                                    button.classList.add('text-red-500')\n                                    button.classList.remove('text-gray-400')\n                                    button.title = 'Quitar like'\n                                  } else {\n                                    icon.classList.remove('fill-current', 'text-red-500')\n                                    icon.classList.add('text-gray-400')\n                                    button.classList.remove('text-red-500')\n                                    button.classList.add('text-gray-400')\n                                    button.title = 'Dar like'\n                                  }\n                                  \n                                  // Actualizar el contador\n                                  likesText.textContent = result.likes\n                                  \n                                  const action = result.userLiked ? 'dado like a' : 'quitado like de'\n                                } else {\n                                  console.error('Error al actualizar like')\n                                }\n                              } catch (error) {\n                                console.error('Error al actualizar like:', error)\n                              }\n                            }\n                         } catch (error) {\n                           console.error('Error al abrir modal de video:', error)\n                         }\n                       }}\n                      className=\"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-200\"\n                    >\n                      <svg className=\"w-12 h-12 text-white\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path d=\"M8 5v14l11-7z\"/>\n                      </svg>\n                    </button>\n                  </div>\n                  \n                                     <div className={`${getVideoConfig().compact ? 'p-2' : 'p-4'}`}>\n                                            <div className={`flex items-center justify-between ${getVideoConfig().compact ? 'mb-1' : 'mb-2'}`}>\n                         <h3 className={`font-semibold text-gray-800 ${getVideoConfig().titleSize}`}>{video.title}</h3>\n                       <div className=\"flex items-center space-x-1\">\n                         {[1, 2, 3, 4, 5].map(star => {\n                           const isFilled = (video.rating || 0) >= star\n                           return (\n                             <svg \n                               key={star}\n                               className={`${getVideoConfig().compact ? 'h-3 w-3' : 'h-4 w-4'} ${isFilled ? 'text-yellow-400 fill-current' : 'text-gray-300'} cursor-pointer`} \n                               fill=\"currentColor\" \n                               viewBox=\"0 0 24 24\"\n                               onClick={async () => {\n                                 try {\n                                   const currentRating = video.rating || 0\n                                   // Si la estrella clickeada ya está marcada, quitar todas las estrellas (rating = 0)\n                                   // Si no está marcada, asignar el valor de la estrella\n                                   const newRating = currentRating >= star ? 0 : star\n                                   await updateVideoDocument(video.id, { rating: newRating })\n                                   video.rating = newRating\n                                 } catch (error) {\n                                   console.error('Error updating rating:', error)\n                                 }\n                               }}\n                             >\n                               <path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\"/>\n                             </svg>\n                           )\n                         })}\n                         <span className={`${getVideoConfig().compact ? 'text-xs' : 'text-xs'} font-medium text-gray-500 ml-1`}>({video.rating || 0})</span>\n                       </div>\n                     </div>\n                                           <p className={`text-gray-600 text-sm ${getVideoConfig().compact ? 'mb-2' : 'mb-3'} ${getVideoConfig().descriptionLines === 1 ? 'line-clamp-1' : getVideoConfig().descriptionLines === 2 ? 'line-clamp-2' : getVideoConfig().descriptionLines === 3 ? 'line-clamp-3' : 'line-clamp-4'}`}>{video.description || 'Sin descripción'}</p>\n                    \n                                         {/* Tags Normales */}\n                                           {getVideoConfig().showTags && (\n                        <div className=\"flex flex-wrap gap-2 mb-3\">\n                          {(() => {\n                            const orderedTags = getOrderedTags(video)\n                            if (orderedTags.length > 0) {\n                              return orderedTags.map(({ tag, categoryKey, color }) => (\n                                <span\n                                  key={`${categoryKey}-${tag}`}\n                                  className={`px-2 py-1 rounded-full text-xs font-medium ${getColorClasses(color)}`}\n                                >\n                                  {tag}\n                                </span>\n                              ))\n                            } else {\n                              return <span className=\"text-gray-400 text-sm\">Sin etiquetas</span>\n                            }\n                          })()}\n                        </div>\n                      )}\n\n                     {/* Tags Iniciales */}\n                                           {getVideoConfig().showTags && (() => {\n                        const tagsIniciales = getOrderedTagsIniciales(video)\n                        if (tagsIniciales.length > 0) {\n                          return (\n                            <div className=\"mb-3\">\n                              <div className=\"flex items-center space-x-2 mb-2\">\n                                <span className=\"text-xs font-medium text-blue-600 uppercase tracking-wide\">Iniciales:</span>\n                              </div>\n                              <div className=\"flex flex-wrap gap-2\">\n                                {tagsIniciales.map(({ tag, categoryKey, color }) => (\n                                  <span\n                                    key={`inicial-${categoryKey}-${tag}`}\n                                    className=\"px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-sm\"\n                                  >\n                                    {tag}\n                                  </span>\n                                ))}\n                              </div>\n                            </div>\n                          )\n                        }\n                        return null\n                      })()}\n\n                     {/* Tags Finales */}\n                                           {getVideoConfig().showTags && (() => {\n                        const tagsFinales = getOrderedTagsFinales(video)\n                        if (tagsFinales.length > 0) {\n                          return (\n                            <div className=\"mb-3\">\n                              <div className=\"flex items-center space-x-2 mb-2\">\n                                <span className=\"text-xs font-medium text-green-600 uppercase tracking-wide\">Finales:</span>\n                              </div>\n                              <div className=\"flex flex-wrap gap-2\">\n                                {tagsFinales.map(({ tag, categoryKey, color }) => (\n                                  <span\n                                    key={`final-${categoryKey}-${tag}`}\n                                    className=\"px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-sm\"\n                                  >\n                                    {tag}\n                                  </span>\n                                ))}\n                              </div>\n                            </div>\n                          )\n                        }\n                        return null\n                      })()}\n                    \n                                                                                                         {getVideoConfig().compact ? (\n                        <CompactCardActions\n                          video={video}\n                          onLike={() => handleVideoLike(video)}\n                          onEdit={() => openEditModal(video)}\n                          onDelete={() => openDeleteModal(video)}\n                          onAddToSequence={() => handleAddVideoToSequence(video)}\n                          onDownload={() => downloadVideo(video)}\n                          onPlay={() => handlePlayVideo(video)}\n                          isVideoInSequence={isVideoInSequence(video)}\n                          isBuilderOpen={isBuilderOpen}\n                          isVideoCompatible={isVideoCompatible(video)}\n                          type=\"video\"\n                        />\n                      ) : (\n                        <div className=\"flex items-center justify-between text-sm text-gray-500\">\n                          <div className=\"flex items-center space-x-2\">\n                            <span className=\"font-medium\">\n                              {(video.fileSize / (1024 * 1024)).toFixed(2)} MB\n                            </span>\n                            <span className=\"text-gray-400\">•</span>\n                            <span className=\"text-gray-600\">\n                              {video.resolution && video.resolution !== 'Unknown' ? \n                                video.resolution : \n                                'HD'\n                              }\n                            </span>\n                            {video.bpm && (\n                              <>\n                                <span className=\"text-gray-400\">•</span>\n                                <span className=\"text-purple-600 font-medium flex items-center space-x-1\">\n                                  <Music className=\"h-3 w-3\" />\n                                  <span>{video.bpm} BPM</span>\n                                </span>\n                              </>\n                            )}\n                          </div>\n                          <div className=\"flex items-center space-x-4\">\n                            <button \n                              onClick={() => handlePlayVideo(video)}\n                              className=\"text-gray-400 hover:text-blue-500 transition-colors duration-200 p-1 rounded hover:bg-blue-50\"\n                              title=\"Reproducir video\"\n                            >\n                              <Play className=\"h-4 w-4\" />\n                            </button>\n                            <button \n                              onClick={() => handleVideoLike(video)}\n                              className={`flex items-center space-x-1 transition-colors duration-200 p-1 rounded hover:bg-red-50 ${\n                                video.userLiked ? 'text-red-500' : 'text-gray-400 hover:text-red-500'\n                              }`}\n                              title={video.userLiked ? 'Quitar like' : 'Dar like'}\n                            >\n                              <Heart className={`h-4 w-4 ${video.userLiked ? 'fill-current' : ''}`} />\n                              <span className=\"font-medium\">{video.likes || 0}</span>\n                            </button>\n                            <button \n                              onClick={() => openEditModal(video)}\n                              className=\"text-gray-400 hover:text-blue-500 transition-colors duration-200 p-1 rounded hover:bg-blue-50\"\n                              title=\"Editar video\"\n                            >\n                              <Edit className=\"h-4 w-4\" />\n                            </button>\n                            <button \n                              onClick={() => openDeleteModal(video)}\n                              className=\"text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 rounded hover:bg-red-50\"\n                              title=\"Eliminar video\"\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </button>\n                            <button \n                              onClick={() => handleAddVideoToSequence(video)}\n                              disabled={isVideoInSequence(video)}\n                              className={`transition-colors duration-200 p-1 rounded ${\n                                isVideoInSequence(video)\n                                  ? 'text-gray-300 cursor-not-allowed'\n                                  : isBuilderOpen && !isVideoCompatible(video)\n                                  ? 'text-red-400 hover:text-red-500 hover:bg-red-50'\n                                  : 'text-gray-400 hover:text-purple-500 hover:bg-purple-50'\n                              }`}\n                              title={\n                                isVideoInSequence(video) \n                                  ? 'Ya en secuencia' \n                                  : isBuilderOpen && !isVideoCompatible(video)\n                                  ? 'Añadir forzadamente (incompatible)'\n                                  : 'Añadir a secuencia'\n                              }\n                            >\n                              <Plus className=\"h-4 w-4\" />\n                            </button>\n                            <button \n                              onClick={() => {\n                                downloadVideo(video)\n                              }}\n                              className=\"text-gray-400 hover:text-green-500 transition-colors duration-200 p-1 rounded hover:bg-green-50\"\n                              title=\"Descargar video\"\n                            >\n                              <Download className=\"h-4 w-4\" />\n                            </button>\n                          </div>\n                        </div>\n                      )}\n                  </div>\n                </div>\n              ))}\n            </div>\n           )}\n         </div>\n        )}\n\n        {/* Secuencias Grid */}\n        {activeTab === 'secuencias' && (\n          <div className=\"mb-8\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <h2 className=\"text-2xl font-semibold text-gray-800\">\n                Secuencias de {selectedStyle.toLowerCase()} ({sequences.length})\n              </h2>\n              <div className=\"flex items-center space-x-4\">\n                {/* Selector de tamaño de cards */}\n                <CardSizeSelector type=\"sequence\" />\n                \n                <button\n                  onClick={toggleBuilder}\n                  className=\"flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-lg font-medium shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105\"\n                >\n                  <Shuffle className=\"h-4 w-4\" />\n                  <span>CREAR SECUENCIA</span>\n                </button>\n              </div>\n            </div>\n            \n            {sequencesLoading ? (\n              <div className=\"flex justify-center items-center py-12\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500\"></div>\n                <span className=\"ml-3 text-gray-600\">Cargando secuencias...</span>\n              </div>\n            ) : (\n              <SequenceGallery\n                sequences={sequences}\n                onDeleteSequence={handleDeleteSequence}\n                onPlaySequence={handlePlaySequence}\n                onEditSequence={handleEditSequence}\n                onDownloadSequence={handleDownloadSequence}\n              />\n            )}\n          </div>\n        )}\n\n\n      </div>\n\n                           {/* Video Upload Modal */}\n                <VideoUploadModal\n           isOpen={isUploadModalOpen}\n           onClose={() => setIsUploadModalOpen(false)}\n           onVideoUploaded={handleVideoUploaded}\n           page=\"figuras\"\n           style={selectedStyle}\n         />\n\n        {/* Video Edit Modal */}\n        <VideoEditModal\n          isOpen={editModal.isOpen}\n          onClose={closeEditModal}\n          video={editModal.video}\n          onVideoUpdated={handleVideoUpdated}\n          page=\"figuras\"\n          style={selectedStyle}\n        />\n\n\n\n       {/* Cleanup Confirmation Modal */}\n       <ConfirmModal\n         isOpen={cleanupModal.isOpen}\n         onClose={closeCleanupModal}\n         onConfirm={() => handleCleanupData(cleanupModal.type)}\n         title={\n           cleanupModal.type === 'update' ? 'Actualizar Rutas de Thumbnails' :\n           cleanupModal.type === 'cleanup' ? 'Limpiar Archivos Huérfanos' :\n           cleanupModal.type === 'cleanup-tags' ? 'Limpiar Tags Duplicados' :\n           'Eliminar Todos los Videos'\n         }\n         message={\n           cleanupModal.type === 'update' ? \n           '¿Actualizar las rutas de thumbnails de videos existentes? Esto corregirá problemas de eliminación.' :\n           cleanupModal.type === 'cleanup' ? \n           '¿Limpiar archivos huérfanos? Esto eliminará archivos que no tienen documento en Firestore.' :\n           cleanupModal.type === 'cleanup-tags' ? \n           '¿Limpiar tags duplicados? Esto eliminará etiquetas repetidas en todos los videos manteniendo solo una instancia de cada tag.' :\n           '¿Eliminar TODOS los videos de Firebase y Storage? Esta acción es IRREVERSIBLE y eliminará todos los datos.'\n         }\n         confirmText={\n           cleanupModal.type === 'update' ? 'Actualizar' :\n           cleanupModal.type === 'cleanup' ? 'Limpiar' :\n           cleanupModal.type === 'cleanup-tags' ? 'Limpiar Tags' :\n           'Eliminar Todo'\n         }\n         cancelText=\"Cancelar\"\n       />\n\n       {/* Confirm Edit Sequence Modal */}\n       <ConfirmModal\n         isOpen={editSequenceModal.isOpen}\n         onClose={handleCancelEditSequence}\n         onConfirm={handleConfirmEditSequence}\n         title=\"🎬 Cargar Secuencia\"\n         message={`¿Deseas cargar la secuencia \"${editSequenceModal.sequence?.name}\"?\n\nEsto reemplazará la secuencia actual en construcción y perderás todos los cambios no guardados.\n\n¿Estás seguro de que quieres continuar?`}\n         confirmText=\"Sí, Cargar\"\n         cancelText=\"Cancelar\"\n         type=\"warning\"\n       />\n\n       {/* Confirm Delete Modal */}\n       <ConfirmModal\n         isOpen={deleteModal.isOpen}\n         onClose={closeDeleteModal}\n         onConfirm={() => handleDeleteVideo(deleteModal.video)}\n         title=\"🗑️ Eliminar Video\"\n         message={`¿Estás seguro de que quieres eliminar el video \"${deleteModal.video?.title}\"?\n\nEsta acción eliminará permanentemente:\n• El archivo de video de Firebase Storage\n• El thumbnail del video\n• Los metadatos de Firestore\n\nEsta acción NO se puede deshacer.`}\n         confirmText=\"Sí, Eliminar\"\n         cancelText=\"Cancelar\"\n         type=\"danger\"\n       />\n\n       {/* Video Player Modal */}\n       {showVideoPlayer && selectedVideo && (\n         <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4\">\n           <div className=\"relative w-full max-w-3xl h-auto max-h-[85vh] bg-white rounded-lg overflow-hidden flex flex-col\">\n             {/* Header */}\n             <div className=\"flex items-center justify-between p-4 bg-gray-50 border-b flex-shrink-0\">\n               <h3 className=\"text-lg font-semibold text-gray-800\">\n                 🎬 {selectedVideo.title}\n               </h3>\n               <button\n                 onClick={handleCloseVideoPlayer}\n                 className=\"text-gray-500 hover:text-gray-700 transition-colors\"\n               >\n                 <X className=\"h-6 w-6\" />\n               </button>\n             </div>\n             \n             {/* Video Player */}\n             <div className=\"flex-1 min-h-0 p-4\">\n               <div className=\"w-full h-full max-h-[65vh] flex items-center justify-center\">\n                 <div className=\"w-full max-w-md\">\n                   <SequenceVideoPlayer\n                     videos={[selectedVideo]}\n                     className=\"w-full h-full\"\n                     showControls={true}\n                     autoplay={true}\n                     loop={false}\n                     muted={false}\n                   />\n                 </div>\n               </div>\n             </div>\n           </div>\n         </div>\n       )}\n\n       {/* Sequence Player Modal */}\n       {showSequencePlayer && selectedSequence && (\n         <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4\">\n           <div className=\"relative w-full max-w-3xl h-auto max-h-[85vh] bg-white rounded-lg overflow-hidden flex flex-col\">\n             {/* Header */}\n             <div className=\"flex items-center justify-between p-4 bg-gray-50 border-b flex-shrink-0\">\n               <h3 className=\"text-lg font-semibold text-gray-800\">\n                 🎬 Secuencia: {selectedSequence.name}\n               </h3>\n               <button\n                 onClick={handleCloseSequencePlayer}\n                 className=\"text-gray-500 hover:text-gray-700 transition-colors\"\n               >\n                 <X className=\"h-6 w-6\" />\n               </button>\n             </div>\n             \n             {/* Sequence Player */}\n             <div className=\"flex-1 min-h-0 p-4\">\n               <div className=\"w-full h-full max-h-[65vh] flex items-center justify-center\">\n                 <div className=\"w-full max-w-md\">\n                   <SequenceVideoPlayer\n                     videos={selectedSequence.videos}\n                     className=\"w-full h-full\"\n                     showControls={true}\n                     autoplay={true}\n                     loop={false}\n                     muted={false}\n                   />\n                 </div>\n               </div>\n               </div>\n           </div>\n         </div>\n       )}\n\n       {/* Download Sequence Modal */}\n       <DownloadModal\n         isOpen={downloadSequenceModal.isOpen}\n         onClose={handleCloseDownloadSequence}\n         video={downloadSequenceModal.sequence ? {\n           ...downloadSequenceModal.sequence,\n           title: downloadSequenceModal.sequence.name,\n           file: null // El archivo se generará dinámicamente\n         } : null}\n         onDownloadComplete={() => {\n           addToast('Secuencia descargada correctamente', 'success')\n           handleCloseDownloadSequence()\n         }}\n       />\n\n       {/* Toasts */}\n       {toasts.map(toast => (\n         <Toast\n           key={toast.id}\n           message={toast.message}\n           type={toast.type}\n           onClose={() => removeToast(toast.id)}\n         />\n       ))}\n     </div>\n   )\n }\n\nexport default FigurasPage "],"file":"assets/FigurasPage-C05wCM0c.js"}