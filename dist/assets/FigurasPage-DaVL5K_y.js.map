{"version":3,"mappings":"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","names":["generateBestVideoThumbnail","videoFile","videoURL","video","canvas","ctx","resolve","reject","videoAspectRatio","canvasWidth","canvasHeight","duration","blob","thumbnailURL","error","uploadFile","file","path","onProgress","storageRef","ref","storage","metadata","snapshot","uploadBytes","getDownloadURL","deleteFile","deleteObject","uploadVideo","maxSize","downloadURL","uploadError","uploadTask","uploadBytesResumable","progress","errorMessage","deleteVideo","videoPath","thumbnailPath","promises","videoRef","thumbnailRef","deleteAllVideoFiles","videosResult","deleteAllFilesInFolder","thumbnailsResult","folderPath","folderRef","result","listAll","deletePromises","itemRef","results","successfulDeletes","r","failedDeletes","cleanupOrphanedFiles","videosFromFirestore","videosFolder","thumbnailsFolder","firestoreVideoPaths","v","firestoreThumbnailPaths","orphanedVideos","item","orphanedThumbnails","downloadFile","fileRef","url","response","blobToFile","filename","migrateVideosToOrganizedStructure","migrationResults","style","page","oldVideoPath","oldThumbnailPath","newVideoPath","newThumbnailPath","videoMigrated","thumbnailMigrated","videoBlob","thumbnailBlob","thumbnailFile","successfulMigrations","alreadyOrganized","failedMigrations","AlertTriangle","createLucideIcon","ChevronUp","ChevronsDown","ChevronsUp","Download","Filter","Grid3x3","GripVertical","Image","LayoutGrid","Loader","Maximize2","Maximize","Minimize2","Minimize","Pause","PenLine","Play","RotateCcw","Shuffle","SkipBack","SkipForward","Square","Volume2","VolumeX","XCircle","categoryStructure","useCategories","selectedPage","setSelectedPage","useState","selectedStyle","setSelectedStyle","useEffect","currentCategories","useMemo","pageData","styleData","availableTags","allTags","categoryKey","categoryData","tag","categoriesList","key","data","availableStyles","availablePages","color","Toast","message","type","onClose","isVisible","setIsVisible","timer","getIcon","jsx","CheckCircle","AlertCircle","getStyles","jsxs","X","VideoPlayer","src","size","loop","loopSegment","initialShowControls","autoplay","muted","onTimeUpdate","onEnded","className","resolutions","currentResolution","onResolutionChange","videoTitle","useRef","containerRef","isPlaying","setIsPlaying","currentTime","setCurrentTime","setDuration","volume","setVolume","isMuted","setIsMuted","showVolumeSlider","setShowVolumeSlider","volumeSliderTimeout","setVolumeSliderTimeout","isFullscreen","setIsFullscreen","isLoopEnabled","setIsLoopEnabled","loopStart","setLoopStart","loopEnd","setLoopEnd","isLoopSegmentMode","setIsLoopSegmentMode","hasPointA","setHasPointA","hasPointB","setHasPointB","savedPointA","setSavedPointA","savedPointB","setSavedPointB","showControls","setShowControls","controlsTimeout","setControlsTimeout","showResolutionMenu","setShowResolutionMenu","selectedResolution","setSelectedResolution","videoMaxResolution","setVideoMaxResolution","currentAutoResolution","setCurrentAutoResolution","showSpeedMenu","setShowSpeedMenu","playbackSpeed","setPlaybackSpeed","videoOrientation","setVideoOrientation","availableSpeeds","checkLoopSegment","handleKeyDown","e","activeElement","togglePlay","skip","nextIndex","handleSpeedChange","timeout","handleClickOutside","event","activateControls","handleVideoClick","lastClickTime","setLastClickTime","clickCount","setClickCount","handleVideoDoubleClick","rect","clickX","videoWidth","seconds","newTime","handleTimeUpdate","handleLoadedMetadata","width","height","isVertical","maxDimension","maxRes","handleEnded","handleSeek","toggleMute","newMutedState","handleVolumeChange","newVolume","toggleFullscreen","setLoopPoint","formatTime","time","minutes","handleResolutionChange","resolution","speed","getSpeedLabel","getResolutionLabel","isResolutionAvailable","resolutionOrder","maxIndex","getSizeClasses","sizeClass","downloadVideo","blobUrl","link","newMode","isAvailable","extractBPMFromVideo","audioContext","arrayBuffer","audioBuffer","checkAudioLevel","bpm","detectBPMFromAudioBuffer","roundedBPM","channelData","sampleRate","analysisLength","rms","sum","sample","peaks","detectPeaks","intervals","i","avgInterval","a","b","limitedBPM","interval","energy","avgEnergy","threshold","minDistance","windowSize","windowData","maxInWindow","lowerThreshold","validateBPM","VideoUploadModal","isOpen","onVideoUploaded","user","useAuth","fileInputRef","selectedFiles","setSelectedFiles","uploading","setUploading","uploadProgress","setUploadProgress","currentStep","setCurrentStep","videoData","setVideoData","toasts","setToasts","selectedTags","setSelectedTags","fieldRefs","collapsedVideos","setCollapsedVideos","resetForm","initialTags","addToast","id","prev","removeToast","toast","toggleVideoCollapse","fileName","newSet","toggleAllVideos","collapse","handleFileSelect","videoFiles","newFiles","existingFile","videoPreview","generateDefaultThumbnail","removeFile","index","fileToRemove","newData","handleTagToggle","category","currentTags","t","newTags","generateThumbnail","_a","customThumbnailFile","uploadResult","thumbnailError","defaultThumbnail","defaultError","uploadVideoFile","checkVideoDuplicate","thumbnailResult","tagsWithStyle","titleInput","descriptionInput","currentTitle","_b","currentDescription","_c","_d","videoResolution","videoHeight","bpmDetected","bpmResult","videoDoc","docResult","createVideoDocument","handleUpload","uploadedVideos","FileSelectionStep","Upload","Trash2","TagsStep","fileIndex","isCollapsed","ChevronDown","el","newTitle","newDescription","reader","UploadStep","renderStep","canProceed","handleNext","handleBack","Fragment","VideoEditModal","onVideoUpdated","loading","setLoading","title","setTitle","description","setDescription","customThumbnail","setCustomThumbnail","setCustomThumbnailFile","tagsIniciales","setTagsIniciales","tagsFinales","setTagsFinales","collapsedSections","setCollapsedSections","initialTagsIniciales","initialTagsFinales","toggleSectionCollapse","sectionName","handleTagInicialToggle","handleTagFinalToggle","handleThumbnailChange","detectVideoResolution","videoUrl","handleSave","thumbnailUrl","resolutionData","updatedData","updateVideoDocument","Edit","Tag","FFMessageType","getMessageID","messageID","ERROR_NOT_LOADED","ERROR_TERMINATED","FFmpeg","__privateAdd","_worker","_resolves","_rejects","_logEventCallbacks","_progressEventCallbacks","__publicField","_registerHandlers","__privateGet","f","_send","trans","signal","classWorkerURL","config","__privateSet","args","ids","fsType","options","mountPoint","encoding","oldPath","newPath","callback","FFFSType","readFromBlobOrFile","fileReader","fetchFile","c","ffmpeg","initFFmpeg","adjustVideoSpeed","speedFactor","outputName","ffmpegInstance","audioError","createSequencePreview","videos","useBPMControl","targetBPM","processedVideos","needsProcessing","fetchError","getStorage","__vitePreload","n","storagePath","urlParts","storageError","dataToWrite","fileList","_","finalData","convertVideoFormat","format","resolutionSettings","qualitySettings","downloadSequenceDirect","sequence","JSZip","zip","sequenceName","generateSequenceVideo","ffmpegPromise","timeoutPromise","convertResult","DownloadModal","onDownloadComplete","setFormat","setResolution","isProcessing","setIsProcessing","setProgress","formatOptions","resolutionOptions","handleDownload","progressInterval","mimeType","dirHandle","selectDownloadFolder","extension","writable","handleDirectDownload","Video","option","ConfirmModal","onConfirm","confirmText","cancelText","getConfirmButtonStyle","SEQUENCES_COLLECTION","createSequence","sequenceData","sequenceWithTimestamp","serverTimestamp","docRef","addDoc","collection","db","updateSequence","sequenceId","updateData","sequenceRef","doc","updateWithTimestamp","updateDoc","deleteSequence","deleteDoc","subscribeToSequencesByStyle","q","query","where","orderBy","onSnapshot","querySnapshot","sequences","_f","_e","_g","useDragAndDrop","onReorder","draggedIndex","setDraggedIndex","dragOverIndex","setDragOverIndex","handleDragStart","useCallback","handleDragOver","handleDragEnter","handleDragLeave","handleDrop","dropIndex","handleDragEnd","getDragStyles","styles","SequenceVideoPlayer","currentBPM","currentVideoIndex","setCurrentVideoIndex","showControlsUI","setShowControlsUI","playbackRate","setPlaybackRate","manualPlaybackSpeed","setManualPlaybackSpeed","useManualSpeed","setUseManualSpeed","currentVideo","handleVideoEnd","goToPreviousVideo","goToNextVideo","handleProgressClick","handleKeyPress","VideoCombiner","videoBlobs","combinedBlob","stream","mediaRecorder","chunks","processNextVideo","videoAspect","canvasAspect","drawWidth","drawHeight","offsetX","offsetY","renderFrame","VideoDownloadModal","setError","downloadUrl","setDownloadUrl","quality","setQuality","videoCombiner","handleDownloadFile","getProgressColor","getProgressIcon","getProgressBarColor","getStageDescription","SequenceBuilder","onSaveSequence","onToggleShowAll","showAllVideos","isIntegrated","onToggleBuilder","getColorClasses","selectedVideo","setSelectedVideo","showVideoModal","setShowVideoModal","isCreatingPreview","setIsCreatingPreview","previewVideoUrl","setPreviewVideoUrl","previewError","setPreviewError","lastPreviewData","setLastPreviewData","sequenceTags","setSequenceTags","isTagsSectionCollapsed","setIsTagsSectionCollapsed","showDownloadModal","setShowDownloadModal","setCurrentBPM","getOrderedTags","orderedTags","categoryTags","getOrderedTagsIniciales","getOrderedTagsFinales","sequenceDescription","editingSequenceId","addVideoToSequence","removeVideoFromSequence","reorderSequence","generateRandomSequence","clearSequence","setSequenceName","setSequenceDescription","isVideoCompatible","isVideoInSequence","toggleBuilder","checkCompatibility","useSequenceBuilderContext","videosWithBPM","bpmValues","averageBPM","confirmModal","setConfirmModal","randomCount","setRandomCount","handleVideoLike","toggleVideoLike","handleGenerateRandom","videosNeeded","lastVideo","compatibleVideos","seqVideo","handleSaveSequence","generateSequenceThumbnail","handleCancel","handleClearSequence","handleConfirmAction","timeoutId","generateRealtimePreview","getAvailableResolutions","handlePlayVideo","previewKey","prevTags","removed","rest","isTagSelected","getOrderedSequenceTags","firstVideo","Plus","star","isFilled","Music","Heart","Save","SmartThumbnail","alt","fallbackSrc","showPlayIcon","props","imageError","setImageError","isLoading","setIsLoading","handleImageLoad","handleImageError","shouldShowFallback","imageSrc","SequenceGallery","onDeleteSequence","onPlaySequence","onEditSequence","onEditThumbnail","onDownloadSequence","deleteModal","setDeleteModal","getSequenceConfig","useCardSize","handleDeleteClick","handleConfirmDelete","handlePlaySequence","handleDownloadSequence","Users","Edit3","CardSizeSelector","videoCardSize","sequenceCardSize","setVideoCardSize","setSequenceCardSize","availableSizes","sizeLabels","currentSize","setSize","sizeIcons","Grid3X3","Grid","sizeColors","CompactCardActions","onLike","onEdit","onDelete","onAddToSequence","onDownload","onPlay","isBuilderOpen","FigurasPage","isUploadModalOpen","setIsUploadModalOpen","editModal","setEditModal","setVideos","searchTerm","setSearchTerm","showFilters","setShowFilters","activeTab","setActiveTab","syncStatus","setSyncStatus","cleanupModal","setCleanupModal","editSequenceModal","setEditSequenceModal","downloadSequenceModal","setDownloadSequenceModal","migrationModal","setMigrationModal","isFullWidth","setIsFullWidth","showVideoPlayer","setShowVideoPlayer","selectedSequence","setSelectedSequence","showSequencePlayer","setShowSequencePlayer","activeCategoryChips","setActiveCategoryChips","sortBy","setSortBy","showFavorites","setShowFavorites","setSequences","sequencesLoading","setSequencesLoading","getVideoConfig","toggleShowAllVideos","getFilteredVideos","loadSequence","getGradientClasses","handleCategoryTitleClick","chip","handleAddVideoToSequence","iconMap","Star","Zap","unsubscribe","subscribeToVideosByStyle","videosData","updatedVideos","likeResult","favoriteResult","checkUserLikedVideo","checkUserFavorite","sequencesData","handleVideoUploaded","openEditModal","closeEditModal","handleVideoUpdated","updatedVideo","prevVideos","action","favoriteAction","sequenceWithStyle","handleDeleteSequence","handleEditSequence","sequenceToEdit","handleConfirmEditSequence","handleCancelEditSequence","handleCloseDownloadSequence","handleCloseVideoPlayer","handleCloseSequencePlayer","handleDeleteVideo","storageResult","firestoreResult","deleteVideoDocument","newVideos","openDeleteModal","closeDeleteModal","handleCleanupData","updateVideoThumbnailPaths","getVideos","cleanupDuplicateTags","deleteAllVideos","openCleanupModal","closeCleanupModal","handleDiagnoseVideos","diagnoseVideos","handleUpdateAllResolutions","videosToUpdate","updatedCount","videoElement","handleMigrateVideos","handleTagFilter","clearFilters","handleSortChange","sortKey","hasCategoryTags","cat","sortVideos","videosToSort","sortedVideos","normalizeText","text","advancedSearch","searchTerms","normalizedTitle","normalizedDescription","normalizedTags","searchWord","normalizedSearchWord","baseFilteredVideos","term","searchMatch","tagsMatch","categoryMatch","favoritesMatch","baseCompatibilityFiltered","filteredVideos","IconComponent","isSelected","gradientClass","Search","EyeOff","Eye","modal","videoContainer","header","videoPlayerContainer","videoInfoContainer","stats","tagsContainer","tagsHTML","tagsInicialesContainer","tagsFinalesContainer","createRoot","root","React","closeModal","ratingContainer","stars","ratingText","starValue","s","currentRating","newRating","likeButton","icon","button","likesText"],"ignoreList":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,33,34,35,36,37,38],"sources":["../../src/services/firebase/storage.js","../../node_modules/lucide-react/dist/esm/icons/alert-triangle.js","../../node_modules/lucide-react/dist/esm/icons/chevron-up.js","../../node_modules/lucide-react/dist/esm/icons/chevrons-down.js","../../node_modules/lucide-react/dist/esm/icons/chevrons-up.js","../../node_modules/lucide-react/dist/esm/icons/download.js","../../node_modules/lucide-react/dist/esm/icons/filter.js","../../node_modules/lucide-react/dist/esm/icons/grid-3x3.js","../../node_modules/lucide-react/dist/esm/icons/grip-vertical.js","../../node_modules/lucide-react/dist/esm/icons/image.js","../../node_modules/lucide-react/dist/esm/icons/layout-grid.js","../../node_modules/lucide-react/dist/esm/icons/loader.js","../../node_modules/lucide-react/dist/esm/icons/maximize-2.js","../../node_modules/lucide-react/dist/esm/icons/maximize.js","../../node_modules/lucide-react/dist/esm/icons/minimize-2.js","../../node_modules/lucide-react/dist/esm/icons/minimize.js","../../node_modules/lucide-react/dist/esm/icons/pause.js","../../node_modules/lucide-react/dist/esm/icons/pen-line.js","../../node_modules/lucide-react/dist/esm/icons/play.js","../../node_modules/lucide-react/dist/esm/icons/rotate-ccw.js","../../node_modules/lucide-react/dist/esm/icons/shuffle.js","../../node_modules/lucide-react/dist/esm/icons/skip-back.js","../../node_modules/lucide-react/dist/esm/icons/skip-forward.js","../../node_modules/lucide-react/dist/esm/icons/square.js","../../node_modules/lucide-react/dist/esm/icons/volume-2.js","../../node_modules/lucide-react/dist/esm/icons/volume-x.js","../../node_modules/lucide-react/dist/esm/icons/x-circle.js","../../src/hooks/useCategories.js","../../src/components/common/Toast.jsx","../../src/components/video/VideoPlayer.jsx","../../src/services/audio/bpmDetection.js","../../src/components/video/VideoUploadModal.jsx","../../src/components/video/VideoEditModal.jsx","../../node_modules/@ffmpeg/ffmpeg/dist/esm/const.js","../../node_modules/@ffmpeg/ffmpeg/dist/esm/utils.js","../../node_modules/@ffmpeg/ffmpeg/dist/esm/errors.js","../../node_modules/@ffmpeg/ffmpeg/dist/esm/classes.js","../../node_modules/@ffmpeg/ffmpeg/dist/esm/types.js","../../node_modules/@ffmpeg/util/dist/esm/index.js","../../src/services/video/videoProcessor.js","../../src/components/video/DownloadModal.jsx","../../src/components/common/ConfirmModal.jsx","../../src/services/firebase/sequences.js","../../src/hooks/useDragAndDrop.js","../../src/components/sequence/SequenceVideoPlayer.jsx","../../src/services/video/videoCombiner.js","../../src/components/video/VideoDownloadModal.jsx","../../src/components/sequence/SequenceBuilder.jsx","../../src/components/common/SmartThumbnail.jsx","../../src/components/sequence/SequenceGallery.jsx","../../src/components/common/CardSizeSelector.jsx","../../src/components/common/CompactCardActions.jsx","../../src/pages/FigurasPage.jsx"],"sourcesContent":["// Servicios de Firebase Storage\r\nimport { \r\n  ref,\r\n  uploadBytes,\r\n  getDownloadURL,\r\n  deleteObject,\r\n  listAll,\r\n  uploadBytesResumable\r\n} from 'firebase/storage';\r\nimport { storage } from './config';\r\n\r\n// Función para generar thumbnail del video completo - ALTA CALIDAD\r\nexport const generateVideoThumbnail = (videoFile) => {\r\n  return new Promise((resolve, reject) => {\r\n    try {\r\n      // Crear URL temporal del video\r\n      const videoURL = URL.createObjectURL(videoFile);\r\n      \r\n      // Crear elemento de video\r\n      const video = document.createElement('video');\r\n      video.crossOrigin = 'anonymous';\r\n      video.muted = true;\r\n      video.playsInline = true;\r\n      \r\n      // Crear canvas para capturar el frame\r\n      const canvas = document.createElement('canvas');\r\n      const ctx = canvas.getContext('2d');\r\n      \r\n      // Configurar canvas para thumbnails de ALTA CALIDAD\r\n      const maxWidth = 1280; // Aumentar de 400 a 1280 para mejor calidad\r\n      const maxHeight = 720; // Aumentar de 400 a 720 para mejor calidad\r\n      \r\n      video.onloadedmetadata = () => {\r\n        try {\r\n          // Calcular las dimensiones manteniendo las proporciones\r\n          const videoAspectRatio = video.videoWidth / video.videoHeight;\r\n          let canvasWidth, canvasHeight;\r\n          \r\n          if (videoAspectRatio > 1) {\r\n            // Video horizontal\r\n            canvasWidth = maxWidth;\r\n            canvasHeight = maxWidth / videoAspectRatio;\r\n          } else {\r\n            // Video vertical\r\n            canvasHeight = maxHeight;\r\n            canvasWidth = maxHeight * videoAspectRatio;\r\n          }\r\n          \r\n          canvas.width = canvasWidth;\r\n          canvas.height = canvasHeight;\r\n          \r\n          // Buscar un frame en el medio del video (como al principio)\r\n          const duration = video.duration;\r\n          const targetTime = Math.min(duration * 0.5, 1); // 50% del video o máximo 1 segundo\r\n          \r\n          video.currentTime = targetTime;\r\n          \r\n          video.onseeked = () => {\r\n            try {\r\n              // Dibujar el frame completo en el canvas\r\n              ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n              \r\n              // Convertir a blob\r\n              canvas.toBlob((blob) => {\r\n                if (blob) {\r\n                  // Crear URL del thumbnail\r\n                  const thumbnailURL = URL.createObjectURL(blob);\r\n                  \r\n                  // Limpiar recursos\r\n                  URL.revokeObjectURL(videoURL);\r\n                  video.remove();\r\n                  canvas.remove();\r\n                  \r\n                  resolve({\r\n                    success: true,\r\n                    thumbnailURL,\r\n                    blob,\r\n                    error: null\r\n                  });\r\n                } else {\r\n                  reject(new Error('No se pudo generar el thumbnail'));\r\n                }\r\n              }, 'image/jpeg', 0.95); // Aumentar calidad de 0.8 a 0.95\r\n              \r\n            } catch (error) {\r\n              reject(new Error(`Error al capturar frame: ${error.message}`));\r\n            }\r\n          };\r\n          \r\n          video.onerror = () => {\r\n            reject(new Error('Error al cargar el video para thumbnail'));\r\n          };\r\n          \r\n        } catch (error) {\r\n          reject(new Error(`Error al procesar metadata: ${error.message}`));\r\n        }\r\n      };\r\n      \r\n      video.onerror = () => {\r\n        // Limpiar recursos en caso de error\r\n        URL.revokeObjectURL(videoURL);\r\n        video.remove();\r\n        canvas.remove();\r\n        reject(new Error('Error al cargar el video'));\r\n      };\r\n      \r\n      // Cargar el video\r\n      video.src = videoURL;\r\n      \r\n    } catch (error) {\r\n      reject(new Error(`Error al generar thumbnail: ${error.message}`));\r\n    }\r\n  });\r\n};\r\n\r\n// Función para generar thumbnail simple (como fig006)\r\nexport const generateBestVideoThumbnail = async (videoFile) => {\r\n  try {\r\n    const videoURL = URL.createObjectURL(videoFile);\r\n    const video = document.createElement('video');\r\n    video.crossOrigin = 'anonymous';\r\n    video.muted = true;\r\n    video.playsInline = true;\r\n    \r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d');\r\n    \r\n    return new Promise((resolve, reject) => {\r\n      video.onloadedmetadata = () => {\r\n        // Configurar canvas para thumbnails de ALTA CALIDAD\r\n        const maxWidth = 1280; // Aumentar de 400 a 1280 para mejor calidad\r\n        const maxHeight = 720; // Aumentar de 400 a 720 para mejor calidad\r\n        \r\n        // Calcular las dimensiones manteniendo las proporciones\r\n        const videoAspectRatio = video.videoWidth / video.videoHeight;\r\n        let canvasWidth, canvasHeight;\r\n        \r\n        if (videoAspectRatio > 1) {\r\n          // Video horizontal\r\n          canvasWidth = maxWidth;\r\n          canvasHeight = maxWidth / videoAspectRatio;\r\n        } else {\r\n          // Video vertical\r\n          canvasHeight = maxHeight;\r\n          canvasWidth = maxHeight * videoAspectRatio;\r\n        }\r\n        \r\n        canvas.width = canvasWidth;\r\n        canvas.height = canvasHeight;\r\n        \r\n        const duration = video.duration;\r\n        \r\n        // Usar solo el punto medio del video (como fig006) o máximo 1 segundo\r\n        video.currentTime = Math.min(duration * 0.5, 1);\r\n        \r\n        video.onseeked = () => {\r\n          try {\r\n            // Dibujar el frame completo en el canvas\r\n            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n            \r\n            canvas.toBlob((blob) => {\r\n              if (blob) {\r\n                const thumbnailURL = URL.createObjectURL(blob);\r\n                \r\n                URL.revokeObjectURL(videoURL);\r\n                video.remove();\r\n                canvas.remove();\r\n                \r\n                resolve({\r\n                  success: true,\r\n                  thumbnailURL,\r\n                  blob,\r\n                  error: null\r\n                });\r\n              } else {\r\n                reject(new Error('No se pudo generar el thumbnail'));\r\n              }\r\n            }, 'image/jpeg', 0.95); // Aumentar calidad de 0.8 a 0.95\r\n            \r\n          } catch (error) {\r\n            reject(new Error(`Error al capturar frame: ${error.message}`));\r\n          }\r\n        };\r\n        \r\n        video.onerror = () => {\r\n          reject(new Error('Error al cargar el video para thumbnail'));\r\n        };\r\n      };\r\n      \r\n      video.onerror = () => {\r\n        URL.revokeObjectURL(videoURL);\r\n        video.remove();\r\n        canvas.remove();\r\n        reject(new Error('Error al cargar el video'));\r\n      };\r\n      \r\n      video.src = videoURL;\r\n    });\r\n    \r\n  } catch (error) {\r\n    return {\r\n      success: false,\r\n      thumbnailURL: 'https://via.placeholder.com/300x200/1a1a1a/ffffff?text=VIDEO',\r\n      blob: null,\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\n// Función de upload simulado para desarrollo (cuando Firebase Storage no está disponible)\r\nexport const uploadVideoSimulated = async (file, path, onProgress) => {\r\n  try {\r\n    // Validar tipo de archivo\r\n    if (!file.type.startsWith('video/')) {\r\n      throw new Error('El archivo debe ser un video');\r\n    }\r\n    \r\n    // Validar tamaño (máximo 100MB)\r\n    const maxSize = 100 * 1024 * 1024; // 100MB\r\n    if (file.size > maxSize) {\r\n      throw new Error('El video es demasiado grande. Máximo 100MB');\r\n    }\r\n    \r\n    // Simular progreso de upload\r\n    for (let i = 0; i <= 100; i += 10) {\r\n      if (onProgress) {\r\n        onProgress(i);\r\n      }\r\n      await new Promise(resolve => setTimeout(resolve, 200)); // Simular delay\r\n    }\r\n    \r\n    // Crear URL temporal del archivo\r\n    const fileUrl = URL.createObjectURL(file);\r\n    \r\n    // Simular metadata\r\n    const metadata = {\r\n      uploadedAt: new Date().toISOString(),\r\n      originalName: file.name,\r\n      fileSize: file.size.toString(),\r\n      fileType: 'video',\r\n      simulated: true\r\n    };\r\n    \r\n    return { \r\n      success: true,\r\n      url: fileUrl, \r\n      path: path,\r\n      error: null,\r\n      simulated: true,\r\n      metadata\r\n    };\r\n    \r\n  } catch (error) {\r\n    console.error('Error uploading video (simulated):', error);\r\n    \r\n    return { \r\n      success: false,\r\n      url: null, \r\n      path: null,\r\n      error: error.message,\r\n      simulated: true\r\n    };\r\n  }\r\n};\r\n\r\n// Subir archivo con progreso\r\nexport const uploadFile = async (file, path, onProgress) => {\r\n  try {\r\n    const storageRef = ref(storage, path);\r\n    \r\n    // Crear metadata para el archivo\r\n    const metadata = {\r\n      contentType: file.type,\r\n      customMetadata: {\r\n        uploadedAt: new Date().toISOString(),\r\n        originalName: file.name,\r\n        fileSize: file.size.toString()\r\n      }\r\n    };\r\n    \r\n    // Subir archivo con metadata\r\n    const snapshot = await uploadBytes(storageRef, file, metadata);\r\n    \r\n    // Obtener URL de descarga\r\n    const downloadURL = await getDownloadURL(snapshot.ref);\r\n    \r\n    return { \r\n      success: true,\r\n      url: downloadURL, \r\n      path: snapshot.ref.fullPath,\r\n      error: null \r\n    };\r\n  } catch (error) {\r\n    console.error('Error uploading file:', error);\r\n    return { \r\n      success: false,\r\n      url: null, \r\n      path: null,\r\n      error: error.message \r\n    };\r\n  }\r\n};\r\n\r\n// Subir imagen con compresión\r\nexport const uploadImage = async (file, path, maxSize = 1024 * 1024) => {\r\n  try {\r\n    // Comprimir imagen si es muy grande\r\n    let fileToUpload = file;\r\n    \r\n    if (file.size > maxSize) {\r\n      const compressedFile = await compressImage(file, maxSize);\r\n      fileToUpload = compressedFile;\r\n    }\r\n    \r\n    return await uploadFile(fileToUpload, path);\r\n  } catch (error) {\r\n    return { \r\n      url: null, \r\n      path: null,\r\n      error: error.message \r\n    };\r\n  }\r\n};\r\n\r\n// Comprimir imagen\r\nconst compressImage = (file, maxSize) => {\r\n  return new Promise((resolve) => {\r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d');\r\n    const img = new Image();\r\n    \r\n    img.onload = () => {\r\n      let { width, height } = img;\r\n      \r\n      // Calcular nuevas dimensiones\r\n      const ratio = Math.min(maxSize / file.size, 1);\r\n      width *= ratio;\r\n      height *= ratio;\r\n      \r\n      canvas.width = width;\r\n      canvas.height = height;\r\n      \r\n      ctx.drawImage(img, 0, 0, width, height);\r\n      \r\n      canvas.toBlob((blob) => {\r\n        const compressedFile = new File([blob], file.name, {\r\n          type: file.type,\r\n          lastModified: Date.now()\r\n        });\r\n        resolve(compressedFile);\r\n      }, file.type, 0.8);\r\n    };\r\n    \r\n    img.src = URL.createObjectURL(file);\r\n  });\r\n};\r\n\r\n// Obtener URL de descarga\r\nexport const getFileURL = async (path) => {\r\n  try {\r\n    const storageRef = ref(storage, path);\r\n    const url = await getDownloadURL(storageRef);\r\n    return { url, error: null };\r\n  } catch (error) {\r\n    return { url: null, error: error.message };\r\n  }\r\n};\r\n\r\n// Eliminar archivo\r\nexport const deleteFile = async (path) => {\r\n  try {\r\n    const storageRef = ref(storage, path);\r\n    await deleteObject(storageRef);\r\n    return { success: true, error: null };\r\n  } catch (error) {\r\n    return { success: false, error: error.message };\r\n  }\r\n};\r\n\r\n// Listar archivos en una carpeta\r\nexport const listFiles = async (folderPath) => {\r\n  try {\r\n    const folderRef = ref(storage, folderPath);\r\n    const result = await listAll(folderRef);\r\n    \r\n    const files = await Promise.all(\r\n      result.items.map(async (itemRef) => {\r\n        const url = await getDownloadURL(itemRef);\r\n        return {\r\n          name: itemRef.name,\r\n          path: itemRef.fullPath,\r\n          url\r\n        };\r\n      })\r\n    );\r\n    \r\n    return { files, error: null };\r\n  } catch (error) {\r\n    return { files: [], error: error.message };\r\n  }\r\n};\r\n\r\n// Subir imagen de perfil\r\nexport const uploadProfileImage = async (file, userId) => {\r\n  const path = `profiles/${userId}/${Date.now()}_${file.name}`;\r\n  return await uploadImage(file, path);\r\n};\r\n\r\n// Subir imagen de nota\r\nexport const uploadNoteImage = async (file, noteId) => {\r\n  const path = `notes/${noteId}/${Date.now()}_${file.name}`;\r\n  return await uploadImage(file, path);\r\n};\r\n\r\n// Subir imagen de evento\r\nexport const uploadEventImage = async (file, eventId) => {\r\n  const path = `events/${eventId}/${Date.now()}_${file.name}`;\r\n  return await uploadImage(file, path);\r\n};\r\n\r\n// Subir imagen de figura\r\nexport const uploadFigureImage = async (file, figureId) => {\r\n  const path = `figures/${figureId}/${Date.now()}_${file.name}`;\r\n  return await uploadImage(file, path);\r\n};\r\n\r\n// Subir video con manejo de errores mejorado y progreso\r\nexport const uploadVideo = async (file, path, onProgress) => {\r\n  try {\r\n    // Validar tipo de archivo\r\n    if (!file.type.startsWith('video/')) {\r\n      throw new Error('El archivo debe ser un video');\r\n    }\r\n    \r\n    // Validar tamaño (máximo 100MB)\r\n    const maxSize = 100 * 1024 * 1024; // 100MB\r\n    if (file.size > maxSize) {\r\n      throw new Error('El video es demasiado grande. Máximo 100MB');\r\n    }\r\n    \r\n    // Ya tienes el plan Blaze, usar Firebase Storage real directamente\r\n    console.log('Subiendo video a Firebase Storage...');\r\n    \r\n    // Crear metadata específica para videos\r\n    const metadata = {\r\n      contentType: file.type,\r\n      customMetadata: {\r\n        uploadedAt: new Date().toISOString(),\r\n        originalName: file.name,\r\n        fileSize: file.size.toString(),\r\n        fileType: 'video'\r\n      }\r\n    };\r\n    \r\n    const storageRef = ref(storage, path);\r\n    \r\n    // Intentar primero con uploadBytes simple\r\n    try {\r\n      const snapshot = await uploadBytes(storageRef, file, metadata);\r\n      const downloadURL = await getDownloadURL(snapshot.ref);\r\n      \r\n      console.log('Video subido exitosamente a Firebase Storage:', downloadURL);\r\n      \r\n      return { \r\n        success: true,\r\n        url: downloadURL, \r\n        path: snapshot.ref.fullPath,\r\n        error: null,\r\n        simulated: false\r\n      };\r\n    } catch (uploadError) {\r\n      console.error('Error con uploadBytes, intentando con uploadBytesResumable:', uploadError);\r\n      \r\n      // Si falla, intentar con uploadBytesResumable\r\n      const uploadTask = uploadBytesResumable(storageRef, file, metadata);\r\n      \r\n      return new Promise((resolve, reject) => {\r\n        uploadTask.on(\r\n          'state_changed',\r\n          (snapshot) => {\r\n            // Progreso del upload\r\n            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\r\n            if (onProgress) {\r\n              onProgress(progress);\r\n            }\r\n          },\r\n          (error) => {\r\n            // Error durante el upload\r\n            console.error('Error uploading video:', error);\r\n            \r\n            let errorMessage = 'Error al subir el video';\r\n            if (error.code === 'storage/unauthorized') {\r\n              errorMessage = 'No tienes permisos para subir videos';\r\n            } else if (error.code === 'storage/quota-exceeded') {\r\n              errorMessage = 'Se ha excedido la cuota de almacenamiento';\r\n            } else if (error.code === 'storage/retry-limit-exceeded') {\r\n              errorMessage = 'Error de conexión. Intenta de nuevo';\r\n            } else if (error.code === 'storage/canceled') {\r\n              errorMessage = 'Upload cancelado';\r\n            } else if (error.message) {\r\n              errorMessage = error.message;\r\n            }\r\n            \r\n            resolve({ \r\n              success: false,\r\n              url: null, \r\n              path: null,\r\n              error: errorMessage,\r\n              simulated: false\r\n            });\r\n          },\r\n          async () => {\r\n            // Upload completado exitosamente\r\n            try {\r\n              const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);\r\n              console.log('Video subido exitosamente a Firebase Storage:', downloadURL);\r\n              resolve({ \r\n                success: true,\r\n                url: downloadURL, \r\n                path: uploadTask.snapshot.ref.fullPath,\r\n                error: null,\r\n                simulated: false\r\n              });\r\n            } catch (error) {\r\n              resolve({ \r\n                success: false,\r\n                url: null, \r\n                path: null,\r\n                error: 'Error al obtener la URL del video',\r\n                simulated: false\r\n              });\r\n            }\r\n          }\r\n        );\r\n      });\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('Error uploading video:', error);\r\n    \r\n    // Manejar errores específicos\r\n    let errorMessage = 'Error al subir el video';\r\n    if (error.code === 'storage/unauthorized') {\r\n      errorMessage = 'No tienes permisos para subir videos';\r\n    } else if (error.code === 'storage/quota-exceeded') {\r\n      errorMessage = 'Se ha excedido la cuota de almacenamiento';\r\n    } else if (error.code === 'storage/retry-limit-exceeded') {\r\n      errorMessage = 'Error de conexión. Intenta de nuevo';\r\n    } else if (error.message) {\r\n      errorMessage = error.message;\r\n    }\r\n    \r\n    return { \r\n      success: false,\r\n      url: null, \r\n      path: null,\r\n      error: errorMessage,\r\n      simulated: false\r\n    };\r\n  }\r\n};\r\n\r\n// Subir video de figura\r\nexport const uploadFigureVideo = async (file, figureId) => {\r\n  const path = `figures/${figureId}/videos/${Date.now()}_${file.name}`;\r\n  return await uploadVideo(file, path);\r\n};\r\n\r\n// Eliminar video completo (archivo + thumbnail)\r\nexport const deleteVideo = async (videoPath, thumbnailPath) => {\r\n  try {\r\n    console.log('🗑️ Iniciando eliminación de archivos:')\r\n    console.log('📁 Video path:', videoPath)\r\n    console.log('🖼️ Thumbnail path:', thumbnailPath)\r\n    \r\n    const promises = [];\r\n    \r\n    // Eliminar archivo de video\r\n    if (videoPath) {\r\n      console.log('🎬 Eliminando video:', videoPath)\r\n      const videoRef = ref(storage, videoPath);\r\n      promises.push(deleteObject(videoRef));\r\n    } else {\r\n      console.log('⚠️ No hay ruta de video para eliminar')\r\n    }\r\n    \r\n    // Eliminar thumbnail (solo si existe y no es null)\r\n    if (thumbnailPath && thumbnailPath !== null && thumbnailPath !== '') {\r\n      console.log('🖼️ Eliminando thumbnail:', thumbnailPath)\r\n      const thumbnailRef = ref(storage, thumbnailPath);\r\n      promises.push(deleteObject(thumbnailRef));\r\n    } else {\r\n      console.log('⚠️ No hay ruta de thumbnail para eliminar (thumbnailPath:', thumbnailPath, ')')\r\n    }\r\n    \r\n    console.log(`📊 Archivos a eliminar: ${promises.length}`)\r\n    \r\n    if (promises.length === 0) {\r\n      console.log('⚠️ No hay archivos para eliminar')\r\n      return { \r\n        success: true, \r\n        error: null,\r\n        deletedCount: 0\r\n      };\r\n    }\r\n    \r\n    await Promise.all(promises);\r\n    \r\n    console.log('✅ Archivos eliminados exitosamente')\r\n    return { \r\n      success: true, \r\n      error: null,\r\n      deletedCount: promises.length\r\n    };\r\n  } catch (error) {\r\n    console.error('❌ Error deleting video:', error);\r\n    return { \r\n      success: false, \r\n      error: error.message,\r\n      deletedCount: 0\r\n    };\r\n  }\r\n};\r\n\r\n// ===== FUNCIONES DE LIMPIEZA DE STORAGE =====\r\n\r\n// Eliminar todos los archivos de videos\r\nexport const deleteAllVideoFiles = async () => {\r\n  try {\r\n    console.log('🗑️ Iniciando eliminación de todos los archivos de videos...')\r\n    \r\n    // Eliminar archivos de videos\r\n    const videosResult = await deleteAllFilesInFolder('videos')\r\n    console.log(`✅ Archivos de videos eliminados: ${videosResult.deletedCount}`)\r\n    \r\n    // Eliminar archivos de thumbnails\r\n    const thumbnailsResult = await deleteAllFilesInFolder('thumbnails')\r\n    console.log(`✅ Archivos de thumbnails eliminados: ${thumbnailsResult.deletedCount}`)\r\n    \r\n    return {\r\n      success: true,\r\n      videosDeleted: videosResult.deletedCount,\r\n      thumbnailsDeleted: thumbnailsResult.deletedCount,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error al eliminar archivos de videos:', error)\r\n    return {\r\n      success: false,\r\n      videosDeleted: 0,\r\n      thumbnailsDeleted: 0,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Eliminar todos los archivos en una carpeta específica\r\nexport const deleteAllFilesInFolder = async (folderPath) => {\r\n  try {\r\n    console.log(`🗑️ Eliminando archivos en carpeta: ${folderPath}`)\r\n    \r\n    const folderRef = ref(storage, folderPath)\r\n    const result = await listAll(folderRef)\r\n    \r\n    if (result.items.length === 0) {\r\n      console.log(`✅ No hay archivos en ${folderPath}`)\r\n      return { success: true, deletedCount: 0, error: null }\r\n    }\r\n    \r\n    console.log(`📊 Archivos a eliminar en ${folderPath}: ${result.items.length}`)\r\n    \r\n    const deletePromises = result.items.map(async (itemRef) => {\r\n      try {\r\n        await deleteObject(itemRef)\r\n        return { success: true, path: itemRef.fullPath }\r\n      } catch (error) {\r\n        console.error(`❌ Error eliminando ${itemRef.fullPath}:`, error)\r\n        return { success: false, path: itemRef.fullPath, error: error.message }\r\n      }\r\n    })\r\n    \r\n    const results = await Promise.all(deletePromises)\r\n    const successfulDeletes = results.filter(r => r.success).length\r\n    const failedDeletes = results.filter(r => !r.success).length\r\n    \r\n    console.log(`✅ ${successfulDeletes} archivos eliminados exitosamente en ${folderPath}`)\r\n    if (failedDeletes > 0) {\r\n      console.log(`⚠️ ${failedDeletes} archivos fallaron al eliminar en ${folderPath}`)\r\n    }\r\n    \r\n    return {\r\n      success: true,\r\n      deletedCount: successfulDeletes,\r\n      failedCount: failedDeletes,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error(`❌ Error al eliminar archivos en ${folderPath}:`, error)\r\n    return {\r\n      success: false,\r\n      deletedCount: 0,\r\n      failedCount: 0,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Limpiar archivos huérfanos (archivos sin documento en Firestore)\r\nexport const cleanupOrphanedFiles = async (videosFromFirestore) => {\r\n  try {\r\n    console.log('🧹 Iniciando limpieza de archivos huérfanos...')\r\n    \r\n    // Obtener todos los archivos de videos y thumbnails\r\n    const videosFolder = await listAll(ref(storage, 'videos'))\r\n    const thumbnailsFolder = await listAll(ref(storage, 'thumbnails'))\r\n    \r\n    // Crear sets de rutas de archivos existentes en Firestore\r\n    const firestoreVideoPaths = new Set(videosFromFirestore.map(v => v.videoPath).filter(Boolean))\r\n    const firestoreThumbnailPaths = new Set(videosFromFirestore.map(v => v.thumbnailPath).filter(Boolean))\r\n    \r\n    // Encontrar archivos huérfanos\r\n    const orphanedVideos = videosFolder.items.filter(item => !firestoreVideoPaths.has(item.fullPath))\r\n    const orphanedThumbnails = thumbnailsFolder.items.filter(item => !firestoreThumbnailPaths.has(item.fullPath))\r\n    \r\n    console.log(`📊 Archivos huérfanos encontrados: ${orphanedVideos.length} videos, ${orphanedThumbnails.length} thumbnails`)\r\n    \r\n    // Eliminar archivos huérfanos\r\n    const deletePromises = [\r\n      ...orphanedVideos.map(item => deleteObject(item)),\r\n      ...orphanedThumbnails.map(item => deleteObject(item))\r\n    ]\r\n    \r\n    if (deletePromises.length > 0) {\r\n      await Promise.all(deletePromises)\r\n      console.log(`✅ ${deletePromises.length} archivos huérfanos eliminados`)\r\n    } else {\r\n      console.log('✅ No se encontraron archivos huérfanos')\r\n    }\r\n    \r\n    return {\r\n      success: true,\r\n      orphanedVideosDeleted: orphanedVideos.length,\r\n      orphanedThumbnailsDeleted: orphanedThumbnails.length,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error en limpieza de archivos huérfanos:', error)\r\n    return {\r\n      success: false,\r\n      orphanedVideosDeleted: 0,\r\n      orphanedThumbnailsDeleted: 0,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Función auxiliar para descargar un archivo desde Firebase Storage\r\nconst downloadFile = async (path) => {\r\n  try {\r\n    const fileRef = ref(storage, path)\r\n    const url = await getDownloadURL(fileRef)\r\n    \r\n    // Descargar el archivo usando fetch\r\n    const response = await fetch(url)\r\n    if (!response.ok) {\r\n      throw new Error(`Error al descargar archivo: ${response.status}`)\r\n    }\r\n    \r\n    const blob = await response.blob()\r\n    return blob\r\n  } catch (error) {\r\n    console.error(`Error descargando archivo ${path}:`, error)\r\n    throw error\r\n  }\r\n}\r\n\r\n// Función auxiliar para convertir blob a File\r\nconst blobToFile = (blob, filename) => {\r\n  return new File([blob], filename, { type: blob.type })\r\n}\r\n\r\n// Migrar videos existentes a la nueva estructura organizada\r\nexport const migrateVideosToOrganizedStructure = async (videosFromFirestore) => {\r\n  try {\r\n    console.log('🔄 Iniciando migración de videos a estructura organizada...')\r\n    \r\n    const migrationResults = []\r\n    \r\n    for (const video of videosFromFirestore) {\r\n      try {\r\n        // Verificar si el video ya está en la nueva estructura\r\n        if (video.videoPath && video.videoPath.includes('/figuras/') || \r\n            video.videoPath && video.videoPath.includes('/escuela/') || \r\n            video.videoPath && video.videoPath.includes('/eventos/')) {\r\n          console.log(`⏭️ Video ${video.title} ya está en estructura organizada`)\r\n          migrationResults.push({\r\n            videoId: video.id,\r\n            title: video.title,\r\n            status: 'already_organized',\r\n            error: null\r\n          })\r\n          continue\r\n        }\r\n        \r\n        // Determinar la nueva ruta basada en el estilo del video\r\n        const style = video.style || 'salsa' // Default a salsa si no hay estilo\r\n        const page = 'figuras' // Default a figuras, se puede mejorar después\r\n        \r\n        const oldVideoPath = video.videoPath\r\n        const oldThumbnailPath = video.thumbnailPath\r\n        \r\n        const newVideoPath = `videos/${page}/${style}/${oldVideoPath.split('/').pop()}`\r\n        const newThumbnailPath = oldThumbnailPath ? \r\n          `thumbnails/${page}/${style}/${oldThumbnailPath.split('/').pop()}` : null\r\n        \r\n        console.log(`🔄 Migrando video: ${video.title}`)\r\n        console.log(`   De: ${oldVideoPath}`)\r\n        console.log(`   A: ${newVideoPath}`)\r\n        \r\n        // MIGRACIÓN REAL DE ARCHIVOS\r\n        let videoMigrated = false\r\n        let thumbnailMigrated = false\r\n        \r\n        // Migrar video\r\n        try {\r\n          console.log(`📥 Descargando video: ${oldVideoPath}`)\r\n          const videoBlob = await downloadFile(oldVideoPath)\r\n          const videoFile = blobToFile(videoBlob, oldVideoPath.split('/').pop())\r\n          \r\n          console.log(`📤 Subiendo video a nueva ubicación: ${newVideoPath}`)\r\n          await uploadFile(videoFile, newVideoPath)\r\n          videoMigrated = true\r\n          console.log(`✅ Video migrado exitosamente`)\r\n          \r\n          // Eliminar archivo original\r\n          console.log(`🗑️ Eliminando archivo original: ${oldVideoPath}`)\r\n          await deleteFile(oldVideoPath)\r\n          \r\n        } catch (error) {\r\n          console.error(`❌ Error migrando video ${video.title}:`, error)\r\n          throw new Error(`Error migrando video: ${error.message}`)\r\n        }\r\n        \r\n        // Migrar thumbnail si existe\r\n        if (oldThumbnailPath && newThumbnailPath) {\r\n          try {\r\n            console.log(`📥 Descargando thumbnail: ${oldThumbnailPath}`)\r\n            const thumbnailBlob = await downloadFile(oldThumbnailPath)\r\n            const thumbnailFile = blobToFile(thumbnailBlob, oldThumbnailPath.split('/').pop())\r\n            \r\n            console.log(`📤 Subiendo thumbnail a nueva ubicación: ${newThumbnailPath}`)\r\n            await uploadFile(thumbnailFile, newThumbnailPath)\r\n            thumbnailMigrated = true\r\n            console.log(`✅ Thumbnail migrado exitosamente`)\r\n            \r\n            // Eliminar archivo original\r\n            console.log(`🗑️ Eliminando thumbnail original: ${oldThumbnailPath}`)\r\n            await deleteFile(oldThumbnailPath)\r\n            \r\n          } catch (error) {\r\n            console.error(`❌ Error migrando thumbnail ${video.title}:`, error)\r\n            // No fallamos la migración completa si falla el thumbnail\r\n          }\r\n        }\r\n        \r\n        migrationResults.push({\r\n          videoId: video.id,\r\n          title: video.title,\r\n          oldVideoPath,\r\n          newVideoPath,\r\n          oldThumbnailPath,\r\n          newThumbnailPath,\r\n          status: 'migrated',\r\n          videoMigrated,\r\n          thumbnailMigrated,\r\n          error: null\r\n        })\r\n        \r\n      } catch (error) {\r\n        console.error(`❌ Error migrando video ${video.title}:`, error)\r\n        migrationResults.push({\r\n          videoId: video.id,\r\n          title: video.title,\r\n          status: 'error',\r\n          error: error.message\r\n        })\r\n      }\r\n    }\r\n    \r\n    const successfulMigrations = migrationResults.filter(r => r.status === 'migrated').length\r\n    const alreadyOrganized = migrationResults.filter(r => r.status === 'already_organized').length\r\n    const failedMigrations = migrationResults.filter(r => r.status === 'error').length\r\n    \r\n    console.log(`✅ Migración completada: ${successfulMigrations} migrados, ${alreadyOrganized} ya organizados, ${failedMigrations} fallidos`)\r\n    \r\n    return {\r\n      success: true,\r\n      totalVideos: videosFromFirestore.length,\r\n      successfulMigrations,\r\n      alreadyOrganized,\r\n      failedMigrations,\r\n      results: migrationResults,\r\n      error: null\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('❌ Error en migración de videos:', error)\r\n    return {\r\n      success: false,\r\n      totalVideos: 0,\r\n      successfulMigrations: 0,\r\n      alreadyOrganized: 0,\r\n      failedMigrations: 0,\r\n      results: [],\r\n      error: error.message\r\n    }\r\n  }\r\n} ","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst AlertTriangle = createLucideIcon(\"AlertTriangle\", [\n  [\n    \"path\",\n    {\n      d: \"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z\",\n      key: \"c3ski4\"\n    }\n  ],\n  [\"path\", { d: \"M12 9v4\", key: \"juzpu7\" }],\n  [\"path\", { d: \"M12 17h.01\", key: \"p32p05\" }]\n]);\n\nexport { AlertTriangle as default };\n//# sourceMappingURL=alert-triangle.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ChevronUp = createLucideIcon(\"ChevronUp\", [[\"path\", { d: \"m18 15-6-6-6 6\", key: \"153udz\" }]]);\n\nexport { ChevronUp as default };\n//# sourceMappingURL=chevron-up.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ChevronsDown = createLucideIcon(\"ChevronsDown\", [\n  [\"path\", { d: \"m7 6 5 5 5-5\", key: \"1lc07p\" }],\n  [\"path\", { d: \"m7 13 5 5 5-5\", key: \"1d48rs\" }]\n]);\n\nexport { ChevronsDown as default };\n//# sourceMappingURL=chevrons-down.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ChevronsUp = createLucideIcon(\"ChevronsUp\", [\n  [\"path\", { d: \"m17 11-5-5-5 5\", key: \"e8nh98\" }],\n  [\"path\", { d: \"m17 18-5-5-5 5\", key: \"2avn1x\" }]\n]);\n\nexport { ChevronsUp as default };\n//# sourceMappingURL=chevrons-up.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Download = createLucideIcon(\"Download\", [\n  [\"path\", { d: \"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\", key: \"ih7n3h\" }],\n  [\"polyline\", { points: \"7 10 12 15 17 10\", key: \"2ggqvy\" }],\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"15\", y2: \"3\", key: \"1vk2je\" }]\n]);\n\nexport { Download as default };\n//# sourceMappingURL=download.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Filter = createLucideIcon(\"Filter\", [\n  [\"polygon\", { points: \"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3\", key: \"1yg77f\" }]\n]);\n\nexport { Filter as default };\n//# sourceMappingURL=filter.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Grid3x3 = createLucideIcon(\"Grid3x3\", [\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"3\", rx: \"2\", key: \"afitv7\" }],\n  [\"path\", { d: \"M3 9h18\", key: \"1pudct\" }],\n  [\"path\", { d: \"M3 15h18\", key: \"5xshup\" }],\n  [\"path\", { d: \"M9 3v18\", key: \"fh3hqa\" }],\n  [\"path\", { d: \"M15 3v18\", key: \"14nvp0\" }]\n]);\n\nexport { Grid3x3 as default };\n//# sourceMappingURL=grid-3x3.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst GripVertical = createLucideIcon(\"GripVertical\", [\n  [\"circle\", { cx: \"9\", cy: \"12\", r: \"1\", key: \"1vctgf\" }],\n  [\"circle\", { cx: \"9\", cy: \"5\", r: \"1\", key: \"hp0tcf\" }],\n  [\"circle\", { cx: \"9\", cy: \"19\", r: \"1\", key: \"fkjjf6\" }],\n  [\"circle\", { cx: \"15\", cy: \"12\", r: \"1\", key: \"1tmaij\" }],\n  [\"circle\", { cx: \"15\", cy: \"5\", r: \"1\", key: \"19l28e\" }],\n  [\"circle\", { cx: \"15\", cy: \"19\", r: \"1\", key: \"f4zoj3\" }]\n]);\n\nexport { GripVertical as default };\n//# sourceMappingURL=grip-vertical.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Image = createLucideIcon(\"Image\", [\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"3\", rx: \"2\", ry: \"2\", key: \"1m3agn\" }],\n  [\"circle\", { cx: \"9\", cy: \"9\", r: \"2\", key: \"af1f0g\" }],\n  [\"path\", { d: \"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21\", key: \"1xmnt7\" }]\n]);\n\nexport { Image as default };\n//# sourceMappingURL=image.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst LayoutGrid = createLucideIcon(\"LayoutGrid\", [\n  [\"rect\", { width: \"7\", height: \"7\", x: \"3\", y: \"3\", rx: \"1\", key: \"1g98yp\" }],\n  [\"rect\", { width: \"7\", height: \"7\", x: \"14\", y: \"3\", rx: \"1\", key: \"6d4xhi\" }],\n  [\"rect\", { width: \"7\", height: \"7\", x: \"14\", y: \"14\", rx: \"1\", key: \"nxv5o0\" }],\n  [\"rect\", { width: \"7\", height: \"7\", x: \"3\", y: \"14\", rx: \"1\", key: \"1bb6yr\" }]\n]);\n\nexport { LayoutGrid as default };\n//# sourceMappingURL=layout-grid.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Loader = createLucideIcon(\"Loader\", [\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"2\", y2: \"6\", key: \"gza1u7\" }],\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"18\", y2: \"22\", key: \"1qhbu9\" }],\n  [\"line\", { x1: \"4.93\", x2: \"7.76\", y1: \"4.93\", y2: \"7.76\", key: \"xae44r\" }],\n  [\"line\", { x1: \"16.24\", x2: \"19.07\", y1: \"16.24\", y2: \"19.07\", key: \"bxnmvf\" }],\n  [\"line\", { x1: \"2\", x2: \"6\", y1: \"12\", y2: \"12\", key: \"89khin\" }],\n  [\"line\", { x1: \"18\", x2: \"22\", y1: \"12\", y2: \"12\", key: \"pb8tfm\" }],\n  [\"line\", { x1: \"4.93\", x2: \"7.76\", y1: \"19.07\", y2: \"16.24\", key: \"1uxjnu\" }],\n  [\"line\", { x1: \"16.24\", x2: \"19.07\", y1: \"7.76\", y2: \"4.93\", key: \"6duxfx\" }]\n]);\n\nexport { Loader as default };\n//# sourceMappingURL=loader.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Maximize2 = createLucideIcon(\"Maximize2\", [\n  [\"polyline\", { points: \"15 3 21 3 21 9\", key: \"mznyad\" }],\n  [\"polyline\", { points: \"9 21 3 21 3 15\", key: \"1avn1i\" }],\n  [\"line\", { x1: \"21\", x2: \"14\", y1: \"3\", y2: \"10\", key: \"ota7mn\" }],\n  [\"line\", { x1: \"3\", x2: \"10\", y1: \"21\", y2: \"14\", key: \"1atl0r\" }]\n]);\n\nexport { Maximize2 as default };\n//# sourceMappingURL=maximize-2.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Maximize = createLucideIcon(\"Maximize\", [\n  [\"path\", { d: \"M8 3H5a2 2 0 0 0-2 2v3\", key: \"1dcmit\" }],\n  [\"path\", { d: \"M21 8V5a2 2 0 0 0-2-2h-3\", key: \"1e4gt3\" }],\n  [\"path\", { d: \"M3 16v3a2 2 0 0 0 2 2h3\", key: \"wsl5sc\" }],\n  [\"path\", { d: \"M16 21h3a2 2 0 0 0 2-2v-3\", key: \"18trek\" }]\n]);\n\nexport { Maximize as default };\n//# sourceMappingURL=maximize.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Minimize2 = createLucideIcon(\"Minimize2\", [\n  [\"polyline\", { points: \"4 14 10 14 10 20\", key: \"11kfnr\" }],\n  [\"polyline\", { points: \"20 10 14 10 14 4\", key: \"rlmsce\" }],\n  [\"line\", { x1: \"14\", x2: \"21\", y1: \"10\", y2: \"3\", key: \"o5lafz\" }],\n  [\"line\", { x1: \"3\", x2: \"10\", y1: \"21\", y2: \"14\", key: \"1atl0r\" }]\n]);\n\nexport { Minimize2 as default };\n//# sourceMappingURL=minimize-2.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Minimize = createLucideIcon(\"Minimize\", [\n  [\"path\", { d: \"M8 3v3a2 2 0 0 1-2 2H3\", key: \"hohbtr\" }],\n  [\"path\", { d: \"M21 8h-3a2 2 0 0 1-2-2V3\", key: \"5jw1f3\" }],\n  [\"path\", { d: \"M3 16h3a2 2 0 0 1 2 2v3\", key: \"198tvr\" }],\n  [\"path\", { d: \"M16 21v-3a2 2 0 0 1 2-2h3\", key: \"ph8mxp\" }]\n]);\n\nexport { Minimize as default };\n//# sourceMappingURL=minimize.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Pause = createLucideIcon(\"Pause\", [\n  [\"rect\", { width: \"4\", height: \"16\", x: \"6\", y: \"4\", key: \"iffhe4\" }],\n  [\"rect\", { width: \"4\", height: \"16\", x: \"14\", y: \"4\", key: \"sjin7j\" }]\n]);\n\nexport { Pause as default };\n//# sourceMappingURL=pause.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst PenLine = createLucideIcon(\"PenLine\", [\n  [\"path\", { d: \"M12 20h9\", key: \"t2du7b\" }],\n  [\"path\", { d: \"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z\", key: \"ymcmye\" }]\n]);\n\nexport { PenLine as default };\n//# sourceMappingURL=pen-line.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Play = createLucideIcon(\"Play\", [\n  [\"polygon\", { points: \"5 3 19 12 5 21 5 3\", key: \"191637\" }]\n]);\n\nexport { Play as default };\n//# sourceMappingURL=play.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst RotateCcw = createLucideIcon(\"RotateCcw\", [\n  [\"path\", { d: \"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8\", key: \"1357e3\" }],\n  [\"path\", { d: \"M3 3v5h5\", key: \"1xhq8a\" }]\n]);\n\nexport { RotateCcw as default };\n//# sourceMappingURL=rotate-ccw.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Shuffle = createLucideIcon(\"Shuffle\", [\n  [\"path\", { d: \"M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22\", key: \"1wmou1\" }],\n  [\"path\", { d: \"m18 2 4 4-4 4\", key: \"pucp1d\" }],\n  [\"path\", { d: \"M2 6h1.9c1.5 0 2.9.9 3.6 2.2\", key: \"10bdb2\" }],\n  [\"path\", { d: \"M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8\", key: \"vgxac0\" }],\n  [\"path\", { d: \"m18 14 4 4-4 4\", key: \"10pe0f\" }]\n]);\n\nexport { Shuffle as default };\n//# sourceMappingURL=shuffle.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst SkipBack = createLucideIcon(\"SkipBack\", [\n  [\"polygon\", { points: \"19 20 9 12 19 4 19 20\", key: \"o2sva\" }],\n  [\"line\", { x1: \"5\", x2: \"5\", y1: \"19\", y2: \"5\", key: \"1ocqjk\" }]\n]);\n\nexport { SkipBack as default };\n//# sourceMappingURL=skip-back.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst SkipForward = createLucideIcon(\"SkipForward\", [\n  [\"polygon\", { points: \"5 4 15 12 5 20 5 4\", key: \"16p6eg\" }],\n  [\"line\", { x1: \"19\", x2: \"19\", y1: \"5\", y2: \"19\", key: \"futhcm\" }]\n]);\n\nexport { SkipForward as default };\n//# sourceMappingURL=skip-forward.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Square = createLucideIcon(\"Square\", [\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"3\", rx: \"2\", key: \"afitv7\" }]\n]);\n\nexport { Square as default };\n//# sourceMappingURL=square.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Volume2 = createLucideIcon(\"Volume2\", [\n  [\"polygon\", { points: \"11 5 6 9 2 9 2 15 6 15 11 19 11 5\", key: \"16drj5\" }],\n  [\"path\", { d: \"M15.54 8.46a5 5 0 0 1 0 7.07\", key: \"ltjumu\" }],\n  [\"path\", { d: \"M19.07 4.93a10 10 0 0 1 0 14.14\", key: \"1kegas\" }]\n]);\n\nexport { Volume2 as default };\n//# sourceMappingURL=volume-2.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst VolumeX = createLucideIcon(\"VolumeX\", [\n  [\"polygon\", { points: \"11 5 6 9 2 9 2 15 6 15 11 19 11 5\", key: \"16drj5\" }],\n  [\"line\", { x1: \"22\", x2: \"16\", y1: \"9\", y2: \"15\", key: \"1ewh16\" }],\n  [\"line\", { x1: \"16\", x2: \"22\", y1: \"9\", y2: \"15\", key: \"5ykzw1\" }]\n]);\n\nexport { VolumeX as default };\n//# sourceMappingURL=volume-x.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst XCircle = createLucideIcon(\"XCircle\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"path\", { d: \"m15 9-6 6\", key: \"1uzhvr\" }],\n  [\"path\", { d: \"m9 9 6 6\", key: \"z0biqf\" }]\n]);\n\nexport { XCircle as default };\n//# sourceMappingURL=x-circle.js.map\n","// 🎯 HOOK PARA GESTIÓN DE CATEGORÍAS - SALSAHACKS V2.0\r\n\r\nimport { useState, useMemo, useEffect } from 'react'\r\n\r\n// Estructura jerárquica de categorías (copiada de CategoriesPage.jsx)\r\nconst categoryStructure = {\r\n  figuras: {\r\n    name: 'FIGURAS',\r\n    icon: 'Music',\r\n    styles: {\r\n      salsa: {\r\n        name: 'SALSA',\r\n        icon: 'Music',\r\n        color: 'salsa',\r\n        categories: {\r\n          estilo: {\r\n            name: 'ESTILO',\r\n            color: 'pink',\r\n            tags: ['Salsa', 'Salsa en línea On1', 'Salsa cubana', 'Estilo LA', 'Estilo NY', 'Estilo show']\r\n          },\r\n          subestilo: {\r\n            name: 'SUBESTILO/TÉCNICA',\r\n            color: 'orange',\r\n            tags: ['Pasitos libres', 'Parejas', 'Footwork On1', 'Footwork On2', 'Shines', 'Fusionado con afro', 'Body movement']\r\n          },\r\n          tipo: {\r\n            name: 'TIPO DE FIGURA',\r\n            color: 'green',\r\n            tags: ['Cross Body Lead', 'Copa', 'Sombrero', 'Dile que no', 'Setenta', 'Vacilala', 'Enchufla']\r\n          },\r\n          manos: {\r\n            name: 'MANOS/TÉCNICA DE AGARRE',\r\n            color: 'blue',\r\n            tags: ['Una mano', 'Dos manos paralelas', 'Cruzadas', 'Entrelazadas', 'Cambio de manos', 'Manos abiertas', 'Sin contacto']\r\n          }\r\n        }\r\n      },\r\n      bachata: {\r\n        name: 'BACHATA',\r\n        icon: 'Heart',\r\n        color: 'bachata',\r\n        categories: {\r\n          estilo: {\r\n            name: 'ESTILO',\r\n            color: 'red',\r\n            tags: ['Bachata dominicana', 'Bachata moderna', 'Bachata sensual', 'Bachata urbana']\r\n          },\r\n          subestilo: {\r\n            name: 'SUBESTILO/TÉCNICA',\r\n            color: 'orange',\r\n            tags: ['Body rolls', 'Hip movement', 'Footwork básico', 'Turns']\r\n          },\r\n          tipo: {\r\n            name: 'TIPO DE FIGURA',\r\n            color: 'green',\r\n            tags: ['Dile que no', 'Setenta', 'Vacilala', 'Sombrero', 'Copa']\r\n          },\r\n          manos: {\r\n            name: 'MANOS/TÉCNICA DE AGARRE',\r\n            color: 'blue',\r\n            tags: ['Una mano', 'Dos manos', 'Cruzadas', 'Entrelazadas']\r\n          }\r\n        }\r\n      },\r\n      kizomba: {\r\n        name: 'KIZOMBA',\r\n        icon: 'Zap',\r\n        color: 'kizomba',\r\n        categories: {\r\n          estilo: {\r\n            name: 'ESTILO',\r\n            color: 'yellow',\r\n            tags: ['Kizomba tradicional', 'Kizomba urbana', 'Tarraxinha', 'Semba']\r\n          },\r\n          subestilo: {\r\n            name: 'SUBESTILO/TÉCNICA',\r\n            color: 'orange',\r\n            tags: ['Body movement', 'Hip rolls', 'Footwork', 'Turns']\r\n          },\r\n          tipo: {\r\n            name: 'TIPO DE FIGURA',\r\n            color: 'green',\r\n            tags: ['Saída', 'Volta', 'Tarraxinha', 'Semba step']\r\n          },\r\n          manos: {\r\n            name: 'MANOS/TÉCNICA DE AGARRE',\r\n            color: 'blue',\r\n            tags: ['Una mano', 'Dos manos', 'Cruzadas', 'Sin contacto']\r\n          }\r\n        }\r\n      },\r\n      zouk: {\r\n        name: 'ZOUK',\r\n        icon: 'Star',\r\n        color: 'zouk',\r\n        categories: {\r\n          estilo: {\r\n            name: 'ESTILO',\r\n            color: 'purple',\r\n            tags: ['Zouk brasileño', 'Zouk flow', 'Zouk neofusion', 'Zouk tradicional']\r\n          },\r\n          subestilo: {\r\n            name: 'SUBESTILO/TÉCNICA',\r\n            color: 'orange',\r\n            tags: ['Body rolls', 'Head movement', 'Footwork', 'Turns']\r\n          },\r\n          tipo: {\r\n            name: 'TIPO DE FIGURA',\r\n            color: 'green',\r\n            tags: ['Lateral', 'Tranca', 'Pião', 'Balanço']\r\n          },\r\n          manos: {\r\n            name: 'MANOS/TÉCNICA DE AGARRE',\r\n            color: 'blue',\r\n            tags: ['Una mano', 'Dos manos', 'Cruzadas', 'Entrelazadas']\r\n          }\r\n        }\r\n      },\r\n      merengue: {\r\n        name: 'MERENGUE',\r\n        icon: 'Sun',\r\n        color: 'merengue',\r\n        categories: {\r\n          estilo: {\r\n            name: 'ESTILO',\r\n            color: 'orange',\r\n            tags: ['Merengue dominicano', 'Merengue tradicional', 'Merengue moderno']\r\n          },\r\n          subestilo: {\r\n            name: 'SUBESTILO/TÉCNICA',\r\n            color: 'orange',\r\n            tags: ['Hip movement', 'Footwork básico', 'Turns simples']\r\n          },\r\n          tipo: {\r\n            name: 'TIPO DE FIGURA',\r\n            color: 'green',\r\n            tags: ['Giros simples', 'Cambios de dirección', 'Pasos básicos']\r\n          },\r\n          manos: {\r\n            name: 'MANOS/TÉCNICA DE AGARRE',\r\n            color: 'blue',\r\n            tags: ['Una mano', 'Dos manos', 'Sin contacto']\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  escuela: {\r\n    name: 'ESCUELA',\r\n    icon: 'GraduationCap',\r\n    styles: {\r\n      salsa: {\r\n        name: 'SALSA',\r\n        icon: 'Music',\r\n        color: 'pink',\r\n        categories: {\r\n          nivel: {\r\n            name: 'NIVEL',\r\n            color: 'green',\r\n            tags: ['Principiante', 'Intermedio', 'Avanzado', 'Experto']\r\n          },\r\n          tipo: {\r\n            name: 'TIPO DE CURSO',\r\n            color: 'blue',\r\n            tags: ['Básico', 'Técnica', 'Coreografía', 'Ritmo', 'Musicalidad']\r\n          },\r\n          duracion: {\r\n            name: 'DURACIÓN',\r\n            color: 'orange',\r\n            tags: ['5-15 min', '10-25 min', '15-45 min', '20-60 min']\r\n          },\r\n          instructor: {\r\n            name: 'INSTRUCTOR',\r\n            color: 'purple',\r\n            tags: ['Carlos Rodríguez', 'María González', 'Juan Pérez', 'Ana López']\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  eventos: {\r\n    name: 'EVENTOS',\r\n    icon: 'Calendar',\r\n    styles: {\r\n      salsa: {\r\n        name: 'SALSA',\r\n        icon: 'Music',\r\n        color: 'pink',\r\n        categories: {\r\n          tipo: {\r\n            name: 'TIPO DE EVENTO',\r\n            color: 'green',\r\n            tags: ['Competición', 'Encuentro', 'Congreso', 'Workshop', 'Fiesta']\r\n          },\r\n          ubicacion: {\r\n            name: 'UBICACIÓN',\r\n            color: 'blue',\r\n            tags: ['Madrid', 'Barcelona', 'Valencia', 'Sevilla', 'Bilbao']\r\n          },\r\n          nivel: {\r\n            name: 'NIVEL',\r\n            color: 'orange',\r\n            tags: ['Todos los niveles', 'Intermedio-Avanzado', 'Solo avanzado']\r\n          },\r\n          fecha: {\r\n            name: 'FECHA',\r\n            color: 'purple',\r\n            tags: ['Este mes', 'Próximo mes', 'Este trimestre', 'Este año']\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport const useCategories = (page = 'figuras', style = 'salsa') => {\r\n  const [selectedPage, setSelectedPage] = useState(page)\r\n  const [selectedStyle, setSelectedStyle] = useState(style)\r\n\r\n  // Actualizar el estilo cuando cambie el parámetro\r\n  useEffect(() => {\r\n    setSelectedStyle(style)\r\n  }, [style])\r\n\r\n  // Actualizar la página cuando cambie el parámetro\r\n  useEffect(() => {\r\n    setSelectedPage(page)\r\n  }, [page])\r\n\r\n  // Obtener categorías para la página y estilo actual\r\n  const currentCategories = useMemo(() => {\r\n    const pageData = categoryStructure[selectedPage]\r\n    if (!pageData) return null\r\n\r\n    const styleData = pageData.styles[selectedStyle]\r\n    if (!styleData) return null\r\n\r\n    return styleData.categories\r\n  }, [selectedPage, selectedStyle])\r\n\r\n  // Obtener todos los tags disponibles para la página y estilo actual\r\n  const availableTags = useMemo(() => {\r\n    if (!currentCategories) return []\r\n\r\n    const allTags = []\r\n    Object.entries(currentCategories).forEach(([categoryKey, categoryData]) => {\r\n      categoryData.tags.forEach(tag => {\r\n        allTags.push({\r\n          tag,\r\n          category: categoryKey,\r\n          categoryName: categoryData.name,\r\n          color: categoryData.color\r\n        })\r\n      })\r\n    })\r\n\r\n    return allTags\r\n  }, [currentCategories])\r\n\r\n  // Obtener categorías organizadas\r\n  const categoriesList = useMemo(() => {\r\n    if (!currentCategories) return []\r\n\r\n    return Object.entries(currentCategories).map(([key, data]) => ({\r\n      key,\r\n      name: data.name,\r\n      color: data.color,\r\n      tags: data.tags\r\n    }))\r\n  }, [currentCategories])\r\n\r\n  // Obtener estilos disponibles para la página actual\r\n  const availableStyles = useMemo(() => {\r\n    const pageData = categoryStructure[selectedPage]\r\n    if (!pageData) return []\r\n\r\n    return Object.entries(pageData.styles).map(([key, data]) => ({\r\n      key,\r\n      name: data.name,\r\n      color: data.color,\r\n      icon: data.icon\r\n    }))\r\n  }, [selectedPage])\r\n\r\n  // Obtener páginas disponibles\r\n  const availablePages = useMemo(() => {\r\n    return Object.entries(categoryStructure).map(([key, data]) => ({\r\n      key,\r\n      name: data.name,\r\n      icon: data.icon\r\n    }))\r\n  }, [])\r\n\r\n  // Función para obtener colores de categorías\r\n  const getColorClasses = (color) => {\r\n    const colorMap = {\r\n             // Colores específicos de estilos de baile\r\n       salsa: 'bg-orange-100 text-orange-800 border-orange-200',\r\n       bachata: 'bg-emerald-100 text-emerald-800 border-emerald-200',\r\n       merengue: 'bg-cyan-100 text-cyan-800 border-cyan-200',\r\n       zouk: 'bg-violet-100 text-violet-800 border-violet-200',\r\n       kizomba: 'bg-amber-100 text-amber-800 border-amber-200',\r\n      \r\n      // Colores genéricos para categorías\r\n      pink: 'bg-pink-100 text-pink-800 border-pink-200',\r\n      red: 'bg-red-100 text-red-800 border-red-200',\r\n      orange: 'bg-orange-100 text-orange-800 border-orange-200',\r\n      yellow: 'bg-yellow-100 text-yellow-800 border-yellow-200',\r\n      green: 'bg-green-100 text-green-800 border-green-200',\r\n      blue: 'bg-blue-100 text-blue-800 border-blue-200',\r\n      purple: 'bg-purple-100 text-purple-800 border-purple-200'\r\n    }\r\n    return colorMap[color] || 'bg-gray-100 text-gray-800 border-gray-200'\r\n  }\r\n\r\n  // Función para obtener gradientes de categorías\r\n  const getGradientClasses = (color) => {\r\n    const gradientMap = {\r\n             // Gradientes específicos de estilos de baile\r\n       salsa: 'from-orange-400 to-pink-500',      // Naranja suave a rosa\r\n       bachata: 'from-emerald-400 to-teal-600',   // Verde esmeralda suave a verde azulado intenso\r\n       merengue: 'from-cyan-400 to-blue-600',     // Cian suave a azul intenso\r\n       zouk: 'from-violet-400 to-indigo-600',     // Violeta suave a índigo intenso\r\n       kizomba: 'from-amber-400 to-orange-600',   // Ámbar suave a naranja intenso\r\n      \r\n      // Gradientes genéricos para categorías\r\n      pink: 'from-pink-500 to-rose-500',\r\n      red: 'from-red-500 to-pink-500',\r\n      orange: 'from-orange-500 to-red-500',\r\n      yellow: 'from-yellow-500 to-orange-500',\r\n      green: 'from-green-500 to-emerald-500',\r\n      blue: 'from-blue-500 to-cyan-500',\r\n      purple: 'from-purple-500 to-pink-500'\r\n    }\r\n    return gradientMap[color] || 'from-gray-500 to-gray-600'\r\n  }\r\n\r\n  return {\r\n    // Estado\r\n    selectedPage,\r\n    selectedStyle,\r\n    setSelectedPage,\r\n    setSelectedStyle,\r\n\r\n    // Datos\r\n    currentCategories,\r\n    availableTags,\r\n    categoriesList,\r\n    availableStyles,\r\n    availablePages,\r\n    categoryStructure,\r\n\r\n    // Utilidades\r\n    getColorClasses,\r\n    getGradientClasses\r\n  }\r\n} ","import { useState, useEffect } from 'react'\r\nimport { CheckCircle, XCircle, AlertCircle, X } from 'lucide-react'\r\n\r\nconst Toast = ({ message, type = 'success', duration = 5000, onClose }) => {\r\n  const [isVisible, setIsVisible] = useState(true)\r\n\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      setIsVisible(false)\r\n      setTimeout(() => {\r\n        onClose?.()\r\n      }, 300) // Tiempo para la animación de salida\r\n    }, duration)\r\n\r\n    return () => clearTimeout(timer)\r\n  }, [duration, onClose])\r\n\r\n  const getIcon = () => {\r\n    switch (type) {\r\n      case 'success':\r\n        return <CheckCircle className=\"w-5 h-5\" />\r\n      case 'error':\r\n        return <XCircle className=\"w-5 h-5\" />\r\n      case 'warning':\r\n        return <AlertCircle className=\"w-5 h-5\" />\r\n      default:\r\n        return <CheckCircle className=\"w-5 h-5\" />\r\n    }\r\n  }\r\n\r\n  const getStyles = () => {\r\n    switch (type) {\r\n      case 'success':\r\n        return 'bg-gradient-to-r from-green-500 to-emerald-500 text-white border-green-400'\r\n      case 'error':\r\n        return 'bg-gradient-to-r from-red-500 to-pink-500 text-white border-red-400'\r\n      case 'warning':\r\n        return 'bg-gradient-to-r from-orange-500 to-red-500 text-white border-orange-400'\r\n      default:\r\n        return 'bg-gradient-to-r from-green-500 to-emerald-500 text-white border-green-400'\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className={`\r\n        fixed top-4 right-4 z-50 max-w-sm w-full\r\n        transform transition-all duration-300 ease-in-out\r\n        ${isVisible ? 'translate-x-0 opacity-100' : 'translate-x-full opacity-0'}\r\n      `}\r\n    >\r\n      <div className={`\r\n        flex items-center justify-between p-4 rounded-lg shadow-lg border\r\n        ${getStyles()}\r\n      `}>\r\n        <div className=\"flex items-center space-x-3\">\r\n          {getIcon()}\r\n          <span className=\"font-medium\">{message}</span>\r\n        </div>\r\n        <button\r\n          onClick={() => {\r\n            setIsVisible(false)\r\n            setTimeout(() => onClose?.(), 300)\r\n          }}\r\n          className=\"ml-4 text-white hover:text-gray-200 transition-colors\"\r\n        >\r\n          <X className=\"w-4 h-4\" />\r\n        </button>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Toast ","import { useState, useRef, useEffect } from 'react'\r\nimport { \r\n  Play, \r\n  Pause, \r\n  Volume2, \r\n  VolumeX, \r\n  RotateCcw, \r\n  RotateCw,\r\n  Maximize,\r\n  Minimize,\r\n  SkipBack,\r\n  SkipForward,\r\n  Settings,\r\n  Minus,\r\n  Zap,\r\n  Download\r\n} from 'lucide-react'\r\nimport { getFileURL } from '../../services/firebase/storage'\r\n\r\nconst VideoPlayer = ({ \r\n  src, \r\n  size = 'medium', \r\n  loop = false, \r\n  loopSegment = null, // { start: number, end: number }\r\n  showControls: initialShowControls = true, \r\n  autoplay = false, \r\n  muted = false,\r\n  onTimeUpdate = null,\r\n  onEnded = null,\r\n  className = '',\r\n  resolutions = null, // Array de resoluciones disponibles\r\n  currentResolution = null, // Resolución actual seleccionada\r\n  onResolutionChange = null, // Callback para cambio de resolución\r\n  videoTitle = 'video' // Título del video para la descarga\r\n}) => {\r\n  const videoRef = useRef(null)\r\n  const containerRef = useRef(null)\r\n  const [isPlaying, setIsPlaying] = useState(false)\r\n  const [currentTime, setCurrentTime] = useState(0)\r\n  const [duration, setDuration] = useState(0)\r\n  const [volume, setVolume] = useState(1)\r\n  const [isMuted, setIsMuted] = useState(muted)\r\n  const [showVolumeSlider, setShowVolumeSlider] = useState(false)\r\n  const [volumeSliderTimeout, setVolumeSliderTimeout] = useState(null)\r\n  const [isFullscreen, setIsFullscreen] = useState(false)\r\n  const [isLoopEnabled, setIsLoopEnabled] = useState(false)\r\n  const [loopStart, setLoopStart] = useState(loopSegment?.start || 0)\r\n  const [loopEnd, setLoopEnd] = useState(loopSegment?.end || 0)\r\n  const [isLoopSegmentMode, setIsLoopSegmentMode] = useState(!!loopSegment)\r\n  const [hasPointA, setHasPointA] = useState(false)\r\n  const [hasPointB, setHasPointB] = useState(false)\r\n  const [savedPointA, setSavedPointA] = useState(0)\r\n  const [savedPointB, setSavedPointB] = useState(0)\r\n  const [showControls, setShowControls] = useState(initialShowControls)\r\n  const [controlsTimeout, setControlsTimeout] = useState(null)\r\n  const [showResolutionMenu, setShowResolutionMenu] = useState(false)\r\n  const [selectedResolution, setSelectedResolution] = useState(currentResolution || 'auto')\r\n  const [videoMaxResolution, setVideoMaxResolution] = useState(null)\r\n  const [currentAutoResolution, setCurrentAutoResolution] = useState(null)\r\n  const [showSpeedMenu, setShowSpeedMenu] = useState(false)\r\n  const [playbackSpeed, setPlaybackSpeed] = useState(1)\r\n  const [videoOrientation, setVideoOrientation] = useState('horizontal') // 'horizontal' o 'vertical'\r\n\r\n  // Velocidades disponibles\r\n  const availableSpeeds = [0.25, 0.5, 0.75, 1, 1.25, 1.5, 2]\r\n\r\n  // Manejar bucle de segmento\r\n  useEffect(() => {\r\n    if (videoRef.current && isLoopSegmentMode && isPlaying && hasPointA && hasPointB) {\r\n      const video = videoRef.current\r\n      const checkLoopSegment = () => {\r\n        if (video.currentTime >= loopEnd) {\r\n          video.currentTime = loopStart\r\n        }\r\n      }\r\n      \r\n      video.addEventListener('timeupdate', checkLoopSegment)\r\n      return () => video.removeEventListener('timeupdate', checkLoopSegment)\r\n    }\r\n  }, [isLoopSegmentMode, loopStart, loopEnd, isPlaying, hasPointA, hasPointB])\r\n\r\n  // Controles de teclado\r\n  useEffect(() => {\r\n    const handleKeyDown = (e) => {\r\n      if (!videoRef.current) return\r\n      \r\n      // No procesar eventos de teclado si el foco está en un campo de entrada\r\n      const activeElement = document.activeElement\r\n      if (activeElement && (\r\n        activeElement.tagName === 'INPUT' || \r\n        activeElement.tagName === 'TEXTAREA' || \r\n        activeElement.contentEditable === 'true' ||\r\n        activeElement.classList.contains('ql-editor') // Para editores de texto enriquecido\r\n      )) {\r\n        return\r\n      }\r\n      \r\n      switch (e.code) {\r\n        case 'Space':\r\n          e.preventDefault()\r\n          togglePlay()\r\n          break\r\n        case 'ArrowLeft':\r\n          e.preventDefault()\r\n          skip(-10)\r\n          break\r\n        case 'ArrowRight':\r\n          e.preventDefault()\r\n          skip(10)\r\n          break\r\n        case 'KeyA':\r\n          e.preventDefault()\r\n          setLoopStart(currentTime)\r\n          break\r\n        case 'KeyB':\r\n          e.preventDefault()\r\n          setLoopEnd(currentTime)\r\n          break\r\n        case 'KeyL':\r\n          e.preventDefault()\r\n          setIsLoopEnabled(!isLoopEnabled)\r\n          break\r\n        case 'KeyS':\r\n          e.preventDefault()\r\n          // Ciclar entre velocidades: 0.5x -> 1x -> 1.5x -> 2x -> 0.5x\r\n          const currentIndex = availableSpeeds.indexOf(playbackSpeed)\r\n          const nextIndex = (currentIndex + 1) % availableSpeeds.length\r\n          handleSpeedChange(availableSpeeds[nextIndex])\r\n          break\r\n      }\r\n    }\r\n\r\n    document.addEventListener('keydown', handleKeyDown)\r\n    return () => document.removeEventListener('keydown', handleKeyDown)\r\n  }, [currentTime, isLoopEnabled, playbackSpeed])\r\n\r\n  // Auto-hide controles\r\n  useEffect(() => {\r\n    if (showControls && isPlaying) {\r\n      const timeout = setTimeout(() => {\r\n        setShowControls(false)\r\n      }, 4000) // Cambiado a 4 segundos\r\n      setControlsTimeout(timeout)\r\n      return () => clearTimeout(timeout)\r\n    }\r\n  }, [showControls, isPlaying])\r\n\r\n  // Cleanup timeouts al desmontar\r\n  useEffect(() => {\r\n    return () => {\r\n      if (controlsTimeout) clearTimeout(controlsTimeout)\r\n      if (volumeSliderTimeout) clearTimeout(volumeSliderTimeout)\r\n    }\r\n  }, [])\r\n\r\n  // Inicializar volumen y velocidad cuando el video se carga\r\n  useEffect(() => {\r\n    if (videoRef.current) {\r\n      videoRef.current.volume = volume\r\n      videoRef.current.muted = isMuted\r\n      videoRef.current.playbackRate = playbackSpeed\r\n    }\r\n  }, [volume, isMuted, playbackSpeed])\r\n\r\n  // Detectar resolución actual cuando se selecciona Auto\r\n  useEffect(() => {\r\n    if (selectedResolution === 'auto' && videoMaxResolution) {\r\n      setCurrentAutoResolution(videoMaxResolution)\r\n    }\r\n  }, [selectedResolution, videoMaxResolution])\r\n\r\n  // Cerrar menús al hacer clic fuera\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (showResolutionMenu) {\r\n        setShowResolutionMenu(false)\r\n      }\r\n      if (showSpeedMenu) {\r\n        setShowSpeedMenu(false)\r\n      }\r\n    }\r\n\r\n    document.addEventListener('click', handleClickOutside)\r\n    return () => document.removeEventListener('click', handleClickOutside)\r\n  }, [showResolutionMenu, showSpeedMenu])\r\n\r\n  // Función helper para activar controles\r\n  const activateControls = () => {\r\n    setShowControls(true)\r\n    if (controlsTimeout) {\r\n      clearTimeout(controlsTimeout)\r\n    }\r\n  }\r\n\r\n  // Mostrar controles al hacer clic en el video\r\n  const handleVideoClick = () => {\r\n    activateControls()\r\n  }\r\n\r\n  // Manejar doble clic para adelantar/retroceder\r\n  const [lastClickTime, setLastClickTime] = useState(0)\r\n  const [clickCount, setClickCount] = useState(0)\r\n\r\n  const handleVideoDoubleClick = (e) => {\r\n    const currentTime = Date.now()\r\n    const timeDiff = currentTime - lastClickTime\r\n    \r\n    if (timeDiff < 300) { // Doble clic detectado\r\n      const rect = e.currentTarget.getBoundingClientRect()\r\n      const clickX = e.clientX - rect.left\r\n      const videoWidth = rect.width\r\n      \r\n      // Si el clic es en la mitad izquierda, retroceder 10s\r\n      // Si el clic es en la mitad derecha, adelantar 10s\r\n      if (clickX < videoWidth / 2) {\r\n        skip(-10)\r\n      } else {\r\n        skip(10)\r\n      }\r\n      \r\n      setClickCount(0)\r\n      setLastClickTime(0)\r\n    } else {\r\n      setClickCount(1)\r\n      setLastClickTime(currentTime)\r\n    }\r\n  }\r\n\r\n  const togglePlay = () => {\r\n    console.log('Toggle play clicked!')\r\n    if (videoRef.current) {\r\n      if (isPlaying) {\r\n        videoRef.current.pause()\r\n      } else {\r\n        videoRef.current.play()\r\n      }\r\n      setIsPlaying(!isPlaying)\r\n    }\r\n  }\r\n\r\n  const skip = (seconds) => {\r\n    if (videoRef.current) {\r\n      const newTime = Math.max(0, Math.min(duration, currentTime + seconds))\r\n      videoRef.current.currentTime = newTime\r\n      setCurrentTime(newTime)\r\n    }\r\n  }\r\n\r\n  const handleTimeUpdate = () => {\r\n    if (videoRef.current) {\r\n      setCurrentTime(videoRef.current.currentTime)\r\n      onTimeUpdate?.(videoRef.current.currentTime)\r\n    }\r\n  }\r\n\r\n  const handleLoadedMetadata = () => {\r\n    if (videoRef.current) {\r\n      setDuration(videoRef.current.duration)\r\n      \r\n      // Detectar resolución máxima del video\r\n      const video = videoRef.current\r\n      const width = video.videoWidth\r\n      const height = video.videoHeight\r\n      \r\n      if (width && height) {\r\n        // Detectar orientación del video\r\n        const isVertical = height > width\r\n        setVideoOrientation(isVertical ? 'vertical' : 'horizontal')\r\n        console.log(`Orientación del video: ${isVertical ? 'vertical' : 'horizontal'} (${width}x${height})`)\r\n        console.log(`Aspect ratio: ${width}:${height} = ${(width/height).toFixed(2)}`)\r\n        \r\n        const maxDimension = Math.max(width, height)\r\n        let maxRes = '480p'\r\n        \r\n        if (maxDimension >= 3840) maxRes = '4k'\r\n        else if (maxDimension >= 1920) maxRes = '1080p'\r\n        else if (maxDimension >= 1280) maxRes = '720p'\r\n        else if (maxDimension >= 854) maxRes = '480p'\r\n        else maxRes = '360p'\r\n        \r\n        setVideoMaxResolution(maxRes)\r\n        console.log(`Resolución máxima del video: ${maxRes} (${width}x${height})`)\r\n      }\r\n      \r\n      if (autoplay) {\r\n        video.play()\r\n        setIsPlaying(true)\r\n      }\r\n    }\r\n  }\r\n\r\n  const handleEnded = () => {\r\n    if (isLoopEnabled && !isLoopSegmentMode) {\r\n      if (videoRef.current) {\r\n        videoRef.current.currentTime = 0\r\n        videoRef.current.play()\r\n      }\r\n    } else if (isLoopSegmentMode) {\r\n      if (videoRef.current) {\r\n        videoRef.current.currentTime = loopStart\r\n        videoRef.current.play()\r\n      }\r\n    } else {\r\n      setIsPlaying(false)\r\n    }\r\n    onEnded?.()\r\n  }\r\n\r\n  const handleSeek = (e) => {\r\n    if (videoRef.current) {\r\n      const rect = e.currentTarget.getBoundingClientRect()\r\n      const percent = (e.clientX - rect.left) / rect.width\r\n      const newTime = percent * duration\r\n      videoRef.current.currentTime = newTime\r\n      setCurrentTime(newTime)\r\n      \r\n      // No actualizar los puntos A-B al hacer clic en la barra de progreso\r\n      // Los puntos solo se actualizan cuando se hace clic en los botones A y B\r\n    }\r\n  }\r\n\r\n  const toggleMute = () => {\r\n    console.log('Toggle mute clicked!')\r\n    if (videoRef.current) {\r\n      const newMutedState = !isMuted\r\n      videoRef.current.muted = newMutedState\r\n      setIsMuted(newMutedState)\r\n      \r\n      if (newMutedState) {\r\n        // Al mutear, guardar el volumen actual y ponerlo en 0\r\n        videoRef.current.volume = 0\r\n      } else {\r\n        // Al desmutear, restaurar el volumen\r\n        videoRef.current.volume = volume\r\n      }\r\n    }\r\n  }\r\n\r\n  const handleVolumeChange = (e) => {\r\n    const newVolume = parseFloat(e.target.value)\r\n    console.log('Volume changed to:', newVolume)\r\n    \r\n    if (videoRef.current) {\r\n      videoRef.current.volume = newVolume\r\n      setVolume(newVolume)\r\n      \r\n      // Si el volumen es 0, mutear. Si no, desmutear\r\n      if (newVolume === 0) {\r\n        videoRef.current.muted = true\r\n        setIsMuted(true)\r\n      } else {\r\n        videoRef.current.muted = false\r\n        setIsMuted(false)\r\n      }\r\n    }\r\n  }\r\n\r\n  const toggleFullscreen = () => {\r\n    try {\r\n      if (!document.fullscreenElement) {\r\n        if (containerRef.current.requestFullscreen) {\r\n          containerRef.current.requestFullscreen()\r\n        } else if (containerRef.current.webkitRequestFullscreen) {\r\n          containerRef.current.webkitRequestFullscreen()\r\n        } else if (containerRef.current.msRequestFullscreen) {\r\n          containerRef.current.msRequestFullscreen()\r\n        }\r\n        setIsFullscreen(true)\r\n      } else {\r\n        if (document.exitFullscreen) {\r\n          document.exitFullscreen()\r\n        } else if (document.webkitExitFullscreen) {\r\n          document.webkitExitFullscreen()\r\n        } else if (document.msExitFullscreen) {\r\n          document.msExitFullscreen()\r\n        }\r\n        setIsFullscreen(false)\r\n      }\r\n    } catch (error) {\r\n      console.error('Error toggling fullscreen:', error)\r\n    }\r\n  }\r\n\r\n  const setLoopPoint = (type) => {\r\n    if (type === 'start') {\r\n      if (hasPointA) {\r\n        // Si ya existe el punto A, lo quitamos\r\n        setHasPointA(false)\r\n        setLoopStart(0)\r\n        console.log('Punto A eliminado')\r\n      } else {\r\n        // Establecer punto A\r\n        setHasPointA(true)\r\n        setLoopStart(currentTime)\r\n        setSavedPointA(currentTime)\r\n        console.log(`Punto A establecido en: ${formatTime(currentTime)}`)\r\n      }\r\n    } else {\r\n      if (hasPointB) {\r\n        // Si ya existe el punto B, lo quitamos\r\n        setHasPointB(false)\r\n        setLoopEnd(0)\r\n        console.log('Punto B eliminado')\r\n      } else {\r\n        // Establecer punto B\r\n        setHasPointB(true)\r\n        setLoopEnd(currentTime)\r\n        setSavedPointB(currentTime)\r\n        console.log(`Punto B establecido en: ${formatTime(currentTime)}`)\r\n      }\r\n    }\r\n  }\r\n\r\n  const formatTime = (time) => {\r\n    const minutes = Math.floor(time / 60)\r\n    const seconds = Math.floor(time % 60)\r\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`\r\n  }\r\n\r\n  const handleResolutionChange = (resolution) => {\r\n    setSelectedResolution(resolution)\r\n    setShowResolutionMenu(false)\r\n    \r\n    // Si se selecciona Auto, simular la detección de resolución actual\r\n    if (resolution === 'auto' && videoMaxResolution) {\r\n      setCurrentAutoResolution(videoMaxResolution)\r\n    } else if (resolution !== 'auto') {\r\n      setCurrentAutoResolution(null)\r\n    }\r\n    \r\n    onResolutionChange?.(resolution)\r\n  }\r\n\r\n  const handleSpeedChange = (speed) => {\r\n    if (videoRef.current) {\r\n      videoRef.current.playbackRate = speed\r\n      setPlaybackSpeed(speed)\r\n    }\r\n    setShowSpeedMenu(false)\r\n  }\r\n\r\n  const getSpeedLabel = (speed) => {\r\n    if (speed === 1) return 'Normal'\r\n    return `${speed}x`\r\n  }\r\n\r\n  const getResolutionLabel = (resolution) => {\r\n    switch (resolution) {\r\n      case 'auto':\r\n        return currentAutoResolution ? `Auto (${currentAutoResolution})` : 'Auto'\r\n      case '4k':\r\n        return '4K'\r\n      case '1080p':\r\n        return '1080p'\r\n      case '720p':\r\n        return '720p'\r\n      case '480p':\r\n        return '480p'\r\n      case '360p':\r\n        return '360p'\r\n      default:\r\n        return resolution\r\n    }\r\n  }\r\n\r\n  const isResolutionAvailable = (resolution) => {\r\n    if (!videoMaxResolution) return true // Si no sabemos la resolución máxima, mostrar todas\r\n    \r\n    const resolutionOrder = ['360p', '480p', '720p', '1080p', '4k']\r\n    const maxIndex = resolutionOrder.indexOf(videoMaxResolution)\r\n    const resIndex = resolutionOrder.indexOf(resolution)\r\n    \r\n    return resIndex <= maxIndex\r\n  }\r\n\r\n  const getSizeClasses = () => {\r\n    let sizeClass = ''\r\n    switch (size) {\r\n      case 'small':\r\n        sizeClass = 'max-w-xs'\r\n        break\r\n      case 'medium':\r\n        sizeClass = 'max-w-md'\r\n        break\r\n      case 'large':\r\n        sizeClass = 'max-w-2xl'\r\n        break\r\n      case 'fullscreen':\r\n        return 'w-full h-full' // Sin aspect ratio forzado para fullscreen\r\n      default:\r\n        sizeClass = 'max-w-md'\r\n    }\r\n    \r\n    // Ajustar el aspect ratio según la orientación del video (solo para tamaños no-fullscreen)\r\n    if (size === 'fullscreen') {\r\n      return sizeClass\r\n    }\r\n    \r\n    const aspectClass = videoOrientation === 'vertical' ? 'aspect-[9/16]' : 'aspect-video'\r\n    \r\n    return `${sizeClass} ${aspectClass}`\r\n  }\r\n\r\n  // Función para descargar video usando Firebase Storage\r\n  const downloadVideo = async () => {\r\n    try {\r\n      console.log('Iniciando descarga de video:', videoTitle)\r\n      \r\n      // Si tenemos una URL de Firebase Storage, descargar directamente\r\n      if (src && (src.includes('firebase') || src.includes('googleapis'))) {\r\n        console.log('Detectada URL de Firebase Storage, descargando...')\r\n        \r\n        // Descargar el archivo como blob para evitar ventanas del navegador\r\n        const response = await fetch(src)\r\n        if (!response.ok) {\r\n          throw new Error(`HTTP error! status: ${response.status}`)\r\n        }\r\n        \r\n        const blob = await response.blob()\r\n        console.log('Blob descargado:', blob.size, 'bytes')\r\n        \r\n        // Crear URL local del blob\r\n        const blobUrl = URL.createObjectURL(blob)\r\n        \r\n        // Crear enlace de descarga\r\n        const link = document.createElement('a')\r\n        link.href = blobUrl\r\n        link.download = videoTitle || 'video.mp4'\r\n        link.style.display = 'none'\r\n        \r\n        // Agregar al DOM y hacer clic\r\n        document.body.appendChild(link)\r\n        link.click()\r\n        document.body.removeChild(link)\r\n        \r\n        // Limpiar la URL del blob después de un momento\r\n        setTimeout(() => {\r\n          URL.revokeObjectURL(blobUrl)\r\n        }, 1000)\r\n        \r\n        console.log('Descarga completada exitosamente')\r\n      } else {\r\n        // Para URLs que no son de Firebase, usar el método original\r\n        console.log('Usando método de descarga directa para URL no-Firebase')\r\n        const link = document.createElement('a')\r\n        link.href = src\r\n        link.download = videoTitle || 'video.mp4'\r\n        link.style.display = 'none'\r\n        document.body.appendChild(link)\r\n        link.click()\r\n        document.body.removeChild(link)\r\n      }\r\n    } catch (error) {\r\n      console.error('Error en descarga:', error)\r\n      alert(`Error al descargar el video: ${error.message}`)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div \r\n      ref={containerRef}\r\n      className={`relative bg-black rounded-lg overflow-hidden video-player-container ${getSizeClasses()} ${className} ${videoOrientation === 'vertical' ? 'video-player-vertical' : ''}`}\r\n      onMouseMove={activateControls}\r\n      onMouseLeave={() => {\r\n        if (isPlaying) {\r\n          const timeout = setTimeout(() => {\r\n            setShowControls(false)\r\n          }, 4000)\r\n          setControlsTimeout(timeout)\r\n        }\r\n      }}\r\n      onTouchStart={activateControls}\r\n      onTouchMove={activateControls}\r\n      onClick={handleVideoClick}\r\n      onDoubleClick={handleVideoDoubleClick}\r\n    >\r\n      <video\r\n        ref={videoRef}\r\n        src={src}\r\n        className={`w-full h-full cursor-pointer ${size === 'fullscreen' ? 'object-contain' : 'object-cover'}`}\r\n        muted={isMuted}\r\n        loop={isLoopEnabled && !isLoopSegmentMode}\r\n        onTimeUpdate={handleTimeUpdate}\r\n        onLoadedMetadata={handleLoadedMetadata}\r\n        onEnded={handleEnded}\r\n        onPlay={() => setIsPlaying(true)}\r\n        onPause={() => setIsPlaying(false)}\r\n        onClick={handleVideoClick}\r\n        onDoubleClick={handleVideoDoubleClick}\r\n        onTouchStart={activateControls}\r\n        onTouchMove={activateControls}\r\n      />\r\n\r\n\r\n\r\n      {/* Overlay de controles */}\r\n      {showControls && (\r\n        <div \r\n          className=\"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent\"\r\n          onMouseMove={activateControls}\r\n          onTouchStart={activateControls}\r\n          onTouchMove={activateControls}\r\n        >\r\n          {/* Controles superiores - solo pantalla completa */}\r\n          <div className=\"absolute top-0 left-0 right-0 p-4 flex justify-end items-center\">\r\n            <div className=\"flex items-center space-x-2\">\r\n              {/* Botón de pantalla completa */}\r\n              <button\r\n                onClick={toggleFullscreen}\r\n                onTouchStart={activateControls}\r\n                className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\r\n              >\r\n                {isFullscreen ? <Minimize className=\"w-4 h-4\" /> : <Maximize className=\"w-4 h-4\" />}\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Controles centrales - solo play/pause para móviles */}\r\n          <div className=\"absolute inset-0 flex items-center justify-center\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              {/* Botón de retroceder 10s - estilo Disney+/YouTube */}\r\n              <button\r\n                onClick={() => skip(-10)}\r\n                onTouchStart={activateControls}\r\n                className=\"p-3 rounded-full bg-black/60 text-white hover:bg-black/80 transition-colors z-10 hidden md:flex items-center justify-center\"\r\n              >\r\n                <div className=\"flex items-center space-x-1\">\r\n                  <div className=\"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center\">\r\n                    <SkipBack className=\"w-3 h-3\" />\r\n                  </div>\r\n                  <span className=\"text-sm font-medium\">10</span>\r\n                </div>\r\n              </button>\r\n\r\n              <button\r\n                onClick={togglePlay}\r\n                onTouchStart={activateControls}\r\n                className=\"p-4 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\r\n              >\r\n                {isPlaying ? <Pause className=\"w-8 h-8\" /> : <Play className=\"w-8 h-8\" />}\r\n              </button>\r\n\r\n              {/* Botón de adelantar 10s - estilo Disney+/YouTube */}\r\n              <button\r\n                onClick={() => skip(10)}\r\n                onTouchStart={activateControls}\r\n                className=\"p-3 rounded-full bg-black/60 text-white hover:bg-black/80 transition-colors z-10 hidden md:flex items-center justify-center\"\r\n              >\r\n                <div className=\"flex items-center space-x-1\">\r\n                  <span className=\"text-sm font-medium\">10</span>\r\n                  <div className=\"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center\">\r\n                    <SkipForward className=\"w-3 h-3\" />\r\n                  </div>\r\n                </div>\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Controles inferiores */}\r\n          <div className=\"absolute bottom-0 left-0 right-0 p-4\">\r\n            {/* Controles de volumen, bucle, A-B y resoluciones - por encima de la barra de progreso */}\r\n            <div className=\"flex justify-end mb-2 space-x-2\">\r\n              {/* Botón de bucle */}\r\n              <button\r\n                onClick={() => setIsLoopEnabled(!isLoopEnabled)}\r\n                onTouchStart={activateControls}\r\n                className={`p-2 rounded-full transition-colors z-10 ${\r\n                  isLoopEnabled ? 'bg-blue-500 text-white' : 'bg-white/20 text-white hover:bg-white/30'\r\n                }`}\r\n                title=\"Bucle\"\r\n              >\r\n                <RotateCcw className=\"w-4 h-4\" />\r\n              </button>\r\n\r\n              {/* Botón de segmento A-B */}\r\n              <button\r\n                onClick={() => {\r\n                  const newMode = !isLoopSegmentMode\r\n                  setIsLoopSegmentMode(newMode)\r\n                  if (!newMode) {\r\n                    // Al desactivar, limpiar todos los puntos\r\n                    setHasPointA(false)\r\n                    setHasPointB(false)\r\n                    setLoopStart(0)\r\n                    setLoopEnd(0)\r\n                  } else {\r\n                    // Al reactivar, restaurar los puntos guardados si existen\r\n                    if (savedPointA > 0) {\r\n                      setHasPointA(true)\r\n                      setLoopStart(savedPointA)\r\n                    }\r\n                    if (savedPointB > 0) {\r\n                      setHasPointB(true)\r\n                      setLoopEnd(savedPointB)\r\n                    }\r\n                  }\r\n                  console.log(`Modo A-B ${newMode ? 'activado' : 'desactivado'}`)\r\n                }}\r\n                onTouchStart={activateControls}\r\n                className={`p-2 rounded-full transition-colors z-10 ${\r\n                  isLoopSegmentMode ? 'bg-green-500 text-white' : 'bg-white/20 text-white hover:bg-white/30'\r\n                }`}\r\n                title=\"Segmento A-B\"\r\n              >\r\n                <div className=\"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none\">\r\n                  A-B\r\n                </div>\r\n              </button>\r\n\r\n              {/* Botón de resoluciones */}\r\n              {resolutions && resolutions.length > 0 && (\r\n                <div className=\"relative\">\r\n                  <button\r\n                    onClick={() => setShowResolutionMenu(!showResolutionMenu)}\r\n                    onTouchStart={activateControls}\r\n                    className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\r\n                    title=\"Resolución\"\r\n                  >\r\n                    <div className=\"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none\">\r\n                      {getResolutionLabel(selectedResolution)}\r\n                    </div>\r\n                  </button>\r\n                  \r\n                                                       {showResolutionMenu && (\r\n                    <div \r\n                      className=\"absolute bottom-full right-0 mb-2 bg-black/90 rounded-lg p-2 z-20 min-w-[80px]\"\r\n                      onTouchStart={activateControls}\r\n                      onTouchMove={activateControls}\r\n                    >\r\n                       {resolutions.map((resolution) => {\r\n                         const isAvailable = isResolutionAvailable(resolution)\r\n                         return (\r\n                           <button\r\n                             key={resolution}\r\n                             onClick={() => isAvailable && handleResolutionChange(resolution)}\r\n                             className={`w-full text-left px-3 py-1 rounded text-xs transition-colors ${\r\n                               !isAvailable \r\n                                 ? 'text-gray-500 cursor-not-allowed opacity-50'\r\n                                 : selectedResolution === resolution \r\n                                   ? 'bg-blue-500 text-white' \r\n                                   : 'text-white hover:bg-white/20'\r\n                             }`}\r\n                             disabled={!isAvailable}\r\n                           >\r\n                             {getResolutionLabel(resolution)}\r\n                             {!isAvailable && (\r\n                               <span className=\"ml-1 text-[10px] opacity-75\">\r\n                                 (no disponible)\r\n                               </span>\r\n                             )}\r\n                           </button>\r\n                         )\r\n                       })}\r\n                     </div>\r\n                   )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Botón de velocidades */}\r\n              <div className=\"relative\">\r\n                <button\r\n                  onClick={() => setShowSpeedMenu(!showSpeedMenu)}\r\n                  onTouchStart={activateControls}\r\n                  className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\r\n                  title=\"Velocidad de reproducción\"\r\n                >\r\n                  <div className=\"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none\">\r\n                    {playbackSpeed === 1 ? '1x' : `${playbackSpeed}x`}\r\n                  </div>\r\n                </button>\r\n                \r\n                {showSpeedMenu && (\r\n                  <div \r\n                    className=\"absolute bottom-full right-0 mb-2 bg-black/90 rounded-lg p-2 z-20 min-w-[80px]\"\r\n                    onTouchStart={activateControls}\r\n                    onTouchMove={activateControls}\r\n                  >\r\n                    {availableSpeeds.map((speed) => (\r\n                      <button\r\n                        key={speed}\r\n                        onClick={() => handleSpeedChange(speed)}\r\n                        className={`w-full text-left px-3 py-1 rounded text-xs transition-colors ${\r\n                          playbackSpeed === speed \r\n                            ? 'bg-blue-500 text-white' \r\n                            : 'text-white hover:bg-white/20'\r\n                        }`}\r\n                      >\r\n                        {getSpeedLabel(speed)}\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Botón de descarga */}\r\n              <button\r\n                onClick={downloadVideo}\r\n                onTouchStart={activateControls}\r\n                className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\r\n                title=\"Descargar video\"\r\n              >\r\n                <Download className=\"w-4 h-4\" />\r\n              </button>\r\n\r\n              {/* Controles de volumen */}\r\n              <div className=\"relative\">\r\n                <button\r\n                  onClick={toggleMute}\r\n                  onTouchStart={activateControls}\r\n                  className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\r\n                  onMouseEnter={() => setShowVolumeSlider(true)}\r\n                  onMouseLeave={() => {\r\n                    const timeout = setTimeout(() => setShowVolumeSlider(false), 1000)\r\n                    setVolumeSliderTimeout(timeout)\r\n                  }}\r\n                >\r\n                  {isMuted ? <VolumeX className=\"w-4 h-4\" /> : <Volume2 className=\"w-4 h-4\" />}\r\n                </button>\r\n                \r\n                                 {showVolumeSlider && (\r\n                   <div \r\n                     className=\"absolute bottom-full right-0 mb-2 bg-black/80 rounded-lg p-3 z-20\"\r\n                     onMouseEnter={() => {\r\n                       if (volumeSliderTimeout) {\r\n                         clearTimeout(volumeSliderTimeout)\r\n                         setVolumeSliderTimeout(null)\r\n                       }\r\n                     }}\r\n                     onMouseLeave={() => {\r\n                       const timeout = setTimeout(() => setShowVolumeSlider(false), 1000)\r\n                       setVolumeSliderTimeout(timeout)\r\n                     }}\r\n                     onTouchStart={activateControls}\r\n                     onTouchMove={activateControls}\r\n                   >\r\n                    <div className=\"flex flex-col items-center space-y-2\">\r\n                                             <input\r\n                         type=\"range\"\r\n                         min=\"0\"\r\n                         max=\"1\"\r\n                         step=\"0.01\"\r\n                         value={volume}\r\n                         onChange={handleVolumeChange}\r\n                         onTouchStart={activateControls}\r\n                         onTouchMove={activateControls}\r\n                         className=\"w-2 h-20 bg-gray-600 rounded-lg appearance-none cursor-pointer slider-vertical\"\r\n                         style={{\r\n                           background: `linear-gradient(to top, #3b82f6 0%, #3b82f6 ${volume * 100}%, #4b5563 ${volume * 100}%, #4b5563 100%)`\r\n                         }}\r\n                         orient=\"vertical\"\r\n                       />\r\n                      <span className=\"text-white text-xs\">{Math.round(volume * 100)}%</span>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Barra de progreso */}\r\n            <div className=\"relative mb-4\">\r\n              <div\r\n                className=\"w-full h-2 bg-white/20 rounded-full cursor-pointer relative\"\r\n                onClick={handleSeek}\r\n                onTouchStart={activateControls}\r\n                onTouchMove={activateControls}\r\n              >\r\n                <div\r\n                  className=\"h-full bg-blue-500 rounded-full\"\r\n                  style={{ width: `${(currentTime / duration) * 100}%` }}\r\n                />\r\n                \r\n                {/* Marcadores de bucle A-B - fuera del progreso para que siempre sean visibles */}\r\n                {isLoopSegmentMode && hasPointA && (\r\n                  <div\r\n                    className=\"absolute top-0 w-1 h-full bg-green-500 z-10\"\r\n                    style={{ left: `${(loopStart / duration) * 100}%` }}\r\n                  />\r\n                )}\r\n                {isLoopSegmentMode && hasPointB && (\r\n                  <div\r\n                    className=\"absolute top-0 w-1 h-full bg-red-500 z-10\"\r\n                    style={{ left: `${(loopEnd / duration) * 100}%` }}\r\n                  />\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Información de tiempo y controles de bucle */}\r\n            <div className=\"flex items-center justify-between text-white text-sm\">\r\n              <div className=\"flex items-center space-x-4\">\r\n                <span>{formatTime(currentTime)} / {formatTime(duration)}</span>\r\n                {playbackSpeed !== 1 && (\r\n                  <span className=\"text-blue-400 font-medium\">\r\n                    {playbackSpeed}x\r\n                  </span>\r\n                )}\r\n                \r\n                {isLoopSegmentMode && (\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <button\r\n                      onClick={() => setLoopPoint('start')}\r\n                      onTouchStart={activateControls}\r\n                      className={`px-2 py-1 rounded text-xs transition-colors ${\r\n                        hasPointA ? 'bg-green-500 text-white' : 'bg-gray-600 text-gray-300 hover:bg-gray-500'\r\n                      }`}\r\n                    >\r\n                      A: {hasPointA ? formatTime(loopStart) : '--:--'}\r\n                    </button>\r\n                    <button\r\n                      onClick={() => setLoopPoint('end')}\r\n                      onTouchStart={activateControls}\r\n                      className={`px-2 py-1 rounded text-xs transition-colors ${\r\n                        hasPointB ? 'bg-red-500 text-white' : 'bg-gray-600 text-gray-300 hover:bg-gray-500'\r\n                      }`}\r\n                    >\r\n                      B: {hasPointB ? formatTime(loopEnd) : '--:--'}\r\n                    </button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              <div className=\"flex items-center space-x-2\">\r\n                <div className=\"text-xs opacity-75\">\r\n                  {isLoopEnabled && (isLoopSegmentMode && hasPointA && hasPointB ? 'Bucle A-B' : 'Bucle completo')}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default VideoPlayer ","// Servicio para detección de BPM usando Web Audio API\r\n// Implementación simplificada sin dependencias externas\r\n\r\nexport const extractBPMFromVideo = async (videoFile) => {\r\n  try {\r\n    console.log('🎵 Iniciando detección de BPM para:', videoFile.name)\r\n    \r\n    // Crear contexto de audio\r\n    const audioContext = new (window.AudioContext || window.webkitAudioContext)()\r\n    \r\n    // Convertir video a ArrayBuffer\r\n    const arrayBuffer = await videoFile.arrayBuffer()\r\n    \r\n    // Decodificar audio del video\r\n    const audioBuffer = await audioContext.decodeAudioData(arrayBuffer)\r\n    \r\n    // Verificar si el video tiene audio significativo\r\n    const hasAudio = checkAudioLevel(audioBuffer)\r\n    if (!hasAudio) {\r\n      console.log('🎵 Video sin audio significativo, usando BPM por defecto')\r\n      return {\r\n        success: false,\r\n        bpm: null,\r\n        originalBPM: null,\r\n        error: 'Video sin audio significativo'\r\n      }\r\n    }\r\n    \r\n    console.log('🎵 Audio decodificado, detectando BPM...')\r\n    \r\n    // Detectar BPM usando análisis de frecuencia\r\n    const bpm = await detectBPMFromAudioBuffer(audioBuffer)\r\n    \r\n    // Redondear a entero\r\n    const roundedBPM = Math.round(bpm)\r\n    \r\n    console.log(`✅ BPM detectado: ${roundedBPM} para ${videoFile.name}`)\r\n    \r\n    return {\r\n      success: true,\r\n      bpm: roundedBPM,\r\n      originalBPM: bpm,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error al detectar BPM:', error)\r\n    return {\r\n      success: false,\r\n      bpm: null,\r\n      originalBPM: null,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Función para verificar si el video tiene audio significativo\r\nconst checkAudioLevel = (audioBuffer) => {\r\n  const channelData = audioBuffer.getChannelData(0)\r\n  const sampleRate = audioBuffer.sampleRate\r\n  \r\n  // Analizar los primeros 5 segundos\r\n  const analysisLength = Math.min(5 * sampleRate, channelData.length)\r\n  const data = channelData.slice(0, analysisLength)\r\n  \r\n  // Calcular RMS (Root Mean Square) para medir el nivel de audio\r\n  const rms = Math.sqrt(data.reduce((sum, sample) => sum + sample * sample, 0) / data.length)\r\n  \r\n  console.log(`🎵 Nivel de audio RMS: ${rms.toFixed(4)}`)\r\n  \r\n  // Considerar que hay audio si RMS > 0.01 (umbral muy bajo)\r\n  return rms > 0.01\r\n}\r\n\r\n// Función para detectar BPM usando análisis de frecuencia\r\nconst detectBPMFromAudioBuffer = async (audioBuffer) => {\r\n  const sampleRate = audioBuffer.sampleRate\r\n  const channelData = audioBuffer.getChannelData(0) // Usar primer canal\r\n  \r\n  // Analizar los primeros 10 segundos para detectar ritmo\r\n  const analysisLength = Math.min(10 * sampleRate, channelData.length)\r\n  const data = channelData.slice(0, analysisLength)\r\n  \r\n  // Detectar picos de energía (beats)\r\n  const peaks = detectPeaks(data, sampleRate)\r\n  \r\n  // Calcular intervalos entre picos\r\n  const intervals = []\r\n  for (let i = 1; i < peaks.length; i++) {\r\n    intervals.push(peaks[i] - peaks[i - 1])\r\n  }\r\n  \r\n  // Calcular BPM promedio\r\n  if (intervals.length > 0) {\r\n    const avgInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length\r\n    const bpm = (60 * sampleRate) / avgInterval\r\n    \r\n    console.log(`🎵 BPM calculado: ${bpm}, intervalos: ${intervals.length}, promedio: ${avgInterval}`)\r\n    \r\n    // Si el BPM calculado es muy alto (>300), probablemente es un error de detección\r\n    if (bpm > 300) {\r\n      console.log(`🎵 BPM demasiado alto (${bpm}), probablemente error de detección`)\r\n      return 120 // Usar BPM por defecto\r\n    }\r\n    \r\n    // Aplicar límites más realistas para salsa (80-180 BPM)\r\n    const limitedBPM = Math.max(80, Math.min(180, bpm))\r\n    \r\n    if (bpm !== limitedBPM) {\r\n      console.log(`🎵 BPM ajustado de ${bpm} a ${limitedBPM}`)\r\n    }\r\n    \r\n    // Si el BPM está muy cerca del límite máximo, verificar si es real\r\n    if (limitedBPM >= 175) {\r\n      console.log(`🎵 BPM muy alto (${limitedBPM}), verificando si es real...`)\r\n      // Verificar si hay suficientes intervalos consistentes\r\n      const consistentIntervals = intervals.filter(interval => \r\n        Math.abs(interval - avgInterval) < avgInterval * 0.3\r\n      )\r\n      \r\n      if (consistentIntervals.length < intervals.length * 0.7) {\r\n        console.log(`🎵 BPM alto pero intervalos inconsistentes, usando BPM por defecto`)\r\n        return 120\r\n      }\r\n    }\r\n    \r\n    return limitedBPM\r\n  }\r\n  \r\n  // BPM por defecto si no se detecta (BPM típico de salsa)\r\n  console.log('🎵 No se detectaron intervalos, usando BPM por defecto: 120')\r\n  return 120\r\n}\r\n\r\n// Función para detectar picos de energía\r\nconst detectPeaks = (data, sampleRate) => {\r\n  const peaks = []\r\n  \r\n  // Calcular umbral dinámico basado en la energía promedio\r\n  const energy = data.map(sample => sample * sample)\r\n  const avgEnergy = energy.reduce((a, b) => a + b, 0) / energy.length\r\n  \r\n  // Umbral más sensible para detectar mejor los beats\r\n  const threshold = Math.max(0.01, Math.min(0.5, avgEnergy * 3))\r\n  \r\n  // Distancia mínima entre picos (0.5 segundos para BPM más realistas)\r\n  const minDistance = sampleRate * 0.5\r\n  \r\n  console.log(`🎵 Detectando picos con umbral: ${threshold.toFixed(4)}, energía promedio: ${avgEnergy.toFixed(4)}`)\r\n  \r\n  // Usar ventana deslizante para detectar picos más precisos\r\n  const windowSize = Math.floor(sampleRate * 0.1) // Ventana de 0.1 segundos\r\n  \r\n  for (let i = windowSize; i < data.length - windowSize; i++) {\r\n    const windowData = data.slice(i - windowSize, i + windowSize)\r\n    const maxInWindow = Math.max(...windowData)\r\n    \r\n    if (data[i] === maxInWindow && data[i] > threshold) {\r\n      if (peaks.length === 0 || i - peaks[peaks.length - 1] > minDistance) {\r\n        peaks.push(i)\r\n      }\r\n    }\r\n  }\r\n  \r\n  console.log(`🎵 Picos detectados: ${peaks.length}`)\r\n  \r\n  // Si no se detectan suficientes picos, reducir el umbral\r\n  if (peaks.length < 3) {\r\n    console.log('🎵 Pocos picos detectados, reduciendo umbral...')\r\n    const lowerThreshold = threshold * 0.5\r\n    peaks.length = 0 // Limpiar array\r\n    \r\n    for (let i = windowSize; i < data.length - windowSize; i++) {\r\n      const windowData = data.slice(i - windowSize, i + windowSize)\r\n      const maxInWindow = Math.max(...windowData)\r\n      \r\n      if (data[i] === maxInWindow && data[i] > lowerThreshold) {\r\n        if (peaks.length === 0 || i - peaks[peaks.length - 1] > minDistance) {\r\n          peaks.push(i)\r\n        }\r\n      }\r\n    }\r\n    console.log(`🎵 Picos detectados con umbral reducido: ${peaks.length}`)\r\n  }\r\n  \r\n  return peaks\r\n}\r\n\r\nexport const validateBPM = (bpm) => {\r\n  // Validar que el BPM esté en un rango razonable para salsa (80-180 BPM)\r\n  if (bpm < 80 || bpm > 180) {\r\n    console.warn(`⚠️ BPM fuera de rango para salsa: ${bpm} (rango esperado: 80-180)`)\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport const getBPMDescription = (bpm) => {\r\n  if (bpm < 60) return 'Muy lento'\r\n  if (bpm < 80) return 'Lento'\r\n  if (bpm < 100) return 'Moderado'\r\n  if (bpm < 120) return 'Medio'\r\n  if (bpm < 140) return 'Rápido'\r\n  if (bpm < 160) return 'Muy rápido'\r\n  return 'Extremadamente rápido'\r\n} ","import React, { useState, useRef, useEffect } from 'react'\r\nimport { X, Upload, Tag, Trash2, CheckCircle, AlertCircle, ChevronDown, ChevronUp, ChevronsDown, ChevronsUp, Music } from 'lucide-react'\r\nimport { uploadVideo, uploadFile, generateVideoThumbnail, generateBestVideoThumbnail } from '../../services/firebase/storage'\r\nimport { createVideoDocument, checkVideoDuplicate } from '../../services/firebase/firestore'\r\nimport { useAuth } from '../../contexts/AuthContext'\r\nimport { useCategories } from '../../hooks/useCategories'\r\nimport Toast from '../common/Toast'\r\nimport VideoPlayer from './VideoPlayer'\r\nimport { extractBPMFromVideo, validateBPM, getBPMDescription } from '../../services/audio/bpmDetection'\r\n\r\nconst VideoUploadModal = ({ isOpen, onClose, onVideoUploaded, page = 'figuras', style = 'salsa' }) => {\r\n  const { user } = useAuth()\r\n  const { currentCategories, categoriesList, getColorClasses } = useCategories(page, style)\r\n  const fileInputRef = useRef(null)\r\n  const [selectedFiles, setSelectedFiles] = useState([])\r\n  const [uploading, setUploading] = useState(false)\r\n  const [uploadProgress, setUploadProgress] = useState({})\r\n  const [currentStep, setCurrentStep] = useState(1)\r\n  const [videoData, setVideoData] = useState({})\r\n  const [toasts, setToasts] = useState([])\r\n\r\n  // Estados para tags organizados por categorías\r\n  const [selectedTags, setSelectedTags] = useState({})\r\n  \r\n  // Refs para mantener los valores de los campos\r\n  const fieldRefs = useRef({})\r\n  \r\n  // Estado para videos plegados/desplegados - TODOS PLEGADOS POR DEFECTO\r\n  const [collapsedVideos, setCollapsedVideos] = useState(new Set())\r\n\r\n  useEffect(() => {\r\n    if (!isOpen) {\r\n      resetForm()\r\n    } else {\r\n      // Resetear el paso cuando se abre el modal\r\n      setCurrentStep(1)\r\n    }\r\n  }, [isOpen])\r\n\r\n  useEffect(() => {\r\n    // Inicializar selectedTags con las categorías disponibles\r\n    if (currentCategories) {\r\n      const initialTags = {}\r\n      Object.keys(currentCategories).forEach(categoryKey => {\r\n        initialTags[categoryKey] = []\r\n      })\r\n      setSelectedTags(initialTags)\r\n    }\r\n  }, [currentCategories])\r\n\r\n  const resetForm = () => {\r\n    // Limpiar URLs de vista previa antes de resetear\r\n    Object.values(videoData).forEach(data => {\r\n      if (data.videoPreview) {\r\n        URL.revokeObjectURL(data.videoPreview)\r\n      }\r\n      if (data.thumbnailPreview) {\r\n        URL.revokeObjectURL(data.thumbnailPreview)\r\n      }\r\n    })\r\n    \r\n    setSelectedFiles([])\r\n    setVideoData({})\r\n    setCollapsedVideos(new Set())\r\n    setUploadProgress({})\r\n    setUploading(false)\r\n    setCurrentStep(1)\r\n    \r\n    // Limpiar el input de archivos\r\n    if (fileInputRef.current) {\r\n      fileInputRef.current.value = ''\r\n    }\r\n  }\r\n\r\n  const addToast = (message, type = 'success') => {\r\n    const id = Date.now()\r\n    setToasts(prev => [...prev, { id, message, type }])\r\n  }\r\n\r\n  const removeToast = (id) => {\r\n    setToasts(prev => prev.filter(toast => toast.id !== id))\r\n  }\r\n\r\n  // Función para alternar el estado plegado/desplegado de un video\r\n  const toggleVideoCollapse = (fileName) => {\r\n    setCollapsedVideos(prev => {\r\n      const newSet = new Set(prev)\r\n      if (newSet.has(fileName)) {\r\n        newSet.delete(fileName)\r\n      } else {\r\n        newSet.add(fileName)\r\n      }\r\n      return newSet\r\n    })\r\n  }\r\n\r\n  // Función para plegar/desplegar todos los videos\r\n  const toggleAllVideos = (collapse) => {\r\n    if (collapse) {\r\n      setCollapsedVideos(new Set(selectedFiles.map(file => file.name)))\r\n    } else {\r\n      setCollapsedVideos(new Set())\r\n    }\r\n  }\r\n\r\n  const handleFileSelect = (event) => {\r\n    const files = Array.from(event.target.files)\r\n    const videoFiles = files.filter(file => file.type.startsWith('video/'))\r\n    \r\n    if (videoFiles.length === 0) {\r\n      addToast('Por favor selecciona archivos de video válidos', 'error')\r\n      return\r\n    }\r\n\r\n    // Filtrar archivos que ya están seleccionados\r\n    const newFiles = videoFiles.filter(file => \r\n      !selectedFiles.some(existingFile => existingFile.name === file.name)\r\n    )\r\n\r\n    if (newFiles.length === 0) {\r\n      addToast('Algunos archivos ya están seleccionados', 'warning')\r\n      return\r\n    }\r\n\r\n    // Actualizar archivos seleccionados\r\n    setSelectedFiles(prev => [...prev, ...newFiles])\r\n\r\n    // Generar vistas previas y thumbnails para los nuevos archivos\r\n    newFiles.forEach(async (file) => {\r\n      const videoPreview = URL.createObjectURL(file)\r\n      \r\n      // Generar thumbnail para la vista previa del modal\r\n      try {\r\n        const thumbnailBlob = await generateDefaultThumbnail(file)\r\n        const thumbnailURL = URL.createObjectURL(thumbnailBlob)\r\n        \r\n        setVideoData(prev => ({\r\n          ...prev,\r\n          [file.name]: {\r\n            ...prev[file.name],\r\n            videoPreview,\r\n            thumbnailPreview: thumbnailURL\r\n          }\r\n        }))\r\n      } catch (error) {\r\n        console.warn('Error generando thumbnail para vista previa:', error)\r\n        setVideoData(prev => ({\r\n          ...prev,\r\n          [file.name]: {\r\n            ...prev[file.name],\r\n            videoPreview\r\n          }\r\n        }))\r\n      }\r\n    })\r\n\r\n    addToast(`${newFiles.length} video(s) agregado(s)`, 'success')\r\n  }\r\n\r\n  const removeFile = (index) => {\r\n    const fileToRemove = selectedFiles[index]\r\n    if (fileToRemove && videoData[fileToRemove.name]) {\r\n      if (videoData[fileToRemove.name].videoPreview) {\r\n        URL.revokeObjectURL(videoData[fileToRemove.name].videoPreview)\r\n      }\r\n      if (videoData[fileToRemove.name].thumbnailPreview) {\r\n        URL.revokeObjectURL(videoData[fileToRemove.name].thumbnailPreview)\r\n      }\r\n    }\r\n    \r\n    setSelectedFiles(prev => prev.filter((_, i) => i !== index))\r\n    setVideoData(prev => {\r\n      const newData = { ...prev }\r\n      delete newData[fileToRemove.name]\r\n      return newData\r\n    })\r\n    setCollapsedVideos(prev => {\r\n      const newSet = new Set(prev)\r\n      newSet.delete(fileToRemove.name)\r\n      return newSet\r\n    })\r\n  }\r\n\r\n  const handleTagToggle = (category, tag) => {\r\n    setSelectedTags(prev => {\r\n      const currentTags = prev[category] || []\r\n      const isSelected = currentTags.includes(tag)\r\n      \r\n      if (isSelected) {\r\n        return {\r\n          ...prev,\r\n          [category]: currentTags.filter(t => t !== tag)\r\n        }\r\n      } else {\r\n        // Usar Set para evitar duplicados automáticamente\r\n        const newTags = [...new Set([...currentTags, tag])]\r\n        return {\r\n          ...prev,\r\n          [category]: newTags\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n\r\n\r\n  const generateThumbnail = async (file) => {\r\n    try {\r\n      // Si hay un thumbnail personalizado, usarlo\r\n      if (videoData[file.name]?.customThumbnailFile) {\r\n        const customThumbnailFile = videoData[file.name].customThumbnailFile\r\n        const thumbnailPath = `thumbnails/${page}/${style}/${Date.now()}_${file.name.replace(/\\.[^/.]+$/, '.jpg')}`\r\n        const uploadResult = await uploadFile(customThumbnailFile, thumbnailPath)\r\n        \r\n        if (uploadResult.success) {\r\n          return { url: uploadResult.url, path: uploadResult.path }\r\n        }\r\n      }\r\n      \r\n      // Intentar generar thumbnail de ALTA CALIDAD automáticamente con timeout\r\n      try {\r\n        const result = await Promise.race([\r\n          generateBestVideoThumbnail(file), // Usar la función de alta calidad\r\n          new Promise((_, reject) => \r\n            setTimeout(() => reject(new Error('Timeout')), 15000) // Aumentar timeout para mejor calidad\r\n          )\r\n        ])\r\n        \r\n        if (result.success && result.blob) {\r\n          // Subir thumbnail a Firebase Storage\r\n          const thumbnailPath = `thumbnails/${page}/${style}/${Date.now()}_${file.name.replace(/\\.[^/.]+$/, '.jpg')}`\r\n          const uploadResult = await uploadFile(result.blob, thumbnailPath)\r\n          \r\n          if (uploadResult.success) {\r\n            // Limpiar blob URL temporal\r\n            if (result.thumbnailURL) {\r\n              URL.revokeObjectURL(result.thumbnailURL)\r\n            }\r\n            return { url: uploadResult.url, path: uploadResult.path }\r\n          }\r\n        }\r\n      } catch (thumbnailError) {\r\n        console.warn('Error generando thumbnail automático:', thumbnailError)\r\n        // Continuar sin thumbnail\r\n      }\r\n      \r\n      // Fallback: usar thumbnail por defecto de Windows o generar uno simple\r\n      try {\r\n        // Intentar usar el thumbnail nativo del archivo (si está disponible)\r\n        const defaultThumbnail = await generateDefaultThumbnail(file)\r\n        if (defaultThumbnail) {\r\n          const thumbnailPath = `thumbnails/${page}/${style}/${Date.now()}_${file.name.replace(/\\.[^/.]+$/, '.jpg')}`\r\n          const uploadResult = await uploadFile(defaultThumbnail, thumbnailPath)\r\n          \r\n          if (uploadResult.success) {\r\n            return { url: uploadResult.url, path: uploadResult.path }\r\n          }\r\n        }\r\n      } catch (defaultError) {\r\n        console.warn('Error generando thumbnail por defecto:', defaultError)\r\n      }\r\n      \r\n      // Fallback final: no thumbnail, se mostrará el placeholder en la UI\r\n      return { url: null, path: null }\r\n    } catch (error) {\r\n      console.error('Error en generateThumbnail:', error)\r\n      return { url: null, path: null }\r\n    }\r\n  }\r\n\r\n  // Función para generar thumbnail por defecto usando el video\r\n  const generateDefaultThumbnail = async (file) => {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        const videoURL = URL.createObjectURL(file)\r\n        const video = document.createElement('video')\r\n        video.crossOrigin = 'anonymous'\r\n        video.muted = true\r\n        video.playsInline = true\r\n        \r\n        const canvas = document.createElement('canvas')\r\n        const ctx = canvas.getContext('2d')\r\n        \r\n        // Configurar canvas con ALTA CALIDAD para thumbnail\r\n        canvas.width = 1280 // Aumentar de 400 a 1280 para mejor calidad\r\n        canvas.height = 720 // Aumentar de 225 a 720 para mejor calidad (16:9)\r\n        \r\n        video.onloadedmetadata = () => {\r\n          try {\r\n            // Intentar capturar frame al inicio del video (0.1 segundos)\r\n            video.currentTime = 0.1\r\n            \r\n            video.onseeked = () => {\r\n              try {\r\n                // Dibujar el frame en el canvas\r\n                ctx.drawImage(video, 0, 0, canvas.width, canvas.height)\r\n                \r\n                // Convertir a blob\r\n                canvas.toBlob((blob) => {\r\n                  if (blob) {\r\n                    // Limpiar recursos\r\n                    URL.revokeObjectURL(videoURL)\r\n                    video.remove()\r\n                    canvas.remove()\r\n                    \r\n                    resolve(blob)\r\n                  } else {\r\n                    reject(new Error('No se pudo generar el thumbnail por defecto'))\r\n                  }\r\n                }, 'image/jpeg', 0.95) // Aumentar calidad de 0.8 a 0.95\r\n                \r\n              } catch (error) {\r\n                reject(new Error(`Error al capturar frame por defecto: ${error.message}`))\r\n              }\r\n            }\r\n            \r\n            video.onerror = () => {\r\n              reject(new Error('Error al cargar el video para thumbnail por defecto'))\r\n            }\r\n            \r\n          } catch (error) {\r\n            reject(new Error(`Error al procesar metadata por defecto: ${error.message}`))\r\n          }\r\n        }\r\n        \r\n        video.onerror = () => {\r\n          URL.revokeObjectURL(videoURL)\r\n          video.remove()\r\n          canvas.remove()\r\n          reject(new Error('Error al cargar el video por defecto'))\r\n        }\r\n        \r\n        // Cargar el video\r\n        video.src = videoURL\r\n        \r\n      } catch (error) {\r\n        reject(new Error(`Error al generar thumbnail por defecto: ${error.message}`))\r\n      }\r\n    })\r\n  }\r\n\r\n  const uploadVideoFile = async (file, index) => {\r\n    try {\r\n      // Verificar duplicado en base de datos\r\n      const duplicateCheck = await checkVideoDuplicate(file.name)\r\n      if (duplicateCheck.isDuplicate) {\r\n        addToast(`Video \"${file.name}\" ya existe en la base de datos`, 'warning')\r\n        return null\r\n      }\r\n\r\n      // Generar thumbnail\r\n      const thumbnailResult = await generateThumbnail(file)\r\n\r\n      // Subir video con estructura organizada por página y estilo\r\n      const videoPath = `videos/${page}/${style}/${Date.now()}_${file.name}`\r\n      const uploadResult = await uploadVideo(file, videoPath, (progress) => {\r\n        setUploadProgress(prev => ({ ...prev, [index]: progress }))\r\n      })\r\n\r\n      if (!uploadResult.success) {\r\n        addToast(`Error al subir ${file.name}: ${uploadResult.error}`, 'error')\r\n        return null\r\n      }\r\n\r\n      // Usar solo los tags seleccionados por el usuario, sin agregar automáticamente el style\r\n      const tagsWithStyle = {\r\n        ...selectedTags,\r\n        estilo: selectedTags.estilo || []\r\n      }\r\n\r\n      // Obtener los valores actuales de los campos de entrada usando refs\r\n      const titleInput = fieldRefs.current[`${file.name}-title`]\r\n      const descriptionInput = fieldRefs.current[`${file.name}-description`]\r\n      \r\n      const currentTitle = titleInput?.value?.trim() || videoData[file.name]?.title || file.name.replace(/\\.[^/.]+$/, '')\r\n      const currentDescription = descriptionInput?.value?.trim() || videoData[file.name]?.description || ''\r\n     \r\n      // Detectar resolución del video\r\n      let videoResolution = null\r\n      let videoWidth = null\r\n      let videoHeight = null\r\n      try {\r\n        const video = document.createElement('video')\r\n        video.src = URL.createObjectURL(file)\r\n        await new Promise((resolve, reject) => {\r\n          video.onloadedmetadata = () => {\r\n            videoWidth = video.videoWidth\r\n            videoHeight = video.videoHeight\r\n            const maxDimension = Math.max(videoWidth, videoHeight)\r\n            \r\n            if (maxDimension >= 3840) videoResolution = '4K'\r\n            else if (maxDimension >= 1920) videoResolution = '1080p'\r\n            else if (maxDimension >= 1280) videoResolution = '720p'\r\n            else if (maxDimension >= 854) videoResolution = '480p'\r\n            else videoResolution = '360p'\r\n            \r\n            URL.revokeObjectURL(video.src)\r\n            resolve()\r\n          }\r\n          video.onerror = reject\r\n        })\r\n      } catch (error) {\r\n        console.warn('No se pudo detectar la resolución del video:', error)\r\n        videoResolution = 'Unknown'\r\n      }\r\n\r\n      // Detectar BPM del video\r\n      let bpm = null\r\n      let bpmDetected = false\r\n      try {\r\n        console.log('🎵 Detectando BPM para:', file.name)\r\n        const bpmResult = await extractBPMFromVideo(file)\r\n        if (bpmResult.success && validateBPM(bpmResult.bpm)) {\r\n          bpm = bpmResult.bpm\r\n          bpmDetected = true\r\n          console.log(`✅ BPM detectado: ${bpm} para ${file.name}`)\r\n        } else {\r\n          console.warn(`⚠️ No se pudo detectar BPM válido para ${file.name}`)\r\n        }\r\n      } catch (error) {\r\n        console.error('❌ Error al detectar BPM:', error)\r\n      }\r\n\r\n      // Crear documento en Firestore\r\n      const videoDoc = {\r\n        title: currentTitle,\r\n        originalTitle: file.name,\r\n        description: currentDescription,\r\n        videoUrl: uploadResult.url,\r\n        thumbnailUrl: thumbnailResult.url || null,\r\n        videoPath: uploadResult.path,\r\n        thumbnailPath: thumbnailResult.path || null,\r\n        fileSize: file.size,\r\n        fileType: file.type,\r\n        duration: 0, // Se puede calcular después\r\n        resolution: videoResolution, // Resolución detectada\r\n        videoWidth, // Dimensiones del video\r\n        videoHeight,\r\n        style: style, // Agregar el estilo del video\r\n        tags: tagsWithStyle,\r\n        uploadedBy: user?.uid || 'anonymous',\r\n        uploadedAt: new Date().toISOString(),\r\n        views: 0,\r\n        likes: 0,\r\n        likedBy: [],\r\n        bpm: bpm, // BPM detectado\r\n        bpmDetected: bpmDetected // Indicar si se detectó BPM\r\n      }\r\n\r\n      const docResult = await createVideoDocument(videoDoc)\r\n      if (!docResult.success) {\r\n        addToast(`Error al guardar metadatos de ${file.name}`, 'error')\r\n        return null\r\n      }\r\n\r\n      addToast(`${file.name} subido exitosamente`, 'success')\r\n      return { ...videoDoc, id: docResult.id }\r\n    } catch (error) {\r\n      console.error('Error uploading video:', error)\r\n      addToast(`Error inesperado al subir ${file.name}`, 'error')\r\n      return null\r\n    }\r\n  }\r\n\r\n  const handleUpload = async () => {\r\n    if (selectedFiles.length === 0) {\r\n      addToast('Selecciona al menos un video', 'error')\r\n      return\r\n    }\r\n\r\n    setUploading(true)\r\n    const uploadedVideos = []\r\n\r\n    for (let i = 0; i < selectedFiles.length; i++) {\r\n      const file = selectedFiles[i]\r\n      const result = await uploadVideoFile(file, i)\r\n      if (result) {\r\n        uploadedVideos.push(result)\r\n      }\r\n    }\r\n\r\n    setUploading(false)\r\n    \r\n    if (uploadedVideos.length > 0) {\r\n      addToast(`${uploadedVideos.length} video(s) subido(s) correctamente`, 'success')\r\n      uploadedVideos.forEach(video => onVideoUploaded(video))\r\n      onClose()\r\n    }\r\n  }\r\n\r\n  const FileSelectionStep = () => (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"text-center\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Seleccionar Videos</h3>\r\n        <p className=\"text-gray-600\">Selecciona uno o varios videos para subir</p>\r\n      </div>\r\n\r\n      <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-6 hover:border-pink-400 transition-colors duration-200\">\r\n        <input\r\n          ref={fileInputRef}\r\n          type=\"file\"\r\n          multiple\r\n          accept=\"video/*\"\r\n          onChange={handleFileSelect}\r\n          className=\"hidden\"\r\n        />\r\n        <button\r\n          onClick={() => fileInputRef.current?.click()}\r\n          className=\"w-full flex flex-col items-center justify-center space-y-2 text-gray-600 hover:text-pink-500 transition-colors duration-200\"\r\n        >\r\n          <Upload className=\"h-12 w-12\" />\r\n          <span className=\"font-medium text-center\">Haz clic para seleccionar videos</span>\r\n          <span className=\"text-sm text-center\">MP4, AVI, MOV, etc. (máx. 100MB cada uno)</span>\r\n        </button>\r\n      </div>\r\n\r\n      {selectedFiles.length > 0 && (\r\n        <div className=\"space-y-2\">\r\n          <h4 className=\"font-medium text-gray-900\">Videos seleccionados ({selectedFiles.length})</h4>\r\n          {selectedFiles.map((file, index) => (\r\n            <div key={index} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n              <div className=\"flex-1\">\r\n                <p className=\"font-medium text-gray-900\">{file.name}</p>\r\n                <p className=\"text-sm text-gray-500\">{(file.size / (1024 * 1024)).toFixed(2)} MB</p>\r\n              </div>\r\n              <button\r\n                onClick={() => removeFile(index)}\r\n                className=\"p-1 text-red-500 hover:text-red-700 transition-colors duration-200\"\r\n              >\r\n                <Trash2 className=\"h-4 w-4\" />\r\n              </button>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n\r\n  const TagsStep = () => (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"text-center\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Configurar Videos</h3>\r\n        <p className=\"text-gray-600\">Personaliza la información de tus videos antes de subirlos</p>\r\n      </div>\r\n\r\n      {/* Controles globales para plegar/desplegar */}\r\n      {selectedFiles.length > 1 && (\r\n        <div className=\"flex justify-center space-x-2\">\r\n          <button\r\n            onClick={() => toggleAllVideos(true)}\r\n            className=\"flex items-center space-x-1 px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors\"\r\n          >\r\n            <ChevronsDown className=\"h-4 w-4\" />\r\n            <span>Plegar Todo</span>\r\n          </button>\r\n          <button\r\n            onClick={() => toggleAllVideos(false)}\r\n            className=\"flex items-center space-x-1 px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors\"\r\n          >\r\n            <ChevronsUp className=\"h-4 w-4\" />\r\n            <span>Desplegar Todo</span>\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      {/* Configuración por video */}\r\n      {selectedFiles.map((file, fileIndex) => {\r\n        const isCollapsed = collapsedVideos.has(file.name)\r\n        return (\r\n          <div key={fileIndex} className=\"border border-gray-200 rounded-lg overflow-hidden\">\r\n            {/* Header del video con botón de plegado */}\r\n            <div className=\"flex items-center justify-between p-4 bg-gray-50 border-b border-gray-200\">\r\n              <div className=\"flex items-center space-x-3\">\r\n                <div className=\"w-12 h-9 bg-gray-100 rounded flex items-center justify-center relative overflow-hidden\">\r\n                  {videoData[file.name]?.thumbnailPreview ? (\r\n                    <img \r\n                      src={videoData[file.name].thumbnailPreview} \r\n                      alt=\"Vista previa del video\"\r\n                      className=\"w-full h-full object-cover\"\r\n                      onError={(e) => {\r\n                        e.target.style.display = 'none'\r\n                        e.target.nextSibling.style.display = 'flex'\r\n                      }}\r\n                    />\r\n                  ) : null}\r\n                  <span className=\"text-xs text-gray-500\" style={{ display: videoData[file.name]?.thumbnailPreview ? 'none' : 'flex' }}>\r\n                    VIDEO\r\n                  </span>\r\n                </div>\r\n                <div>\r\n                  <h4 className=\"font-medium text-gray-900\">{file.name}</h4>\r\n                  <p className=\"text-sm text-gray-500\">{(file.size / (1024 * 1024)).toFixed(2)} MB</p>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex items-center space-x-2\">\r\n                <button\r\n                  onClick={() => toggleVideoCollapse(file.name)}\r\n                  className=\"p-1 text-gray-500 hover:text-gray-700 transition-colors\"\r\n                  title={isCollapsed ? \"Desplegar\" : \"Plegar\"}\r\n                >\r\n                  {isCollapsed ? <ChevronDown className=\"h-4 w-4\" /> : <ChevronUp className=\"h-4 w-4\" />}\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Contenido del video (condicionalmente visible) */}\r\n            {!isCollapsed && (\r\n              <div className=\"p-4 space-y-4\">\r\n                {/* Reproductor de video */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"font-medium text-gray-900\">Vista previa del video</h4>\r\n                  <div className=\"flex justify-center\">\r\n                    <VideoPlayer\r\n                      src={videoData[file.name]?.videoPreview || URL.createObjectURL(file)}\r\n                      size=\"medium\"\r\n                      loop={true}\r\n                      showControls={true}\r\n                      autoplay={false}\r\n                      muted={false}\r\n                      className=\"w-full max-w-2xl\"\r\n                      resolutions={['auto', '4k', '1080p', '720p', '480p', '360p']}\r\n                      currentResolution=\"auto\"\r\n                      videoTitle={videoData[file.name]?.title || file.name.replace(/\\.[^/.]+$/, '')}\r\n                      onResolutionChange={(resolution) => {\r\n                        console.log(`Resolución cambiada a: ${resolution}`)\r\n                        // Aquí se implementaría la lógica para cambiar la resolución del video\r\n                      }}\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex items-center justify-between text-sm text-gray-600\">\r\n                    <span>{file.name}</span>\r\n                    <span>{(file.size / (1024 * 1024)).toFixed(2)} MB</span>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Nombre personalizado */}\r\n                <div className=\"space-y-2\">\r\n                  <label className=\"block text-sm font-medium text-gray-700\">\r\n                    Nombre del video\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    data-file={file.name}\r\n                    data-field=\"title\"\r\n                    ref={(el) => {\r\n                      if (el) {\r\n                        fieldRefs.current[`${file.name}-title`] = el\r\n                        if (!el.value) {\r\n                          el.value = videoData[file.name]?.title || file.name.replace(/\\.[^/.]+$/, '')\r\n                        }\r\n                      }\r\n                    }}\r\n                    onBlur={(e) => {\r\n                      const newTitle = e.target.value.trim()\r\n                      if (newTitle !== (videoData[file.name]?.title || file.name.replace(/\\.[^/.]+$/, ''))) {\r\n                        setVideoData(prev => ({\r\n                          ...prev,\r\n                          [file.name]: {\r\n                            ...prev[file.name],\r\n                            title: newTitle\r\n                          }\r\n                        }))\r\n                      }\r\n                    }}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent\"\r\n                    placeholder=\"Ingresa un nombre para el video\"\r\n                  />\r\n                </div>\r\n\r\n                {/* Descripción */}\r\n                <div className=\"space-y-2\">\r\n                  <label className=\"block text-sm font-medium text-gray-700\">\r\n                    Descripción (opcional)\r\n                  </label>\r\n                  <textarea\r\n                    data-file={file.name}\r\n                    data-field=\"description\"\r\n                    ref={(el) => {\r\n                      if (el) {\r\n                        fieldRefs.current[`${file.name}-description`] = el\r\n                        if (!el.value) {\r\n                          el.value = videoData[file.name]?.description || ''\r\n                        }\r\n                      }\r\n                    }}\r\n                    onBlur={(e) => {\r\n                      const newDescription = e.target.value.trim()\r\n                      if (newDescription !== (videoData[file.name]?.description || '')) {\r\n                        setVideoData(prev => ({\r\n                          ...prev,\r\n                          [file.name]: {\r\n                            ...prev[file.name],\r\n                            description: newDescription\r\n                          }\r\n                        }))\r\n                      }\r\n                    }}\r\n                    rows={2}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent\"\r\n                    placeholder=\"Describe brevemente el contenido del video...\"\r\n                  />\r\n                </div>\r\n\r\n                                 {/* Thumbnail personalizado - TAMBIÉN DOBLE DE GRANDE */}\r\n                 <div className=\"space-y-2\">\r\n                   <label className=\"block text-sm font-medium text-gray-700\">\r\n                     Thumbnail personalizado (opcional)\r\n                   </label>\r\n                   <div className=\"flex items-center space-x-3\">\r\n                     <div className=\"w-40 h-24 bg-gray-100 rounded border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden\">\r\n                       {videoData[file.name]?.customThumbnail ? (\r\n                         <img \r\n                           src={videoData[file.name].customThumbnail} \r\n                           alt=\"Thumbnail personalizado\" \r\n                           className=\"w-full h-full object-cover rounded\"\r\n                         />\r\n                       ) : (\r\n                         <span className=\"text-xs text-gray-500\">IMG</span>\r\n                       )}\r\n                     </div>\r\n                     <input\r\n                       type=\"file\"\r\n                       accept=\"image/*\"\r\n                       onChange={(e) => {\r\n                         const thumbnailFile = e.target.files[0]\r\n                         if (thumbnailFile) {\r\n                           const reader = new FileReader()\r\n                           reader.onload = (e) => {\r\n                             setVideoData(prev => ({\r\n                               ...prev,\r\n                               [file.name]: {\r\n                                 ...prev[file.name],\r\n                                 customThumbnail: e.target.result,\r\n                                 customThumbnailFile: thumbnailFile\r\n                               }\r\n                             }))\r\n                           }\r\n                           reader.readAsDataURL(thumbnailFile)\r\n                         }\r\n                       }}\r\n                       className=\"flex-1 text-sm text-gray-500 file:mr-4 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-sm file:font-medium file:bg-pink-50 file:text-pink-700 hover:file:bg-pink-100\"\r\n                     />\r\n                   </div>\r\n                 </div>\r\n\r\n                 \r\n              </div>\r\n            )}\r\n          </div>\r\n        )\r\n      })}\r\n\r\n      {/* Etiquetas globales */}\r\n      <div className=\"border-t pt-6\">\r\n        <h4 className=\"font-medium text-gray-900 mb-4\">Etiquetas para todos los videos</h4>\r\n        \r\n        {categoriesList.map((category) => (\r\n          <div key={category.key} className=\"space-y-3 mb-4\">\r\n            <h5 className=\"font-medium text-gray-700 capitalize\">{category.name}</h5>\r\n            <div className=\"flex flex-wrap gap-2\">\r\n              {category.tags.map(tag => (\r\n                <button\r\n                  key={tag}\r\n                  onClick={() => handleTagToggle(category.key, tag)}\r\n                  className={`px-3 py-1 rounded-full text-sm font-medium transition-all duration-200 ${\r\n                    selectedTags[category.key]?.includes(tag)\r\n                       ? 'bg-gradient-to-r from-pink-500 to-orange-500 text-white shadow-lg'\r\n                       : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\r\n                  }`}\r\n                >\r\n                  {tag}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n             <div className=\"bg-blue-50 p-4 rounded-lg\">\r\n         <div className=\"flex items-start space-x-2\">\r\n           <AlertCircle className=\"h-5 w-5 text-blue-500 mt-0.5\" />\r\n           <div>\r\n             <p className=\"text-sm text-blue-800 font-medium\">Información</p>\r\n                           <p className=\"text-sm text-blue-700\">Personaliza cada video individualmente y aplica etiquetas que se usarán para todos los videos seleccionados.</p>\r\n           </div>\r\n         </div>\r\n       </div>\r\n    </div>\r\n  )\r\n\r\n  const UploadStep = () => (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"text-center\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Subiendo Videos</h3>\r\n        <p className=\"text-gray-600\">Procesando {selectedFiles.length} video(s)...</p>\r\n      </div>\r\n\r\n      {selectedFiles.map((file, index) => (\r\n        <div key={index} className=\"space-y-2\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <span className=\"font-medium text-gray-900\">{file.name}</span>\r\n            <span className=\"text-sm text-gray-500\">{uploadProgress[index] || 0}%</span>\r\n          </div>\r\n          <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n            <div\r\n              className=\"bg-gradient-to-r from-pink-500 to-orange-500 h-2 rounded-full transition-all duration-300\"\r\n              style={{ width: `${uploadProgress[index] || 0}%` }}\r\n            />\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  )\r\n\r\n  const renderStep = () => {\r\n    switch (currentStep) {\r\n      case 1:\r\n        return <FileSelectionStep />\r\n      case 2:\r\n        return <TagsStep />\r\n      case 3:\r\n        return <UploadStep />\r\n      default:\r\n        return <FileSelectionStep />\r\n    }\r\n  }\r\n\r\n  const canProceed = () => {\r\n    switch (currentStep) {\r\n      case 1:\r\n        return selectedFiles.length > 0\r\n      case 2:\r\n        return true // Siempre se puede proceder desde tags\r\n      case 3:\r\n        return false // No se puede proceder durante upload\r\n      default:\r\n        return false\r\n    }\r\n  }\r\n\r\n  const handleNext = () => {\r\n    if (currentStep === 2) {\r\n      handleUpload()\r\n    } else {\r\n      setCurrentStep(prev => prev + 1)\r\n      // Cuando se avanza al paso 2, plegar todos los videos\r\n      if (currentStep === 1) {\r\n        setCollapsedVideos(new Set(selectedFiles.map(file => file.name)))\r\n      }\r\n    }\r\n  }\r\n\r\n  const handleBack = () => {\r\n    setCurrentStep(prev => Math.max(1, prev - 1))\r\n  }\r\n\r\n  if (!isOpen) return null\r\n\r\n  return (\r\n    <>\r\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n        <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\r\n            <div className=\"flex items-center space-x-3\">\r\n              <div className=\"p-2 bg-gradient-to-r from-pink-500 to-orange-500 rounded-full\">\r\n                <Upload className=\"h-6 w-6 text-white\" />\r\n              </div>\r\n              <div>\r\n                <h2 className=\"text-xl font-semibold text-gray-900\">Subir Videos</h2>\r\n                <p className=\"text-sm text-gray-500\">Paso {currentStep} de 3</p>\r\n              </div>\r\n            </div>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"text-gray-400 hover:text-gray-600 transition-colors duration-200\"\r\n            >\r\n              <X className=\"h-6 w-6\" />\r\n            </button>\r\n          </div>\r\n\r\n          {/* Content */}\r\n          <div className=\"p-6 overflow-y-auto max-h-[60vh]\">\r\n            {renderStep()}\r\n          </div>\r\n\r\n          {/* Footer */}\r\n          <div className=\"flex items-center justify-between p-6 border-t border-gray-200\">\r\n            <button\r\n              onClick={handleBack}\r\n              disabled={currentStep === 1 || uploading}\r\n              className=\"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              Atrás\r\n            </button>\r\n            \r\n            <div className=\"flex space-x-3\">\r\n              <button\r\n                onClick={onClose}\r\n                disabled={uploading}\r\n                className=\"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n              >\r\n                Cancelar\r\n              </button>\r\n              \r\n              {currentStep < 3 && (\r\n                <button\r\n                  onClick={handleNext}\r\n                  disabled={!canProceed() || uploading}\r\n                  className=\"px-6 py-2 bg-gradient-to-r from-pink-500 to-orange-500 text-white rounded-lg font-medium hover:shadow-lg transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none\"\r\n                >\r\n                  {currentStep === 2 ? 'Subir Videos' : 'Siguiente'}\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Toasts */}\r\n      {toasts.map(toast => (\r\n        <Toast\r\n          key={toast.id}\r\n          message={toast.message}\r\n          type={toast.type}\r\n          onClose={() => removeToast(toast.id)}\r\n        />\r\n      ))}\r\n    </>\r\n  )\r\n}\r\n\r\nexport default VideoUploadModal ","import { useState, useRef, useEffect } from 'react'\r\nimport { X, Edit, Tag, Save, AlertCircle, ChevronDown, ChevronUp, ChevronsDown, ChevronsUp } from 'lucide-react'\r\nimport { updateVideoDocument } from '../../services/firebase/firestore'\r\nimport { uploadFile } from '../../services/firebase/storage'\r\nimport { useAuth } from '../../contexts/AuthContext'\r\nimport { useCategories } from '../../hooks/useCategories'\r\nimport Toast from '../common/Toast'\r\nimport VideoPlayer from './VideoPlayer'\r\n\r\nconst VideoEditModal = ({ isOpen, onClose, video, onVideoUpdated, page = 'figuras', style = 'salsa' }) => {\r\n  const { user } = useAuth()\r\n  const { currentCategories, categoriesList, getColorClasses } = useCategories(page, style)\r\n  const [loading, setLoading] = useState(false)\r\n  const [toasts, setToasts] = useState([])\r\n  \r\n  // Estados para el formulario\r\n  const [title, setTitle] = useState('')\r\n  const [description, setDescription] = useState('')\r\n  const [customThumbnail, setCustomThumbnail] = useState(null)\r\n  const [customThumbnailFile, setCustomThumbnailFile] = useState(null)\r\n  \r\n  // Estados para tags organizados por categorías\r\n  const [selectedTags, setSelectedTags] = useState({})\r\n  const [tagsIniciales, setTagsIniciales] = useState({})\r\n  const [tagsFinales, setTagsFinales] = useState({})\r\n  \r\n  // Estado para secciones plegadas/desplegadas\r\n  const [collapsedSections, setCollapsedSections] = useState(new Set(['tags-iniciales', 'tags-finales']))\r\n\r\n     useEffect(() => {\r\n     if (!isOpen || !video) return\r\n     \r\n     // Inicializar datos del video\r\n     setTitle(video.title || '')\r\n     setDescription(video.description || '')\r\n     setCustomThumbnail(video.thumbnailUrl || null)\r\n     setCustomThumbnailFile(null) // Resetear archivo de thumbnail\r\n     \r\n     // Inicializar tags\r\n     if (currentCategories) {\r\n       const initialTags = {}\r\n       const initialTagsIniciales = {}\r\n       const initialTagsFinales = {}\r\n       \r\n       Object.keys(currentCategories).forEach(categoryKey => {\r\n         initialTags[categoryKey] = video.tags?.[categoryKey] || []\r\n         initialTagsIniciales[categoryKey] = video.tagsIniciales?.[categoryKey] || []\r\n         initialTagsFinales[categoryKey] = video.tagsFinales?.[categoryKey] || []\r\n       })\r\n       \r\n       setSelectedTags(initialTags)\r\n       setTagsIniciales(initialTagsIniciales)\r\n       setTagsFinales(initialTagsFinales)\r\n     }\r\n   }, [isOpen, video, currentCategories])\r\n\r\n   // Resetear estados cuando se cierra el modal\r\n   useEffect(() => {\r\n     if (!isOpen) {\r\n       setTitle('')\r\n       setDescription('')\r\n       setCustomThumbnail(null)\r\n       setCustomThumbnailFile(null)\r\n       setSelectedTags({})\r\n       setTagsIniciales({})\r\n       setTagsFinales({})\r\n     }\r\n   }, [isOpen])\r\n\r\n  const addToast = (message, type = 'success') => {\r\n    const id = Date.now()\r\n    setToasts(prev => [...prev, { id, message, type }])\r\n  }\r\n\r\n  const removeToast = (id) => {\r\n    setToasts(prev => prev.filter(toast => toast.id !== id))\r\n  }\r\n\r\n  // Función para alternar el estado plegado/desplegado de una sección\r\n  const toggleSectionCollapse = (sectionName) => {\r\n    setCollapsedSections(prev => {\r\n      const newSet = new Set(prev)\r\n      if (newSet.has(sectionName)) {\r\n        newSet.delete(sectionName)\r\n      } else {\r\n        newSet.add(sectionName)\r\n      }\r\n      return newSet\r\n    })\r\n  }\r\n\r\n  const handleTagToggle = (category, tag) => {\r\n    setSelectedTags(prev => {\r\n      const currentTags = prev[category] || []\r\n      const isSelected = currentTags.includes(tag)\r\n      \r\n      if (isSelected) {\r\n        return {\r\n          ...prev,\r\n          [category]: currentTags.filter(t => t !== tag)\r\n        }\r\n      } else {\r\n        // Usar Set para evitar duplicados automáticamente\r\n        const newTags = [...new Set([...currentTags, tag])]\r\n        return {\r\n          ...prev,\r\n          [category]: newTags\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  const handleTagInicialToggle = (category, tag) => {\r\n    setTagsIniciales(prev => {\r\n      const currentTags = prev[category] || []\r\n      const isSelected = currentTags.includes(tag)\r\n      \r\n      if (isSelected) {\r\n        return {\r\n          ...prev,\r\n          [category]: currentTags.filter(t => t !== tag)\r\n        }\r\n      } else {\r\n        // Usar Set para evitar duplicados automáticamente\r\n        const newTags = [...new Set([...currentTags, tag])]\r\n        return {\r\n          ...prev,\r\n          [category]: newTags\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  const handleTagFinalToggle = (category, tag) => {\r\n    setTagsFinales(prev => {\r\n      const currentTags = prev[category] || []\r\n      const isSelected = currentTags.includes(tag)\r\n      \r\n      if (isSelected) {\r\n        return {\r\n          ...prev,\r\n          [category]: currentTags.filter(t => t !== tag)\r\n        }\r\n      } else {\r\n        // Usar Set para evitar duplicados automáticamente\r\n        const newTags = [...new Set([...currentTags, tag])]\r\n        return {\r\n          ...prev,\r\n          [category]: newTags\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  const handleThumbnailChange = (e) => {\r\n    const file = e.target.files[0]\r\n    if (file) {\r\n      const reader = new FileReader()\r\n      reader.onload = (e) => {\r\n        setCustomThumbnail(e.target.result)\r\n        setCustomThumbnailFile(file)\r\n      }\r\n      reader.readAsDataURL(file)\r\n    }\r\n  }\r\n\r\n  // Función para detectar resolución del video\r\n  const detectVideoResolution = async (videoUrl) => {\r\n    try {\r\n      const video = document.createElement('video')\r\n      video.src = videoUrl\r\n      await new Promise((resolve, reject) => {\r\n        video.onloadedmetadata = () => {\r\n          const width = video.videoWidth\r\n          const height = video.videoHeight\r\n          const maxDimension = Math.max(width, height)\r\n          \r\n          let resolution = 'Unknown'\r\n          if (maxDimension >= 3840) resolution = '4K'\r\n          else if (maxDimension >= 1920) resolution = '1080p'\r\n          else if (maxDimension >= 1280) resolution = '720p'\r\n          else if (maxDimension >= 854) resolution = '480p'\r\n          else resolution = '360p'\r\n          \r\n          resolve({ resolution, videoWidth: width, videoHeight: height })\r\n        }\r\n        video.onerror = reject\r\n        // Timeout por si el video no carga\r\n        setTimeout(() => reject(new Error('Timeout')), 10000)\r\n      })\r\n    } catch (error) {\r\n      console.warn('No se pudo detectar la resolución del video:', error)\r\n      return { resolution: 'Unknown', videoWidth: null, videoHeight: null }\r\n    }\r\n  }\r\n\r\n  const handleSave = async () => {\r\n    if (!video) return\r\n    \r\n    setLoading(true)\r\n    \r\n    try {\r\n             // Subir nuevo thumbnail si se seleccionó uno\r\n       let thumbnailUrl = video.thumbnailUrl\r\n       let thumbnailPath = video.thumbnailPath\r\n       \r\n       if (customThumbnailFile) {\r\n         const newThumbnailPath = `thumbnails/${Date.now()}_${video.originalTitle.replace(/\\.[^/.]+$/, '.jpg')}`\r\n         const uploadResult = await uploadFile(customThumbnailFile, newThumbnailPath)\r\n         \r\n         if (uploadResult.success) {\r\n           thumbnailUrl = uploadResult.url\r\n           thumbnailPath = uploadResult.path\r\n         } else {\r\n           addToast('Error al subir el nuevo thumbnail', 'error')\r\n           setLoading(false)\r\n           return\r\n         }\r\n       }\r\n\r\n      // Usar solo los tags seleccionados por el usuario, sin agregar automáticamente el style\r\n      const tagsWithStyle = {\r\n        ...selectedTags,\r\n        estilo: selectedTags.estilo || []\r\n      }\r\n\r\n      // Detectar resolución si no existe\r\n      let resolution = video.resolution\r\n      let videoWidth = video.videoWidth\r\n      let videoHeight = video.videoHeight\r\n      \r\n      if (!resolution || resolution === 'Unknown') {\r\n        try {\r\n          const resolutionData = await detectVideoResolution(video.videoUrl)\r\n          resolution = resolutionData.resolution\r\n          videoWidth = resolutionData.videoWidth\r\n          videoHeight = resolutionData.videoHeight\r\n          console.log(`Resolución detectada: ${resolution} (${videoWidth}x${videoHeight})`)\r\n        } catch (error) {\r\n          console.warn('No se pudo detectar la resolución:', error)\r\n          resolution = 'Unknown'\r\n        }\r\n      }\r\n\r\n      // Preparar datos actualizados\r\n      const updatedData = {\r\n        title: title.trim(),\r\n        description: description.trim(),\r\n        thumbnailUrl,\r\n        thumbnailPath,\r\n        resolution, // Incluir la resolución detectada\r\n        videoWidth, // Incluir dimensiones del video\r\n        videoHeight,\r\n        tags: tagsWithStyle,\r\n        tagsIniciales,\r\n        tagsFinales,\r\n        updatedBy: user?.uid || 'anonymous',\r\n        updatedAt: new Date().toISOString()\r\n      }\r\n\r\n      // Actualizar en Firestore\r\n      const result = await updateVideoDocument(video.id, updatedData)\r\n      \r\n      if (result.success) {\r\n        addToast('Video actualizado exitosamente', 'success')\r\n        onVideoUpdated({ ...video, ...updatedData })\r\n        onClose()\r\n      } else {\r\n        addToast(`Error al actualizar video: ${result.error}`, 'error')\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating video:', error)\r\n      addToast('Error inesperado al actualizar video', 'error')\r\n    }\r\n    \r\n    setLoading(false)\r\n  }\r\n\r\n  if (!isOpen || !video) return null\r\n\r\n  return (\r\n    <>\r\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n        <div className=\"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\r\n            <div className=\"flex items-center space-x-3\">\r\n              <div className=\"p-2 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full\">\r\n                <Edit className=\"h-6 w-6 text-white\" />\r\n              </div>\r\n              <div>\r\n                <h2 className=\"text-xl font-semibold text-gray-900\">Editar Video</h2>\r\n                <p className=\"text-sm text-gray-500\">{video.title}</p>\r\n              </div>\r\n            </div>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"text-gray-400 hover:text-gray-600 transition-colors duration-200\"\r\n            >\r\n              <X className=\"h-6 w-6\" />\r\n            </button>\r\n          </div>\r\n\r\n          {/* Content */}\r\n          <div className=\"p-6 overflow-y-auto max-h-[60vh]\">\r\n            <div className=\"space-y-6\">\r\n                             {/* Reproductor de video */}\r\n               <div className=\"space-y-4\">\r\n                 <h4 className=\"font-medium text-gray-900\">Vista previa del video</h4>\r\n                 <div className=\"flex justify-center\">\r\n                   <VideoPlayer\r\n                     src={video.videoUrl}\r\n                     size=\"medium\"\r\n                     loop={true}\r\n                     showControls={true}\r\n                     autoplay={false}\r\n                     muted={false}\r\n                     className=\"w-full max-w-2xl\"\r\n                     resolutions={['auto', '4k', '1080p', '720p', '480p', '360p']}\r\n                     currentResolution=\"auto\"\r\n                     videoTitle={video.title || 'video'}\r\n                     onResolutionChange={(resolution) => {\r\n                       console.log(`Resolución cambiada a: ${resolution}`)\r\n                       // Aquí se implementaría la lógica para cambiar la resolución del video\r\n                     }}\r\n                   />\r\n                 </div>\r\n                 <div className=\"flex items-center justify-between text-sm text-gray-600\">\r\n                   <div className=\"flex items-center space-x-2\">\r\n                     <span>{video.originalTitle}</span>\r\n                     <span className=\"text-gray-400\">•</span>\r\n                     <span>{(video.fileSize / (1024 * 1024)).toFixed(2)} MB</span>\r\n                     {video.resolution && video.resolution !== 'Unknown' && (\r\n                       <>\r\n                         <span className=\"text-gray-400\">•</span>\r\n                         <span>{video.resolution}</span>\r\n                       </>\r\n                     )}\r\n                   </div>\r\n                 </div>\r\n               </div>\r\n\r\n              {/* Título */}\r\n              <div className=\"space-y-2\">\r\n                <label className=\"block text-sm font-medium text-gray-700\">\r\n                  Título del video\r\n                </label>\r\n                                 <input\r\n                   type=\"text\"\r\n                   value={title}\r\n                   onChange={(e) => setTitle(e.target.value)}\r\n                   className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-500\"\r\n                   placeholder=\"Ingresa un título para el video\"\r\n                 />\r\n              </div>\r\n\r\n              {/* Descripción */}\r\n              <div className=\"space-y-2\">\r\n                <label className=\"block text-sm font-medium text-gray-700\">\r\n                  Descripción\r\n                </label>\r\n                                 <textarea\r\n                   value={description}\r\n                   onChange={(e) => setDescription(e.target.value)}\r\n                   rows={3}\r\n                   className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-500\"\r\n                   placeholder=\"Describe brevemente el contenido del video...\"\r\n                 />\r\n              </div>\r\n\r\n              {/* Thumbnail personalizado */}\r\n              <div className=\"space-y-2\">\r\n                <label className=\"block text-sm font-medium text-gray-700\">\r\n                  Thumbnail personalizado\r\n                </label>\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className=\"w-40 h-24 bg-gray-100 rounded border-2 border-dashed border-gray-300 flex items-center justify-center\">\r\n                    {customThumbnail ? (\r\n                      <img \r\n                        src={customThumbnail} \r\n                        alt=\"Thumbnail\" \r\n                        className=\"w-full h-full object-cover rounded\"\r\n                      />\r\n                    ) : (\r\n                      <span className=\"text-xs text-gray-500\">IMG</span>\r\n                    )}\r\n                  </div>\r\n                  <input\r\n                    type=\"file\"\r\n                    accept=\"image/*\"\r\n                    onChange={handleThumbnailChange}\r\n                    className=\"flex-1 text-sm text-gray-500 file:mr-4 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Tags Normales */}\r\n              <div className=\"space-y-4\">\r\n                <h4 className=\"font-medium text-gray-900\">Tags Normales</h4>\r\n                {categoriesList.map((category) => (\r\n                  <div key={category.key} className=\"space-y-3\">\r\n                    <h5 className=\"font-medium text-gray-700 capitalize\">{category.name}</h5>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                      {category.tags.map(tag => (\r\n                        <button\r\n                          key={tag}\r\n                          onClick={() => handleTagToggle(category.key, tag)}\r\n                          className={`px-3 py-1 rounded-full text-sm font-medium transition-all duration-200 ${\r\n                            selectedTags[category.key]?.includes(tag)\r\n                              ? 'bg-gradient-to-r from-pink-500 to-orange-500 text-white shadow-lg'\r\n                              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\r\n                          }`}\r\n                        >\r\n                          {tag}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n\r\n              {/* Tags Iniciales */}\r\n              <div className=\"border-t pt-6\">\r\n                <button\r\n                  onClick={() => toggleSectionCollapse('tags-iniciales')}\r\n                  className=\"flex items-center justify-between w-full p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg hover:from-blue-100 hover:to-purple-100 transition-all duration-200\"\r\n                >\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <Tag className=\"h-5 w-5 text-blue-600\" />\r\n                    <h4 className=\"font-medium text-gray-900\">Tags Iniciales (cómo empieza la figura)</h4>\r\n                  </div>\r\n                  {collapsedSections.has('tags-iniciales') ? (\r\n                    <ChevronDown className=\"h-5 w-5 text-gray-500\" />\r\n                  ) : (\r\n                    <ChevronUp className=\"h-5 w-5 text-gray-500\" />\r\n                  )}\r\n                </button>\r\n                \r\n                <div className={`mt-4 transition-all duration-300 ease-in-out overflow-hidden ${\r\n                  collapsedSections.has('tags-iniciales') ? 'max-h-0 opacity-0' : 'max-h-96 opacity-100'\r\n                }`}>\r\n                  <div className=\"space-y-4 bg-blue-50 rounded-lg p-4\">\r\n                    {categoriesList.map((category) => (\r\n                      <div key={`inicial-${category.key}`} className=\"space-y-2\">\r\n                        <h6 className=\"text-xs font-medium text-gray-600 uppercase tracking-wide\">{category.name}</h6>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                          {category.tags.map(tag => (\r\n                            <button\r\n                              key={`inicial-${tag}`}\r\n                              onClick={() => handleTagInicialToggle(category.key, tag)}\r\n                              className={`px-2 py-1 rounded-full text-xs font-medium transition-all duration-200 ${\r\n                                tagsIniciales[category.key]?.includes(tag)\r\n                                  ? 'bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg'\r\n                                  : 'bg-white text-gray-700 hover:bg-blue-100'\r\n                              }`}\r\n                            >\r\n                              {tag}\r\n                            </button>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Tags Finales */}\r\n              <div className=\"border-t pt-6\">\r\n                <button\r\n                  onClick={() => toggleSectionCollapse('tags-finales')}\r\n                  className=\"flex items-center justify-between w-full p-4 bg-gradient-to-r from-green-50 to-teal-50 rounded-lg hover:from-green-100 hover:to-teal-100 transition-all duration-200\"\r\n                >\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <Tag className=\"h-5 w-5 text-green-600\" />\r\n                    <h4 className=\"font-medium text-gray-900\">Tags Finales (cómo termina la figura)</h4>\r\n                  </div>\r\n                  {collapsedSections.has('tags-finales') ? (\r\n                    <ChevronDown className=\"h-5 w-5 text-gray-500\" />\r\n                  ) : (\r\n                    <ChevronUp className=\"h-5 w-5 text-gray-500\" />\r\n                  )}\r\n                </button>\r\n                \r\n                <div className={`mt-4 transition-all duration-300 ease-in-out overflow-hidden ${\r\n                  collapsedSections.has('tags-finales') ? 'max-h-0 opacity-0' : 'max-h-96 opacity-100'\r\n                }`}>\r\n                  <div className=\"space-y-4 bg-green-50 rounded-lg p-4\">\r\n                    {categoriesList.map((category) => (\r\n                      <div key={`final-${category.key}`} className=\"space-y-2\">\r\n                        <h6 className=\"text-xs font-medium text-gray-600 uppercase tracking-wide\">{category.name}</h6>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                          {category.tags.map(tag => (\r\n                            <button\r\n                              key={`final-${tag}`}\r\n                              onClick={() => handleTagFinalToggle(category.key, tag)}\r\n                              className={`px-2 py-1 rounded-full text-xs font-medium transition-all duration-200 ${\r\n                                tagsFinales[category.key]?.includes(tag)\r\n                                  ? 'bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-lg'\r\n                                  : 'bg-white text-gray-700 hover:bg-green-100'\r\n                              }`}\r\n                            >\r\n                              {tag}\r\n                            </button>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Información */}\r\n              <div className=\"bg-blue-50 p-4 rounded-lg\">\r\n                <div className=\"flex items-start space-x-2\">\r\n                  <AlertCircle className=\"h-5 w-5 text-blue-500 mt-0.5\" />\r\n                  <div>\r\n                    <p className=\"text-sm text-blue-800 font-medium\">Información</p>\r\n                    <p className=\"text-sm text-blue-700\">Los tags iniciales y finales ayudarán a crear secuencias lógicas conectando figuras.</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Footer */}\r\n          <div className=\"flex items-center justify-between p-6 border-t border-gray-200\">\r\n            <button\r\n              onClick={onClose}\r\n              disabled={loading}\r\n              className=\"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              Cancelar\r\n            </button>\r\n            \r\n            <button\r\n              onClick={handleSave}\r\n              disabled={loading || !title.trim()}\r\n              className=\"px-6 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg font-medium hover:shadow-lg transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none\"\r\n            >\r\n              {loading ? 'Guardando...' : 'Guardar Cambios'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Toasts */}\r\n      {toasts.map(toast => (\r\n        <Toast\r\n          key={toast.id}\r\n          message={toast.message}\r\n          type={toast.type}\r\n          onClose={() => removeToast(toast.id)}\r\n        />\r\n      ))}\r\n    </>\r\n  )\r\n}\r\n\r\nexport default VideoEditModal ","export const MIME_TYPE_JAVASCRIPT = \"text/javascript\";\nexport const MIME_TYPE_WASM = \"application/wasm\";\nexport const CORE_VERSION = \"0.12.9\";\nexport const CORE_URL = `https://unpkg.com/@ffmpeg/core@${CORE_VERSION}/dist/umd/ffmpeg-core.js`;\nexport var FFMessageType;\n(function (FFMessageType) {\n    FFMessageType[\"LOAD\"] = \"LOAD\";\n    FFMessageType[\"EXEC\"] = \"EXEC\";\n    FFMessageType[\"FFPROBE\"] = \"FFPROBE\";\n    FFMessageType[\"WRITE_FILE\"] = \"WRITE_FILE\";\n    FFMessageType[\"READ_FILE\"] = \"READ_FILE\";\n    FFMessageType[\"DELETE_FILE\"] = \"DELETE_FILE\";\n    FFMessageType[\"RENAME\"] = \"RENAME\";\n    FFMessageType[\"CREATE_DIR\"] = \"CREATE_DIR\";\n    FFMessageType[\"LIST_DIR\"] = \"LIST_DIR\";\n    FFMessageType[\"DELETE_DIR\"] = \"DELETE_DIR\";\n    FFMessageType[\"ERROR\"] = \"ERROR\";\n    FFMessageType[\"DOWNLOAD\"] = \"DOWNLOAD\";\n    FFMessageType[\"PROGRESS\"] = \"PROGRESS\";\n    FFMessageType[\"LOG\"] = \"LOG\";\n    FFMessageType[\"MOUNT\"] = \"MOUNT\";\n    FFMessageType[\"UNMOUNT\"] = \"UNMOUNT\";\n})(FFMessageType || (FFMessageType = {}));\n","/**\n * Generate an unique message ID.\n */\nexport const getMessageID = (() => {\n    let messageID = 0;\n    return () => messageID++;\n})();\n","export const ERROR_UNKNOWN_MESSAGE_TYPE = new Error(\"unknown message type\");\nexport const ERROR_NOT_LOADED = new Error(\"ffmpeg is not loaded, call `await ffmpeg.load()` first\");\nexport const ERROR_TERMINATED = new Error(\"called FFmpeg.terminate()\");\nexport const ERROR_IMPORT_FAILURE = new Error(\"failed to import ffmpeg-core.js\");\n","import { FFMessageType } from \"./const.js\";\nimport { getMessageID } from \"./utils.js\";\nimport { ERROR_TERMINATED, ERROR_NOT_LOADED } from \"./errors.js\";\n/**\n * Provides APIs to interact with ffmpeg web worker.\n *\n * @example\n * ```ts\n * const ffmpeg = new FFmpeg();\n * ```\n */\nexport class FFmpeg {\n    #worker = null;\n    /**\n     * #resolves and #rejects tracks Promise resolves and rejects to\n     * be called when we receive message from web worker.\n     */\n    #resolves = {};\n    #rejects = {};\n    #logEventCallbacks = [];\n    #progressEventCallbacks = [];\n    loaded = false;\n    /**\n     * register worker message event handlers.\n     */\n    #registerHandlers = () => {\n        if (this.#worker) {\n            this.#worker.onmessage = ({ data: { id, type, data }, }) => {\n                switch (type) {\n                    case FFMessageType.LOAD:\n                        this.loaded = true;\n                        this.#resolves[id](data);\n                        break;\n                    case FFMessageType.MOUNT:\n                    case FFMessageType.UNMOUNT:\n                    case FFMessageType.EXEC:\n                    case FFMessageType.FFPROBE:\n                    case FFMessageType.WRITE_FILE:\n                    case FFMessageType.READ_FILE:\n                    case FFMessageType.DELETE_FILE:\n                    case FFMessageType.RENAME:\n                    case FFMessageType.CREATE_DIR:\n                    case FFMessageType.LIST_DIR:\n                    case FFMessageType.DELETE_DIR:\n                        this.#resolves[id](data);\n                        break;\n                    case FFMessageType.LOG:\n                        this.#logEventCallbacks.forEach((f) => f(data));\n                        break;\n                    case FFMessageType.PROGRESS:\n                        this.#progressEventCallbacks.forEach((f) => f(data));\n                        break;\n                    case FFMessageType.ERROR:\n                        this.#rejects[id](data);\n                        break;\n                }\n                delete this.#resolves[id];\n                delete this.#rejects[id];\n            };\n        }\n    };\n    /**\n     * Generic function to send messages to web worker.\n     */\n    #send = ({ type, data }, trans = [], signal) => {\n        if (!this.#worker) {\n            return Promise.reject(ERROR_NOT_LOADED);\n        }\n        return new Promise((resolve, reject) => {\n            const id = getMessageID();\n            this.#worker && this.#worker.postMessage({ id, type, data }, trans);\n            this.#resolves[id] = resolve;\n            this.#rejects[id] = reject;\n            signal?.addEventListener(\"abort\", () => {\n                reject(new DOMException(`Message # ${id} was aborted`, \"AbortError\"));\n            }, { once: true });\n        });\n    };\n    on(event, callback) {\n        if (event === \"log\") {\n            this.#logEventCallbacks.push(callback);\n        }\n        else if (event === \"progress\") {\n            this.#progressEventCallbacks.push(callback);\n        }\n    }\n    off(event, callback) {\n        if (event === \"log\") {\n            this.#logEventCallbacks = this.#logEventCallbacks.filter((f) => f !== callback);\n        }\n        else if (event === \"progress\") {\n            this.#progressEventCallbacks = this.#progressEventCallbacks.filter((f) => f !== callback);\n        }\n    }\n    /**\n     * Loads ffmpeg-core inside web worker. It is required to call this method first\n     * as it initializes WebAssembly and other essential variables.\n     *\n     * @category FFmpeg\n     * @returns `true` if ffmpeg core is loaded for the first time.\n     */\n    load = ({ classWorkerURL, ...config } = {}, { signal } = {}) => {\n        if (!this.#worker) {\n            this.#worker = classWorkerURL ?\n                new Worker(new URL(classWorkerURL, import.meta.url), {\n                    type: \"module\",\n                }) :\n                // We need to duplicated the code here to enable webpack\n                // to bundle worekr.js here.\n                new Worker(new URL(\"./worker.js\", import.meta.url), {\n                    type: \"module\",\n                });\n            this.#registerHandlers();\n        }\n        return this.#send({\n            type: FFMessageType.LOAD,\n            data: config,\n        }, undefined, signal);\n    };\n    /**\n     * Execute ffmpeg command.\n     *\n     * @remarks\n     * To avoid common I/O issues, [\"-nostdin\", \"-y\"] are prepended to the args\n     * by default.\n     *\n     * @example\n     * ```ts\n     * const ffmpeg = new FFmpeg();\n     * await ffmpeg.load();\n     * await ffmpeg.writeFile(\"video.avi\", ...);\n     * // ffmpeg -i video.avi video.mp4\n     * await ffmpeg.exec([\"-i\", \"video.avi\", \"video.mp4\"]);\n     * const data = ffmpeg.readFile(\"video.mp4\");\n     * ```\n     *\n     * @returns `0` if no error, `!= 0` if timeout (1) or error.\n     * @category FFmpeg\n     */\n    exec = (\n    /** ffmpeg command line args */\n    args, \n    /**\n     * milliseconds to wait before stopping the command execution.\n     *\n     * @defaultValue -1\n     */\n    timeout = -1, { signal } = {}) => this.#send({\n        type: FFMessageType.EXEC,\n        data: { args, timeout },\n    }, undefined, signal);\n    /**\n     * Execute ffprobe command.\n     *\n     * @example\n     * ```ts\n     * const ffmpeg = new FFmpeg();\n     * await ffmpeg.load();\n     * await ffmpeg.writeFile(\"video.avi\", ...);\n     * // Getting duration of a video in seconds: ffprobe -v error -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 video.avi -o output.txt\n     * await ffmpeg.ffprobe([\"-v\", \"error\", \"-show_entries\", \"format=duration\", \"-of\", \"default=noprint_wrappers=1:nokey=1\", \"video.avi\", \"-o\", \"output.txt\"]);\n     * const data = ffmpeg.readFile(\"output.txt\");\n     * ```\n     *\n     * @returns `0` if no error, `!= 0` if timeout (1) or error.\n     * @category FFmpeg\n     */\n    ffprobe = (\n    /** ffprobe command line args */\n    args, \n    /**\n     * milliseconds to wait before stopping the command execution.\n     *\n     * @defaultValue -1\n     */\n    timeout = -1, { signal } = {}) => this.#send({\n        type: FFMessageType.FFPROBE,\n        data: { args, timeout },\n    }, undefined, signal);\n    /**\n     * Terminate all ongoing API calls and terminate web worker.\n     * `FFmpeg.load()` must be called again before calling any other APIs.\n     *\n     * @category FFmpeg\n     */\n    terminate = () => {\n        const ids = Object.keys(this.#rejects);\n        // rejects all incomplete Promises.\n        for (const id of ids) {\n            this.#rejects[id](ERROR_TERMINATED);\n            delete this.#rejects[id];\n            delete this.#resolves[id];\n        }\n        if (this.#worker) {\n            this.#worker.terminate();\n            this.#worker = null;\n            this.loaded = false;\n        }\n    };\n    /**\n     * Write data to ffmpeg.wasm.\n     *\n     * @example\n     * ```ts\n     * const ffmpeg = new FFmpeg();\n     * await ffmpeg.load();\n     * await ffmpeg.writeFile(\"video.avi\", await fetchFile(\"../video.avi\"));\n     * await ffmpeg.writeFile(\"text.txt\", \"hello world\");\n     * ```\n     *\n     * @category File System\n     */\n    writeFile = (path, data, { signal } = {}) => {\n        const trans = [];\n        if (data instanceof Uint8Array) {\n            trans.push(data.buffer);\n        }\n        return this.#send({\n            type: FFMessageType.WRITE_FILE,\n            data: { path, data },\n        }, trans, signal);\n    };\n    mount = (fsType, options, mountPoint) => {\n        const trans = [];\n        return this.#send({\n            type: FFMessageType.MOUNT,\n            data: { fsType, options, mountPoint },\n        }, trans);\n    };\n    unmount = (mountPoint) => {\n        const trans = [];\n        return this.#send({\n            type: FFMessageType.UNMOUNT,\n            data: { mountPoint },\n        }, trans);\n    };\n    /**\n     * Read data from ffmpeg.wasm.\n     *\n     * @example\n     * ```ts\n     * const ffmpeg = new FFmpeg();\n     * await ffmpeg.load();\n     * const data = await ffmpeg.readFile(\"video.mp4\");\n     * ```\n     *\n     * @category File System\n     */\n    readFile = (path, \n    /**\n     * File content encoding, supports two encodings:\n     * - utf8: read file as text file, return data in string type.\n     * - binary: read file as binary file, return data in Uint8Array type.\n     *\n     * @defaultValue binary\n     */\n    encoding = \"binary\", { signal } = {}) => this.#send({\n        type: FFMessageType.READ_FILE,\n        data: { path, encoding },\n    }, undefined, signal);\n    /**\n     * Delete a file.\n     *\n     * @category File System\n     */\n    deleteFile = (path, { signal } = {}) => this.#send({\n        type: FFMessageType.DELETE_FILE,\n        data: { path },\n    }, undefined, signal);\n    /**\n     * Rename a file or directory.\n     *\n     * @category File System\n     */\n    rename = (oldPath, newPath, { signal } = {}) => this.#send({\n        type: FFMessageType.RENAME,\n        data: { oldPath, newPath },\n    }, undefined, signal);\n    /**\n     * Create a directory.\n     *\n     * @category File System\n     */\n    createDir = (path, { signal } = {}) => this.#send({\n        type: FFMessageType.CREATE_DIR,\n        data: { path },\n    }, undefined, signal);\n    /**\n     * List directory contents.\n     *\n     * @category File System\n     */\n    listDir = (path, { signal } = {}) => this.#send({\n        type: FFMessageType.LIST_DIR,\n        data: { path },\n    }, undefined, signal);\n    /**\n     * Delete an empty directory.\n     *\n     * @category File System\n     */\n    deleteDir = (path, { signal } = {}) => this.#send({\n        type: FFMessageType.DELETE_DIR,\n        data: { path },\n    }, undefined, signal);\n}\n","export var FFFSType;\n(function (FFFSType) {\n    FFFSType[\"MEMFS\"] = \"MEMFS\";\n    FFFSType[\"NODEFS\"] = \"NODEFS\";\n    FFFSType[\"NODERAWFS\"] = \"NODERAWFS\";\n    FFFSType[\"IDBFS\"] = \"IDBFS\";\n    FFFSType[\"WORKERFS\"] = \"WORKERFS\";\n    FFFSType[\"PROXYFS\"] = \"PROXYFS\";\n})(FFFSType || (FFFSType = {}));\n","import { ERROR_RESPONSE_BODY_READER, ERROR_INCOMPLETED_DOWNLOAD, } from \"./errors.js\";\nimport { HeaderContentLength } from \"./const.js\";\nconst readFromBlobOrFile = (blob) => new Promise((resolve, reject) => {\n    const fileReader = new FileReader();\n    fileReader.onload = () => {\n        const { result } = fileReader;\n        if (result instanceof ArrayBuffer) {\n            resolve(new Uint8Array(result));\n        }\n        else {\n            resolve(new Uint8Array());\n        }\n    };\n    fileReader.onerror = (event) => {\n        reject(Error(`File could not be read! Code=${event?.target?.error?.code || -1}`));\n    };\n    fileReader.readAsArrayBuffer(blob);\n});\n/**\n * An util function to fetch data from url string, base64, URL, File or Blob format.\n *\n * Examples:\n * ```ts\n * // URL\n * await fetchFile(\"http://localhost:3000/video.mp4\");\n * // base64\n * await fetchFile(\"data:<type>;base64,wL2dvYWwgbW9yZ...\");\n * // URL\n * await fetchFile(new URL(\"video.mp4\", import.meta.url));\n * // File\n * fileInput.addEventListener('change', (e) => {\n *   await fetchFile(e.target.files[0]);\n * });\n * // Blob\n * const blob = new Blob(...);\n * await fetchFile(blob);\n * ```\n */\nexport const fetchFile = async (file) => {\n    let data;\n    if (typeof file === \"string\") {\n        /* From base64 format */\n        if (/data:_data\\/([a-zA-Z]*);base64,([^\"]*)/.test(file)) {\n            data = atob(file.split(\",\")[1])\n                .split(\"\")\n                .map((c) => c.charCodeAt(0));\n            /* From remote server/URL */\n        }\n        else {\n            data = await (await fetch(file)).arrayBuffer();\n        }\n    }\n    else if (file instanceof URL) {\n        data = await (await fetch(file)).arrayBuffer();\n    }\n    else if (file instanceof File || file instanceof Blob) {\n        data = await readFromBlobOrFile(file);\n    }\n    else {\n        return new Uint8Array();\n    }\n    return new Uint8Array(data);\n};\n/**\n * importScript dynamically import a script, useful when you\n * want to use different versions of ffmpeg.wasm based on environment.\n *\n * Example:\n *\n * ```ts\n * await importScript(\"http://localhost:3000/ffmpeg.js\");\n * ```\n */\nexport const importScript = async (url) => new Promise((resolve) => {\n    const script = document.createElement(\"script\");\n    const eventHandler = () => {\n        script.removeEventListener(\"load\", eventHandler);\n        resolve();\n    };\n    script.src = url;\n    script.type = \"text/javascript\";\n    script.addEventListener(\"load\", eventHandler);\n    document.getElementsByTagName(\"head\")[0].appendChild(script);\n});\n/**\n * Download content of a URL with progress.\n *\n * Progress only works when Content-Length is provided by the server.\n *\n */\nexport const downloadWithProgress = async (url, cb) => {\n    const resp = await fetch(url);\n    let buf;\n    try {\n        // Set total to -1 to indicate that there is not Content-Type Header.\n        const total = parseInt(resp.headers.get(HeaderContentLength) || \"-1\");\n        const reader = resp.body?.getReader();\n        if (!reader)\n            throw ERROR_RESPONSE_BODY_READER;\n        const chunks = [];\n        let received = 0;\n        for (;;) {\n            const { done, value } = await reader.read();\n            const delta = value ? value.length : 0;\n            if (done) {\n                if (total != -1 && total !== received)\n                    throw ERROR_INCOMPLETED_DOWNLOAD;\n                cb && cb({ url, total, received, delta, done });\n                break;\n            }\n            chunks.push(value);\n            received += delta;\n            cb && cb({ url, total, received, delta, done });\n        }\n        const data = new Uint8Array(received);\n        let position = 0;\n        for (const chunk of chunks) {\n            data.set(chunk, position);\n            position += chunk.length;\n        }\n        buf = data.buffer;\n    }\n    catch (e) {\n        console.log(`failed to send download progress event: `, e);\n        // Fetch arrayBuffer directly when it is not possible to get progress.\n        buf = await resp.arrayBuffer();\n        cb &&\n            cb({\n                url,\n                total: buf.byteLength,\n                received: buf.byteLength,\n                delta: 0,\n                done: true,\n            });\n    }\n    return buf;\n};\n/**\n * toBlobURL fetches data from an URL and return a blob URL.\n *\n * Example:\n *\n * ```ts\n * await toBlobURL(\"http://localhost:3000/ffmpeg.js\", \"text/javascript\");\n * ```\n */\nexport const toBlobURL = async (url, mimeType, progress = false, cb) => {\n    const buf = progress\n        ? await downloadWithProgress(url, cb)\n        : await (await fetch(url)).arrayBuffer();\n    const blob = new Blob([buf], { type: mimeType });\n    return URL.createObjectURL(blob);\n};\n","// Servicio para procesamiento de video usando FFmpeg.wasm\r\nimport { FFmpeg } from '@ffmpeg/ffmpeg'\r\nimport { fetchFile } from '@ffmpeg/util'\r\n\r\nlet ffmpeg = null\r\n\r\n// Inicializar FFmpeg\r\nexport const initFFmpeg = async () => {\r\n  if (ffmpeg && ffmpeg.FS) {\r\n    console.log('✅ FFmpeg ya inicializado, reutilizando instancia')\r\n    return ffmpeg\r\n  }\r\n  \r\n  console.log('🎬 Inicializando FFmpeg...')\r\n  ffmpeg = new FFmpeg()\r\n  \r\n  try {\r\n    await ffmpeg.load()\r\n    console.log('✅ FFmpeg inicializado correctamente')\r\n    return ffmpeg\r\n  } catch (error) {\r\n    console.error('❌ Error al inicializar FFmpeg:', error)\r\n    ffmpeg = null\r\n    throw new Error('No se pudo inicializar FFmpeg')\r\n  }\r\n}\r\n\r\n// Ajustar velocidad de un video\r\nexport const adjustVideoSpeed = async (videoFile, speedFactor, outputName = 'output.mp4') => {\r\n  try {\r\n    console.log(`🎬 Ajustando velocidad del video: factor ${speedFactor}`)\r\n    \r\n    const ffmpegInstance = await initFFmpeg()\r\n    \r\n    // Verificar que FFmpeg esté correctamente inicializado\r\n    if (!ffmpegInstance || !ffmpegInstance.FS) {\r\n      throw new Error('FFmpeg no está correctamente inicializado')\r\n    }\r\n    \r\n    // Escribir archivo de entrada\r\n    ffmpegInstance.FS('writeFile', 'input.mp4', await fetchFile(videoFile))\r\n    \r\n    // Intentar primero con audio, si falla, procesar solo video\r\n    try {\r\n      // Ajustar velocidad manteniendo pitch del audio\r\n      await ffmpegInstance.run(\r\n        '-i', 'input.mp4',\r\n        '-filter:v', `setpts=${1/speedFactor}*PTS`,\r\n        '-filter:a', `atempo=${speedFactor}`,\r\n        '-c:v', 'libx264',\r\n        '-c:a', 'aac',\r\n        '-preset', 'fast',\r\n        outputName\r\n      )\r\n    } catch (audioError) {\r\n      console.log('⚠️ Error con audio, procesando solo video:', audioError.message)\r\n      \r\n      // Procesar solo video sin audio\r\n      await ffmpegInstance.run(\r\n        '-i', 'input.mp4',\r\n        '-filter:v', `setpts=${1/speedFactor}*PTS`,\r\n        '-c:v', 'libx264',\r\n        '-an', // Sin audio\r\n        '-preset', 'fast',\r\n        outputName\r\n      )\r\n    }\r\n    \r\n    // Leer archivo de salida\r\n    const data = ffmpegInstance.FS('readFile', outputName)\r\n    \r\n    // Limpiar archivos temporales\r\n    try {\r\n      ffmpegInstance.FS('unlink', 'input.mp4')\r\n      ffmpegInstance.FS('unlink', outputName)\r\n    } catch (e) {\r\n      console.warn('⚠️ No se pudieron limpiar archivos temporales')\r\n    }\r\n    \r\n    console.log('✅ Velocidad ajustada correctamente')\r\n    \r\n    return {\r\n      success: true,\r\n      data: data,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error al ajustar velocidad:', error)\r\n    return {\r\n      success: false,\r\n      data: null,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Concatenar múltiples videos\r\nexport const concatenateVideos = async (videoFiles, outputName = 'concatenated.mp4') => {\r\n  try {\r\n    console.log(`🎬 Concatenando ${videoFiles.length} videos...`)\r\n    \r\n    const ffmpegInstance = await initFFmpeg()\r\n    \r\n    // Verificar que FFmpeg esté correctamente inicializado\r\n    if (!ffmpegInstance || !ffmpegInstance.FS) {\r\n      throw new Error('FFmpeg no está correctamente inicializado')\r\n    }\r\n    \r\n    // Escribir archivos de entrada\r\n    for (let i = 0; i < videoFiles.length; i++) {\r\n      const fileName = `input${i}.mp4`\r\n      ffmpegInstance.FS('writeFile', fileName, await fetchFile(videoFiles[i]))\r\n    }\r\n    \r\n    // Crear archivo de lista para concatenación\r\n    const fileList = videoFiles.map((_, i) => `file input${i}.mp4`).join('\\n')\r\n    ffmpegInstance.FS('writeFile', 'filelist.txt', fileList)\r\n    \r\n    // Concatenar videos\r\n    await ffmpegInstance.run(\r\n      '-f', 'concat',\r\n      '-safe', '0',\r\n      '-i', 'filelist.txt',\r\n      '-c', 'copy',\r\n      outputName\r\n    )\r\n    \r\n    // Leer archivo de salida\r\n    const data = ffmpegInstance.FS('readFile', outputName)\r\n    \r\n    // Limpiar archivos temporales\r\n    for (let i = 0; i < videoFiles.length; i++) {\r\n      ffmpegInstance.FS('unlink', `input${i}.mp4`)\r\n    }\r\n    ffmpegInstance.FS('unlink', 'filelist.txt')\r\n    ffmpegInstance.FS('unlink', outputName)\r\n    \r\n    console.log('✅ Videos concatenados correctamente')\r\n    \r\n    return {\r\n      success: true,\r\n      data: data,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error al concatenar videos:', error)\r\n    return {\r\n      success: false,\r\n      data: null,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Procesar secuencia completa con ajuste de BPM\r\nexport const processVideoSequence = async (videos, targetBPM) => {\r\n  try {\r\n    console.log(`🎬 Procesando secuencia de ${videos.length} videos a ${targetBPM} BPM...`)\r\n    \r\n    const ffmpegInstance = await initFFmpeg()\r\n    const processedVideos = []\r\n    \r\n         // Procesar cada video individualmente\r\n     for (let i = 0; i < videos.length; i++) {\r\n       const video = videos[i]\r\n       const speedFactor = targetBPM / video.bpm\r\n       \r\n               console.log(`🎬 Procesando video ${i + 1}/${videos.length}: ${video.title} (BPM: ${video.bpm} → ${targetBPM}, factor: ${speedFactor.toFixed(2)}x)`)\r\n        \r\n        // Descargar video desde Firebase Storage si no tiene file\r\n        let videoBlob\r\n        if (video.file) {\r\n          videoBlob = video.file\r\n        } else if (video.videoUrl) {\r\n          console.log(`📥 Descargando video ${i + 1}/${videos.length} desde URL: ${video.videoUrl}`)\r\n          \r\n          try {\r\n            // Intentar descarga directa primero\r\n            const response = await fetch(video.videoUrl, {\r\n              mode: 'cors',\r\n              credentials: 'omit'\r\n            })\r\n            \r\n            if (!response.ok) {\r\n              throw new Error(`HTTP ${response.status}: ${response.statusText}`)\r\n            }\r\n            \r\n            videoBlob = await response.blob()\r\n            console.log(`✅ Video descargado exitosamente: ${videoBlob.size} bytes`)\r\n          } catch (fetchError) {\r\n            console.warn(`⚠️ Error en fetch directo: ${fetchError.message}`)\r\n            \r\n            // Si falla, intentar con Firebase Storage SDK\r\n            try {\r\n              const { getStorage, ref, getDownloadURL } = await import('firebase/storage')\r\n              const storage = getStorage()\r\n              \r\n              // Si videoUrl es una URL completa, extraer la ruta\r\n              let storagePath = video.videoUrl\r\n              if (video.videoUrl.includes('firebasestorage.googleapis.com')) {\r\n                // Extraer la ruta del bucket de la URL\r\n                const urlParts = video.videoUrl.split('/o/')\r\n                if (urlParts.length > 1) {\r\n                  storagePath = decodeURIComponent(urlParts[1].split('?')[0])\r\n                }\r\n              }\r\n              \r\n              const videoRef = ref(storage, storagePath)\r\n              const downloadURL = await getDownloadURL(videoRef)\r\n              \r\n              const response = await fetch(downloadURL)\r\n              if (!response.ok) {\r\n                throw new Error(`HTTP ${response.status}: ${response.statusText}`)\r\n              }\r\n              \r\n              videoBlob = await response.blob()\r\n              console.log(`✅ Video descargado via Firebase SDK: ${videoBlob.size} bytes`)\r\n            } catch (storageError) {\r\n              throw new Error(`Error descargando video ${i + 1} (${video.title}): ${storageError.message}`)\r\n            }\r\n          }\r\n        } else {\r\n          throw new Error(`Video ${i + 1} (${video.title}) no tiene archivo ni URL asociada`)\r\n        }\r\n        \r\n        // Ajustar velocidad del video\r\n       const result = await adjustVideoSpeed(videoBlob, speedFactor, `adjusted${i}.mp4`)\r\n       \r\n       if (!result.success) {\r\n         throw new Error(`Error al procesar video ${i + 1} (${video.title}): ${result.error}`)\r\n       }\r\n       \r\n       processedVideos.push(result.data)\r\n       console.log(`✅ Video ${i + 1} procesado correctamente`)\r\n     }\r\n    \r\n    // Concatenar todos los videos ajustados\r\n    console.log('🎬 Concatenando videos procesados...')\r\n    \r\n    // Escribir videos procesados\r\n    for (let i = 0; i < processedVideos.length; i++) {\r\n      ffmpegInstance.FS('writeFile', `processed${i}.mp4`, processedVideos[i])\r\n    }\r\n    \r\n    // Crear archivo de lista\r\n    const fileList = processedVideos.map((_, i) => `file processed${i}.mp4`).join('\\n')\r\n    ffmpegInstance.FS('writeFile', 'filelist.txt', fileList)\r\n    \r\n    // Concatenar\r\n    await ffmpegInstance.run(\r\n      '-f', 'concat',\r\n      '-safe', '0',\r\n      '-i', 'filelist.txt',\r\n      '-c', 'copy',\r\n      'final_sequence.mp4'\r\n    )\r\n    \r\n    // Leer resultado final\r\n    const finalData = ffmpegInstance.FS('readFile', 'final_sequence.mp4')\r\n    \r\n    // Limpiar archivos temporales\r\n    for (let i = 0; i < processedVideos.length; i++) {\r\n      try {\r\n        ffmpegInstance.FS('unlink', `processed${i}.mp4`)\r\n      } catch (e) {\r\n        console.warn(`⚠️ No se pudo limpiar archivo temporal processed${i}.mp4`)\r\n      }\r\n    }\r\n    try {\r\n      ffmpegInstance.FS('unlink', 'filelist.txt')\r\n      ffmpegInstance.FS('unlink', 'final_sequence.mp4')\r\n    } catch (e) {\r\n      console.warn('⚠️ No se pudieron limpiar algunos archivos temporales')\r\n    }\r\n    \r\n    console.log('✅ Secuencia procesada correctamente')\r\n    \r\n    return {\r\n      success: true,\r\n      data: finalData,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error al procesar secuencia:', error)\r\n    return {\r\n      success: false,\r\n      data: null,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Crear preview de secuencia (con o sin ajuste de BPM)\r\nexport const createSequencePreview = async (videos, useBPMControl = false, targetBPM = null) => {\r\n  try {\r\n    console.log(`🎬 Creando preview de secuencia con ${videos.length} videos...`)\r\n    console.log(`🎬 Control BPM: ${useBPMControl ? 'Activado' : 'Desactivado'}`)\r\n    if (useBPMControl && targetBPM) {\r\n      console.log(`🎬 BPM objetivo: ${targetBPM}`)\r\n    }\r\n    \r\n    const ffmpegInstance = await initFFmpeg()\r\n    const processedVideos = []\r\n    \r\n    // Optimización: Si no hay control BPM, procesar más rápido\r\n    const needsProcessing = useBPMControl && targetBPM\r\n    \r\n    // Procesar cada video según el estado del control BPM\r\n    for (let i = 0; i < videos.length; i++) {\r\n      const video = videos[i]\r\n      \r\n      // Descargar video desde Firebase Storage si no tiene file\r\n      let videoBlob\r\n      if (video.file) {\r\n        videoBlob = video.file\r\n        console.log(`✅ Video ${i + 1}/${videos.length}: ${video.title} (archivo local)`)\r\n      } else if (video.videoUrl) {\r\n        console.log(`📥 Descargando video ${i + 1}/${videos.length} desde URL...`)\r\n        \r\n        try {\r\n          // Intentar descarga directa primero\r\n          const response = await fetch(video.videoUrl, {\r\n            mode: 'cors',\r\n            credentials: 'omit',\r\n            headers: {\r\n              'Accept': 'video/*,*/*;q=0.9',\r\n              'Cache-Control': 'no-cache'\r\n            }\r\n          })\r\n          \r\n          if (!response.ok) {\r\n            throw new Error(`HTTP ${response.status}: ${response.statusText}`)\r\n          }\r\n          \r\n          videoBlob = await response.blob()\r\n          console.log(`✅ Video ${i + 1}/${videos.length}: ${video.title} descargado (${videoBlob.size} bytes)`)\r\n        } catch (fetchError) {\r\n          console.warn(`⚠️ Error en fetch directo: ${fetchError.message}`)\r\n          \r\n          // Si falla, intentar con Firebase Storage SDK\r\n          try {\r\n            const { getStorage, ref, getDownloadURL } = await import('firebase/storage')\r\n            const storage = getStorage()\r\n            \r\n            // Si videoUrl es una URL completa, extraer la ruta\r\n            let storagePath = video.videoUrl\r\n            if (video.videoUrl.includes('firebasestorage.googleapis.com')) {\r\n              // Extraer la ruta del bucket de la URL\r\n              const urlParts = video.videoUrl.split('/o/')\r\n              if (urlParts.length > 1) {\r\n                storagePath = decodeURIComponent(urlParts[1].split('?')[0])\r\n              }\r\n            }\r\n            \r\n            const videoRef = ref(storage, storagePath)\r\n            const downloadURL = await getDownloadURL(videoRef)\r\n            \r\n            const response = await fetch(downloadURL)\r\n            if (!response.ok) {\r\n              throw new Error(`HTTP ${response.status}: ${response.statusText}`)\r\n            }\r\n            \r\n            videoBlob = await response.blob()\r\n            console.log(`✅ Video ${i + 1}/${videos.length}: ${video.title} descargado via Firebase (${videoBlob.size} bytes)`)\r\n          } catch (storageError) {\r\n            throw new Error(`Error descargando video ${i + 1} (${video.title}): ${storageError.message}`)\r\n          }\r\n        }\r\n      } else {\r\n        throw new Error(`Video ${i + 1} (${video.title}) no tiene archivo ni URL asociada`)\r\n      }\r\n      \r\n      if (needsProcessing && video.bpm) {\r\n        // Ajustar velocidad según BPM\r\n        const speedFactor = targetBPM / video.bpm\r\n        console.log(`🎬 Procesando video ${i + 1}/${videos.length}: ${video.title} (BPM: ${video.bpm} → ${targetBPM}, factor: ${speedFactor.toFixed(2)}x)`)\r\n        \r\n        const result = await adjustVideoSpeed(videoBlob, speedFactor, `preview${i}.mp4`)\r\n        if (!result.success) {\r\n          throw new Error(`Error al procesar video ${i + 1} (${video.title}): ${result.error}`)\r\n        }\r\n        processedVideos.push(result.data)\r\n      } else {\r\n        // Usar video original sin ajuste (más rápido)\r\n        console.log(`🎬 Usando video ${i + 1}/${videos.length}: ${video.title} (sin procesamiento)`)\r\n        processedVideos.push(videoBlob)\r\n      }\r\n    }\r\n    \r\n         // Concatenar videos\r\n     console.log('🎬 Concatenando videos para preview...')\r\n     \r\n     // Escribir videos procesados\r\n     for (let i = 0; i < processedVideos.length; i++) {\r\n       const videoData = processedVideos[i]\r\n       // Si es un blob, convertirlo a Uint8Array, si ya es Uint8Array, usarlo directamente\r\n       const dataToWrite = videoData instanceof Blob ? await fetchFile(videoData) : videoData\r\n       ffmpegInstance.FS('writeFile', `preview${i}.mp4`, dataToWrite)\r\n       console.log(`📝 Video ${i + 1}/${processedVideos.length} escrito al sistema de archivos`)\r\n     }\r\n     \r\n     // Crear archivo de lista\r\n     const fileList = processedVideos.map((_, i) => `file preview${i}.mp4`).join('\\n')\r\n     ffmpegInstance.FS('writeFile', 'filelist.txt', fileList)\r\n     console.log('📋 Lista de archivos creada')\r\n     \r\n     // Concatenar (optimizado para velocidad)\r\n     console.log('🔗 Iniciando concatenación...')\r\n     await ffmpegInstance.run(\r\n       '-f', 'concat',\r\n       '-safe', '0',\r\n       '-i', 'filelist.txt',\r\n       '-c', 'copy',\r\n       '-avoid_negative_ts', 'make_zero',\r\n       'sequence_preview.mp4'\r\n     )\r\n     console.log('✅ Concatenación completada')\r\n    \r\n    // Leer resultado final\r\n    const finalData = ffmpegInstance.FS('readFile', 'sequence_preview.mp4')\r\n    \r\n    // Limpiar archivos temporales\r\n    for (let i = 0; i < processedVideos.length; i++) {\r\n      try {\r\n        ffmpegInstance.FS('unlink', `preview${i}.mp4`)\r\n      } catch (e) {\r\n        console.warn(`⚠️ No se pudo limpiar archivo temporal preview${i}.mp4`)\r\n      }\r\n    }\r\n    try {\r\n      ffmpegInstance.FS('unlink', 'filelist.txt')\r\n      ffmpegInstance.FS('unlink', 'sequence_preview.mp4')\r\n    } catch (e) {\r\n      console.warn('⚠️ No se pudieron limpiar algunos archivos temporales')\r\n    }\r\n    \r\n    console.log('✅ Preview de secuencia creado correctamente')\r\n    \r\n    return {\r\n      success: true,\r\n      data: finalData,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error al crear preview de secuencia:', error)\r\n    return {\r\n      success: false,\r\n      data: null,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Convertir video a diferentes formatos y resoluciones\r\nexport const convertVideoFormat = async (videoFile, format = 'mp4', resolution = '720p') => {\r\n  try {\r\n    console.log(`🎬 Convirtiendo video a formato ${format} con resolución ${resolution}...`)\r\n    \r\n    const ffmpegInstance = await initFFmpeg()\r\n    \r\n    // Escribir archivo de entrada\r\n    ffmpegInstance.FS('writeFile', 'input.mp4', await fetchFile(videoFile))\r\n    \r\n    // Configurar resolución y calidad\r\n    let resolutionSettings = []\r\n    let qualitySettings = []\r\n    \r\n    // Configurar resolución\r\n    switch (resolution) {\r\n      case '360p':\r\n        resolutionSettings = ['-vf', 'scale=-1:360']\r\n        qualitySettings = ['-crf', '28', '-preset', 'ultrafast']\r\n        break\r\n      case '480p':\r\n        resolutionSettings = ['-vf', 'scale=-1:480']\r\n        qualitySettings = ['-crf', '25', '-preset', 'fast']\r\n        break\r\n      case '720p':\r\n        resolutionSettings = ['-vf', 'scale=-1:720']\r\n        qualitySettings = ['-crf', '23', '-preset', 'fast']\r\n        break\r\n      case '1080p':\r\n        resolutionSettings = ['-vf', 'scale=-1:1080']\r\n        qualitySettings = ['-crf', '20', '-preset', 'medium']\r\n        break\r\n      case '4k':\r\n        resolutionSettings = ['-vf', 'scale=-1:2160']\r\n        qualitySettings = ['-crf', '18', '-preset', 'medium']\r\n        break\r\n      default:\r\n        resolutionSettings = ['-vf', 'scale=-1:720']\r\n        qualitySettings = ['-crf', '23', '-preset', 'fast']\r\n    }\r\n    \r\n    // Convertir formato\r\n    await ffmpegInstance.run(\r\n      '-i', 'input.mp4',\r\n      ...resolutionSettings,\r\n      ...qualitySettings,\r\n      `output.${format}`\r\n    )\r\n    \r\n    // Leer archivo de salida\r\n    const data = ffmpegInstance.FS('readFile', `output.${format}`)\r\n    \r\n    // Limpiar archivos temporales\r\n    ffmpegInstance.FS('unlink', 'input.mp4')\r\n    ffmpegInstance.FS('unlink', `output.${format}`)\r\n    \r\n    console.log('✅ Video convertido correctamente')\r\n    \r\n    return {\r\n      success: true,\r\n      data: data,\r\n      format: format,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error al convertir video:', error)\r\n    return {\r\n      success: false,\r\n      data: null,\r\n      format: null,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Descarga directa de secuencia sin FFmpeg (más rápida)\r\nexport const downloadSequenceDirect = async (sequence) => {\r\n  try {\r\n    console.log(`📥 Descarga directa de secuencia: ${sequence.name}`)\r\n    \r\n    if (!sequence.videos || sequence.videos.length === 0) {\r\n      throw new Error('La secuencia no tiene videos')\r\n    }\r\n    \r\n    // Si solo hay un video, descargarlo directamente\r\n    if (sequence.videos.length === 1) {\r\n      const video = sequence.videos[0]\r\n      if (video.file) {\r\n        return {\r\n          success: true,\r\n          data: video.file,\r\n          format: 'mp4',\r\n          error: null\r\n        }\r\n      } else if (video.videoUrl) {\r\n        const response = await fetch(video.videoUrl)\r\n        if (!response.ok) throw new Error('Error descargando video')\r\n        const blob = await response.blob()\r\n        return {\r\n          success: true,\r\n          data: blob,\r\n          format: 'mp4',\r\n          error: null\r\n        }\r\n      }\r\n    }\r\n    \r\n         // Para múltiples videos, crear un archivo ZIP con todos los videos\r\n     const JSZip = await import('jszip')\r\n     const zip = new JSZip.default()\r\n     \r\n     // Obtener nombre base de la secuencia (limpio para nombres de archivo)\r\n     const sequenceName = (sequence.name || sequence.title || 'secuencia')\r\n       .replace(/[^a-zA-Z0-9\\s]/g, '') // Remover caracteres especiales\r\n       .replace(/\\s+/g, '_') // Reemplazar espacios con guiones bajos\r\n       .toLowerCase()\r\n     \r\n     for (let i = 0; i < sequence.videos.length; i++) {\r\n       const video = sequence.videos[i]\r\n       let videoBlob\r\n       \r\n       if (video.file) {\r\n         videoBlob = video.file\r\n       } else if (video.videoUrl) {\r\n         const response = await fetch(video.videoUrl)\r\n         if (!response.ok) throw new Error(`Error descargando video ${i + 1}`)\r\n         videoBlob = await response.blob()\r\n       } else {\r\n         throw new Error(`Video ${i + 1} no tiene archivo ni URL`)\r\n       }\r\n       \r\n       // Nombrar archivo con formato: secuencia_1.mp4, secuencia_2.mp4, etc.\r\n       const fileName = `${sequenceName}_${i + 1}.mp4`\r\n       zip.file(fileName, videoBlob)\r\n       console.log(`📁 Agregando al ZIP: ${fileName}`)\r\n     }\r\n    \r\n    const zipBlob = await zip.generateAsync({ type: 'blob' })\r\n    return {\r\n      success: true,\r\n      data: zipBlob,\r\n      format: 'zip',\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error en descarga directa:', error)\r\n    return {\r\n      success: false,\r\n      data: null,\r\n      format: null,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\n// Generar video final de secuencia para descarga\r\nexport const generateSequenceVideo = async (sequence, format = 'mp4', resolution = '720p') => {\r\n  try {\r\n    console.log(`🎬 Generando video de secuencia: ${sequence.name}`)\r\n    console.log(`📹 Formato: ${format}, Resolución: ${resolution}`)\r\n    \r\n    if (!sequence.videos || sequence.videos.length === 0) {\r\n      throw new Error('La secuencia no tiene videos')\r\n    }\r\n    \r\n    // Usar la configuración de BPM guardada en la secuencia\r\n    const useBPMControl = sequence.useBPMControl || false\r\n    const targetBPM = sequence.targetBPM || null\r\n    \r\n    console.log(`🎵 Configuración BPM: ${useBPMControl ? 'Activado' : 'Desactivado'}, BPM: ${targetBPM}`)\r\n    \r\n    // Si no hay control BPM, usar descarga directa (más rápida)\r\n    if (!useBPMControl || !targetBPM) {\r\n      console.log('🚀 Usando descarga directa (sin FFmpeg)')\r\n      return await downloadSequenceDirect(sequence)\r\n    }\r\n    \r\n    // Intentar inicializar FFmpeg con timeout\r\n    console.log('🎬 Intentando inicializar FFmpeg...')\r\n    const ffmpegPromise = initFFmpeg()\r\n    const timeoutPromise = new Promise((_, reject) => \r\n      setTimeout(() => reject(new Error('Timeout inicializando FFmpeg')), 10000)\r\n    )\r\n    \r\n    try {\r\n      await Promise.race([ffmpegPromise, timeoutPromise])\r\n    } catch (error) {\r\n      console.warn('⚠️ FFmpeg no pudo inicializarse, usando descarga directa')\r\n      return await downloadSequenceDirect(sequence)\r\n    }\r\n    \r\n    // Generar el video combinado con FFmpeg\r\n    const result = await createSequencePreview(sequence.videos, useBPMControl, targetBPM)\r\n    \r\n    if (!result.success) {\r\n      throw new Error(`Error generando video: ${result.error}`)\r\n    }\r\n    \r\n    // Si se requiere un formato específico o resolución diferente, convertir\r\n    if (format !== 'mp4' || resolution !== '720p') {\r\n      console.log(`🔄 Convirtiendo a formato ${format} con resolución ${resolution}...`)\r\n      const convertResult = await convertVideoFormat(\r\n        new Blob([result.data], { type: 'video/mp4' }), \r\n        format, \r\n        resolution\r\n      )\r\n      \r\n      if (!convertResult.success) {\r\n        throw new Error(`Error convirtiendo formato: ${convertResult.error}`)\r\n      }\r\n      \r\n      return {\r\n        success: true,\r\n        data: convertResult.data,\r\n        format: format,\r\n        error: null\r\n      }\r\n    }\r\n    \r\n    return {\r\n      success: true,\r\n      data: result.data,\r\n      format: 'mp4',\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error generando video de secuencia:', error)\r\n    return {\r\n      success: false,\r\n      data: null,\r\n      format: null,\r\n      error: error.message\r\n    }\r\n  }\r\n} ","import React, { useState } from 'react'\r\nimport { X, Download, Video, Settings, Check } from 'lucide-react'\r\nimport { convertVideoFormat, generateSequenceVideo } from '../../services/video/videoProcessor'\r\n\r\nconst DownloadModal = ({ isOpen, onClose, video, onDownloadComplete }) => {\r\n  const [format, setFormat] = useState('mp4')\r\n  const [resolution, setResolution] = useState('720p')\r\n  const [isProcessing, setIsProcessing] = useState(false)\r\n  const [progress, setProgress] = useState(0)\r\n  \r\n  // Opciones de formato\r\n  const formatOptions = [\r\n    { value: 'mp4', label: 'MP4', description: 'Formato estándar, compatible con todo' },\r\n    { value: 'avi', label: 'AVI', description: 'Formato clásico, buena calidad' },\r\n    { value: 'mov', label: 'MOV', description: 'Formato Apple, alta calidad' },\r\n    { value: 'webm', label: 'WebM', description: 'Formato web, archivos pequeños' }\r\n  ]\r\n  \r\n  // Opciones de resolución\r\n  const resolutionOptions = [\r\n    { value: '360p', label: '360p', description: 'Calidad baja, archivo pequeño' },\r\n    { value: '480p', label: '480p', description: 'Calidad estándar, balance' },\r\n    { value: '720p', label: '720p', description: 'HD, buena calidad' },\r\n    { value: '1080p', label: '1080p', description: 'Full HD, alta calidad' },\r\n    { value: '4k', label: '4K', description: 'Ultra HD, máxima calidad' }\r\n  ]\r\n  \r\n  // Obtener descripción del formato\r\n  const getFormatDescription = (formatValue) => {\r\n    const option = formatOptions.find(opt => opt.value === formatValue)\r\n    return option ? option.description : ''\r\n  }\r\n  \r\n  // Obtener descripción de la resolución\r\n  const getResolutionDescription = (resolutionValue) => {\r\n    const option = resolutionOptions.find(opt => opt.value === resolutionValue)\r\n    return option ? option.description : ''\r\n  }\r\n  \r\n  // Manejar descarga\r\n  const handleDownload = async () => {\r\n    if (!video) {\r\n      console.error('No hay video para descargar')\r\n      return\r\n    }\r\n    \r\n    setIsProcessing(true)\r\n    setProgress(0)\r\n    \r\n         try {\r\n       console.log(`🎬 Iniciando descarga: ${format}, resolución: ${resolution}`)\r\n      \r\n      // Simular progreso\r\n      const progressInterval = setInterval(() => {\r\n        setProgress(prev => {\r\n          if (prev >= 90) {\r\n            clearInterval(progressInterval)\r\n            return 90\r\n          }\r\n          return prev + 10\r\n        })\r\n      }, 500)\r\n      \r\n      let result\r\n      \r\n      try {\r\n        // Verificar si es una secuencia o un video individual\r\n        if (video.videos && Array.isArray(video.videos)) {\r\n          // Es una secuencia\r\n          console.log('🎬 Procesando secuencia...')\r\n          result = await generateSequenceVideo(video, format, resolution)\r\n        } else if (video.file) {\r\n          // Es un video individual\r\n          console.log('🎬 Procesando video individual...')\r\n          result = await convertVideoFormat(video.file, format, resolution)\r\n        } else {\r\n          throw new Error('Formato de video no válido')\r\n        }\r\n        \r\n        // Limpiar intervalo y establecer progreso al 100%\r\n        clearInterval(progressInterval)\r\n        setProgress(100)\r\n        \r\n        // Pequeña pausa para mostrar el 100%\r\n        await new Promise(resolve => setTimeout(resolve, 200))\r\n      } catch (error) {\r\n        clearInterval(progressInterval)\r\n        throw error\r\n      }\r\n      \r\n                          if (result.success) {\r\n          // Crear blob y descargar\r\n          const mimeType = result.format === 'zip' ? 'application/zip' : `video/${result.format || format}`\r\n          const blob = new Blob([result.data], { type: mimeType })\r\n          \r\n          try {\r\n            const dirHandle = await selectDownloadFolder()\r\n            \r\n            if (dirHandle) {\r\n              // Usar File System Access API\r\n              const extension = result.format === 'zip' ? 'zip' : (result.format || format)\r\n              const fileName = `${video.title || video.name}_${resolution}.${extension}`\r\n              const fileHandle = await dirHandle.getFileHandle(fileName, { create: true })\r\n              const writable = await fileHandle.createWritable()\r\n              await writable.write(blob)\r\n              await writable.close()\r\n              console.log('✅ Archivo guardado en carpeta seleccionada')\r\n            } else {\r\n              // Descarga normal\r\n              const url = URL.createObjectURL(blob)\r\n              const a = document.createElement('a')\r\n              a.href = url\r\n              const extension = result.format === 'zip' ? 'zip' : (result.format || format)\r\n              a.download = `${video.title || video.name}_${resolution}.${extension}`\r\n              document.body.appendChild(a)\r\n              a.click()\r\n              document.body.removeChild(a)\r\n              URL.revokeObjectURL(url)\r\n              console.log('✅ Archivo descargado correctamente')\r\n            }\r\n            \r\n            onDownloadComplete && onDownloadComplete()\r\n            onClose()\r\n          } catch (error) {\r\n            console.error('Error al guardar archivo:', error)\r\n            throw new Error('Error al guardar el archivo')\r\n          }\r\n        } else {\r\n          throw new Error(result.error)\r\n        }\r\n    } catch (error) {\r\n      console.error('❌ Error al descargar video:', error)\r\n      alert(`Error al procesar video: ${error.message}`)\r\n    } finally {\r\n      setIsProcessing(false)\r\n      setProgress(0)\r\n    }\r\n  }\r\n  \r\n  // Función para elegir carpeta de descarga\r\n  const selectDownloadFolder = async () => {\r\n    try {\r\n      // Verificar si la API de File System Access está disponible\r\n      if ('showDirectoryPicker' in window) {\r\n        const dirHandle = await window.showDirectoryPicker()\r\n        return dirHandle\r\n      } else {\r\n        // Fallback: usar descarga normal\r\n        console.log('API de File System Access no disponible, usando descarga normal')\r\n        return null\r\n      }\r\n    } catch (error) {\r\n      console.log('Usuario canceló la selección de carpeta o error:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  // Descarga directa (sin conversión)\r\n  const handleDirectDownload = async () => {\r\n    if (!video || !video.file) {\r\n      console.error('No hay video para descargar')\r\n      return\r\n    }\r\n    \r\n    try {\r\n      const dirHandle = await selectDownloadFolder()\r\n      \r\n      if (dirHandle) {\r\n        // Usar File System Access API\r\n        const fileName = `${video.title || video.name}.mp4`\r\n        const fileHandle = await dirHandle.getFileHandle(fileName, { create: true })\r\n        const writable = await fileHandle.createWritable()\r\n        await writable.write(video.file)\r\n        await writable.close()\r\n        console.log('✅ Archivo guardado en carpeta seleccionada')\r\n      } else {\r\n        // Descarga normal\r\n        const url = URL.createObjectURL(video.file)\r\n        const a = document.createElement('a')\r\n        a.href = url\r\n        a.download = video.title || 'video'\r\n        document.body.appendChild(a)\r\n        a.click()\r\n        document.body.removeChild(a)\r\n        URL.revokeObjectURL(url)\r\n      }\r\n      \r\n      onClose()\r\n    } catch (error) {\r\n      console.error('Error en descarga directa:', error)\r\n      alert('Error al descargar el archivo')\r\n    }\r\n  }\r\n  \r\n  if (!isOpen) return null\r\n  \r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\r\n          <div className=\"flex items-center space-x-2\">\r\n            <Download className=\"h-5 w-5 text-blue-600\" />\r\n            <h2 className=\"text-lg font-semibold text-gray-800\">\r\n              {video?.videos ? 'Descargar Secuencia' : 'Descargar Video'}\r\n            </h2>\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-gray-600 transition-colors\"\r\n          >\r\n            <X className=\"h-5 w-5\" />\r\n          </button>\r\n        </div>\r\n        \r\n        {/* Content */}\r\n        <div className=\"p-6 space-y-6\">\r\n          {/* Video/Sequence Info */}\r\n          <div className=\"bg-gray-50 rounded-lg p-4\">\r\n            <div className=\"flex items-center space-x-3\">\r\n              <Video className=\"h-8 w-8 text-gray-400\" />\r\n              <div className=\"flex-1 min-w-0\">\r\n                <h3 className=\"font-medium text-gray-800 truncate\">\r\n                  {video?.title || video?.name || 'Sin título'}\r\n                </h3>\r\n                {video?.videos ? (\r\n                  // Información de secuencia\r\n                  <div className=\"space-y-1\">\r\n                    <p className=\"text-sm text-gray-500\">\r\n                      {video.videos.length} videos • Duración aproximada: {Math.floor(video.videos.length * 30 / 60)}:{(video.videos.length * 30 % 60).toString().padStart(2, '0')}\r\n                    </p>\r\n                    {video.useBPMControl && video.targetBPM && (\r\n                      <p className=\"text-sm text-purple-600\">\r\n                        BPM ajustado: {video.targetBPM}\r\n                      </p>\r\n                    )}\r\n                    {video.description && (\r\n                      <p className=\"text-sm text-gray-600\">\r\n                        {video.description}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                ) : (\r\n                  // Información de video individual\r\n                  <div className=\"space-y-1\">\r\n                    <p className=\"text-sm text-gray-500\">\r\n                      {video?.fileSize ? `${(video.fileSize / (1024 * 1024)).toFixed(2)} MB` : 'Tamaño desconocido'}\r\n                    </p>\r\n                    {video?.bpm && (\r\n                      <p className=\"text-sm text-purple-600\">\r\n                        BPM: {video.bpm}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Format Selection */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-3\">\r\n              Formato de salida\r\n            </label>\r\n            <div className=\"space-y-2\">\r\n              {formatOptions.map(option => (\r\n                <label\r\n                  key={option.value}\r\n                  className={`flex items-center p-3 border rounded-lg cursor-pointer transition-colors ${\r\n                    format === option.value\r\n                      ? 'border-blue-500 bg-blue-50'\r\n                      : 'border-gray-200 hover:border-gray-300'\r\n                  }`}\r\n                >\r\n                  <input\r\n                    type=\"radio\"\r\n                    name=\"format\"\r\n                    value={option.value}\r\n                    checked={format === option.value}\r\n                    onChange={(e) => setFormat(e.target.value)}\r\n                    className=\"sr-only\"\r\n                  />\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <div className={`w-4 h-4 rounded-full border-2 flex items-center justify-center ${\r\n                      format === option.value\r\n                        ? 'border-blue-500 bg-blue-500'\r\n                        : 'border-gray-300'\r\n                    }`}>\r\n                      {format === option.value && (\r\n                        <div className=\"w-2 h-2 rounded-full bg-white\"></div>\r\n                      )}\r\n                    </div>\r\n                    <div>\r\n                      <div className=\"font-medium text-gray-800\">{option.label}</div>\r\n                      <div className=\"text-sm text-gray-500\">{option.description}</div>\r\n                    </div>\r\n                  </div>\r\n                </label>\r\n              ))}\r\n            </div>\r\n          </div>\r\n          \r\n                     {/* Resolution Selection */}\r\n           <div>\r\n             <label className=\"block text-sm font-medium text-gray-700 mb-3\">\r\n               Resolución\r\n             </label>\r\n             <div className=\"space-y-2\">\r\n               {resolutionOptions.map(option => (\r\n                 <label\r\n                   key={option.value}\r\n                   className={`flex items-center p-3 border rounded-lg cursor-pointer transition-colors ${\r\n                     resolution === option.value\r\n                       ? 'border-blue-500 bg-blue-50'\r\n                       : 'border-gray-200 hover:border-gray-300'\r\n                   }`}\r\n                 >\r\n                   <input\r\n                     type=\"radio\"\r\n                     name=\"resolution\"\r\n                     value={option.value}\r\n                     checked={resolution === option.value}\r\n                     onChange={(e) => setResolution(e.target.value)}\r\n                     className=\"sr-only\"\r\n                   />\r\n                   <div className=\"flex items-center space-x-3\">\r\n                     <div className={`w-4 h-4 rounded-full border-2 flex items-center justify-center ${\r\n                       resolution === option.value\r\n                         ? 'border-blue-500 bg-blue-500'\r\n                         : 'border-gray-300'\r\n                     }`}>\r\n                       {resolution === option.value && (\r\n                         <div className=\"w-2 h-2 rounded-full bg-white\"></div>\r\n                       )}\r\n                     </div>\r\n                     <div>\r\n                       <div className=\"font-medium text-gray-800\">{option.label}</div>\r\n                       <div className=\"text-sm text-gray-500\">{option.description}</div>\r\n                     </div>\r\n                   </div>\r\n                 </label>\r\n               ))}\r\n             </div>\r\n           </div>\r\n          \r\n          {/* Progress Bar */}\r\n          {isProcessing && (\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex justify-between text-sm text-gray-600\">\r\n                <span>Procesando video...</span>\r\n                <span>{progress}%</span>\r\n              </div>\r\n              <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n                <div\r\n                  className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\r\n                  style={{ width: `${progress}%` }}\r\n                ></div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Footer */}\r\n        <div className=\"flex items-center justify-between p-6 border-t border-gray-200\">\r\n          <button\r\n            onClick={handleDirectDownload}\r\n            disabled={isProcessing}\r\n            className=\"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors\"\r\n          >\r\n            Descargar original\r\n          </button>\r\n          \r\n          <div className=\"flex space-x-3\">\r\n            <button\r\n              onClick={onClose}\r\n              disabled={isProcessing}\r\n              className=\"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors\"\r\n            >\r\n              Cancelar\r\n            </button>\r\n            <button\r\n              onClick={handleDownload}\r\n              disabled={isProcessing}\r\n              className={`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${\r\n                isProcessing\r\n                  ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\r\n                  : 'bg-blue-600 text-white hover:bg-blue-700'\r\n              }`}\r\n            >\r\n              {isProcessing ? 'Procesando...' : 'Descargar'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default DownloadModal ","import { X, AlertTriangle } from 'lucide-react'\r\n\r\nconst ConfirmModal = ({ \r\n  isOpen, \r\n  onClose, \r\n  onConfirm, \r\n  title = 'Confirmar acción', \r\n  message = '¿Estás seguro de que quieres realizar esta acción?',\r\n  confirmText = 'Confirmar',\r\n  cancelText = 'Cancelar',\r\n  type = 'warning'\r\n}) => {\r\n  if (!isOpen) return null\r\n\r\n  const getIcon = () => {\r\n    switch (type) {\r\n      case 'danger':\r\n        return <AlertTriangle className=\"w-8 h-8 text-red-500\" />\r\n      case 'warning':\r\n        return <AlertTriangle className=\"w-8 h-8 text-orange-500\" />\r\n      case 'info':\r\n        return <AlertTriangle className=\"w-8 h-8 text-blue-500\" />\r\n      default:\r\n        return <AlertTriangle className=\"w-8 h-8 text-orange-500\" />\r\n    }\r\n  }\r\n\r\n  const getConfirmButtonStyle = () => {\r\n    switch (type) {\r\n      case 'danger':\r\n        return 'bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600'\r\n      case 'warning':\r\n        return 'bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600'\r\n      case 'info':\r\n        return 'bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600'\r\n      default:\r\n        return 'bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600'\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\r\n      {/* Overlay */}\r\n      <div \r\n        className=\"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm\"\r\n        onClick={onClose}\r\n      />\r\n      \r\n      {/* Modal */}\r\n      <div className=\"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\r\n          <div className=\"flex items-center space-x-3\">\r\n            {getIcon()}\r\n            <h3 className=\"text-lg font-semibold text-gray-900\">{title}</h3>\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-gray-600 transition-colors\"\r\n          >\r\n            <X className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <div className=\"p-6\">\r\n          <div className=\"text-gray-600 leading-relaxed whitespace-pre-line\">{message}</div>\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"flex items-center justify-end space-x-3 p-6 border-t border-gray-200\">\r\n          <button\r\n            onClick={onClose}\r\n            className=\"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors font-medium\"\r\n          >\r\n            {cancelText}\r\n          </button>\r\n          <button\r\n            onClick={() => {\r\n              onConfirm()\r\n              onClose()\r\n            }}\r\n            className={`px-4 py-2 text-white rounded-lg transition-all font-medium ${getConfirmButtonStyle()}`}\r\n          >\r\n            {confirmText}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ConfirmModal ","// 🎬 SERVICIOS DE FIREBASE PARA SECUENCIAS - SALSAHACKS V2.0\r\n\r\nimport { \r\n  collection, \r\n  addDoc, \r\n  updateDoc, \r\n  deleteDoc, \r\n  doc, \r\n  getDocs, \r\n  query, \r\n  where, \r\n  orderBy,\r\n  onSnapshot,\r\n  serverTimestamp \r\n} from 'firebase/firestore'\r\nimport { db } from './config'\r\n\r\nconst SEQUENCES_COLLECTION = 'sequences'\r\n\r\n// Crear una nueva secuencia\r\nexport const createSequence = async (sequenceData) => {\r\n  console.log('🔥 Firebase: Creando secuencia...')\r\n  console.log('📦 Datos de secuencia:', sequenceData)\r\n  \r\n  try {\r\n    const sequenceWithTimestamp = {\r\n      ...sequenceData,\r\n      createdAt: serverTimestamp(),\r\n      updatedAt: serverTimestamp()\r\n    }\r\n    \r\n    console.log('⏰ Secuencia con timestamps:', sequenceWithTimestamp)\r\n    const docRef = await addDoc(collection(db, SEQUENCES_COLLECTION), sequenceWithTimestamp)\r\n    console.log('📄 Documento creado con ID:', docRef.id)\r\n    \r\n    const result = {\r\n      id: docRef.id,\r\n      ...sequenceData,\r\n      createdAt: new Date().toISOString(),\r\n      updatedAt: new Date().toISOString()\r\n    }\r\n    \r\n    console.log('✅ Secuencia creada exitosamente:', result)\r\n    return result\r\n  } catch (error) {\r\n    console.error('❌ Error al crear secuencia:', error)\r\n    throw new Error('No se pudo crear la secuencia')\r\n  }\r\n}\r\n\r\n// Obtener todas las secuencias\r\nexport const getSequences = async () => {\r\n  try {\r\n    const q = query(\r\n      collection(db, SEQUENCES_COLLECTION),\r\n      orderBy('createdAt', 'desc')\r\n    )\r\n    \r\n    const querySnapshot = await getDocs(q)\r\n    const sequences = []\r\n    \r\n    querySnapshot.forEach((doc) => {\r\n      const data = doc.data()\r\n      sequences.push({\r\n        id: doc.id,\r\n        ...data,\r\n        createdAt: data.createdAt?.toDate?.()?.toISOString() || data.createdAt,\r\n        updatedAt: data.updatedAt?.toDate?.()?.toISOString() || data.updatedAt\r\n      })\r\n    })\r\n    \r\n    return sequences\r\n  } catch (error) {\r\n    console.error('Error al obtener secuencias:', error)\r\n    throw new Error('No se pudieron obtener las secuencias')\r\n  }\r\n}\r\n\r\n// Obtener secuencias por estilo\r\nexport const getSequencesByStyle = async (style) => {\r\n  try {\r\n    const q = query(\r\n      collection(db, SEQUENCES_COLLECTION),\r\n      where('style', '==', style),\r\n      orderBy('createdAt', 'desc')\r\n    )\r\n    \r\n    const querySnapshot = await getDocs(q)\r\n    const sequences = []\r\n    \r\n    querySnapshot.forEach((doc) => {\r\n      const data = doc.data()\r\n      sequences.push({\r\n        id: doc.id,\r\n        ...data,\r\n        createdAt: data.createdAt?.toDate?.()?.toISOString() || data.createdAt,\r\n        updatedAt: data.updatedAt?.toDate?.()?.toISOString() || data.updatedAt\r\n      })\r\n    })\r\n    \r\n    return sequences\r\n  } catch (error) {\r\n    console.error('Error al obtener secuencias por estilo:', error)\r\n    throw new Error('No se pudieron obtener las secuencias')\r\n  }\r\n}\r\n\r\n// Actualizar una secuencia\r\nexport const updateSequence = async (sequenceId, updateData) => {\r\n  try {\r\n    const sequenceRef = doc(db, SEQUENCES_COLLECTION, sequenceId)\r\n    const updateWithTimestamp = {\r\n      ...updateData,\r\n      updatedAt: serverTimestamp()\r\n    }\r\n    \r\n    await updateDoc(sequenceRef, updateWithTimestamp)\r\n    \r\n    return {\r\n      id: sequenceId,\r\n      ...updateData,\r\n      updatedAt: new Date().toISOString()\r\n    }\r\n  } catch (error) {\r\n    console.error('Error al actualizar secuencia:', error)\r\n    throw new Error('No se pudo actualizar la secuencia')\r\n  }\r\n}\r\n\r\n// Eliminar una secuencia\r\nexport const deleteSequence = async (sequenceId) => {\r\n  try {\r\n    const sequenceRef = doc(db, SEQUENCES_COLLECTION, sequenceId)\r\n    await deleteDoc(sequenceRef)\r\n    \r\n    return { success: true }\r\n  } catch (error) {\r\n    console.error('Error al eliminar secuencia:', error)\r\n    throw new Error('No se pudo eliminar la secuencia')\r\n  }\r\n}\r\n\r\n// Suscribirse a cambios en tiempo real de secuencias\r\nexport const subscribeToSequences = (callback) => {\r\n  try {\r\n    const q = query(\r\n      collection(db, SEQUENCES_COLLECTION),\r\n      orderBy('createdAt', 'desc')\r\n    )\r\n    \r\n    return onSnapshot(q, (querySnapshot) => {\r\n      const sequences = []\r\n      \r\n      querySnapshot.forEach((doc) => {\r\n        const data = doc.data()\r\n        sequences.push({\r\n          id: doc.id,\r\n          ...data,\r\n          createdAt: data.createdAt?.toDate?.()?.toISOString() || data.createdAt,\r\n          updatedAt: data.updatedAt?.toDate?.()?.toISOString() || data.updatedAt\r\n        })\r\n      })\r\n      \r\n      callback(sequences)\r\n    })\r\n  } catch (error) {\r\n    console.error('Error al suscribirse a secuencias:', error)\r\n    throw new Error('No se pudo suscribir a las secuencias')\r\n  }\r\n}\r\n\r\n// Suscribirse a cambios en tiempo real de secuencias por estilo\r\nexport const subscribeToSequencesByStyle = (style, callback) => {\r\n  console.log('🎬 Firebase: Suscribiéndose a secuencias para estilo:', style)\r\n  \r\n  try {\r\n    const q = query(\r\n      collection(db, SEQUENCES_COLLECTION),\r\n      where('style', '==', style),\r\n      orderBy('createdAt', 'desc')\r\n    )\r\n    \r\n    return onSnapshot(q, (querySnapshot) => {\r\n      console.log(`🎬 Firebase: Actualización recibida - ${querySnapshot.size} secuencias para ${style}`)\r\n      \r\n      const sequences = []\r\n      \r\n      querySnapshot.forEach((doc) => {\r\n        const data = doc.data()\r\n        const sequence = {\r\n          id: doc.id,\r\n          ...data,\r\n          createdAt: data.createdAt?.toDate?.()?.toISOString() || data.createdAt,\r\n          updatedAt: data.updatedAt?.toDate?.()?.toISOString() || data.updatedAt\r\n        }\r\n        sequences.push(sequence)\r\n        console.log(`📋 Secuencia cargada: ${sequence.name} (${sequence.videos?.length || 0} videos)`)\r\n      })\r\n      \r\n      console.log(`🎉 Total de secuencias cargadas: ${sequences.length}`)\r\n      callback(sequences)\r\n    })\r\n  } catch (error) {\r\n    console.error('❌ Error al suscribirse a secuencias por estilo:', error)\r\n    throw new Error('No se pudo suscribir a las secuencias')\r\n  }\r\n}\r\n\r\n// Buscar secuencias por nombre o descripción\r\nexport const searchSequences = async (searchTerm) => {\r\n  try {\r\n    const allSequences = await getSequences()\r\n    \r\n    const normalizedSearchTerm = searchTerm.toLowerCase().trim()\r\n    \r\n    return allSequences.filter(sequence => {\r\n      const name = sequence.name?.toLowerCase() || ''\r\n      const description = sequence.description?.toLowerCase() || ''\r\n      \r\n      return name.includes(normalizedSearchTerm) || \r\n             description.includes(normalizedSearchTerm)\r\n    })\r\n  } catch (error) {\r\n    console.error('Error al buscar secuencias:', error)\r\n    throw new Error('No se pudo buscar las secuencias')\r\n  }\r\n}\r\n\r\n// Obtener estadísticas de secuencias\r\nexport const getSequenceStats = async () => {\r\n  try {\r\n    const sequences = await getSequences()\r\n    \r\n    const stats = {\r\n      total: sequences.length,\r\n      byStyle: {},\r\n      averageVideosPerSequence: 0,\r\n      totalVideos: 0\r\n    }\r\n    \r\n    sequences.forEach(sequence => {\r\n      // Contar por estilo\r\n      const style = sequence.style || 'unknown'\r\n      stats.byStyle[style] = (stats.byStyle[style] || 0) + 1\r\n      \r\n      // Contar videos totales\r\n      stats.totalVideos += sequence.videos?.length || 0\r\n    })\r\n    \r\n    // Calcular promedio\r\n    if (stats.total > 0) {\r\n      stats.averageVideosPerSequence = Math.round(stats.totalVideos / stats.total)\r\n    }\r\n    \r\n    return stats\r\n  } catch (error) {\r\n    console.error('Error al obtener estadísticas de secuencias:', error)\r\n    throw new Error('No se pudieron obtener las estadísticas')\r\n  }\r\n} ","// 🎬 HOOK PARA DRAG AND DROP - SALSAHACKS V2.0\r\n\r\nimport { useState, useCallback } from 'react'\r\n\r\nexport const useDragAndDrop = (onReorder) => {\r\n  const [draggedIndex, setDraggedIndex] = useState(null)\r\n  const [dragOverIndex, setDragOverIndex] = useState(null)\r\n\r\n  const handleDragStart = useCallback((index) => {\r\n    setDraggedIndex(index)\r\n  }, [])\r\n\r\n  const handleDragOver = useCallback((e, index) => {\r\n    e.preventDefault()\r\n    setDragOverIndex(index)\r\n  }, [])\r\n\r\n  const handleDragEnter = useCallback((e, index) => {\r\n    e.preventDefault()\r\n    setDragOverIndex(index)\r\n  }, [])\r\n\r\n  const handleDragLeave = useCallback((e) => {\r\n    e.preventDefault()\r\n    setDragOverIndex(null)\r\n  }, [])\r\n\r\n  const handleDrop = useCallback((e, dropIndex) => {\r\n    e.preventDefault()\r\n    \r\n    if (draggedIndex !== null && draggedIndex !== dropIndex) {\r\n      onReorder(draggedIndex, dropIndex)\r\n    }\r\n    \r\n    setDraggedIndex(null)\r\n    setDragOverIndex(null)\r\n  }, [draggedIndex, onReorder])\r\n\r\n  const handleDragEnd = useCallback(() => {\r\n    setDraggedIndex(null)\r\n    setDragOverIndex(null)\r\n  }, [])\r\n\r\n  const getDragStyles = useCallback((index) => {\r\n    const styles = {\r\n      cursor: 'grab',\r\n      transition: 'all 0.2s ease',\r\n      transform: 'scale(1)',\r\n      opacity: 1\r\n    }\r\n\r\n    if (draggedIndex === index) {\r\n      styles.cursor = 'grabbing'\r\n      styles.transform = 'scale(1.05) rotate(2deg)'\r\n      styles.opacity = 0.7\r\n      styles.zIndex = 1000\r\n    }\r\n\r\n    if (dragOverIndex === index && draggedIndex !== index) {\r\n      styles.transform = 'scale(1.02)'\r\n      styles.borderLeft = '4px solid #3b82f6'\r\n      styles.backgroundColor = '#f0f9ff'\r\n    }\r\n\r\n    return styles\r\n  }, [draggedIndex, dragOverIndex])\r\n\r\n  return {\r\n    draggedIndex,\r\n    dragOverIndex,\r\n    handleDragStart,\r\n    handleDragOver,\r\n    handleDragEnter,\r\n    handleDragLeave,\r\n    handleDrop,\r\n    handleDragEnd,\r\n    getDragStyles\r\n  }\r\n} ","import React, { useState, useRef, useEffect } from 'react'\nimport { \n  Play, \n  Pause, \n  Volume2, \n  VolumeX, \n  RotateCcw, \n  RotateCw, \n  Maximize, \n  Minimize, \n  SkipBack, \n  SkipForward,\n  Download,\n  Settings\n} from 'lucide-react'\n\nconst SequenceVideoPlayer = ({ \n  videos, \n  currentBPM = null,\n  className = '',\n  showControls = true,\n  autoplay = false,\n  loop = false,\n  muted = false\n}) => {\n  const [currentVideoIndex, setCurrentVideoIndex] = useState(0)\n  const [isPlaying, setIsPlaying] = useState(false)\n  const [isMuted, setIsMuted] = useState(muted)\n  const [isFullscreen, setIsFullscreen] = useState(false)\n  const [showControlsUI, setShowControlsUI] = useState(showControls)\n  const [currentTime, setCurrentTime] = useState(0)\n  const [duration, setDuration] = useState(0)\n  const [playbackRate, setPlaybackRate] = useState(1)\n  const [volume, setVolume] = useState(1)\n  const [showVolumeSlider, setShowVolumeSlider] = useState(false)\n  const [volumeSliderTimeout, setVolumeSliderTimeout] = useState(null)\n  const [isLoopEnabled, setIsLoopEnabled] = useState(false)\n  const [loopStart, setLoopStart] = useState(0)\n  const [loopEnd, setLoopEnd] = useState(0)\n  const [isLoopSegmentMode, setIsLoopSegmentMode] = useState(false)\n  const [hasPointA, setHasPointA] = useState(false)\n  const [hasPointB, setHasPointB] = useState(false)\n  const [savedPointA, setSavedPointA] = useState(0)\n  const [savedPointB, setSavedPointB] = useState(0)\n  const [controlsTimeout, setControlsTimeout] = useState(null)\n  const [showSpeedMenu, setShowSpeedMenu] = useState(false)\n  const [manualPlaybackSpeed, setManualPlaybackSpeed] = useState(1)\n  const [useManualSpeed, setUseManualSpeed] = useState(true)\n  \n  const videoRef = useRef(null)\n  const containerRef = useRef(null)\n  \n  const currentVideo = videos[currentVideoIndex]\n  \n  // Velocidades disponibles\n  const availableSpeeds = [0.25, 0.5, 0.75, 1, 1.25, 1.5, 2]\n\n  // Velocidad fija en 1x (sin ajuste automático de BPM)\n  useEffect(() => {\n    setPlaybackRate(1)\n    if (videoRef.current) {\n      videoRef.current.playbackRate = 1\n    }\n  }, [currentVideoIndex])\n\n\n\n  // Manejar bucle de segmento\n  useEffect(() => {\n    if (videoRef.current && isLoopSegmentMode && isPlaying && hasPointA && hasPointB) {\n      const video = videoRef.current\n      const checkLoopSegment = () => {\n        if (video.currentTime >= loopEnd) {\n          video.currentTime = loopStart\n        }\n      }\n      \n      video.addEventListener('timeupdate', checkLoopSegment)\n      return () => video.removeEventListener('timeupdate', checkLoopSegment)\n    }\n  }, [isLoopSegmentMode, loopStart, loopEnd, isPlaying, hasPointA, hasPointB])\n\n  // Auto-hide controls\n  useEffect(() => {\n    if (showControls && isPlaying) {\n      if (controlsTimeout) {\n        clearTimeout(controlsTimeout)\n      }\n      const timeout = setTimeout(() => {\n        setShowControlsUI(false)\n      }, 4000)\n      setControlsTimeout(timeout)\n    }\n    return () => {\n      if (controlsTimeout) {\n        clearTimeout(controlsTimeout)\n      }\n    }\n  }, [isPlaying, showControls])\n\n  // Cleanup timeouts al desmontar\n  useEffect(() => {\n    return () => {\n      if (controlsTimeout) clearTimeout(controlsTimeout)\n      if (volumeSliderTimeout) clearTimeout(volumeSliderTimeout)\n    }\n  }, [])\n\n  // Cerrar menús al hacer clic fuera\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (showSpeedMenu) {\n        setShowSpeedMenu(false)\n      }\n    }\n\n    document.addEventListener('click', handleClickOutside)\n    return () => document.removeEventListener('click', handleClickOutside)\n  }, [showSpeedMenu])\n\n  // Función helper para activar controles\n  const activateControls = () => {\n    setShowControlsUI(true)\n    if (controlsTimeout) {\n      clearTimeout(controlsTimeout)\n    }\n  }\n\n  // Handle video end\n  const handleVideoEnd = () => {\n    if (isLoopEnabled && !isLoopSegmentMode) {\n      // Loop completo\n      if (videoRef.current) {\n        videoRef.current.currentTime = 0\n        videoRef.current.play()\n      }\n    } else if (isLoopSegmentMode && hasPointA && hasPointB) {\n      // Loop de segmento\n      if (videoRef.current) {\n        videoRef.current.currentTime = loopStart\n        videoRef.current.play()\n      }\n    } else {\n      // No cambiar automáticamente al siguiente video\n      // Solo pausar el video actual\n      setIsPlaying(false)\n    }\n  }\n  \n  // Handle time update\n  const handleTimeUpdate = () => {\n    if (videoRef.current) {\n      setCurrentTime(videoRef.current.currentTime)\n    }\n  }\n  \n  // Handle loaded metadata\n  const handleLoadedMetadata = () => {\n    if (videoRef.current) {\n      setDuration(videoRef.current.duration)\n      // Aplicar velocidad manual\n      videoRef.current.playbackRate = manualPlaybackSpeed\n      setPlaybackRate(manualPlaybackSpeed)\n    }\n  }\n  \n  // Toggle play/pause\n  const togglePlay = () => {\n    if (videoRef.current) {\n      if (isPlaying) {\n        videoRef.current.pause()\n      } else {\n        videoRef.current.play()\n      }\n      setIsPlaying(!isPlaying)\n    }\n  }\n  \n  // Navigate to previous video\n  const goToPreviousVideo = () => {\n    if (currentVideoIndex > 0) {\n      setCurrentVideoIndex(prev => prev - 1)\n      setCurrentTime(0)\n      if (videoRef.current) {\n        videoRef.current.currentTime = 0\n      }\n    }\n  }\n  \n  // Navigate to next video\n  const goToNextVideo = () => {\n    if (currentVideoIndex < videos.length - 1) {\n      setCurrentVideoIndex(prev => prev + 1)\n      setCurrentTime(0)\n      if (videoRef.current) {\n        videoRef.current.currentTime = 0\n      }\n    }\n  }\n\n  // Skip function\n  const skip = (seconds) => {\n    if (videoRef.current) {\n      const newTime = Math.max(0, Math.min(duration, currentTime + seconds))\n      videoRef.current.currentTime = newTime\n      setCurrentTime(newTime)\n    }\n  }\n  \n  // Toggle mute\n  const toggleMute = () => {\n    if (videoRef.current) {\n      const newMutedState = !isMuted\n      videoRef.current.muted = newMutedState\n      setIsMuted(newMutedState)\n      \n      if (newMutedState) {\n        // Al mutear, guardar el volumen actual y ponerlo en 0\n        videoRef.current.volume = 0\n      } else {\n        // Al desmutear, restaurar el volumen\n        videoRef.current.volume = volume\n      }\n    }\n  }\n\n  const handleVolumeChange = (e) => {\n    const newVolume = parseFloat(e.target.value)\n    \n    if (videoRef.current) {\n      videoRef.current.volume = newVolume\n      setVolume(newVolume)\n      \n      // Si el volumen es 0, mutear. Si no, desmutear\n      if (newVolume === 0) {\n        videoRef.current.muted = true\n        setIsMuted(true)\n      } else {\n        videoRef.current.muted = false\n        setIsMuted(false)\n      }\n    }\n  }\n  \n  // Toggle fullscreen\n  const toggleFullscreen = () => {\n    try {\n      if (!document.fullscreenElement) {\n        if (containerRef.current.requestFullscreen) {\n          containerRef.current.requestFullscreen()\n        } else if (containerRef.current.webkitRequestFullscreen) {\n          containerRef.current.webkitRequestFullscreen()\n        } else if (containerRef.current.msRequestFullscreen) {\n          containerRef.current.msRequestFullscreen()\n        }\n        setIsFullscreen(true)\n      } else {\n        if (document.exitFullscreen) {\n          document.exitFullscreen()\n        } else if (document.webkitExitFullscreen) {\n          document.webkitExitFullscreen()\n        } else if (document.msExitFullscreen) {\n          document.msExitFullscreen()\n        }\n        setIsFullscreen(false)\n      }\n    } catch (error) {\n      console.error('Error toggling fullscreen:', error)\n    }\n  }\n  \n  // Handle progress bar click\n  const handleProgressClick = (e) => {\n    if (videoRef.current) {\n      const rect = e.currentTarget.getBoundingClientRect()\n      const clickX = e.clientX - rect.left\n      const percentage = clickX / rect.width\n      const newTime = percentage * duration\n      videoRef.current.currentTime = newTime\n      setCurrentTime(newTime)\n    }\n  }\n\n  const setLoopPoint = (type) => {\n    if (type === 'start') {\n      if (hasPointA) {\n        // Si ya existe el punto A, lo quitamos\n        setHasPointA(false)\n        setLoopStart(0)\n        console.log('Punto A eliminado')\n      } else {\n        // Establecer punto A\n        setHasPointA(true)\n        setLoopStart(currentTime)\n        setSavedPointA(currentTime)\n        console.log(`Punto A establecido en: ${formatTime(currentTime)}`)\n      }\n    } else {\n      if (hasPointB) {\n        // Si ya existe el punto B, lo quitamos\n        setHasPointB(false)\n        setLoopEnd(0)\n        console.log('Punto B eliminado')\n      } else {\n        // Establecer punto B\n        setHasPointB(true)\n        setLoopEnd(currentTime)\n        setSavedPointB(currentTime)\n        console.log(`Punto B establecido en: ${formatTime(currentTime)}`)\n      }\n    }\n  }\n\n  const formatTime = (time) => {\n    const minutes = Math.floor(time / 60)\n    const seconds = Math.floor(time % 60)\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`\n  }\n\n  const handleSpeedChange = (speed) => {\n    setManualPlaybackSpeed(speed)\n    if (videoRef.current) {\n      videoRef.current.playbackRate = speed\n      setPlaybackRate(speed)\n    }\n    setShowSpeedMenu(false)\n  }\n\n  const getSpeedLabel = (speed) => {\n    if (speed === 1) return 'Normal'\n    return `${speed}x`\n  }\n\n  // Función para descargar video\n  const downloadVideo = async () => {\n    try {\n      console.log('Iniciando descarga de video:', currentVideo.title)\n      \n      if (currentVideo.videoUrl && (currentVideo.videoUrl.includes('firebase') || currentVideo.videoUrl.includes('googleapis'))) {\n        console.log('Detectada URL de Firebase Storage, descargando...')\n        \n        const response = await fetch(currentVideo.videoUrl)\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`)\n        }\n        \n        const blob = await response.blob()\n        console.log('Blob descargado:', blob.size, 'bytes')\n        \n        const blobUrl = URL.createObjectURL(blob)\n        \n        const link = document.createElement('a')\n        link.href = blobUrl\n        link.download = currentVideo.title || 'video.mp4'\n        link.style.display = 'none'\n        \n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n        \n        setTimeout(() => {\n          URL.revokeObjectURL(blobUrl)\n        }, 1000)\n        \n        console.log('Descarga completada exitosamente')\n      } else {\n        console.log('Usando método de descarga directa para URL no-Firebase')\n        const link = document.createElement('a')\n        link.href = currentVideo.videoUrl\n        link.download = currentVideo.title || 'video.mp4'\n        link.style.display = 'none'\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      }\n    } catch (error) {\n      console.error('Error en descarga:', error)\n      alert(`Error al descargar el video: ${error.message}`)\n    }\n  }\n  \n  // Keyboard shortcuts\n  useEffect(() => {\n    const handleKeyPress = (e) => {\n      if (e.target.tagName === 'INPUT') return\n      \n      switch (e.code) {\n        case 'Space':\n          e.preventDefault()\n          togglePlay()\n          break\n        case 'KeyF':\n          e.preventDefault()\n          toggleFullscreen()\n          break\n        case 'KeyM':\n          e.preventDefault()\n          toggleMute()\n          break\n        case 'ArrowLeft':\n          e.preventDefault()\n          if (e.ctrlKey || e.metaKey) {\n            goToPreviousVideo()\n          } else {\n            skip(-10)\n          }\n          break\n        case 'ArrowRight':\n          e.preventDefault()\n          if (e.ctrlKey || e.metaKey) {\n            goToNextVideo()\n          } else {\n            skip(10)\n          }\n          break\n        case 'KeyA':\n          e.preventDefault()\n          setLoopPoint('start')\n          break\n        case 'KeyB':\n          e.preventDefault()\n          setLoopPoint('end')\n          break\n        case 'KeyL':\n          e.preventDefault()\n          setIsLoopEnabled(!isLoopEnabled)\n          break\n        case 'KeyS':\n          e.preventDefault()\n          // Ciclar entre velocidades\n          const currentIndex = availableSpeeds.indexOf(manualPlaybackSpeed)\n          const nextIndex = (currentIndex + 1) % availableSpeeds.length\n          handleSpeedChange(availableSpeeds[nextIndex])\n          break\n      }\n    }\n    \n    document.addEventListener('keydown', handleKeyPress)\n    return () => document.removeEventListener('keydown', handleKeyPress)\n  }, [currentTime, duration, currentVideoIndex, isLoopEnabled, manualPlaybackSpeed])\n  \n  if (!currentVideo) {\n    return (\n      <div className={`bg-black rounded-lg flex items-center justify-center ${className}`}>\n        <div className=\"text-white text-center\">\n          <p>No hay videos en la secuencia</p>\n        </div>\n      </div>\n    )\n  }\n  \n  return (\n    <div \n      ref={containerRef}\n      className={`relative bg-black rounded-lg overflow-hidden ${className}`}\n      onMouseEnter={activateControls}\n      onMouseLeave={() => {\n        if (isPlaying) {\n          const timeout = setTimeout(() => {\n            setShowControlsUI(false)\n          }, 4000)\n          setControlsTimeout(timeout)\n        }\n      }}\n      onTouchStart={activateControls}\n      onTouchMove={activateControls}\n    >\n      {/* Video Element */}\n      <video\n        ref={videoRef}\n        src={currentVideo.videoUrl}\n        className=\"w-full h-full object-contain cursor-pointer\"\n        onEnded={handleVideoEnd}\n        onTimeUpdate={handleTimeUpdate}\n        onLoadedMetadata={handleLoadedMetadata}\n        onPlay={() => setIsPlaying(true)}\n        onPause={() => setIsPlaying(false)}\n        muted={isMuted}\n        autoPlay={autoplay}\n        loop={false} // We handle looping manually\n        onClick={activateControls}\n      />\n      \n             {/* Video Info Overlay */}\n       <div className=\"absolute top-2 left-2 bg-black bg-opacity-75 text-white px-3 py-2 rounded-lg text-sm\">\n         <div className=\"flex items-center space-x-2\">\n           <span className=\"font-medium\">\n             {currentVideoIndex + 1} / {videos.length}\n           </span>\n           <span className=\"text-gray-300\">|</span>\n           <span className=\"max-w-xs truncate\">{currentVideo.title}</span>\n           {playbackRate !== 1 && (\n             <>\n               <span className=\"text-gray-300\">|</span>\n               <span className=\"text-blue-400 font-medium\">\n                 {playbackRate.toFixed(2)}x\n               </span>\n             </>\n           )}\n         </div>\n         {videos.length > 1 && (\n           <div className=\"text-xs text-gray-400 mt-1\">\n             Usa Ctrl+←/→ para cambiar de video\n           </div>\n         )}\n       </div>\n      \n      {/* Controls Overlay */}\n      {showControlsUI && (\n        <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent flex flex-col justify-end\">\n          {/* Controles superiores */}\n          <div className=\"absolute top-0 left-0 right-0 p-4 flex justify-end items-center\">\n            <div className=\"flex items-center space-x-2\">\n              <button\n                onClick={toggleFullscreen}\n                className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\n              >\n                {isFullscreen ? <Minimize className=\"w-4 h-4\" /> : <Maximize className=\"w-4 h-4\" />}\n              </button>\n            </div>\n          </div>\n\n          {/* Controles centrales */}\n          <div className=\"absolute inset-0 flex items-center justify-center\">\n            <div className=\"flex items-center space-x-4\">\n              {/* Botón de video anterior */}\n              <button\n                onClick={goToPreviousVideo}\n                disabled={currentVideoIndex === 0}\n                className={`p-2 rounded-full transition-colors z-10 ${\n                  currentVideoIndex === 0 \n                    ? 'bg-gray-600 text-gray-400 cursor-not-allowed' \n                    : 'bg-black/60 text-white hover:bg-black/80'\n                }`}\n                title=\"Video anterior (Ctrl+←)\"\n              >\n                <div className=\"flex items-center space-x-1\">\n                  <div className=\"w-3 h-3 rounded-full border-2 border-current flex items-center justify-center\">\n                    <SkipBack className=\"w-1.5 h-1.5\" />\n                  </div>\n                  <span className=\"text-xs font-medium\">Anterior</span>\n                </div>\n              </button>\n\n              {/* Botón de retroceder 10s */}\n              <button\n                onClick={() => skip(-10)}\n                className=\"p-3 rounded-full bg-black/60 text-white hover:bg-black/80 transition-colors z-10 hidden md:flex items-center justify-center\"\n                title=\"Retroceder 10s (←)\"\n              >\n                <div className=\"flex items-center space-x-1\">\n                  <div className=\"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center\">\n                    <SkipBack className=\"w-3 h-3\" />\n                  </div>\n                  <span className=\"text-sm font-medium\">10</span>\n                </div>\n              </button>\n\n              <button\n                onClick={togglePlay}\n                className=\"p-4 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\n                title=\"Play/Pause (Espacio)\"\n              >\n                {isPlaying ? <Pause className=\"w-8 h-8\" /> : <Play className=\"w-8 h-8\" />}\n              </button>\n\n              {/* Botón de adelantar 10s */}\n              <button\n                onClick={() => skip(10)}\n                className=\"p-3 rounded-full bg-black/60 text-white hover:bg-black/80 transition-colors z-10 hidden md:flex items-center justify-center\"\n                title=\"Adelantar 10s (→)\"\n              >\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"text-sm font-medium\">10</span>\n                  <div className=\"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center\">\n                    <SkipForward className=\"w-3 h-3\" />\n                  </div>\n                </div>\n              </button>\n\n              {/* Botón de siguiente video */}\n              <button\n                onClick={goToNextVideo}\n                disabled={currentVideoIndex === videos.length - 1}\n                className={`p-2 rounded-full transition-colors z-10 ${\n                  currentVideoIndex === videos.length - 1 \n                    ? 'bg-gray-600 text-gray-400 cursor-not-allowed' \n                    : 'bg-black/60 text-white hover:bg-black/80'\n                }`}\n                title=\"Siguiente video (Ctrl+→)\"\n              >\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"text-xs font-medium\">Siguiente</span>\n                  <div className=\"w-3 h-3 rounded-full border-2 border-current flex items-center justify-center\">\n                    <SkipForward className=\"w-1.5 h-1.5\" />\n                  </div>\n                </div>\n              </button>\n            </div>\n          </div>\n\n          {/* Controles inferiores */}\n          <div className=\"absolute bottom-0 left-0 right-0 p-4\">\n            {/* Controles de volumen, bucle, A-B y velocidades */}\n            <div className=\"flex justify-end mb-2 space-x-2\">\n              {/* Botón de bucle */}\n              <button\n                onClick={() => setIsLoopEnabled(!isLoopEnabled)}\n                className={`p-2 rounded-full transition-colors z-10 ${\n                  isLoopEnabled ? 'bg-blue-500 text-white' : 'bg-white/20 text-white hover:bg-white/30'\n                }`}\n                title=\"Bucle\"\n              >\n                <RotateCcw className=\"w-4 h-4\" />\n              </button>\n\n              {/* Botón de segmento A-B */}\n              <button\n                onClick={() => {\n                  const newMode = !isLoopSegmentMode\n                  setIsLoopSegmentMode(newMode)\n                  if (!newMode) {\n                    setHasPointA(false)\n                    setHasPointB(false)\n                    setLoopStart(0)\n                    setLoopEnd(0)\n                  } else {\n                    if (savedPointA > 0) {\n                      setHasPointA(true)\n                      setLoopStart(savedPointA)\n                    }\n                    if (savedPointB > 0) {\n                      setHasPointB(true)\n                      setLoopEnd(savedPointB)\n                    }\n                  }\n                }}\n                className={`p-2 rounded-full transition-colors z-10 ${\n                  isLoopSegmentMode ? 'bg-green-500 text-white' : 'bg-white/20 text-white hover:bg-white/30'\n                }`}\n                title=\"Segmento A-B\"\n              >\n                <div className=\"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none\">\n                  A-B\n                </div>\n              </button>\n\n              {/* Botón de velocidades */}\n              <div className=\"relative\">\n                <button\n                  onClick={() => setShowSpeedMenu(!showSpeedMenu)}\n                  className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\n                  title=\"Velocidad de reproducción\"\n                >\n                                     <div className=\"flex items-center justify-center w-4 h-4 text-[10px] font-bold leading-none\">\n                     {manualPlaybackSpeed === 1 ? '1x' : `${manualPlaybackSpeed}x`}\n                   </div>\n                </button>\n                \n                                 {showSpeedMenu && (\n                   <div className=\"absolute bottom-full right-0 mb-2 bg-black/90 rounded-lg p-2 z-20 min-w-[80px]\">\n                     {availableSpeeds.map((speed) => (\n                       <button\n                         key={speed}\n                         onClick={() => handleSpeedChange(speed)}\n                         className={`w-full text-left px-3 py-1 rounded text-xs transition-colors ${\n                           manualPlaybackSpeed === speed \n                             ? 'bg-blue-500 text-white' \n                             : 'text-white hover:bg-white/20'\n                         }`}\n                       >\n                         {getSpeedLabel(speed)}\n                       </button>\n                     ))}\n                   </div>\n                 )}\n              </div>\n\n              {/* Botón de descarga */}\n              <button\n                onClick={downloadVideo}\n                className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\n                title=\"Descargar video\"\n              >\n                <Download className=\"w-4 h-4\" />\n              </button>\n\n              {/* Controles de volumen */}\n              <div className=\"relative\">\n                <button\n                  onClick={toggleMute}\n                  className=\"p-2 rounded-full bg-white/20 text-white hover:bg-white/30 transition-colors z-10\"\n                  onMouseEnter={() => setShowVolumeSlider(true)}\n                  onMouseLeave={() => {\n                    const timeout = setTimeout(() => setShowVolumeSlider(false), 1000)\n                    setVolumeSliderTimeout(timeout)\n                  }}\n                >\n                  {isMuted ? <VolumeX className=\"w-4 h-4\" /> : <Volume2 className=\"w-4 h-4\" />}\n                </button>\n                \n                {showVolumeSlider && (\n                  <div \n                    className=\"absolute bottom-full right-0 mb-2 bg-black/80 rounded-lg p-3 z-20\"\n                    onMouseEnter={() => {\n                      if (volumeSliderTimeout) {\n                        clearTimeout(volumeSliderTimeout)\n                        setVolumeSliderTimeout(null)\n                      }\n                    }}\n                    onMouseLeave={() => {\n                      const timeout = setTimeout(() => setShowVolumeSlider(false), 1000)\n                      setVolumeSliderTimeout(timeout)\n                    }}\n                  >\n                    <div className=\"flex flex-col items-center space-y-2\">\n                      <input\n                        type=\"range\"\n                        min=\"0\"\n                        max=\"1\"\n                        step=\"0.01\"\n                        value={volume}\n                        onChange={handleVolumeChange}\n                        className=\"w-2 h-20 bg-gray-600 rounded-lg appearance-none cursor-pointer slider-vertical\"\n                        style={{\n                          background: `linear-gradient(to top, #3b82f6 0%, #3b82f6 ${volume * 100}%, #4b5563 ${volume * 100}%, #4b5563 100%)`\n                        }}\n                        orient=\"vertical\"\n                      />\n                      <span className=\"text-white text-xs\">{Math.round(volume * 100)}%</span>\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Barra de progreso */}\n            <div className=\"relative mb-4\">\n              <div\n                className=\"w-full h-2 bg-white/20 rounded-full cursor-pointer relative\"\n                onClick={handleProgressClick}\n              >\n                <div\n                  className=\"h-full bg-blue-500 rounded-full\"\n                  style={{ width: `${(currentTime / duration) * 100}%` }}\n                />\n                \n                {/* Marcadores de bucle A-B */}\n                {isLoopSegmentMode && hasPointA && (\n                  <div\n                    className=\"absolute top-0 w-1 h-full bg-green-500 z-10\"\n                    style={{ left: `${(loopStart / duration) * 100}%` }}\n                  />\n                )}\n                {isLoopSegmentMode && hasPointB && (\n                  <div\n                    className=\"absolute top-0 w-1 h-full bg-red-500 z-10\"\n                    style={{ left: `${(loopEnd / duration) * 100}%` }}\n                  />\n                )}\n              </div>\n            </div>\n\n            {/* Información de tiempo y controles de bucle */}\n            <div className=\"flex items-center justify-between text-white text-sm\">\n              <div className=\"flex items-center space-x-4\">\n                <span>{formatTime(currentTime)} / {formatTime(duration)}</span>\n                {playbackRate !== 1 && (\n                  <span className=\"text-blue-400 font-medium\">\n                    {playbackRate.toFixed(2)}x\n                  </span>\n                )}\n                \n                {isLoopSegmentMode && (\n                  <div className=\"flex items-center space-x-2\">\n                    <button\n                      onClick={() => setLoopPoint('start')}\n                      className={`px-2 py-1 rounded text-xs transition-colors ${\n                        hasPointA ? 'bg-green-500 text-white' : 'bg-gray-600 text-gray-300 hover:bg-gray-500'\n                      }`}\n                    >\n                      A: {hasPointA ? formatTime(loopStart) : '--:--'}\n                    </button>\n                    <button\n                      onClick={() => setLoopPoint('end')}\n                      className={`px-2 py-1 rounded text-xs transition-colors ${\n                        hasPointB ? 'bg-red-500 text-white' : 'bg-gray-600 text-gray-300 hover:bg-gray-500'\n                      }`}\n                    >\n                      B: {hasPointB ? formatTime(loopEnd) : '--:--'}\n                    </button>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"text-xs opacity-75\">\n                  {isLoopEnabled && (isLoopSegmentMode && hasPointA && hasPointB ? 'Bucle A-B' : 'Bucle completo')}\n                </div>\n              </div>\n            </div>\n\n            {/* Indicador de progreso de la secuencia */}\n            {videos.length > 1 && (\n              <div className=\"mt-2\">\n                <div className=\"flex items-center justify-between text-xs text-gray-300 mb-1\">\n                  <span>Progreso de la secuencia</span>\n                  <span>{currentVideoIndex + 1} de {videos.length}</span>\n                </div>\n                <div className=\"w-full h-1 bg-gray-600 rounded-full\">\n                  <div \n                    className=\"h-full bg-blue-500 rounded-full transition-all duration-300\"\n                    style={{ width: `${((currentVideoIndex + 1) / videos.length) * 100}%` }}\n                  />\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default SequenceVideoPlayer\n","class VideoCombiner {\r\n  constructor() {\r\n    this.isLoaded = true // No necesitamos cargar nada\r\n  }\r\n\r\n  async load() {\r\n    // No necesitamos cargar nada\r\n    return Promise.resolve()\r\n  }\r\n\r\n  // Método principal que usa MediaRecorder optimizado para capturar todos los frames\r\n  async combineVideos(videos, onProgress) {\r\n    try {\r\n      console.log('Iniciando combinación con MediaRecorder optimizado...')\r\n      \r\n      if (onProgress) {\r\n        onProgress({\r\n          stage: 'init',\r\n          current: 0,\r\n          total: 100,\r\n          message: 'Iniciando MediaRecorder...'\r\n        })\r\n      }\r\n\r\n      // Descargar todos los videos\r\n      const videoBlobs = []\r\n      \r\n      for (let i = 0; i < videos.length; i++) {\r\n        const video = videos[i]\r\n        console.log(`Descargando video ${i + 1}/${videos.length}: ${video.title}`)\r\n        \r\n        if (onProgress) {\r\n          onProgress({\r\n            stage: 'download',\r\n            current: ((i + 1) / videos.length) * 50,\r\n            total: 100,\r\n            message: `Descargando: ${video.title}`\r\n          })\r\n        }\r\n\r\n        try {\r\n          // Usar Firebase SDK para obtener URL de descarga\r\n          const { ref, getDownloadURL } = await import('firebase/storage')\r\n          const { storage } = await import('../firebase/config')\r\n          \r\n          const videoRef = ref(storage, video.videoPath)\r\n          const downloadURL = await getDownloadURL(videoRef)\r\n          \r\n          console.log(`URL de descarga obtenida para ${video.title}:`, downloadURL)\r\n\r\n          // Descargar video para combinación\r\n          const response = await fetch(downloadURL)\r\n          if (!response.ok) {\r\n            throw new Error(`Error descargando video: ${response.statusText}`)\r\n          }\r\n          \r\n          const videoBlob = await response.blob()\r\n          videoBlobs.push(videoBlob)\r\n          \r\n          console.log(`Video ${i + 1} descargado: ${video.title}`)\r\n          \r\n        } catch (error) {\r\n          console.error(`Error con video ${video.title}:`, error)\r\n          throw new Error(`Error procesando video ${video.title}: ${error.message}`)\r\n        }\r\n      }\r\n\r\n      if (onProgress) {\r\n        onProgress({\r\n          stage: 'combine',\r\n          current: 50,\r\n          total: 100,\r\n          message: 'Combinando videos...'\r\n        })\r\n      }\r\n\r\n      // Crear un video combinado usando MediaRecorder optimizado\r\n      const combinedBlob = await this.combineVideoBlobs(videoBlobs)\r\n\r\n      if (onProgress) {\r\n        onProgress({\r\n          stage: 'complete',\r\n          current: 100,\r\n          total: 100,\r\n          message: '¡Combinación completada!'\r\n        })\r\n      }\r\n\r\n      console.log('Combinación completada, archivo creado')\r\n      return combinedBlob\r\n\r\n    } catch (error) {\r\n      console.error('Error combinando videos:', error)\r\n      throw new Error(`Error combinando videos: ${error.message}`)\r\n    }\r\n  }\r\n\r\n  // Método para combinar blobs de video con calidad optimizada\r\n  async combineVideoBlobs(videoBlobs) {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        // Crear un canvas para combinar los videos\r\n        const canvas = document.createElement('canvas')\r\n        const ctx = canvas.getContext('2d')\r\n        \r\n        // Configurar canvas con resolución alta\r\n        canvas.width = 1920\r\n        canvas.height = 1080\r\n        \r\n        // Crear MediaRecorder con máxima calidad y FPS alto\r\n        const stream = canvas.captureStream(60) // 60 FPS para suavidad\r\n        const mediaRecorder = new MediaRecorder(stream, {\r\n          mimeType: 'video/webm;codecs=vp9',\r\n          videoBitsPerSecond: 30000000 // 30 Mbps para máxima calidad\r\n        })\r\n        \r\n        const chunks = []\r\n        \r\n        mediaRecorder.ondataavailable = (event) => {\r\n          if (event.data.size > 0) {\r\n            chunks.push(event.data)\r\n          }\r\n        }\r\n        \r\n        mediaRecorder.onstop = () => {\r\n          const combinedBlob = new Blob(chunks, { type: 'video/webm' })\r\n          resolve(combinedBlob)\r\n        }\r\n        \r\n        mediaRecorder.onerror = (error) => {\r\n          reject(error)\r\n        }\r\n        \r\n        // Iniciar grabación\r\n        mediaRecorder.start()\r\n        \r\n        // Procesar cada video\r\n        let currentVideoIndex = 0\r\n        \r\n        const processNextVideo = () => {\r\n          if (currentVideoIndex >= videoBlobs.length) {\r\n            mediaRecorder.stop()\r\n            return\r\n          }\r\n          \r\n          const videoBlob = videoBlobs[currentVideoIndex]\r\n          const videoUrl = URL.createObjectURL(videoBlob)\r\n          const video = document.createElement('video')\r\n          \r\n          video.onloadedmetadata = () => {\r\n            video.currentTime = 0\r\n            video.muted = false\r\n            video.volume = 1.0\r\n            video.play()\r\n          }\r\n          \r\n          video.ontimeupdate = () => {\r\n            // Dibujar el frame actual en el canvas con máxima calidad\r\n            ctx.imageSmoothingEnabled = true\r\n            ctx.imageSmoothingQuality = 'high'\r\n            \r\n            // Limpiar canvas antes de dibujar\r\n            ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n            \r\n            // Calcular dimensiones para mantener proporción\r\n            const videoAspect = video.videoWidth / video.videoHeight\r\n            const canvasAspect = canvas.width / canvas.height\r\n            \r\n            let drawWidth, drawHeight, offsetX, offsetY\r\n            \r\n            if (videoAspect > canvasAspect) {\r\n              // Video más ancho que canvas\r\n              drawWidth = canvas.width\r\n              drawHeight = canvas.width / videoAspect\r\n              offsetX = 0\r\n              offsetY = (canvas.height - drawHeight) / 2\r\n            } else {\r\n              // Video más alto que canvas\r\n              drawHeight = canvas.height\r\n              drawWidth = canvas.height * videoAspect\r\n              offsetX = (canvas.width - drawWidth) / 2\r\n              offsetY = 0\r\n            }\r\n            \r\n            // Dibujar video centrado y escalado\r\n            ctx.drawImage(video, offsetX, offsetY, drawWidth, drawHeight)\r\n          }\r\n          \r\n          // Usar requestAnimationFrame para capturar TODOS los frames\r\n          video.onplay = () => {\r\n            const renderFrame = () => {\r\n              if (!video.paused && !video.ended) {\r\n                ctx.imageSmoothingEnabled = true\r\n                ctx.imageSmoothingQuality = 'high'\r\n                \r\n                // Limpiar canvas antes de dibujar\r\n                ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n                \r\n                // Calcular dimensiones para mantener proporción\r\n                const videoAspect = video.videoWidth / video.videoHeight\r\n                const canvasAspect = canvas.width / canvas.height\r\n                \r\n                let drawWidth, drawHeight, offsetX, offsetY\r\n                \r\n                if (videoAspect > canvasAspect) {\r\n                  drawWidth = canvas.width\r\n                  drawHeight = canvas.width / videoAspect\r\n                  offsetX = 0\r\n                  offsetY = (canvas.height - drawHeight) / 2\r\n                } else {\r\n                  drawHeight = canvas.height\r\n                  drawWidth = canvas.height * videoAspect\r\n                  offsetX = (canvas.width - drawWidth) / 2\r\n                  offsetY = 0\r\n                }\r\n                \r\n                // Dibujar video centrado y escalado\r\n                ctx.drawImage(video, offsetX, offsetY, drawWidth, drawHeight)\r\n                \r\n                // Continuar renderizando inmediatamente para capturar todos los frames\r\n                requestAnimationFrame(renderFrame)\r\n              }\r\n            }\r\n            \r\n            // Iniciar renderizado inmediato\r\n            requestAnimationFrame(renderFrame)\r\n          }\r\n          \r\n          video.onended = () => {\r\n            URL.revokeObjectURL(videoUrl)\r\n            currentVideoIndex++\r\n            setTimeout(processNextVideo, 100) // Pausa para transición suave\r\n          }\r\n          \r\n          video.src = videoUrl\r\n        }\r\n        \r\n        processNextVideo()\r\n        \r\n      } catch (error) {\r\n        reject(error)\r\n      }\r\n    })\r\n  }\r\n\r\n  // Método simple (igual que el principal)\r\n  async combineVideosSimple(videos, onProgress) {\r\n    return this.combineVideos(videos, onProgress)\r\n  }\r\n\r\n  // Limpiar archivos temporales\r\n  async cleanup(videoFiles) {\r\n    try {\r\n      console.log('Limpiando archivos temporales...')\r\n      \r\n      // Eliminar archivos de video\r\n      for (const file of videoFiles) {\r\n        await this.ffmpeg.deleteFile(file)\r\n      }\r\n      \r\n      // Eliminar archivos del sistema\r\n      await this.ffmpeg.deleteFile('filelist.txt')\r\n      await this.ffmpeg.deleteFile('output.mp4')\r\n      \r\n      console.log('Archivos temporales eliminados')\r\n    } catch (error) {\r\n      console.warn('Error limpiando archivos temporales:', error)\r\n    }\r\n  }\r\n\r\n  // Método para obtener información del video\r\n  async getVideoInfo(videoUrl) {\r\n    try {\r\n      const response = await fetch(videoUrl)\r\n      const blob = await response.blob()\r\n      \r\n      return {\r\n        size: blob.size,\r\n        type: blob.type,\r\n        duration: null // No podemos obtener duración sin procesar el video\r\n      }\r\n    } catch (error) {\r\n      console.error('Error obteniendo información del video:', error)\r\n      return null\r\n    }\r\n  }\r\n}\r\n\r\nexport default VideoCombiner\r\n","import React, { useState, useEffect } from 'react'\r\nimport { X, Download, AlertCircle, CheckCircle, Loader } from 'lucide-react'\r\nimport VideoCombiner from '../../services/video/videoCombiner'\r\n\r\nconst VideoDownloadModal = ({ \r\n  isOpen, \r\n  onClose, \r\n  videos, \r\n  sequenceName = 'Secuencia' \r\n}) => {\r\n  const [progress, setProgress] = useState(null)\r\n  const [isProcessing, setIsProcessing] = useState(false)\r\n  const [error, setError] = useState(null)\r\n  const [downloadUrl, setDownloadUrl] = useState(null)\r\n  const [quality, setQuality] = useState('fast') // 'fast' o 'professional'\r\n\r\n  const videoCombiner = new VideoCombiner()\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setProgress(null)\r\n      setError(null)\r\n      setDownloadUrl(null)\r\n      setIsProcessing(false)\r\n    }\r\n  }, [isOpen])\r\n\r\n  const handleDownload = async () => {\r\n    if (!videos || videos.length === 0) {\r\n      setError('No hay videos para combinar')\r\n      return\r\n    }\r\n\r\n    setIsProcessing(true)\r\n    setError(null)\r\n    setProgress({\r\n      stage: 'init',\r\n      current: 0,\r\n      total: 100,\r\n      message: 'Iniciando FFmpeg.wasm...'\r\n    })\r\n\r\n    try {\r\n      console.log('Iniciando combinación con FFmpeg.wasm...')\r\n      const combinedBlob = await videoCombiner.combineVideos(videos, setProgress)\r\n\r\n      // Crear URL para descarga\r\n      const url = URL.createObjectURL(combinedBlob)\r\n      setDownloadUrl(url)\r\n\r\n      setProgress({\r\n        stage: 'complete',\r\n        current: 100,\r\n        total: 100,\r\n        message: '¡Videos combinados exitosamente!'\r\n      })\r\n\r\n    } catch (error) {\r\n      console.error('Error en descarga:', error)\r\n      setError(`Error combinando videos: ${error.message}`)\r\n      setProgress(null)\r\n    } finally {\r\n      setIsProcessing(false)\r\n    }\r\n  }\r\n\r\n  const handleDownloadFile = () => {\r\n    if (downloadUrl) {\r\n      const link = document.createElement('a')\r\n      link.href = downloadUrl\r\n      link.download = `${sequenceName}.webm`\r\n      document.body.appendChild(link)\r\n      link.click()\r\n      document.body.removeChild(link)\r\n    }\r\n  }\r\n\r\n  const getProgressColor = () => {\r\n    if (error) return 'text-red-500'\r\n    if (progress?.stage === 'complete') return 'text-green-500'\r\n    return 'text-blue-500'\r\n  }\r\n\r\n  const getProgressIcon = () => {\r\n    if (error) return <AlertCircle className=\"h-5 w-5\" />\r\n    if (progress?.stage === 'complete') return <CheckCircle className=\"h-5 w-5\" />\r\n    return <Loader className=\"h-5 w-5 animate-spin\" />\r\n  }\r\n\r\n  const getProgressBarColor = () => {\r\n    if (error) return 'bg-red-500'\r\n    if (progress?.stage === 'complete') return 'bg-green-500'\r\n    return 'bg-blue-500'\r\n  }\r\n\r\n  const getStageDescription = () => {\r\n    switch (progress?.stage) {\r\n      case 'init':\r\n        return 'Inicializando FFmpeg.wasm...'\r\n      case 'download':\r\n        return 'Descargando videos...'\r\n      case 'combine':\r\n        return 'Combinando videos con FFmpeg...'\r\n      case 'finalize':\r\n        return 'Finalizando archivo...'\r\n      case 'complete':\r\n        return '¡Proceso completado!'\r\n      default:\r\n        return 'Preparando...'\r\n    }\r\n  }\r\n\r\n  if (!isOpen) return null\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n      <div className=\"bg-white rounded-lg p-6 w-full max-w-md mx-4\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h2 className=\"text-xl font-semibold text-gray-800\">\r\n            Descargar Secuencia\r\n          </h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-gray-600 transition-colors\"\r\n            disabled={isProcessing}\r\n          >\r\n            <X className=\"h-5 w-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <div className=\"space-y-4\">\r\n          {/* Video Info */}\r\n          <div className=\"bg-gray-50 rounded-lg p-3\">\r\n            <p className=\"text-sm text-gray-600\">\r\n              <strong>{videos?.length || 0} videos</strong> serán combinados en uno solo\r\n            </p>\r\n            <p className=\"text-xs text-gray-500 mt-1\">\r\n              Duración total: {videos?.reduce((sum, v) => sum + (v.duration || 0), 0).toFixed(1)}s\r\n              {videos?.some(v => !v.duration) && ' (calculando...)'}\r\n            </p>\r\n            <p className=\"text-xs text-blue-600 mt-1\">\r\n              Formato: WebM (calidad optimizada con MediaRecorder)\r\n            </p>\r\n          </div>\r\n\r\n          {/* Progress */}\r\n          {progress && (\r\n            <div className=\"space-y-3\">\r\n              <div className=\"flex items-center space-x-2\">\r\n                {getProgressIcon()}\r\n                <span className={`text-sm font-medium ${getProgressColor()}`}>\r\n                  {progress.message}\r\n                </span>\r\n              </div>\r\n              \r\n              <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n                <div\r\n                  className={`h-2 rounded-full transition-all duration-300 ${getProgressBarColor()}`}\r\n                  style={{ width: `${progress.current}%` }}\r\n                />\r\n              </div>\r\n              \r\n              <p className=\"text-xs text-gray-500\">\r\n                {getStageDescription()}\r\n              </p>\r\n            </div>\r\n          )}\r\n\r\n          {/* Error */}\r\n          {error && (\r\n            <div className=\"bg-red-50 border border-red-200 rounded-lg p-3\">\r\n              <div className=\"flex items-center space-x-2\">\r\n                <AlertCircle className=\"h-5 w-5 text-red-500\" />\r\n                <span className=\"text-sm text-red-700\">{error}</span>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Success */}\r\n          {downloadUrl && (\r\n            <div className=\"bg-green-50 border border-green-200 rounded-lg p-3\">\r\n              <div className=\"flex items-center space-x-2\">\r\n                <CheckCircle className=\"h-5 w-5 text-green-500\" />\r\n                <span className=\"text-sm text-green-700\">\r\n                  ¡Videos combinados exitosamente!\r\n                </span>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Actions */}\r\n        <div className=\"flex space-x-3 mt-6\">\r\n          {!isProcessing && !downloadUrl && (\r\n            <button\r\n              onClick={handleDownload}\r\n              className=\"flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2\"\r\n            >\r\n              <Download className=\"h-4 w-4\" />\r\n              <span>Combinar Videos</span>\r\n            </button>\r\n          )}\r\n\r\n          {downloadUrl && (\r\n            <button\r\n              onClick={handleDownloadFile}\r\n              className=\"flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center space-x-2\"\r\n            >\r\n              <Download className=\"h-4 w-4\" />\r\n              <span>Descargar WebM</span>\r\n            </button>\r\n          )}\r\n\r\n          <button\r\n            onClick={onClose}\r\n            className=\"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\r\n            disabled={isProcessing}\r\n          >\r\n            {downloadUrl ? 'Cerrar' : 'Cancelar'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default VideoDownloadModal\r\n","// 🎬 COMPONENTE CONSTRUCTOR DE SECUENCIAS - SALSAHACKS V2.0\r\n\r\nimport React, { useState, useEffect } from 'react'\r\nimport { \r\n  Plus, \r\n  Trash2, \r\n  Play, \r\n  Save, \r\n  Edit, \r\n  X, \r\n  ChevronDown, \r\n  ChevronUp,\r\n  Heart, \r\n  Music,\r\n  Shuffle,\r\n  GripVertical\r\n} from 'lucide-react'\r\nimport { useSequenceBuilderContext } from '../../contexts/SequenceBuilderContext'\r\nimport { createSequence, getSequencesByStyle, deleteSequence, subscribeToSequencesByStyle } from '../../services/firebase/sequences'\r\nimport { getVideos, toggleVideoLike } from '../../services/firebase/firestore'\r\nimport { useAuth } from '../../contexts/AuthContext'\r\nimport { useTheme } from '../../contexts/ThemeContext'\r\nimport { useCategories } from '../../hooks/useCategories'\r\nimport { useDragAndDrop } from '../../hooks/useDragAndDrop'\r\nimport Toast from '../common/Toast'\r\nimport ConfirmModal from '../common/ConfirmModal'\r\nimport VideoPlayer from '../video/VideoPlayer.jsx'\r\nimport SequenceTimeline from './SequenceTimeline.jsx'\r\nimport SequenceVideoPlayer from './SequenceVideoPlayer.jsx'\r\nimport BPMController from './BPMController'\r\nimport VideoDownloadModal from '../video/VideoDownloadModal'\r\nimport { processVideoSequence, createSequencePreview } from '../../services/video/videoProcessor'\r\n\r\nconst SequenceBuilder = ({ \r\n  isOpen, \r\n  onClose, \r\n  videos, \r\n  onSaveSequence,\r\n  onToggleShowAll,\r\n  showAllVideos,\r\n  style = 'salsa',\r\n  isIntegrated = false,\r\n  onToggleBuilder\r\n}) => {\r\n  // Usar el hook de categorías para obtener categoriesList y getColorClasses\r\n  const { categoriesList, getColorClasses } = useCategories('figuras', style)\r\n  const { user } = useAuth()\r\n  \r\n  // Estados para procesamiento\r\n\r\n  \r\n  // Estados para reproducción de video individual\r\n  const [selectedVideo, setSelectedVideo] = useState(null)\r\n  const [showVideoModal, setShowVideoModal] = useState(false)\r\n  \r\n  // Estados para preview en tiempo real\r\n  const [isCreatingPreview, setIsCreatingPreview] = useState(false)\r\n  const [previewVideoUrl, setPreviewVideoUrl] = useState(null)\r\n  const [previewError, setPreviewError] = useState(null)\r\n  const [lastPreviewData, setLastPreviewData] = useState(null) // Para cache\r\n\r\n  // Estados para tags de secuencia\r\n  const [sequenceTags, setSequenceTags] = useState({})\r\n  const [isTagsSectionCollapsed, setIsTagsSectionCollapsed] = useState(true)\r\n\r\n  // Estados para modal de descarga\r\n  const [showDownloadModal, setShowDownloadModal] = useState(false)\r\n\r\n  // Estado para BPM actual\r\n  const [currentBPM, setCurrentBPM] = useState(null)\r\n\r\n  // Funciones auxiliares para tags (actualizadas para usar categoriesList)\r\n  const getOrderedTags = (video) => {\r\n    console.log('🏷️ getOrderedTags - video:', video.title, 'tags:', video.tags)\r\n    \r\n    if (!video.tags || Object.keys(video.tags).length === 0) {\r\n      console.log('❌ No hay tags en el video')\r\n      return []\r\n    }\r\n    \r\n    const orderedTags = []\r\n    \r\n    categoriesList.forEach(category => {\r\n      const categoryTags = video.tags[category.key]\r\n      if (Array.isArray(categoryTags)) {\r\n        console.log(`📋 Categoría ${category.key}:`, categoryTags)\r\n        categoryTags.forEach(tag => {\r\n          orderedTags.push({\r\n            tag,\r\n            categoryKey: category.key,\r\n            color: category.color\r\n          })\r\n        })\r\n      }\r\n    })\r\n    \r\n    console.log('✅ Tags ordenados:', orderedTags)\r\n    return orderedTags\r\n  }\r\n\r\n  const getOrderedTagsIniciales = (video) => {\r\n    console.log('🏷️ getOrderedTagsIniciales - video:', video.title, 'tagsIniciales:', video.tagsIniciales)\r\n    \r\n    if (!video.tagsIniciales || Object.keys(video.tagsIniciales).length === 0) {\r\n      console.log('❌ No hay tagsIniciales en el video')\r\n      return []\r\n    }\r\n    \r\n    const orderedTags = []\r\n    \r\n    categoriesList.forEach(category => {\r\n      const categoryTags = video.tagsIniciales[category.key]\r\n      if (Array.isArray(categoryTags)) {\r\n        console.log(`📋 Categoría inicial ${category.key}:`, categoryTags)\r\n        categoryTags.forEach(tag => {\r\n          orderedTags.push({\r\n            tag,\r\n            categoryKey: category.key,\r\n            color: category.color,\r\n            type: 'inicial'\r\n          })\r\n        })\r\n      }\r\n    })\r\n    \r\n    console.log('✅ Tags iniciales ordenados:', orderedTags)\r\n    return orderedTags\r\n  }\r\n\r\n  const getOrderedTagsFinales = (video) => {\r\n    console.log('🏷️ getOrderedTagsFinales - video:', video.title, 'tagsFinales:', video.tagsFinales)\r\n    \r\n    if (!video.tagsFinales || Object.keys(video.tagsFinales).length === 0) {\r\n      console.log('❌ No hay tagsFinales en el video')\r\n      return []\r\n    }\r\n    \r\n    const orderedTags = []\r\n    \r\n    categoriesList.forEach(category => {\r\n      const categoryTags = video.tagsFinales[category.key]\r\n      if (Array.isArray(categoryTags)) {\r\n        console.log(`📋 Categoría final ${category.key}:`, categoryTags)\r\n        categoryTags.forEach(tag => {\r\n          orderedTags.push({\r\n            tag,\r\n            categoryKey: category.key,\r\n            color: category.color,\r\n            type: 'final'\r\n          })\r\n        })\r\n      }\r\n    })\r\n    \r\n    console.log('✅ Tags finales ordenados:', orderedTags)\r\n    return orderedTags\r\n  }\r\n\r\n  const {\r\n    sequence,\r\n    sequenceName,\r\n    sequenceDescription,\r\n    editingSequenceId, // Obtener el ID de la secuencia que se está editando\r\n    addVideoToSequence,\r\n    removeVideoFromSequence,\r\n    reorderSequence,\r\n    generateRandomSequence,\r\n    clearSequence,\r\n    setSequenceName,\r\n    setSequenceDescription,\r\n    isVideoCompatible,\r\n    isVideoInSequence,\r\n    toggleBuilder,\r\n    checkCompatibility\r\n  } = useSequenceBuilderContext()\r\n\r\n  // Calcular BPM promedio de la secuencia\r\n  useEffect(() => {\r\n    const videosWithBPM = sequence.filter(video => video.bpm)\r\n    if (videosWithBPM.length > 0) {\r\n      const bpmValues = videosWithBPM.map(video => video.bpm)\r\n      const averageBPM = bpmValues.reduce((sum, bpm) => sum + bpm, 0) / bpmValues.length\r\n      setCurrentBPM(Math.round(averageBPM))\r\n    } else {\r\n      setCurrentBPM(null)\r\n    }\r\n  }, [sequence])\r\n\r\n  const {\r\n    handleDragStart,\r\n    handleDragOver,\r\n    handleDragEnter,\r\n    handleDragLeave,\r\n    handleDrop,\r\n    handleDragEnd,\r\n    getDragStyles\r\n  } = useDragAndDrop(reorderSequence)\r\n\r\n  const [toasts, setToasts] = useState([])\r\n  const [confirmModal, setConfirmModal] = useState({ isOpen: false, type: null })\r\n  const [randomCount, setRandomCount] = useState(5) // Estado para el número de videos aleatorios\r\n\r\n  const addToast = (message, type = 'success') => {\r\n    const id = Date.now()\r\n    setToasts(prev => [...prev, { id, message, type }])\r\n  }\r\n\r\n  const removeToast = (id) => {\r\n    setToasts(prev => prev.filter(toast => toast.id !== id))\r\n  }\r\n\r\n  // Función para manejar likes\r\n  const handleVideoLike = async (video) => {\r\n    if (!user) {\r\n      addToast('Debes iniciar sesión para dar like', 'error')\r\n      return\r\n    }\r\n\r\n    try {\r\n      const result = await toggleVideoLike(video.id, user.uid)\r\n      \r\n      if (result.success) {\r\n        addToast(`Has ${result.userLiked ? 'dado like a' : 'quitado like de'} \"${video.title}\"`, 'success')\r\n      } else {\r\n        addToast('Error al actualizar like', 'error')\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al manejar like:', error)\r\n      addToast('Error al actualizar like', 'error')\r\n    }\r\n  }\r\n\r\n  const handleGenerateRandom = () => {\r\n    const videosNeeded = randomCount - sequence.length\r\n    \r\n    if (videosNeeded <= 0) {\r\n      addToast('La secuencia ya tiene suficientes videos', 'info')\r\n      return\r\n    }\r\n    \r\n    // Verificar cuántos videos compatibles hay disponibles\r\n    if (sequence.length > 0) {\r\n      const lastVideo = sequence[sequence.length - 1]\r\n      const compatibleVideos = videos.filter(video => \r\n        !sequence.some(seqVideo => seqVideo.id === video.id) && // No incluir ya añadidos\r\n        checkCompatibility(lastVideo, video)\r\n      )\r\n      \r\n      if (compatibleVideos.length === 0) {\r\n        addToast('No hay videos compatibles disponibles para continuar la secuencia', 'warning')\r\n        return\r\n      }\r\n      \r\n      if (compatibleVideos.length < videosNeeded) {\r\n        addToast(`Solo hay ${compatibleVideos.length} videos compatibles disponibles de los ${videosNeeded} necesarios`, 'info')\r\n        // Completar con los disponibles\r\n        generateRandomSequence(videos, sequence.length + compatibleVideos.length)\r\n        addToast(`Secuencia completada con ${compatibleVideos.length} videos adicionales`)\r\n        return\r\n      }\r\n    }\r\n    \r\n    // Generar la secuencia completa\r\n    generateRandomSequence(videos, randomCount)\r\n    addToast(`Secuencia completada hasta ${randomCount} videos`)\r\n  }\r\n\r\n  const handleSaveSequence = async () => {\r\n    console.log('💾 Intentando guardar secuencia...')\r\n    console.log('📝 Nombre:', sequenceName)\r\n    console.log('📋 Videos en secuencia:', sequence.length)\r\n    console.log('🎨 Estilo:', style)\r\n    console.log('🔄 Editando secuencia ID:', editingSequenceId)\r\n    \r\n    if (!sequenceName.trim()) {\r\n      addToast('Por favor, añade un nombre a la secuencia', 'error')\r\n      return\r\n    }\r\n\r\n    if (sequence.length === 0) {\r\n      addToast('La secuencia debe tener al menos un video', 'error')\r\n      return\r\n    }\r\n\r\n    try {\r\n      // Generar thumbnail de la secuencia\r\n      const thumbnailUrl = await generateSequenceThumbnail()\r\n      \r\n      const sequenceData = {\r\n        name: sequenceName,\r\n        description: sequenceDescription,\r\n        videos: sequence,\r\n        style: style,\r\n        tags: sequenceTags, // Agregar tags de secuencia\r\n        thumbnailUrl: thumbnailUrl, // Agregar thumbnail\r\n        resolution: sequence.length > 0 ? sequence[0].resolution : 'HD', // Usar resolución del primer video\r\n        createdAt: new Date().toISOString()\r\n      }\r\n      \r\n      // Si estamos editando una secuencia existente, incluir el ID\r\n      if (editingSequenceId) {\r\n        sequenceData.id = editingSequenceId\r\n        console.log('🔄 Guardando como EDICIÓN de secuencia existente:', editingSequenceId)\r\n      } else {\r\n        console.log('🆕 Guardando como NUEVA secuencia')\r\n      }\r\n      \r\n      console.log('📦 Datos de secuencia a guardar:', sequenceData)\r\n      await onSaveSequence(sequenceData)\r\n      \r\n      const message = editingSequenceId \r\n        ? '✅ Secuencia actualizada exitosamente'\r\n        : '✅ Secuencia guardada exitosamente. Ve a \"GALERÍA DE SECUENCIAS\" para verla.'\r\n      \r\n      addToast(message)\r\n      clearSequence()\r\n      if (onToggleBuilder) {\r\n        onToggleBuilder()\r\n      }\r\n    } catch (error) {\r\n      console.error('❌ Error al guardar secuencia:', error)\r\n      addToast('Error al guardar la secuencia', 'error')\r\n    }\r\n  }\r\n\r\n  const handleCancel = () => {\r\n    if (sequence.length > 0 || sequenceName.trim() || sequenceDescription.trim()) {\r\n      setConfirmModal({ isOpen: true, type: 'cancel' })\r\n    } else {\r\n      if (onToggleBuilder) {\r\n        onToggleBuilder()\r\n      }\r\n    }\r\n  }\r\n\r\n  const handleClearSequence = () => {\r\n    setConfirmModal({ isOpen: true, type: 'clear' })\r\n  }\r\n\r\n  const handleConfirmAction = () => {\r\n    if (confirmModal.type === 'cancel') {\r\n      clearSequence()\r\n      if (onToggleBuilder) {\r\n        onToggleBuilder()\r\n      }\r\n    } else if (confirmModal.type === 'clear') {\r\n      clearSequence()\r\n    }\r\n    setConfirmModal({ isOpen: false, type: null })\r\n  }\r\n  \r\n  // Efecto para generar preview en tiempo real cuando cambie la secuencia\r\n  useEffect(() => {\r\n    const timeoutId = setTimeout(() => {\r\n      generateRealtimePreview()\r\n    }, 500) // Debounce de 500ms para evitar demasiadas regeneraciones\r\n\r\n    return () => clearTimeout(timeoutId)\r\n  }, [sequence]) // Se ejecuta cuando cambia la secuencia\r\n\r\n  // Cleanup de URLs cuando se desmonte el componente\r\n  useEffect(() => {\r\n    return () => {\r\n      if (previewVideoUrl) {\r\n        URL.revokeObjectURL(previewVideoUrl)\r\n      }\r\n    }\r\n  }, [previewVideoUrl])\r\n  \r\n  // Función para obtener resoluciones disponibles basadas en la resolución del video\r\n  const getAvailableResolutions = (video) => {\r\n    if (!video || !video.resolution) {\r\n      return ['auto', '360p', '480p', '720p', '1080p']\r\n    }\r\n    \r\n    const resolution = video.resolution.toLowerCase()\r\n    const resolutions = ['auto']\r\n    \r\n    // Agregar resoluciones hasta la máxima disponible\r\n    if (resolution.includes('4k') || resolution.includes('2160p')) {\r\n      resolutions.push('360p', '480p', '720p', '1080p', '4k')\r\n    } else if (resolution.includes('1080p') || resolution.includes('1920')) {\r\n      resolutions.push('360p', '480p', '720p', '1080p')\r\n    } else if (resolution.includes('720p') || resolution.includes('1280')) {\r\n      resolutions.push('360p', '480p', '720p')\r\n    } else if (resolution.includes('480p') || resolution.includes('854')) {\r\n      resolutions.push('360p', '480p')\r\n    } else {\r\n      resolutions.push('360p')\r\n    }\r\n    \r\n    return resolutions\r\n  }\r\n\r\n  // Función para reproducir video individual\r\n  const handlePlayVideo = (video) => {\r\n    console.log('🎬 Reproduciendo video individual:', video.title)\r\n    setSelectedVideo(video)\r\n    setShowVideoModal(true)\r\n    addToast(`🎬 Reproduciendo: ${video.title}`, 'info')\r\n  }\r\n\r\n  // Función para generar preview en tiempo real\r\n  const generateRealtimePreview = async () => {\r\n    if (!sequence || sequence.length === 0) {\r\n      setPreviewVideoUrl(null)\r\n      setPreviewError(null)\r\n      return\r\n    }\r\n    \r\n    // Crear clave de cache para verificar si necesitamos regenerar\r\n    const previewKey = JSON.stringify({\r\n      videos: sequence.map(v => v.id),\r\n      sequenceLength: sequence.length\r\n    })\r\n    \r\n    // Si ya tenemos el mismo preview, no regenerar\r\n    if (lastPreviewData === previewKey && previewVideoUrl) {\r\n      return\r\n    }\r\n    \r\n    setIsCreatingPreview(true)\r\n    setPreviewError(null)\r\n    \r\n    try {\r\n      console.log('🎬 Generando preview en tiempo real...')\r\n      \r\n      // Verificar que todos los videos tengan URLs válidas\r\n      const validVideos = sequence.filter(video => video.videoUrl)\r\n      \r\n      if (validVideos.length === 0) {\r\n        throw new Error('No hay videos válidos en la secuencia')\r\n      }\r\n      \r\n      // Para el preview en tiempo real, usaremos el SequenceTimeline\r\n      // que muestra los videos en una línea de tiempo como CapCut\r\n      setPreviewVideoUrl('sequence-timeline') // Marcador especial para indicar que usamos el timeline\r\n      setLastPreviewData(previewKey)\r\n      \r\n      console.log('✅ Preview en tiempo real generado (modo timeline)')\r\n      \r\n    } catch (error) {\r\n      console.error('❌ Error al generar preview en tiempo real:', error)\r\n      setPreviewError(error.message)\r\n    } finally {\r\n      setIsCreatingPreview(false)\r\n    }\r\n  }\r\n\r\n\r\n\r\n  // Funciones para manejar tags de secuencia\r\n  const handleTagToggle = (categoryKey, tag) => {\r\n    setSequenceTags(prevTags => {\r\n      const currentTags = prevTags[categoryKey] || []\r\n      const isSelected = currentTags.includes(tag)\r\n      \r\n      if (isSelected) {\r\n        // Remover tag\r\n        const newTags = currentTags.filter(t => t !== tag)\r\n        if (newTags.length === 0) {\r\n          const { [categoryKey]: removed, ...rest } = prevTags\r\n          return rest\r\n        } else {\r\n          return { ...prevTags, [categoryKey]: newTags }\r\n        }\r\n      } else {\r\n        // Agregar tag\r\n        return { ...prevTags, [categoryKey]: [...currentTags, tag] }\r\n      }\r\n    })\r\n  }\r\n\r\n  const isTagSelected = (categoryKey, tag) => {\r\n    return sequenceTags[categoryKey]?.includes(tag) || false\r\n  }\r\n\r\n  const getOrderedSequenceTags = () => {\r\n    const orderedTags = []\r\n    \r\n    categoriesList.forEach(category => {\r\n      const categoryTags = sequenceTags[category.key]\r\n      if (Array.isArray(categoryTags)) {\r\n        categoryTags.forEach(tag => {\r\n          orderedTags.push({\r\n            tag,\r\n            categoryKey: category.key,\r\n            color: category.color\r\n          })\r\n        })\r\n      }\r\n    })\r\n    \r\n    return orderedTags\r\n  }\r\n\r\n  // Función para generar thumbnail de la secuencia\r\n  const generateSequenceThumbnail = async () => {\r\n    if (sequence.length === 0) return null\r\n    \r\n    try {\r\n      // Usar el primer video como base para el thumbnail\r\n      const firstVideo = sequence[0]\r\n      \r\n      // Si el primer video tiene thumbnail, usarlo como base\r\n      if (firstVideo.thumbnailUrl) {\r\n        return firstVideo.thumbnailUrl\r\n      }\r\n      \r\n      // Si no, generar un thumbnail del video\r\n      const { getStorage, ref, getDownloadURL } = await import('firebase/storage')\r\n      const storage = getStorage()\r\n      const videoRef = ref(storage, firstVideo.videoUrl)\r\n      const downloadURL = await getDownloadURL(videoRef)\r\n      \r\n      // Por ahora, usar la URL del video como thumbnail\r\n      // En el futuro, se podría generar un thumbnail real del video\r\n      return downloadURL\r\n    } catch (error) {\r\n      console.error('Error al generar thumbnail:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  // Si no está abierto, no renderizar\r\n  if (!isOpen) return null\r\n\r\n  return (\r\n    <>\r\n      <div className=\"bg-white rounded-lg border border-gray-200 shadow-sm mb-6\">\r\n        {/* Header del constructor */}\r\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-200\">\r\n          <div className=\"flex items-center space-x-4\">\r\n            <h2 className=\"text-xl font-bold text-gray-800\">Constructor de Secuencias</h2>\r\n            <span className=\"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium\">\r\n              {sequence.length} videos\r\n            </span>\r\n          </div>\r\n          <div className=\"flex items-center space-x-2\">\r\n            <button\r\n              onClick={onToggleBuilder}\r\n              className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\r\n            >\r\n              <X className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Contenido del constructor */}\r\n        <div className=\"p-4\">\r\n          {/* Controles superiores */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\r\n            {/* Nombre y descripción */}\r\n            <div className=\"md:col-span-2 space-y-3\">\r\n              <div className=\"space-y-1\">\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Nombre de la secuencia...\"\r\n                  value={sequenceName}\r\n                  onChange={(e) => setSequenceName(e.target.value)}\r\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                />\r\n                {!sequenceName.trim() && sequence.length > 0 && (\r\n                  <p className=\"text-xs text-orange-600\">\r\n                    ⚠️ Añade un nombre para poder guardar la secuencia\r\n                  </p>\r\n                )}\r\n              </div>\r\n              <textarea\r\n                placeholder=\"Descripción (opcional)...\"\r\n                value={sequenceDescription}\r\n                onChange={(e) => setSequenceDescription(e.target.value)}\r\n                rows=\"2\"\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\r\n              />\r\n            </div>\r\n\r\n            {/* Botones de acción */}\r\n            <div className=\"flex flex-col space-y-3\">\r\n              <div className=\"space-y-2\">\r\n                <label className=\"block text-sm font-medium text-gray-700 text-center\">\r\n                  Número de videos:\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  value={randomCount}\r\n                  onChange={(e) => setRandomCount(Math.max(1, parseInt(e.target.value) || 5))}\r\n                  min=\"1\"\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-center text-sm\"\r\n                  placeholder=\"5\"\r\n                />\r\n                {sequence.length > 0 && (\r\n                  <div className=\"text-xs text-gray-500 text-center\">\r\n                    {(() => {\r\n                      const lastVideo = sequence[sequence.length - 1]\r\n                      const compatibleVideos = videos.filter(video => \r\n                        !sequence.some(seqVideo => seqVideo.id === video.id) &&\r\n                        checkCompatibility(lastVideo, video)\r\n                      )\r\n                      const videosNeeded = randomCount - sequence.length\r\n                      return `${compatibleVideos.length} compatibles disponibles (necesitas ${videosNeeded})`\r\n                    })()}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              <button\r\n                onClick={handleGenerateRandom}\r\n                className=\"flex items-center justify-center space-x-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-colors\"\r\n              >\r\n                <Shuffle className=\"w-4 h-4\" />\r\n                <span>Completar hasta {randomCount}</span>\r\n              </button>\r\n              <button\r\n                onClick={handleClearSequence}\r\n                className=\"flex items-center justify-center space-x-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors\"\r\n              >\r\n                <Trash2 className=\"w-4 h-4\" />\r\n                <span>Limpiar</span>\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Preview en tiempo real */}\r\n          <div className=\"mb-6\">\r\n            <div className=\"bg-gray-50 rounded-lg p-4 border border-gray-200\">\r\n              <h3 className=\"text-lg font-semibold text-gray-800 mb-3 flex items-center\">\r\n                <Play className=\"h-5 w-5 text-blue-600 mr-2\" />\r\n                Preview en Tiempo Real\r\n              </h3>\r\n              \r\n              {isCreatingPreview && (\r\n                <div className=\"flex items-center justify-center py-8\">\r\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3\"></div>\r\n                  <span className=\"text-gray-600\">Generando preview...</span>\r\n                </div>\r\n              )}\r\n              \r\n              {previewError && (\r\n                <div className=\"flex items-center justify-center py-8 text-red-600\">\r\n                  <span>❌ Error: {previewError}</span>\r\n                </div>\r\n              )}\r\n              \r\n              {!isCreatingPreview && !previewError && previewVideoUrl && (\r\n                <div className=\"space-y-4\">\r\n                  {/* Video Player Principal */}\r\n                  {previewVideoUrl === 'sequence-timeline' ? (\r\n                    <SequenceVideoPlayer\r\n                      videos={sequence}\r\n                      currentBPM={currentBPM}\r\n                      className=\"w-full h-96\"\r\n                      showControls={true}\r\n                      autoplay={false}\r\n                      loop={false}\r\n                      muted={false}\r\n                    />\r\n                  ) : (\r\n                    <div className=\"bg-black rounded-lg overflow-hidden\">\r\n                      <VideoPlayer\r\n                        src={previewVideoUrl}\r\n                        className=\"w-full h-96 object-contain\"\r\n                        showControls={true}\r\n                        autoplay={false}\r\n                        loop={false}\r\n                        muted={false}\r\n                        size=\"medium\"\r\n                        videoTitle=\"Preview de Secuencia\"\r\n                      />\r\n                    </div>\r\n                  )}\r\n                  \r\n\r\n                </div>\r\n              )}\r\n              \r\n              {!isCreatingPreview && !previewError && sequence.length === 0 && (\r\n                <div className=\"flex items-center justify-center py-8 text-gray-500\">\r\n                  <span>Añade videos a la secuencia para ver el preview</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n          \r\n\r\n\r\n          {/* Secuencia actual */}\r\n          <div className=\"mb-6\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <h3 className=\"text-lg font-semibold text-gray-700\">Secuencia Actual ({sequence.length} videos)</h3>\r\n              \r\n              {/* Botón de descarga prominente */}\r\n\r\n            </div>\r\n            \r\n            {sequence.length === 0 ? (\r\n              <div className=\"text-center py-8 text-gray-500 bg-gray-50 rounded-lg\">\r\n                <Plus className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\r\n                <p>No hay videos en la secuencia</p>\r\n                <p className=\"text-sm\">Selecciona videos de la galería para comenzar</p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                {sequence.map((video, index) => (\r\n                  <div\r\n                    key={`${video.id}-${index}`}\r\n                    draggable\r\n                    onDragStart={() => handleDragStart(index)}\r\n                    onDragOver={(e) => handleDragOver(e, index)}\r\n                    onDragEnter={(e) => handleDragEnter(e, index)}\r\n                    onDragLeave={handleDragLeave}\r\n                    onDrop={(e) => handleDrop(e, index)}\r\n                    onDragEnd={handleDragEnd}\r\n                    style={getDragStyles(index)}\r\n                    className=\"bg-white rounded-lg shadow-md overflow-hidden border border-gray-100 hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02] relative\"\r\n                  >\r\n                    {/* Header con número de orden y botón eliminar */}\r\n                    <div className=\"absolute top-2 left-2 z-10 flex items-center space-x-2\">\r\n                      <div className=\"bg-purple-500 text-white px-2 py-1 rounded-full text-sm font-bold shadow-lg\">\r\n                        #{index + 1}\r\n                      </div>\r\n                      <button\r\n                        onClick={() => removeVideoFromSequence(index)}\r\n                        className=\"bg-red-500 text-white p-1 rounded-full hover:bg-red-600 transition-colors shadow-lg\"\r\n                        title=\"Eliminar de la secuencia\"\r\n                      >\r\n                        <Trash2 className=\"w-3 h-3\" />\r\n                      </button>\r\n                    </div>\r\n\r\n                    {/* Grip handle para arrastrar */}\r\n                    <div className=\"absolute top-2 right-2 z-10\">\r\n                      <GripVertical className=\"w-5 h-5 text-gray-400 cursor-grab hover:text-gray-600 transition-colors\" />\r\n                    </div>\r\n\r\n                    {/* Thumbnail */}\r\n                    <div className=\"relative group\">\r\n                      <div className=\"w-full aspect-video bg-gradient-to-br from-gray-100 to-gray-200 relative overflow-hidden flex items-center justify-center\">\r\n                        {video.thumbnailUrl && video.thumbnailUrl !== 'https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO' ? (\r\n                          <img\r\n                            src={video.thumbnailUrl}\r\n                            alt={video.title}\r\n                            className=\"w-full h-full object-cover\"\r\n                            loading=\"lazy\"\r\n                            onError={(e) => {\r\n                              e.target.style.display = 'none';\r\n                              e.target.nextSibling.style.display = 'flex';\r\n                            }}\r\n                          />\r\n                        ) : null}\r\n                        <div className={`flex flex-col items-center justify-center text-gray-500 ${video.thumbnailUrl && video.thumbnailUrl !== 'https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO' ? 'hidden' : 'flex'}`}>\r\n                          <svg className=\"w-12 h-12 mb-2 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\" />\r\n                          </svg>\r\n                          <span className=\"text-sm font-medium\">{video.title}</span>\r\n                        </div>\r\n                        <div className=\"absolute bottom-2 left-2 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-sm font-medium\">\r\n                          {video.resolution && video.resolution !== 'Unknown' ? video.resolution : 'HD'}\r\n                        </div>\r\n                        \r\n                        {/* Botón de play */}\r\n                        <button\r\n                          onClick={() => handlePlayVideo(video)}\r\n                          className=\"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-200\"\r\n                        >\r\n                          <svg className=\"w-12 h-12 text-white\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path d=\"M8 5v14l11-7z\"/>\r\n                          </svg>\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    {/* Contenido del card */}\r\n                    <div className=\"p-4\">\r\n                      {/* Título y rating */}\r\n                      <div className=\"flex items-center justify-between mb-2\">\r\n                        <h3 className=\"font-semibold text-gray-800 text-lg truncate\">{video.title}</h3>\r\n                        <div className=\"flex items-center space-x-1\">\r\n                          {[1, 2, 3, 4, 5].map(star => {\r\n                            const isFilled = (video.rating || 0) >= star\r\n                            return (\r\n                              <svg \r\n                                key={star}\r\n                                className={`h-4 w-4 ${isFilled ? 'text-yellow-400 fill-current' : 'text-gray-300'}`} \r\n                                fill=\"currentColor\" \r\n                                viewBox=\"0 0 24 24\"\r\n                              >\r\n                                <path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\"/>\r\n                              </svg>\r\n                            )\r\n                          })}\r\n                          <span className=\"text-xs font-medium text-gray-500 ml-1\">({video.rating || 0})</span>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Descripción */}\r\n                      <p className=\"text-gray-600 text-sm mb-3 line-clamp-2\">{video.description || 'Sin descripción'}</p>\r\n                      \r\n                      {/* Tags Normales */}\r\n                      <div className=\"flex flex-wrap gap-2 mb-3\">\r\n                        {(() => {\r\n                          const orderedTags = getOrderedTags(video)\r\n                          if (orderedTags.length > 0) {\r\n                            return orderedTags.map(({ tag, categoryKey, color }) => (\r\n                              <span\r\n                                key={`${categoryKey}-${tag}`}\r\n                                className={`px-2 py-1 rounded-full text-xs font-medium ${getColorClasses(color)}`}\r\n                              >\r\n                                {tag}\r\n                              </span>\r\n                            ))\r\n                          } else {\r\n                            return <span className=\"text-gray-400 text-sm\">Sin etiquetas</span>\r\n                          }\r\n                        })()}\r\n                      </div>\r\n\r\n                      {/* Tags Iniciales */}\r\n                      {(() => {\r\n                        const tagsIniciales = getOrderedTagsIniciales(video)\r\n                        if (tagsIniciales.length > 0) {\r\n                          return (\r\n                            <div className=\"mb-3\">\r\n                              <div className=\"flex items-center space-x-2 mb-2\">\r\n                                <span className=\"text-xs font-medium text-blue-600 uppercase tracking-wide\">Iniciales:</span>\r\n                              </div>\r\n                              <div className=\"flex flex-wrap gap-2\">\r\n                                {tagsIniciales.map(({ tag, categoryKey, color }) => (\r\n                                  <span\r\n                                    key={`inicial-${categoryKey}-${tag}`}\r\n                                    className=\"px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-sm\"\r\n                                  >\r\n                                    {tag}\r\n                                  </span>\r\n                                ))}\r\n                              </div>\r\n                            </div>\r\n                          )\r\n                        }\r\n                        return null\r\n                      })()}\r\n\r\n                      {/* Tags Finales */}\r\n                      {(() => {\r\n                        const tagsFinales = getOrderedTagsFinales(video)\r\n                        if (tagsFinales.length > 0) {\r\n                          return (\r\n                            <div className=\"mb-3\">\r\n                              <div className=\"flex items-center space-x-2 mb-2\">\r\n                                <span className=\"text-xs font-medium text-green-600 uppercase tracking-wide\">Finales:</span>\r\n                              </div>\r\n                              <div className=\"flex flex-wrap gap-2\">\r\n                                {tagsFinales.map(({ tag, categoryKey, color }) => (\r\n                                  <span\r\n                                    key={`final-${categoryKey}-${tag}`}\r\n                                    className=\"px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-sm\"\r\n                                  >\r\n                                    {tag}\r\n                                  </span>\r\n                                ))}\r\n                              </div>\r\n                            </div>\r\n                          )\r\n                        }\r\n                        return null\r\n                      })()}\r\n                      \r\n                      {/* Stats del video */}\r\n                      <div className=\"flex items-center justify-between text-sm text-gray-500 pt-2 border-t border-gray-100\">\r\n                        <div className=\"flex items-center space-x-2\">\r\n                          <span className=\"font-medium\">\r\n                            {(video.fileSize / (1024 * 1024)).toFixed(2)} MB\r\n                          </span>\r\n                          <span className=\"text-gray-400\">•</span>\r\n                          <span className=\"text-gray-600\">\r\n                            {video.resolution && video.resolution !== 'Unknown' ? \r\n                              video.resolution : \r\n                              'HD'\r\n                            }\r\n                          </span>\r\n                          <span className=\"text-gray-400\">•</span>\r\n                          <div className=\"flex items-center space-x-1\">\r\n                            <Music className=\"h-3 w-3 text-purple-500\" />\r\n                            <span className=\"font-medium text-purple-600\">{video.bpm || 'N/A'} BPM</span>\r\n                          </div>\r\n                        </div>\r\n                        <button \r\n                          onClick={() => handleVideoLike(video)}\r\n                          className={`flex items-center space-x-1 transition-colors duration-200 p-1 rounded hover:bg-red-50 ${\r\n                            video.userLiked ? 'text-red-500' : 'text-gray-400 hover:text-red-500'\r\n                          }`}\r\n                          title={video.userLiked ? 'Quitar like' : 'Dar like'}\r\n                        >\r\n                          <Heart className={`h-4 w-4 ${video.userLiked ? 'fill-current' : ''}`} />\r\n                          <span className=\"font-medium\">{video.likes || 0}</span>\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Tags de Secuencia */}\r\n          <div className=\"mb-6\">\r\n            <div className=\"bg-white rounded-lg shadow-md p-4 border border-gray-200\">\r\n              {/* Header con toggle */}\r\n              <div className=\"flex items-center justify-between mb-3\">\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <svg className=\"h-5 w-5 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\" />\r\n                  </svg>\r\n                  <h3 className=\"text-lg font-semibold text-gray-800\">Tags de Secuencia</h3>\r\n                </div>\r\n                <button\r\n                  onClick={() => setIsTagsSectionCollapsed(!isTagsSectionCollapsed)}\r\n                  className=\"p-1 text-gray-500 hover:text-gray-700 transition-colors\"\r\n                  title={isTagsSectionCollapsed ? \"Expandir tags\" : \"Colapsar tags\"}\r\n                >\r\n                  <svg \r\n                    className={`w-4 h-4 transform transition-transform ${isTagsSectionCollapsed ? 'rotate-90' : ''}`}\r\n                    fill=\"none\" \r\n                    stroke=\"currentColor\" \r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n\r\n              {/* Tags seleccionados */}\r\n              {(() => {\r\n                const orderedTags = getOrderedSequenceTags()\r\n                if (orderedTags.length > 0) {\r\n                  return (\r\n                    <div className=\"mb-3\">\r\n                      <div className=\"flex flex-wrap gap-2\">\r\n                        {orderedTags.map(({ tag, categoryKey, color }) => (\r\n                          <span\r\n                            key={`${categoryKey}-${tag}`}\r\n                            className={`px-3 py-1 rounded-full text-sm font-medium ${getColorClasses(color)} flex items-center space-x-1`}\r\n                          >\r\n                            <span>{tag}</span>\r\n                            <button\r\n                              onClick={() => handleTagToggle(categoryKey, tag)}\r\n                              className=\"ml-1 hover:bg-black hover:bg-opacity-20 rounded-full p-0.5\"\r\n                            >\r\n                              <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                              </svg>\r\n                            </button>\r\n                          </span>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  )\r\n                }\r\n                return null\r\n              })()}\r\n\r\n              {/* Categorías de tags - Sección colapsable */}\r\n              <div className={`overflow-hidden transition-all duration-300 ease-in-out ${\r\n                isTagsSectionCollapsed ? 'max-h-0 opacity-0' : 'max-h-96 opacity-100'\r\n              }`}>\r\n                <div className=\"space-y-4\">\r\n                  {categoriesList.map(category => (\r\n                    <div key={category.key} className=\"border-t border-gray-100 pt-3\">\r\n                      <h4 className=\"text-sm font-medium text-gray-700 mb-2 flex items-center space-x-2\">\r\n                        <span className={`w-3 h-3 rounded-full ${getColorClasses(category.color).replace('text-', 'bg-')}`}></span>\r\n                        <span>{category.name}</span>\r\n                      </h4>\r\n                      <div className=\"flex flex-wrap gap-2\">\r\n                        {category.tags.map(tag => (\r\n                          <button\r\n                            key={tag}\r\n                            onClick={() => handleTagToggle(category.key, tag)}\r\n                            className={`px-3 py-1 rounded-full text-sm font-medium transition-colors ${\r\n                              isTagSelected(category.key, tag)\r\n                                ? getColorClasses(category.color)\r\n                                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\r\n                            }`}\r\n                          >\r\n                            {tag}\r\n                          </button>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Botones de guardar/cancelar */}\r\n          <div className=\"flex space-x-3 pt-4 border-t\">\r\n            <button\r\n              onClick={handleSaveSequence}\r\n              disabled={sequence.length === 0 || !sequenceName.trim()}\r\n              className=\"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-lg transition-colors\"\r\n            >\r\n              <Save className=\"w-4 h-4\" />\r\n              <span>{editingSequenceId ? 'Actualizar Secuencia' : 'Guardar Secuencia'}</span>\r\n            </button>\r\n            <button\r\n              onClick={handleCancel}\r\n              className=\"px-6 py-2 border border-gray-300 hover:bg-gray-50 rounded-lg transition-colors\"\r\n            >\r\n              Cancelar\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Modal de video individual */}\r\n      {showVideoModal && selectedVideo && (\r\n                <div\r\n          className=\"fixed inset-0 bg-black bg-opacity-95 flex items-center justify-center z-50 p-4\"\r\n          onClick={() => setShowVideoModal(false)}\r\n        >\r\n          <div\r\n            className=\"bg-black rounded-lg overflow-hidden w-full max-w-6xl max-h-[95vh] flex flex-col\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between p-4 border-b border-gray-700 bg-gray-900\">\r\n              <h3 className=\"text-xl font-semibold text-white\">{selectedVideo.title}</h3>\r\n              <button \r\n                onClick={() => setShowVideoModal(false)}\r\n                className=\"text-gray-400 hover:text-white text-2xl font-bold p-2 hover:bg-gray-800 rounded transition-colors\"\r\n              >\r\n                &times;\r\n              </button>\r\n            </div>\r\n            \r\n            {/* Video Player */}\r\n            <div className=\"flex-1 bg-black flex items-center justify-center p-4\">\r\n              <div className=\"w-full h-full flex items-center justify-center\">\r\n                <VideoPlayer\r\n                  src={selectedVideo.videoUrl}\r\n                  className=\"max-w-full max-h-full object-contain\"\r\n                  showControls={true}\r\n                  autoplay={false}\r\n                  loop={false}\r\n                  muted={false}\r\n                  resolutions={getAvailableResolutions(selectedVideo)}\r\n                  currentResolution=\"auto\"\r\n                  videoTitle={selectedVideo.title}\r\n                  size=\"fullscreen\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n\r\n\r\n      {/* Modales */}\r\n      <ConfirmModal\r\n        isOpen={confirmModal.isOpen}\r\n        onClose={() => setConfirmModal({ isOpen: false, type: null })}\r\n        onConfirm={handleConfirmAction}\r\n        title={\r\n          confirmModal.type === 'cancel' \r\n            ? '¿Cancelar secuencia?' \r\n            : '¿Limpiar secuencia?'\r\n        }\r\n        message={\r\n          confirmModal.type === 'cancel'\r\n            ? '¿Estás seguro de que quieres cancelar? Se perderán todos los cambios.'\r\n            : '¿Estás seguro de que quieres limpiar la secuencia actual?'\r\n        }\r\n        confirmText=\"Confirmar\"\r\n        cancelText=\"Cancelar\"\r\n      />\r\n\r\n      {/* Toasts */}\r\n      {toasts.map(toast => (\r\n        <Toast\r\n          key={toast.id}\r\n          message={toast.message}\r\n          type={toast.type}\r\n          onClose={() => removeToast(toast.id)}\r\n        />\r\n      ))}\r\n\r\n      {/* Modal de descarga */}\r\n      <VideoDownloadModal\r\n        isOpen={showDownloadModal}\r\n        onClose={() => setShowDownloadModal(false)}\r\n        videos={sequence}\r\n        sequenceName={sequenceName || 'Secuencia'}\r\n      />\r\n    </>\r\n  )\r\n}\r\n\r\nexport default SequenceBuilder ","// 🖼️ COMPONENTE SMART THUMBNAIL - SALSAHACKS V2.0\r\n\r\nimport React, { useState } from 'react'\r\nimport { Image, Play } from 'lucide-react'\r\n\r\nconst SmartThumbnail = ({ \r\n  src, \r\n  alt, \r\n  className = '', \r\n  fallbackSrc = '/placeholder-video.svg',\r\n  showPlayIcon = false,\r\n  ...props \r\n}) => {\r\n  const [imageError, setImageError] = useState(false)\r\n  const [isLoading, setIsLoading] = useState(true)\r\n\r\n  const handleImageLoad = () => {\r\n    setIsLoading(false)\r\n    setImageError(false)\r\n  }\r\n\r\n  const handleImageError = () => {\r\n    setIsLoading(false)\r\n    setImageError(true)\r\n  }\r\n\r\n  // Si no hay src o es una URL placeholder, mostrar fallback directamente\r\n  const shouldShowFallback = !src || \r\n    src === null ||\r\n    src === undefined ||\r\n    src === 'https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO' ||\r\n    src === 'https://via.placeholder.com/300x200/1a1a1a/ffffff?text=EVENTO'\r\n  \r\n  const imageSrc = shouldShowFallback || imageError ? fallbackSrc : src\r\n\r\n  return (\r\n    <div className={`relative ${className}`} {...props}>\r\n      {/* Estado de carga mejorado */}\r\n      {isLoading && (\r\n        <div className=\"absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-200 animate-pulse flex items-center justify-center\">\r\n          <div className=\"relative\">\r\n            <div className=\"w-8 h-8 border-3 border-gray-300 border-t-pink-500 rounded-full animate-spin\"></div>\r\n            <div className=\"absolute inset-0 w-8 h-8 border-3 border-transparent border-t-pink-300 rounded-full animate-spin\" style={{animationDelay: '-0.5s'}}></div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Imagen */}\r\n      <img\r\n        src={imageSrc}\r\n        alt={alt}\r\n        className={`w-full h-full object-cover transition-all duration-300 ${\r\n          isLoading ? 'opacity-0 scale-95' : 'opacity-100 scale-100'\r\n        }`}\r\n        onLoad={handleImageLoad}\r\n        onError={handleImageError}\r\n        loading=\"lazy\"\r\n        decoding=\"async\"\r\n        fetchPriority=\"high\"\r\n      />\r\n\r\n      {/* Icono de reproducción (opcional) */}\r\n      {showPlayIcon && !isLoading && (\r\n        <div className=\"absolute inset-0 bg-black bg-opacity-20 flex items-center justify-center\">\r\n          <div className=\"w-8 h-8 bg-white bg-opacity-90 rounded-full flex items-center justify-center\">\r\n            <Play className=\"w-4 h-4 text-gray-800 fill-current\" />\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Fallback cuando no hay imagen */}\r\n      {(imageError || shouldShowFallback) && !isLoading && (\r\n        <div className=\"absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center\">\r\n          <div className=\"text-center\">\r\n            <Image className=\"w-8 h-8 text-gray-400 mx-auto mb-2\" />\r\n            <p className=\"text-xs text-gray-500 font-medium\">Sin miniatura</p>\r\n            {showPlayIcon && (\r\n              <div className=\"mt-2 w-6 h-6 bg-white bg-opacity-90 rounded-full flex items-center justify-center mx-auto\">\r\n                <Play className=\"w-3 h-3 text-gray-600 fill-current\" />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default SmartThumbnail ","// 🎬 COMPONENTE GALERÍA DE SECUENCIAS - SALSAHACKS V2.0\r\n\r\nimport React, { useState } from 'react'\r\nimport { \r\n  Play, \r\n  Edit3, \r\n  Trash2, \r\n  Download, \r\n  Clock,\r\n  Users,\r\n  Calendar,\r\n  Tag,\r\n  Image\r\n} from 'lucide-react'\r\nimport ConfirmModal from '../common/ConfirmModal'\r\nimport Toast from '../common/Toast'\r\nimport SmartThumbnail from '../common/SmartThumbnail.jsx'\r\nimport { useCategories } from '../../hooks/useCategories'\r\nimport { useCardSize } from '../../contexts/CardSizeContext'\r\n\r\nconst SequenceGallery = ({ \r\n  sequences, \r\n  onDeleteSequence, \r\n  onPlaySequence,\r\n  onEditSequence,\r\n  onEditThumbnail,\r\n  onDownloadSequence \r\n}) => {\r\n  const [toasts, setToasts] = useState([])\r\n  const [deleteModal, setDeleteModal] = useState({ isOpen: false, sequence: null })\r\n  \r\n  // Usar el hook de categorías para obtener getColorClasses\r\n  const { getColorClasses } = useCategories('figuras', 'salsa')\r\n  const { getSequenceConfig } = useCardSize()\r\n\r\n  const addToast = (message, type = 'success') => {\r\n    const id = Date.now()\r\n    setToasts(prev => [...prev, { id, message, type }])\r\n  }\r\n\r\n  const removeToast = (id) => {\r\n    setToasts(prev => prev.filter(toast => toast.id !== id))\r\n  }\r\n\r\n  const handleDeleteClick = (sequence) => {\r\n    setDeleteModal({ isOpen: true, sequence })\r\n  }\r\n\r\n  const handleConfirmDelete = async () => {\r\n    try {\r\n      await onDeleteSequence(deleteModal.sequence.id)\r\n      addToast('Secuencia eliminada exitosamente')\r\n    } catch (error) {\r\n      addToast('Error al eliminar la secuencia', 'error')\r\n    }\r\n    setDeleteModal({ isOpen: false, sequence: null })\r\n  }\r\n\r\n  const handlePlaySequence = (sequence) => {\r\n    try {\r\n      onPlaySequence(sequence)\r\n      addToast('Reproduciendo secuencia')\r\n    } catch (error) {\r\n      addToast('Error al reproducir la secuencia', 'error')\r\n    }\r\n  }\r\n\r\n  const handleDownloadSequence = (sequence) => {\r\n    try {\r\n      if (onDownloadSequence) {\r\n        onDownloadSequence(sequence)\r\n        addToast('Abriendo opciones de descarga')\r\n      } else {\r\n        addToast('Funcionalidad de descarga no disponible', 'warning')\r\n      }\r\n    } catch (error) {\r\n      addToast('Error al abrir descarga', 'error')\r\n    }\r\n  }\r\n\r\n  const formatDate = (dateString) => {\r\n    const date = new Date(dateString)\r\n    return date.toLocaleDateString('es-ES', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    })\r\n  }\r\n\r\n  const getTotalDuration = (videos) => {\r\n    // Calcular duración total aproximada (asumiendo 30 segundos por video)\r\n    const totalSeconds = videos.length * 30\r\n    const minutes = Math.floor(totalSeconds / 60)\r\n    const seconds = totalSeconds % 60\r\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`\r\n  }\r\n\r\n  const getOrderedSequenceTags = (sequence) => {\r\n    if (!sequence.tags || Object.keys(sequence.tags).length === 0) {\r\n      return []\r\n    }\r\n    \r\n    const orderedTags = []\r\n    const categoriesList = [\r\n      { key: 'dificultad', color: 'red' },\r\n      { key: 'estilo', color: 'blue' },\r\n      { key: 'nivel', color: 'green' },\r\n      { key: 'figura', color: 'purple' },\r\n      { key: 'posicion', color: 'orange' },\r\n      { key: 'transicion', color: 'teal' }\r\n    ]\r\n    \r\n    categoriesList.forEach(category => {\r\n      const categoryTags = sequence.tags[category.key]\r\n      if (Array.isArray(categoryTags)) {\r\n        categoryTags.forEach(tag => {\r\n          orderedTags.push({\r\n            tag,\r\n            categoryKey: category.key,\r\n            color: category.color\r\n          })\r\n        })\r\n      }\r\n    })\r\n    \r\n    return orderedTags\r\n  }\r\n\r\n  if (sequences.length === 0) {\r\n    return (\r\n      <div className=\"text-center py-12\">\r\n        <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n          <Play className=\"w-8 h-8 text-gray-400\" />\r\n        </div>\r\n        <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No hay secuencias guardadas</h3>\r\n        <p className=\"text-gray-500 mb-4\">Crea tu primera secuencia usando el constructor de secuencias</p>\r\n        <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto\">\r\n          <h4 className=\"font-medium text-blue-900 mb-2\">¿Cómo crear una secuencia?</h4>\r\n          <ol className=\"text-sm text-blue-800 space-y-1 text-left\">\r\n            <li>1. Haz clic en \"CREAR SECUENCIA\"</li>\r\n            <li>2. Añade videos con el botón \"+\" de la galería</li>\r\n            <li>3. Escribe un nombre para la secuencia</li>\r\n            <li>4. Haz clic en \"Guardar Secuencia\"</li>\r\n            <li>5. ¡Listo! Aparecerá aquí automáticamente</li>\r\n          </ol>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Grid de secuencias */}\r\n      <div className={`grid gap-6 ${getSequenceConfig().grid}`}>\r\n        {sequences.map((sequence) => (\r\n          <div\r\n            key={sequence.id}\r\n            className=\"bg-white rounded-lg shadow-md overflow-hidden border border-gray-100 hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02]\"\r\n          >\r\n            {/* Thumbnail */}\r\n            <div className=\"relative group\">\r\n              <div className={`w-full ${getSequenceConfig().aspect} bg-gradient-to-br from-gray-100 to-gray-200 relative overflow-hidden flex items-center justify-center`}>\r\n                {sequence.thumbnailUrl ? (\r\n                  <SmartThumbnail\r\n                    src={sequence.thumbnailUrl}\r\n                    alt={sequence.name}\r\n                    className=\"w-full h-full object-cover\"\r\n                  />\r\n                ) : (\r\n                  <div className=\"flex flex-col items-center justify-center text-gray-500\">\r\n                    <Play className=\"w-12 h-12 mb-2 text-gray-400\" />\r\n                    <span className=\"text-sm font-medium\">{sequence.name}</span>\r\n                  </div>\r\n                )}\r\n                \r\n                {/* Badge de resolución */}\r\n                <div className=\"absolute bottom-2 left-2 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-sm font-medium\">\r\n                  {sequence.resolution && sequence.resolution !== 'Unknown' ? sequence.resolution : 'HD'}\r\n                </div>\r\n                \r\n                {/* Botón de editar thumbnail */}\r\n                <button\r\n                  onClick={(e) => {\r\n                    e.stopPropagation()\r\n                    onEditThumbnail && onEditThumbnail(sequence)\r\n                  }}\r\n                  className=\"absolute top-2 right-2 bg-black bg-opacity-75 text-white p-1 rounded hover:bg-opacity-90 transition-colors\"\r\n                  title=\"Editar thumbnail\"\r\n                >\r\n                  <Image className=\"w-3 h-3\" />\r\n                </button>\r\n                \r\n                {/* Botón de reproducción */}\r\n                <button\r\n                  onClick={() => handlePlaySequence(sequence)}\r\n                  className=\"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-200\"\r\n                >\r\n                  <Play className=\"w-12 h-12 text-white\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Contenido del card */}\r\n            <div className={`${getSequenceConfig().compact ? 'p-2' : 'p-4'}`}>\r\n              {/* Título y rating */}\r\n              <div className={`flex items-center justify-between ${getSequenceConfig().compact ? 'mb-1' : 'mb-2'}`}>\r\n                <h3 className={`font-semibold text-gray-800 ${getSequenceConfig().titleSize} truncate`}>{sequence.name}</h3>\r\n                <div className=\"flex items-center space-x-1\">\r\n                  <span className={`bg-blue-100 text-blue-800 px-2 py-1 rounded-full ${getSequenceConfig().compact ? 'text-xs' : 'text-xs'} font-medium`}>\r\n                    {sequence.videos.length} videos\r\n                  </span>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Descripción o Iconos */}\r\n              {getSequenceConfig().showIcons ? (\r\n                // Mostrar solo número de videos en tamaños pequeños y medianos\r\n                <div className=\"flex items-center justify-center text-gray-500 mb-2\">\r\n                  <div className=\"flex items-center space-x-1\">\r\n                    <Users className=\"w-3 h-3\" />\r\n                    <span className=\"text-xs font-medium\">{sequence.videos.length} videos</span>\r\n                  </div>\r\n                </div>\r\n              ) : (\r\n                // Mostrar descripción en tamaños grandes\r\n                <p className={`text-gray-600 text-sm ${getSequenceConfig().compact ? 'mb-2' : 'mb-3'} ${getSequenceConfig().descriptionLines === 1 ? 'line-clamp-1' : getSequenceConfig().descriptionLines === 2 ? 'line-clamp-2' : getSequenceConfig().descriptionLines === 3 ? 'line-clamp-3' : 'line-clamp-4'}`}>{sequence.description || 'Sin descripción'}</p>\r\n              )}\r\n              \r\n              {/* Tags de la secuencia */}\r\n              {getSequenceConfig().showTags && (\r\n                <div className=\"flex flex-wrap gap-2 mb-3\">\r\n                  {(() => {\r\n                    const orderedTags = getOrderedSequenceTags(sequence)\r\n                    if (orderedTags.length > 0) {\r\n                      return orderedTags.map(({ tag, categoryKey, color }) => (\r\n                        <span\r\n                          key={`${categoryKey}-${tag}`}\r\n                          className={`px-2 py-1 rounded-full text-xs font-medium ${getColorClasses(color)}`}\r\n                        >\r\n                          {tag}\r\n                        </span>\r\n                      ))\r\n                    } else {\r\n                      return <span className=\"text-gray-400 text-sm\">Sin etiquetas</span>\r\n                    }\r\n                  })()}\r\n                </div>\r\n              )}\r\n              \r\n              {/* Stats del video */}\r\n              {getSequenceConfig().showStats && (\r\n                <div className=\"flex items-center justify-between text-sm text-gray-500 pt-2 border-t border-gray-100\">\r\n                  {/* Información de stats - solo en tamaños grandes */}\r\n                  {!getSequenceConfig().compact && (\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <Users className=\"w-4 h-4\" />\r\n                      <span className=\"font-medium\">\r\n                        {sequence.videos.length} videos\r\n                      </span>\r\n                      <span className=\"text-gray-400\">•</span>\r\n                      <span className=\"text-gray-600\">\r\n                        {sequence.resolution && sequence.resolution !== 'Unknown' ? \r\n                          sequence.resolution : \r\n                          'HD'\r\n                        }\r\n                      </span>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* Botones de acción - siempre visibles */}\r\n                  <div className={`flex items-center space-x-2 ${getSequenceConfig().compact ? 'w-full justify-center' : ''}`}>\r\n                    <button\r\n                      onClick={() => handleDownloadSequence(sequence)}\r\n                      className=\"text-gray-400 hover:text-green-500 transition-colors duration-200 p-1 rounded hover:bg-green-50\"\r\n                      title=\"Descargar secuencia\"\r\n                    >\r\n                      <Download className={`${getSequenceConfig().compact ? 'h-3 w-3' : 'h-4 w-4'}`} />\r\n                    </button>\r\n                    <button\r\n                      onClick={() => onEditSequence(sequence)}\r\n                      className=\"text-gray-400 hover:text-blue-500 transition-colors duration-200 p-1 rounded hover:bg-blue-50\"\r\n                      title=\"Editar secuencia\"\r\n                    >\r\n                      <Edit3 className={`${getSequenceConfig().compact ? 'h-3 w-3' : 'h-4 w-4'}`} />\r\n                    </button>\r\n                    <button\r\n                      onClick={() => handleDeleteClick(sequence)}\r\n                      className=\"text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 rounded hover:bg-red-50\"\r\n                      title=\"Eliminar secuencia\"\r\n                    >\r\n                      <Trash2 className={`${getSequenceConfig().compact ? 'h-3 w-3' : 'h-4 w-4'}`} />\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n           </div>\r\n         </div>\r\n       ))}\r\n     </div>\r\n\r\n      {/* Modal de confirmación de eliminación */}\r\n      <ConfirmModal\r\n        isOpen={deleteModal.isOpen}\r\n        onClose={() => setDeleteModal({ isOpen: false, sequence: null })}\r\n        onConfirm={handleConfirmDelete}\r\n        title=\"¿Eliminar secuencia?\"\r\n        message={`¿Estás seguro de que quieres eliminar la secuencia \"${deleteModal.sequence?.name}\"? Esta acción no se puede deshacer.`}\r\n        confirmText=\"Eliminar\"\r\n        cancelText=\"Cancelar\"\r\n        confirmClassName=\"bg-red-500 hover:bg-red-600\"\r\n      />\r\n\r\n      {/* Toasts */}\r\n      {toasts.map(toast => (\r\n        <Toast\r\n          key={toast.id}\r\n          message={toast.message}\r\n          type={toast.type}\r\n          onClose={() => removeToast(toast.id)}\r\n        />\r\n      ))}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default SequenceGallery ","// 🎴 SELECTOR DE TAMAÑOS DE CARDS - SALSAHACKS V2.0\r\n\r\nimport React from 'react'\r\nimport { Grid, Grid3X3, Square, LayoutGrid } from 'lucide-react'\r\nimport { useCardSize } from '../../contexts/CardSizeContext'\r\n\r\nconst CardSizeSelector = ({ type = 'video' }) => {\r\n  const {\r\n    videoCardSize,\r\n    sequenceCardSize,\r\n    setVideoCardSize,\r\n    setSequenceCardSize,\r\n    availableSizes,\r\n    sizeLabels\r\n  } = useCardSize()\r\n\r\n  const currentSize = type === 'video' ? videoCardSize : sequenceCardSize\r\n  const setSize = type === 'video' ? setVideoCardSize : setSequenceCardSize\r\n\r\n  // Iconos para cada tamaño\r\n  const sizeIcons = {\r\n    small: <LayoutGrid className=\"h-4 w-4\" />,\r\n    medium: <Grid3X3 className=\"h-4 w-4\" />,\r\n    large: <Grid className=\"h-4 w-4\" />,\r\n    'extra-large': <Square className=\"h-4 w-4\" />\r\n  }\r\n\r\n  // Colores para cada tamaño\r\n  const sizeColors = {\r\n    small: 'from-gray-400 to-gray-500',\r\n    medium: 'from-blue-400 to-blue-500',\r\n    large: 'from-purple-400 to-purple-500',\r\n    'extra-large': 'from-pink-400 to-pink-500'\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex items-center space-x-2\">\r\n      <span className=\"text-sm font-medium text-gray-700 mr-2\">\r\n        Tamaño:\r\n      </span>\r\n      <div className=\"flex bg-gray-100 rounded-lg p-1\">\r\n        {availableSizes.map((size) => (\r\n          <button\r\n            key={size}\r\n            onClick={() => setSize(size)}\r\n            className={`flex items-center space-x-1 px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 ${\r\n              currentSize === size\r\n                ? `bg-gradient-to-r ${sizeColors[size]} text-white shadow-lg transform scale-105`\r\n                : 'text-gray-600 hover:text-gray-800 hover:bg-white'\r\n            }`}\r\n            title={`${sizeLabels[size]} - ${size} cards`}\r\n          >\r\n            {sizeIcons[size]}\r\n            <span className=\"hidden sm:inline\">{sizeLabels[size]}</span>\r\n          </button>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default CardSizeSelector\r\n\r\n","// 🎴 ACCIONES COMPACTAS PARA CARDS - SALSAHACKS V2.0\r\n\r\nimport React from 'react'\r\nimport { Heart, Edit, Trash2, Plus, Download, Play } from 'lucide-react'\r\n\r\nconst CompactCardActions = ({ \r\n  video, \r\n  onLike, \r\n  onEdit, \r\n  onDelete, \r\n  onAddToSequence, \r\n  onDownload, \r\n  onPlay,\r\n  isVideoInSequence,\r\n  isBuilderOpen,\r\n  isVideoCompatible,\r\n  type = 'video' // 'video' o 'sequence'\r\n}) => {\r\n  if (type === 'video') {\r\n    return (\r\n      <div className=\"flex items-center justify-center space-x-1 mt-2\">\r\n        {/* Botón de reproducción */}\r\n        <button\r\n          onClick={onPlay}\r\n          className=\"p-1 text-gray-400 hover:text-blue-500 transition-colors rounded\"\r\n          title=\"Reproducir\"\r\n        >\r\n          <Play className=\"h-3 w-3\" />\r\n        </button>\r\n        \r\n        {/* Botón de like */}\r\n        <button\r\n          onClick={onLike}\r\n          className={`p-1 transition-colors rounded ${\r\n            video.userLiked ? 'text-red-500' : 'text-gray-400 hover:text-red-500'\r\n          }`}\r\n          title={video.userLiked ? 'Quitar like' : 'Dar like'}\r\n        >\r\n          <Heart className={`h-3 w-3 ${video.userLiked ? 'fill-current' : ''}`} />\r\n        </button>\r\n        \r\n        {/* Botón de añadir a secuencia */}\r\n        <button\r\n          onClick={onAddToSequence}\r\n          disabled={isVideoInSequence}\r\n          className={`p-1 transition-colors rounded ${\r\n            isVideoInSequence\r\n              ? 'text-gray-300 cursor-not-allowed'\r\n              : isBuilderOpen && !isVideoCompatible\r\n              ? 'text-red-400 hover:text-red-500'\r\n              : 'text-gray-400 hover:text-purple-500'\r\n          }`}\r\n          title={\r\n            isVideoInSequence \r\n              ? 'Ya en secuencia' \r\n              : isBuilderOpen && !isVideoCompatible\r\n              ? 'Añadir forzadamente'\r\n              : 'Añadir a secuencia'\r\n          }\r\n        >\r\n          <Plus className=\"h-3 w-3\" />\r\n        </button>\r\n        \r\n        {/* Botón de descargar */}\r\n        <button\r\n          onClick={onDownload}\r\n          className=\"p-1 text-gray-400 hover:text-green-500 transition-colors rounded\"\r\n          title=\"Descargar\"\r\n        >\r\n          <Download className=\"h-3 w-3\" />\r\n        </button>\r\n        \r\n        {/* Botón de editar */}\r\n        <button\r\n          onClick={onEdit}\r\n          className=\"p-1 text-gray-400 hover:text-blue-500 transition-colors rounded\"\r\n          title=\"Editar\"\r\n        >\r\n          <Edit className=\"h-3 w-3\" />\r\n        </button>\r\n        \r\n        {/* Botón de eliminar */}\r\n        <button\r\n          onClick={onDelete}\r\n          className=\"p-1 text-gray-400 hover:text-red-500 transition-colors rounded\"\r\n          title=\"Eliminar\"\r\n        >\r\n          <Trash2 className=\"h-3 w-3\" />\r\n        </button>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Para secuencias\r\n  return (\r\n    <div className=\"flex items-center justify-center space-x-1 mt-2\">\r\n      {/* Botón de reproducción */}\r\n      <button\r\n        onClick={onPlay}\r\n        className=\"p-1 text-gray-400 hover:text-blue-500 transition-colors rounded\"\r\n        title=\"Reproducir secuencia\"\r\n      >\r\n        <Play className=\"h-3 w-3\" />\r\n      </button>\r\n      \r\n      {/* Botón de descargar */}\r\n      <button\r\n        onClick={onDownload}\r\n        className=\"p-1 text-gray-400 hover:text-green-500 transition-colors rounded\"\r\n        title=\"Descargar secuencia\"\r\n      >\r\n        <Download className=\"h-3 w-3\" />\r\n      </button>\r\n      \r\n      {/* Botón de editar */}\r\n      <button\r\n        onClick={onEdit}\r\n        className=\"p-1 text-gray-400 hover:text-blue-500 transition-colors rounded\"\r\n        title=\"Editar secuencia\"\r\n      >\r\n        <Edit className=\"h-3 w-3\" />\r\n      </button>\r\n      \r\n      {/* Botón de eliminar */}\r\n      <button\r\n        onClick={onDelete}\r\n        className=\"p-1 text-gray-400 hover:text-red-500 transition-colors rounded\"\r\n        title=\"Eliminar secuencia\"\r\n      >\r\n        <Trash2 className=\"h-3 w-3\" />\r\n      </button>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default CompactCardActions\r\n","import React, { useState, useEffect } from 'react'\nimport { \n  Search, \n  Upload, \n  Plus, \n  Heart, \n  Music,\n  Trash2,\n  Filter,\n  X,\n  ChevronDown,\n  ChevronUp,\n  Star,\n  Zap,\n  Edit,\n  Download,\n  Maximize2,\n  Minimize2,\n  Play,\n  Shuffle,\n  Eye,\n  EyeOff\n} from 'lucide-react'\nimport { useCategories } from '../hooks/useCategories'\nimport CategoryBadge from '../components/common/CategoryBadge'\nimport VideoUploadModal from '../components/video/VideoUploadModal'\nimport VideoEditModal from '../components/video/VideoEditModal'\nimport VideoPlayer from '../components/video/VideoPlayer'\nimport DownloadModal from '../components/video/DownloadModal'\nimport ConfirmModal from '../components/common/ConfirmModal'\nimport Toast from '../components/common/Toast'\nimport SequenceBuilder from '../components/sequence/SequenceBuilder'\nimport SequenceGallery from '../components/sequence/SequenceGallery'\nimport SequenceVideoPlayer from '../components/sequence/SequenceVideoPlayer'\nimport CardSizeSelector from '../components/common/CardSizeSelector'\nimport CompactCardActions from '../components/common/CompactCardActions'\nimport CategoryChips from '../components/common/CategoryChips'\nimport { useSequenceBuilderContext } from '../contexts/SequenceBuilderContext'\n\nimport { \n  getVideos, \n  deleteVideoDocument, \n  subscribeToVideosByStyle,\n  deleteAllVideos,\n  updateVideoThumbnailPaths,\n  diagnoseVideos,\n  updateVideoDocument,\n  cleanupDuplicateTags,\n  toggleVideoLike,\n  checkUserLikedVideo,\n  checkUserFavorite\n} from '../services/firebase/firestore'\nimport {\n  createSequence,\n  getSequencesByStyle,\n  deleteSequence,\n  subscribeToSequencesByStyle,\n  updateSequence\n} from '../services/firebase/sequences'\nimport { \n  deleteVideo, \n  deleteAllVideoFiles, \n  cleanupOrphanedFiles,\n  getFileURL,\n  migrateVideosToOrganizedStructure\n} from '../services/firebase/storage'\nimport { useAuth } from '../contexts/AuthContext'\nimport { useTheme } from '../contexts/ThemeContext'\nimport { useCardSize } from '../contexts/CardSizeContext'\n\nconst FigurasPage = () => {\n  const [isUploadModalOpen, setIsUploadModalOpen] = useState(false)\n  const [editModal, setEditModal] = useState({ isOpen: false, video: null })\n  const [videos, setVideos] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [toasts, setToasts] = useState([])\n  const [deleteModal, setDeleteModal] = useState({ isOpen: false, video: null })\n  const [selectedTags, setSelectedTags] = useState([])\n  const [searchTerm, setSearchTerm] = useState('')\n  const [showFilters, setShowFilters] = useState(false)\n  const [activeTab, setActiveTab] = useState('videos')\n  const [syncStatus, setSyncStatus] = useState('idle') // idle, syncing, error\n  const [cleanupModal, setCleanupModal] = useState({ isOpen: false, type: null })\n  const [editSequenceModal, setEditSequenceModal] = useState({ isOpen: false, sequence: null })\n  const [downloadSequenceModal, setDownloadSequenceModal] = useState({ isOpen: false, sequence: null })\n  const [migrationModal, setMigrationModal] = useState({ isOpen: false })\n  const [isFullWidth, setIsFullWidth] = useState(false) // Modo ancho completo\n  \n  // Estados para reproductor de video individual\n  const [selectedVideo, setSelectedVideo] = useState(null)\n  const [showVideoPlayer, setShowVideoPlayer] = useState(false)\n  \n  // Estados para reproductor de secuencias\n  const [selectedSequence, setSelectedSequence] = useState(null)\n  const [showSequencePlayer, setShowSequencePlayer] = useState(false)\n  \n  // Estados para el sistema de chips y filtros\n  const [activeCategoryChips, setActiveCategoryChips] = useState([])\n  const [sortBy, setSortBy] = useState('none')\n  const [showFavorites, setShowFavorites] = useState(false)\n  \n  // Estados para secuencias\n  const [sequences, setSequences] = useState([])\n  const [sequencesLoading, setSequencesLoading] = useState(true)\n  \n  const { user } = useAuth()\n  const { getVideoConfig, getSequenceConfig } = useCardSize()\n  \n  // Usar el contexto de constructor de secuencias\n  const {\n    addVideoToSequence,\n    removeVideoFromSequence,\n    sequence,\n    sequenceName,\n    clearSequence,\n    isBuilderOpen,\n    toggleBuilder,\n    showAllVideos,\n    toggleShowAllVideos,\n    getFilteredVideos,\n    isVideoInSequence,\n    isVideoCompatible,\n    checkCompatibility,\n    loadSequence\n  } = useSequenceBuilderContext()\n\n  // Estado local para el estilo seleccionado\n  const [selectedStyle, setSelectedStyle] = useState('salsa')\n  \n  // Usar el sistema de categorías con estilo dinámico\n  const { \n    availableStyles,\n    getGradientClasses,\n    categoriesList, \n    getColorClasses\n  } = useCategories('figuras', selectedStyle)\n  \n  // Función para manejar click en título de categoría\n  const handleCategoryTitleClick = (categoryKey) => {\n    setActiveCategoryChips(prev => {\n      // Si ya está activa, la removemos\n      if (prev.includes(categoryKey)) {\n        return prev.filter(chip => chip !== categoryKey)\n      }\n      // Si no está activa, la agregamos\n      return [...prev, categoryKey]\n    })\n  }\n\n  // Función auxiliar para filtrar videos por estilo\n  const filterVideosByStyle = (videos, style) => {\n    return videos.filter(video => \n      video.style === style || video.tags?.estilo?.includes(style)\n    )\n  }\n\n  // Función para añadir video al constructor\n  const handleAddVideoToSequence = (video) => {\n    addVideoToSequence(video)\n    if (!isBuilderOpen) {\n      toggleBuilder()\n    }\n  }\n\n  // Mapeo de iconos para los estilos\n  const iconMap = {\n    Music: Music,\n    Heart: Heart,\n    Star: Star,\n    Zap: Zap\n  }\n\n  // Sincronización en tiempo real con Firebase\n  useEffect(() => {\n    console.log('🔄 Iniciando sincronización en tiempo real para:', selectedStyle)\n    setSyncStatus('syncing')\n    \n    // Suscribirse a cambios en tiempo real para el estilo seleccionado\n    const unsubscribe = subscribeToVideosByStyle(selectedStyle, (videosData) => {\n      console.log(`🔄 Actualización en tiempo real recibida: ${videosData.length} videos para ${selectedStyle}`)\n      setVideos(videosData)\n      setLoading(false)\n      setSyncStatus('idle')\n    })\n    \n    // Cleanup al desmontar o cambiar estilo\n    return () => {\n      console.log('🔄 Desuscribiendo de sincronización en tiempo real')\n      unsubscribe()\n    }\n  }, [selectedStyle])\n\n  // Verificar estado de likes del usuario cuando se cargan videos\n  useEffect(() => {\n    if (videos.length > 0 && user) {\n      console.log('❤️ Verificando estado de likes y favoritos del usuario para', videos.length, 'videos')\n      \n      const checkUserLikesAndFavorites = async () => {\n        const updatedVideos = await Promise.all(\n          videos.map(async (video) => {\n            try {\n              const [likeResult, favoriteResult] = await Promise.all([\n                checkUserLikedVideo(video.id, user.uid),\n                checkUserFavorite(video.id, user.uid)\n              ])\n              return { \n                ...video, \n                userLiked: likeResult.userLiked,\n                isFavorite: favoriteResult.isFavorite\n              }\n            } catch (error) {\n              console.error('Error al verificar like/favorito para video:', video.id, error)\n              return { ...video, userLiked: false, isFavorite: false }\n            }\n          })\n        )\n        \n        setVideos(updatedVideos)\n      }\n      \n      checkUserLikesAndFavorites()\n    }\n  }, [videos.length, user])\n\n  // Sincronización en tiempo real para secuencias\n  useEffect(() => {\n    console.log('🎬 FigurasPage: useEffect de secuencias ejecutándose')\n    console.log('🎬 selectedStyle actual:', selectedStyle)\n    console.log('🎬 subscribeToSequencesByStyle disponible:', typeof subscribeToSequencesByStyle)\n    \n    if (!selectedStyle) {\n      console.log('⚠️ No hay selectedStyle, saltando suscripción')\n      return\n    }\n    \n    console.log('🎬 Iniciando sincronización de secuencias para:', selectedStyle)\n    setSequencesLoading(true)\n    \n    try {\n      // Suscribirse a cambios en tiempo real para las secuencias del estilo seleccionado\n      const unsubscribe = subscribeToSequencesByStyle(selectedStyle, (sequencesData) => {\n        console.log(`🎬 Actualización de secuencias recibida: ${sequencesData.length} secuencias para ${selectedStyle}`)\n        setSequences(sequencesData)\n        setSequencesLoading(false)\n      })\n      \n      // Cleanup al desmontar o cambiar estilo\n      return () => {\n        console.log('🎬 Desuscribiendo de sincronización de secuencias')\n        unsubscribe()\n      }\n    } catch (error) {\n      console.error('❌ Error al suscribirse a secuencias:', error)\n      setSequencesLoading(false)\n    }\n  }, [selectedStyle])\n\n\n\n  // Función para actualizar la lista de videos después de subir uno nuevo\n  const handleVideoUploaded = async (video) => {\n    console.log('Video subido:', video)\n    addToast(`${video.title} subido exitosamente`, 'success')\n    // La sincronización en tiempo real se encargará de actualizar la lista automáticamente\n  }\n\n  // Función para abrir modal de edición\n  const openEditModal = (video) => {\n    setEditModal({ isOpen: true, video })\n  }\n\n  // Función para cerrar modal de edición\n  const closeEditModal = () => {\n    setEditModal({ isOpen: false, video: null })\n  }\n\n  // Función para manejar video actualizado\n  const handleVideoUpdated = (updatedVideo) => {\n    setVideos(prev => prev.map(v => v.id === updatedVideo.id ? updatedVideo : v))\n    addToast(`${updatedVideo.title} actualizado exitosamente`, 'success')\n  }\n\n  // Función para manejar likes\n  const handleVideoLike = async (video) => {\n    if (!user) {\n      addToast('Debes iniciar sesión para dar like', 'error')\n      return\n    }\n\n    try {\n      const result = await toggleVideoLike(video.id, user.uid)\n      \n      if (result.success) {\n        // Actualizar el video en el estado local\n        setVideos(prevVideos => \n          prevVideos.map(v => \n            v.id === video.id \n              ? { \n                  ...v, \n                  likes: result.likes, \n                  likedBy: result.likedBy,\n                  userLiked: result.userLiked,\n                  isFavorite: result.isFavorite\n                }\n              : v\n          )\n        )\n        \n        const action = result.userLiked ? 'dado like a' : 'quitado like de'\n        const favoriteAction = result.isFavorite ? 'y agregado a favoritos' : 'y removido de favoritos'\n        addToast(`Has ${action} \"${video.title}\" ${favoriteAction}`, 'success')\n      } else {\n        addToast('Error al actualizar like', 'error')\n      }\n    } catch (error) {\n      console.error('Error al manejar like:', error)\n      addToast('Error al actualizar like', 'error')\n    }\n  }\n\n  // Función para añadir notificaciones\n  const addToast = (message, type = 'success') => {\n    const id = Date.now()\n    setToasts(prev => [...prev, { id, message, type }])\n  }\n\n  // Función para eliminar notificaciones\n  const removeToast = (id) => {\n    setToasts(prev => prev.filter(toast => toast.id !== id))\n  }\n\n  // Funciones para manejar secuencias\n  const handleSaveSequence = async (sequenceData) => {\n    console.log('🎬 FigurasPage: Recibida solicitud de guardar secuencia')\n    console.log('📦 Datos recibidos:', sequenceData)\n    \n    try {\n      const sequenceWithStyle = {\n        ...sequenceData,\n        style: selectedStyle\n      }\n      \n      console.log('🎨 Secuencia con estilo:', sequenceWithStyle)\n      \n      // Verificar si es una edición o una nueva secuencia\n      if (sequenceData.id) {\n        // Es una edición - actualizar secuencia existente\n        console.log('🔄 Actualizando secuencia existente:', sequenceData.id)\n        const result = await updateSequence(sequenceData.id, sequenceWithStyle)\n        console.log('✅ Secuencia actualizada exitosamente:', result)\n        addToast('✅ Secuencia actualizada exitosamente')\n      } else {\n        // Es una nueva secuencia - crear nueva\n        console.log('🆕 Creando nueva secuencia')\n        const result = await createSequence(sequenceWithStyle)\n        console.log('✅ Secuencia creada exitosamente:', result)\n        addToast('✅ Secuencia guardada exitosamente. Ve a \"GALERÍA DE SECUENCIAS\" para verla.')\n      }\n    } catch (error) {\n      console.error('❌ Error al guardar secuencia:', error)\n      addToast('Error al guardar la secuencia', 'error')\n      throw error\n    }\n  }\n\n  const handleDeleteSequence = async (sequenceId) => {\n    try {\n      await deleteSequence(sequenceId)\n      addToast('Secuencia eliminada exitosamente')\n    } catch (error) {\n      console.error('Error al eliminar secuencia:', error)\n      addToast('Error al eliminar la secuencia', 'error')\n      throw error\n    }\n  }\n\n  const handlePlaySequence = (sequence) => {\n    console.log('🎬 Reproduciendo secuencia:', sequence.name)\n    setSelectedSequence(sequence)\n    setShowSequencePlayer(true)\n    addToast(`🎬 Reproduciendo secuencia: ${sequence.name}`, 'info')\n  }\n\n  const handleEditSequence = (sequenceToEdit) => {\n    console.log('🎬 Editando secuencia:', sequenceToEdit)\n    \n    // Verificar si hay una secuencia en construcción\n    if (sequence.length > 0 || sequenceName.trim()) {\n      // Abrir modal de confirmación\n      setEditSequenceModal({ isOpen: true, sequence: sequenceToEdit })\n    } else {\n      // Cargar directamente la secuencia\n      loadSequence(sequenceToEdit)\n      addToast(`Secuencia \"${sequenceToEdit.name}\" cargada para edición`)\n    }\n  }\n\n  const handleConfirmEditSequence = () => {\n    const sequenceToEdit = editSequenceModal.sequence\n    if (sequenceToEdit) {\n      loadSequence(sequenceToEdit)\n      addToast(`Secuencia \"${sequenceToEdit.name}\" cargada para edición`)\n    }\n    setEditSequenceModal({ isOpen: false, sequence: null })\n  }\n\n  const handleCancelEditSequence = () => {\n    console.log('❌ Usuario canceló la carga de secuencia')\n    setEditSequenceModal({ isOpen: false, sequence: null })\n  }\n\n  const handleDownloadSequence = (sequence) => {\n    console.log('📥 Abriendo descarga de secuencia:', sequence)\n    setDownloadSequenceModal({ isOpen: true, sequence })\n  }\n\n  const handleCloseDownloadSequence = () => {\n    setDownloadSequenceModal({ isOpen: false, sequence: null })\n  }\n  \n  // Función para reproducir video individual\n  const handlePlayVideo = (video) => {\n    console.log('🎬 Reproduciendo video individual:', video.title)\n    setSelectedVideo(video)\n    setShowVideoPlayer(true)\n    addToast(`🎬 Reproduciendo: ${video.title}`, 'info')\n  }\n  \n  // Función para cerrar el reproductor\n  const handleCloseVideoPlayer = () => {\n    setShowVideoPlayer(false)\n    setSelectedVideo(null)\n  }\n  \n  // Función para cerrar el reproductor de secuencias\n  const handleCloseSequencePlayer = () => {\n    setShowSequencePlayer(false)\n    setSelectedSequence(null)\n  }\n\n\n\n  // Función para eliminar video\n  const handleDeleteVideo = async (video) => {\n    try {\n      console.log('🗑️ Iniciando eliminación de video:', video)\n      console.log('📁 Video path:', video.videoPath)\n      console.log('🖼️ Thumbnail path:', video.thumbnailPath)\n      console.log('🆔 Video ID:', video.id)\n      \n      // Eliminar de Firebase Storage\n      const storageResult = await deleteVideo(video.videoPath, video.thumbnailPath)\n      console.log('📦 Resultado eliminación Storage:', storageResult)\n      \n      // Si hay error al eliminar archivos, intentar solo eliminar el video\n      if (!storageResult.success) {\n        console.log('⚠️ Error eliminando archivos, intentando solo eliminar video...')\n        \n        // Intentar eliminar solo el video si el thumbnail falló\n        if (storageResult.error && storageResult.error.includes('thumbnails')) {\n          const videoOnlyResult = await deleteVideo(video.videoPath, null)\n          if (!videoOnlyResult.success) {\n            addToast(`Error al eliminar archivos: ${storageResult.error}`, 'error')\n            return\n          }\n        } else {\n          addToast(`Error al eliminar archivos: ${storageResult.error}`, 'error')\n          return\n        }\n      }\n\n      // Eliminar de Firestore\n      console.log('🔥 Intentando eliminar documento de Firestore con ID:', video.id)\n      const firestoreResult = await deleteVideoDocument(video.id)\n      console.log('🔥 Resultado eliminación Firestore:', firestoreResult)\n      \n      if (!firestoreResult.success) {\n        addToast(`Error al eliminar metadatos: ${firestoreResult.error}`, 'error')\n        return\n      }\n\n      // Actualizar lista local\n      console.log('🔄 Actualizando lista local, eliminando video con ID:', video.id)\n      setVideos(prev => {\n        const newVideos = prev.filter(v => v.id !== video.id)\n        console.log(`📊 Lista actualizada: ${prev.length} -> ${newVideos.length} videos`)\n        return newVideos\n      })\n      \n      addToast(`${video.title} eliminado correctamente`, 'success')\n      console.log('✅ Eliminación completada exitosamente')\n    } catch (error) {\n      console.error('❌ Error deleting video:', error)\n      addToast('Error inesperado al eliminar video', 'error')\n    }\n  }\n\n  // Función para abrir modal de eliminación\n  const openDeleteModal = (video) => {\n    console.log('🔘 Botón eliminar clickeado para video:', video)\n    setDeleteModal({ isOpen: true, video })\n  }\n\n  // Función para cerrar modal de eliminación\n  const closeDeleteModal = () => {\n    setDeleteModal({ isOpen: false, video: null })\n  }\n\n  // Funciones de limpieza y sincronización\n  const handleCleanupData = async (type) => {\n    try {\n      setSyncStatus('syncing')\n      addToast('Iniciando limpieza de datos...', 'info')\n      \n      if (type === 'update') {\n        // Actualizar rutas de thumbnails existentes\n        const result = await updateVideoThumbnailPaths()\n        if (result.success) {\n          addToast(`✅ ${result.updatedCount} videos actualizados`, 'success')\n        } else {\n          addToast(`❌ Error: ${result.error}`, 'error')\n        }\n      } else if (type === 'cleanup') {\n        // Limpiar archivos huérfanos\n        const videosData = await getVideos()\n        const result = await cleanupOrphanedFiles(videosData)\n        if (result.success) {\n          addToast(`🧹 ${result.orphanedVideosDeleted} videos y ${result.orphanedThumbnailsDeleted} thumbnails huérfanos eliminados`, 'success')\n        } else {\n          addToast(`❌ Error: ${result.error}`, 'error')\n        }\n      } else if (type === 'cleanup-tags') {\n        // Limpiar tags duplicados\n        const result = await cleanupDuplicateTags()\n        if (result.success) {\n          addToast(`🏷️ ${result.updatedCount} videos actualizados con tags limpios`, 'success')\n        } else {\n          addToast(`❌ Error: ${result.error}`, 'error')\n        }\n      } else if (type === 'delete-all') {\n        // Eliminar todos los videos (confirmar primero)\n        const confirmed = window.confirm('¿Estás seguro de que quieres eliminar TODOS los videos? Esta acción no se puede deshacer.')\n        if (!confirmed) {\n          setSyncStatus('idle')\n          return\n        }\n        \n        // Eliminar de Firestore\n        const firestoreResult = await deleteAllVideos()\n        if (!firestoreResult.success) {\n          addToast(`❌ Error eliminando documentos: ${firestoreResult.error}`, 'error')\n          setSyncStatus('idle')\n          return\n        }\n        \n        // Eliminar archivos de Storage\n        const storageResult = await deleteAllVideoFiles()\n        if (!storageResult.success) {\n          addToast(`❌ Error eliminando archivos: ${storageResult.error}`, 'error')\n          setSyncStatus('idle')\n          return\n        }\n        \n        addToast(`🗑️ ${firestoreResult.deletedCount} videos eliminados completamente`, 'success')\n      }\n      \n      setSyncStatus('idle')\n      setCleanupModal({ isOpen: false, type: null })\n    } catch (error) {\n      console.error('Error en limpieza:', error)\n      addToast(`❌ Error inesperado: ${error.message}`, 'error')\n      setSyncStatus('idle')\n    }\n  }\n\n  const openCleanupModal = (type) => {\n    setCleanupModal({ isOpen: true, type })\n  }\n\n  const closeCleanupModal = () => {\n    setCleanupModal({ isOpen: false, type: null })\n  }\n\n  // Función para ejecutar diagnóstico de videos\n  const handleDiagnoseVideos = async () => {\n    try {\n      addToast('Ejecutando diagnóstico de videos...', 'info')\n      const result = await diagnoseVideos()\n      \n      if (result.success) {\n        console.log('🔍 Resultado del diagnóstico:', result)\n        \n        let message = `Diagnóstico: ${result.totalVideos} videos total, ${result.salsaVideos} de salsa`\n        if (result.fig003Found) {\n          message += ` ✅ Fig003 encontrado`\n        } else {\n          message += ` ❌ Fig003 NO encontrado`\n        }\n        if (result.videosWithoutResolution > 0) {\n          message += ` ⚠️ ${result.videosWithoutResolution} sin resolución`\n        }\n        \n        addToast(message, 'success')\n      } else {\n        addToast(`Error en diagnóstico: ${result.error}`, 'error')\n      }\n    } catch (error) {\n      console.error('Error ejecutando diagnóstico:', error)\n      addToast('Error al ejecutar diagnóstico', 'error')\n    }\n  }\n\n  // Función para actualizar resoluciones de todos los videos\n  const handleUpdateAllResolutions = async () => {\n    try {\n      addToast('🔄 Actualizando resoluciones de videos...', 'info')\n      \n      // Obtener todos los videos\n      const allVideos = await getVideos()\n      const videosToUpdate = allVideos.filter(video => \n        !video.resolution || video.resolution === 'Unknown'\n      )\n      \n      if (videosToUpdate.length === 0) {\n        addToast('✅ Todos los videos ya tienen resolución detectada', 'success')\n        return\n      }\n      \n      let updatedCount = 0\n      \n      for (const video of videosToUpdate) {\n        try {\n          // Detectar resolución del video\n          const videoElement = document.createElement('video')\n          videoElement.crossOrigin = 'anonymous'\n          \n                     await new Promise((resolve, reject) => {\n             videoElement.onloadedmetadata = () => {\n               const videoWidth = videoElement.videoWidth\n               const videoHeight = videoElement.videoHeight\n               const maxDimension = Math.max(videoWidth, videoHeight)\n               \n               let resolution = 'Unknown'\n               if (maxDimension >= 3840) resolution = '4K'\n               else if (maxDimension >= 1920) resolution = '1080p'\n               else if (maxDimension >= 1280) resolution = '720p'\n               else if (maxDimension >= 854) resolution = '480p'\n               else resolution = '360p'\n               \n               // Actualizar en Firestore con resolución y dimensiones\n               updateVideoDocument(video.id, { \n                 resolution,\n                 videoWidth,\n                 videoHeight\n               })\n               updatedCount++\n               resolve()\n             }\n            \n            videoElement.onerror = reject\n            videoElement.src = video.videoUrl\n          })\n          \n          // Limpiar el elemento de video\n          videoElement.remove()\n          \n        } catch (error) {\n          console.error(`Error actualizando resolución para video ${video.id}:`, error)\n        }\n      }\n      \n      addToast(`✅ Resoluciones actualizadas: ${updatedCount} videos`, 'success')\n      \n    } catch (error) {\n      console.error('Error al actualizar resoluciones:', error)\n      addToast('Error al actualizar resoluciones', 'error')\n    }\n  }\n\n  // Función para migrar videos a estructura organizada\n  const handleMigrateVideos = async () => {\n    try {\n      addToast('🔄 Iniciando migración REAL de videos a estructura organizada...', 'info')\n      \n      const result = await migrateVideosToOrganizedStructure(videos)\n      \n      if (result.success) {\n        let message = `✅ Migración REAL completada: ${result.successfulMigrations} videos movidos físicamente`\n        if (result.alreadyOrganized > 0) {\n          message += `, ${result.alreadyOrganized} ya organizados`\n        }\n        if (result.failedMigrations > 0) {\n          message += `, ${result.failedMigrations} fallidos`\n        }\n        \n        addToast(message, 'success')\n        console.log('📊 Resultados de migración REAL:', result.results)\n        \n        // Recargar videos para reflejar los cambios\n        window.location.reload()\n      } else {\n        addToast(`❌ Error en migración: ${result.error}`, 'error')\n      }\n    } catch (error) {\n      console.error('Error ejecutando migración:', error)\n      addToast('❌ Error al ejecutar migración', 'error')\n    }\n  }\n\n  // Función para manejar filtros por tags\n  const handleTagFilter = (tag) => {\n    setSelectedTags(prev => {\n      const isSelected = prev.includes(tag)\n      if (isSelected) {\n        return prev.filter(t => t !== tag)\n      } else {\n        return [...prev, tag]\n      }\n    })\n  }\n\n  // Función para limpiar filtros\n  const clearFilters = () => {\n    setSelectedTags([])\n    setSearchTerm('')\n  }\n\n  // Funciones para el sistema de chips y filtros\n  const handleCategoryChipFilter = (chips) => {\n    setActiveCategoryChips(chips)\n  }\n\n  const handleSortChange = (sortKey) => {\n    setSortBy(sortKey)\n  }\n\n  const handleShowFavorites = (show) => {\n    setShowFavorites(show)\n  }\n\n  // Función para verificar si un video tiene tags de categoría específica\n  const hasCategoryTags = (video, categoryKey) => {\n    if (!video.tags) return false\n    \n    // Buscar en las categorías dinámicas del hook useCategories\n    const category = categoriesList.find(cat => cat.key === categoryKey)\n    if (!category) return false\n    \n    // Verificar si el video tiene tags para esta categoría\n    const categoryTags = video.tags[categoryKey]\n    return categoryTags && Array.isArray(categoryTags) && categoryTags.length > 0\n  }\n\n  // Función para ordenar videos\n  const sortVideos = (videosToSort) => {\n    if (sortBy === 'none') return videosToSort\n\n    const sortedVideos = [...videosToSort]\n    \n    switch (sortBy) {\n      case 'name':\n        return sortedVideos.sort((a, b) => a.title.localeCompare(b.title))\n      case 'name-desc':\n        return sortedVideos.sort((a, b) => b.title.localeCompare(a.title))\n      case 'rating':\n        return sortedVideos.sort((a, b) => (b.rating || 0) - (a.rating || 0))\n      case 'rating-desc':\n        return sortedVideos.sort((a, b) => (a.rating || 0) - (b.rating || 0))\n      case 'likes':\n        return sortedVideos.sort((a, b) => (b.likes || 0) - (a.likes || 0))\n      case 'likes-desc':\n        return sortedVideos.sort((a, b) => (a.likes || 0) - (b.likes || 0))\n      default:\n        return sortedVideos\n    }\n  }\n\n  // Función para obtener tags ordenados según el orden de categorías\n  const getOrderedTags = (video) => {\n    if (!video.tags || Object.keys(video.tags).length === 0) {\n      return []\n    }\n\n\n\n    // Crear array de tags ordenados según el orden de categoriesList\n    const orderedTags = []\n    \n    categoriesList.forEach(category => {\n      const categoryTags = video.tags[category.key]\n      if (Array.isArray(categoryTags)) {\n        categoryTags.forEach(tag => {\n          orderedTags.push({\n            tag,\n            categoryKey: category.key,\n            color: category.color\n          })\n        })\n      }\n    })\n\n\n    return orderedTags\n  }\n\n  // Función para obtener tags iniciales ordenados\n  const getOrderedTagsIniciales = (video) => {\n    if (!video.tagsIniciales || Object.keys(video.tagsIniciales).length === 0) {\n      return []\n    }\n\n    const orderedTags = []\n    \n    categoriesList.forEach(category => {\n      const categoryTags = video.tagsIniciales[category.key]\n      if (Array.isArray(categoryTags)) {\n        categoryTags.forEach(tag => {\n          orderedTags.push({\n            tag,\n            categoryKey: category.key,\n            color: category.color,\n            type: 'inicial'\n          })\n        })\n      }\n    })\n\n\n    return orderedTags\n  }\n\n  // Función para obtener tags finales ordenados\n  const getOrderedTagsFinales = (video) => {\n    if (!video.tagsFinales || Object.keys(video.tagsFinales).length === 0) {\n      return []\n    }\n\n    const orderedTags = []\n    \n    categoriesList.forEach(category => {\n      const categoryTags = video.tagsFinales[category.key]\n      if (Array.isArray(categoryTags)) {\n        categoryTags.forEach(tag => {\n          orderedTags.push({\n            tag,\n            categoryKey: category.key,\n            color: category.color,\n            type: 'final'\n          })\n        })\n      }\n    })\n\n\n    return orderedTags\n  }\n\n  // Función para normalizar texto (eliminar tildes y convertir a minúsculas)\n  const normalizeText = (text) => {\n    return text\n      .toLowerCase()\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '') // Eliminar diacríticos (tildes)\n      .trim()\n  }\n\n  // Función de búsqueda avanzada\n  const advancedSearch = (video, searchTerms) => {\n    if (!searchTerms || searchTerms.length === 0) return true\n\n    // Normalizar el texto del video\n    const normalizedTitle = normalizeText(video.title || '')\n    const normalizedDescription = normalizeText(video.description || '')\n    \n    // Normalizar tags del video\n    const normalizedTags = []\n    if (video.tags) {\n      Object.values(video.tags).forEach(categoryTags => {\n        if (Array.isArray(categoryTags)) {\n          categoryTags.forEach(tag => {\n            normalizedTags.push(normalizeText(tag))\n          })\n        }\n      })\n    }\n\n    // Verificar que TODAS las palabras de búsqueda estén presentes\n    return searchTerms.every(searchWord => {\n      const normalizedSearchWord = normalizeText(searchWord)\n      \n      // Buscar en título\n      if (normalizedTitle.includes(normalizedSearchWord)) return true\n      \n      // Buscar en descripción\n      if (normalizedDescription.includes(normalizedSearchWord)) return true\n      \n      // Buscar en tags\n      if (normalizedTags.some(tag => tag.includes(normalizedSearchWord))) return true\n      \n      return false\n    })\n  }\n\n  // Filtrar videos basado en tags seleccionados y búsqueda avanzada\n  const baseFilteredVideos = videos.filter(video => {\n    // Dividir términos de búsqueda por espacios y filtrar vacíos\n    const searchTerms = searchTerm\n      .split(' ')\n      .map(term => term.trim())\n      .filter(term => term.length > 0)\n\n    // Filtro por búsqueda avanzada\n    const searchMatch = advancedSearch(video, searchTerms)\n\n    // Filtro por tags - EXCLUYENTE (todos los tags seleccionados deben estar presentes)\n    const tagsMatch = selectedTags.length === 0 || \n      selectedTags.every(tag => {\n        // Buscar en todas las categorías de tags del video\n        if (video.tags) {\n          return Object.values(video.tags).some(categoryTags => \n            Array.isArray(categoryTags) && categoryTags.includes(tag)\n          )\n        }\n        return false\n      })\n\n      // Filtro por chips de categorías\n  const categoryMatch = activeCategoryChips.length === 0 || \n    activeCategoryChips.some(chip => hasCategoryTags(video, chip))\n\n  // Filtro por favoritos\n  const favoritesMatch = !showFavorites || video.isFavorite\n\n  return searchMatch && tagsMatch && categoryMatch && favoritesMatch\n  })\n\n  // Aplicar filtro de compatibilidad sobre los videos ya filtrados\n  const baseCompatibilityFiltered = getFilteredVideos(baseFilteredVideos)\n\n  // Aplicar ordenamiento final\n  const filteredVideos = sortVideos(baseCompatibilityFiltered)\n\n  // Función para descargar video usando Firebase Storage\n  const downloadVideo = async (video) => {\n    try {\n      console.log('Iniciando descarga de video individual:', video.title)\n      \n      // Usar Firebase SDK directamente para descargar\n      const { ref, getDownloadURL } = await import('firebase/storage')\n      const { storage } = await import('../services/firebase/config')\n      \n      const videoRef = ref(storage, video.videoPath)\n      \n      // Obtener la URL de descarga con token de acceso\n      const downloadURL = await getDownloadURL(videoRef)\n      \n      console.log('URL de descarga obtenida:', downloadURL)\n      \n      // Crear enlace de descarga directo\n      const link = document.createElement('a')\n      link.href = downloadURL\n      link.download = video.title || 'video'\n      link.target = '_blank'\n      link.rel = 'noopener noreferrer'\n      \n      // Agregar al DOM y hacer clic\n      document.body.appendChild(link)\n      link.click()\n      document.body.removeChild(link)\n      \n      addToast('Descarga iniciada', 'success')\n    } catch (error) {\n      console.error('Error en descarga:', error)\n      addToast('Error al descargar el video', 'error')\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-white\">\n      {/* Main Content */}\n      <div className={`${isFullWidth ? 'w-full px-0' : 'max-w-6xl mx-auto px-6'} py-8`}>\n        {/* Title */}\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-4xl font-bold mb-2\">\n            <span className=\"text-pink-500\">FIGURAS</span>\n            <span className={`bg-gradient-to-r ${getGradientClasses(selectedStyle)} bg-clip-text text-transparent`}> - {selectedStyle.toUpperCase()}</span>\n          </h1>\n          <p className=\"text-gray-600 text-lg\">Galería de videos de figuras de {selectedStyle.toLowerCase()}</p>\n        </div>\n\n        {/* Style Filters */}\n        <div className=\"flex flex-wrap justify-center gap-3 mb-8\">\n          {availableStyles.map((style) => {\n            const IconComponent = iconMap[style.icon]\n                                      const isSelected = selectedStyle === style.key\n             // Usar gradientes específicos para cada estilo\n             const gradientClass = getGradientClasses(style.color)\n            \n            return (\n                             <button\n                 key={style.name}\n                 onClick={() => setSelectedStyle(style.key)}\n                 className={`relative flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${\n                   isSelected\n                     ? `bg-gradient-to-r ${gradientClass} text-white shadow-lg transform scale-105`\n                     : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300'\n                 }`}\n               >\n                {IconComponent && <IconComponent className=\"h-4 w-4\" />}\n                <span>{style.name}</span>\n              </button>\n            )\n          })}\n        </div>\n\n        {/* Search Bar */}\n        <div className=\"max-w-2xl mx-auto mb-8\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5\" />\n            <input\n              type=\"text\"\n              placeholder={`Buscar en ${selectedStyle.toLowerCase()}... (múltiples palabras, sin tildes)`}\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200\"\n            />\n          </div>\n          \n          {/* Search Status Indicator */}\n          {searchTerm.trim() && (\n            <div className=\"mt-3 text-center\">\n              <div className=\"inline-flex items-center space-x-2 px-4 py-2 bg-blue-50 border border-blue-200 rounded-lg\">\n                <Search className=\"h-4 w-4 text-blue-500\" />\n                <span className=\"text-sm text-blue-700\">\n                  Buscando: <span className=\"font-medium\">\"{searchTerm}\"</span>\n                </span>\n                <span className=\"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded\">\n                  {filteredVideos.length} resultado{filteredVideos.length !== 1 ? 's' : ''}\n                </span>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Tag Filters - Collapsible con títulos clickeables */}\n        {categoriesList.length > 0 && (\n          <div className=\"mb-8\">\n            <button\n              onClick={() => setShowFilters(!showFilters)}\n              className=\"flex items-center justify-center space-x-2 mx-auto px-6 py-3 bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 rounded-lg font-medium shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105\"\n            >\n              <Filter className=\"h-5 w-5\" />\n              <span>Filtros Avanzados por Tags - {selectedStyle}</span>\n              {showFilters ? (\n                <ChevronUp className=\"h-5 w-5\" />\n              ) : (\n                <ChevronDown className=\"h-5 w-5\" />\n              )}\n            </button>\n            \n            {/* Collapsible Content */}\n            <div className={`mt-4 transition-all duration-300 ease-in-out overflow-hidden ${\n              showFilters ? 'max-h-96 opacity-100' : 'max-h-0 opacity-0'\n            }`}>\n              <div className=\"space-y-4 bg-gray-50 rounded-lg p-6 border border-gray-200\">\n                {categoriesList.map((category) => (\n                  <div key={category.key} className=\"space-y-2\">\n                    {/* Título clickeable de categoría */}\n                    <button\n                      onClick={() => handleCategoryTitleClick(category.key)}\n                      className={`w-full text-center font-medium py-2 px-4 rounded-lg transition-all duration-200 transform hover:scale-105 ${\n                        activeCategoryChips.includes(category.key)\n                          ? `bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white shadow-lg`\n                          : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300'\n                      }`}\n                    >\n                      <div className=\"flex items-center justify-center space-x-2\">\n                        <span>{category.name}</span>\n                        {activeCategoryChips.includes(category.key) && (\n                          <span className=\"text-xs bg-white bg-opacity-20 px-2 py-1 rounded\">\n                            ACTIVO\n                          </span>\n                        )}\n                      </div>\n                    </button>\n                    \n                    {/* Tags de la categoría */}\n                    <div className=\"flex flex-wrap justify-center gap-2\">\n                      {category.tags.map(tag => (\n                        <button\n                          key={tag}\n                          onClick={() => handleTagFilter(tag)}\n                          className={`px-3 py-1 rounded-full text-sm font-medium transition-all duration-200 ${\n                            selectedTags.includes(tag)\n                              ? `bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white shadow-lg`\n                              : `${getColorClasses(category.color)} hover:bg-opacity-80`\n                          }`}\n                        >\n                          {tag}\n                        </button>\n                      ))}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        )}\n\n\n\n\n\n        {/* Action Buttons - Main Level */}\n        <div className=\"flex flex-col sm:flex-row gap-4 justify-center mb-6\">\n          <button \n            onClick={() => setIsUploadModalOpen(true)}\n            className={`flex items-center justify-center space-x-2 px-6 py-3 bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white rounded-lg font-medium shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105`}\n          >\n            <Upload className=\"h-5 w-5\" />\n            <span>SUBIR VIDEO(S) A {selectedStyle.toUpperCase()}</span>\n          </button>\n          <button \n            onClick={toggleBuilder}\n            className={`flex items-center justify-center space-x-2 px-6 py-3 rounded-lg font-medium shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 ${\n              isBuilderOpen \n                ? 'bg-gradient-to-r from-red-500 to-pink-500 text-white' \n                : `bg-gradient-to-r ${getGradientClasses(selectedStyle)} hover:opacity-90 text-white`\n            }`}\n          >\n            <Shuffle className=\"h-5 w-5\" />\n            <span>{isBuilderOpen ? 'OCULTAR SECUENCIA' : 'CREAR SECUENCIA'}</span>\n          </button>\n        </div>\n\n        {/* Botones de ordenamiento y favoritos - Nueva ubicación */}\n        <div className=\"flex flex-wrap justify-center gap-3 mb-6\">\n          {/* Botón A-Z/Z-A combinado */}\n          <button\n            onClick={() => handleSortChange(sortBy === 'name' ? 'name-desc' : 'name')}\n            className={`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${\n              sortBy === 'name' || sortBy === 'name-desc'\n                ? `bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white shadow-lg`\n                : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50'\n            }`}\n          >\n            <span>{sortBy === 'name' ? 'A-Z' : sortBy === 'name-desc' ? 'Z-A' : 'A-Z'}</span>\n          </button>\n          \n          {/* Botón Puntuación */}\n          <button\n            onClick={() => handleSortChange(sortBy === 'rating' ? 'rating-desc' : 'rating')}\n            className={`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${\n              sortBy === 'rating' || sortBy === 'rating-desc'\n                ? `bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white shadow-lg`\n                : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50'\n            }`}\n          >\n            <Star className=\"h-4 w-4\" />\n            <span>{sortBy === 'rating' ? 'Puntuación ↓' : sortBy === 'rating-desc' ? 'Puntuación ↑' : 'Puntuación'}</span>\n          </button>\n          \n          {/* Botón Favoritos */}\n          <button\n            onClick={() => {\n              if (!showFavorites) {\n                // Si no está mostrando favoritos, activar y ordenar por likes descendente\n                setShowFavorites(true)\n                setSortBy('likes')\n              } else if (sortBy === 'likes') {\n                // Si está mostrando favoritos y ordenado por likes, cambiar a ascendente\n                setSortBy('likes-desc')\n              } else if (sortBy === 'likes-desc') {\n                // Si está en ascendente, volver a descendente\n                setSortBy('likes')\n              } else {\n                // Si está en otro ordenamiento, desactivar favoritos\n                setShowFavorites(false)\n                setSortBy('none')\n              }\n            }}\n            className={`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${\n              showFavorites\n                ? `bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white shadow-lg`\n                : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50'\n            }`}\n          >\n            <Heart className=\"h-4 w-4\" />\n            <span>\n              {!showFavorites ? 'Mostrar Favoritos' : \n               sortBy === 'likes' ? 'Favoritos ↓' : \n               sortBy === 'likes-desc' ? 'Favoritos ↑' : \n               'Ocultar Favoritos'}\n            </span>\n          </button>\n        </div>\n\n        {/* Sequence Builder - Collapsible */}\n        {isBuilderOpen && (\n          <SequenceBuilder\n            isOpen={true}\n            videos={videos}\n            onSaveSequence={handleSaveSequence}\n            onToggleShowAll={toggleShowAllVideos}\n            showAllVideos={showAllVideos}\n            style={selectedStyle}\n            onToggleBuilder={toggleBuilder}\n          />\n        )}\n\n        {/* Sync Status and Cleanup Controls */}\n        <div className=\"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200\">\n          <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4\">\n            {/* Sync Status */}\n            <div className=\"flex items-center space-x-2\">\n              <div className={`w-3 h-3 rounded-full ${\n                syncStatus === 'idle' ? 'bg-green-500' : \n                syncStatus === 'syncing' ? 'bg-yellow-500 animate-pulse' : \n                'bg-red-500'\n              }`}></div>\n              <span className=\"text-sm text-gray-600\">\n                {syncStatus === 'idle' ? '✅ Sincronizado con Firebase' : \n                 syncStatus === 'syncing' ? '🔄 Sincronizando...' : \n                 '❌ Error de sincronización'}\n              </span>\n            </div>\n            \n            {/* Cleanup Buttons */}\n            <div className=\"flex flex-wrap gap-2\">\n              <button\n                onClick={handleDiagnoseVideos}\n                disabled={syncStatus === 'syncing'}\n                className=\"px-3 py-1 text-xs bg-purple-500 text-white rounded hover:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                🔍 Diagnóstico\n              </button>\n              <button\n                onClick={handleUpdateAllResolutions}\n                disabled={syncStatus === 'syncing'}\n                className=\"px-3 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                📐 Actualizar Resoluciones\n              </button>\n              <button\n                onClick={() => openCleanupModal('update')}\n                disabled={syncStatus === 'syncing'}\n                className=\"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                🔧 Actualizar Rutas\n              </button>\n              <button\n                onClick={() => openCleanupModal('cleanup')}\n                disabled={syncStatus === 'syncing'}\n                className=\"px-3 py-1 text-xs bg-yellow-500 text-white rounded hover:bg-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                🧹 Limpiar Huérfanos\n              </button>\n              <button\n                onClick={() => openCleanupModal('cleanup-tags')}\n                disabled={syncStatus === 'syncing'}\n                className=\"px-3 py-1 text-xs bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                🏷️ Limpiar Tags\n              </button>\n              <button\n                onClick={handleMigrateVideos}\n                disabled={syncStatus === 'syncing'}\n                className=\"px-3 py-1 text-xs bg-indigo-500 text-white rounded hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n                title=\"Mover físicamente videos existentes a estructura organizada (videos/page/style/)\"\n              >\n                📁 Migrar Videos REAL\n              </button>\n              <button\n                onClick={() => openCleanupModal('delete-all')}\n                disabled={syncStatus === 'syncing'}\n                className=\"px-3 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                🗑️ Eliminar Todo\n              </button>\n            </div>\n          </div>\n        </div>\n\n        {/* Gallery Tabs */}\n        <div className=\"flex justify-center gap-4 mb-8\">\n          <button\n            onClick={() => setActiveTab('videos')}\n            className={`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${\n              activeTab === 'videos'\n                ? `bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white shadow-lg transform scale-105`\n                : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50'\n            }`}\n          >\n            <Music className=\"h-6 w-6\" />\n            <span>GALERÍA DE VIDEOS</span>\n          </button>\n          <button\n            onClick={() => setActiveTab('secuencias')}\n            className={`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${\n              activeTab === 'secuencias'\n                ? `bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white shadow-lg transform scale-105`\n                : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50'\n            }`}\n          >\n            <Plus className=\"h-6 w-6\" />\n            <span>GALERÍA DE SECUENCIAS ({sequences.length})</span>\n          </button>\n        </div>\n\n\n\n        {/* Videos Grid */}\n        {activeTab === 'videos' && (\n          <div className=\"mb-8\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <div>\n                <h2 className=\"text-2xl font-semibold text-gray-800\">\n                  Videos de {selectedStyle.toLowerCase()} ({filteredVideos.length})\n                </h2>\n                {(activeCategoryChips.length > 0 || sortBy !== 'none' || showFavorites) && (\n                  <p className=\"text-sm text-gray-600 mt-1\">\n                    {activeCategoryChips.length > 0 && `Filtrado por: ${activeCategoryChips.join(', ')} `}\n                    {sortBy !== 'none' && `• Ordenado por: ${sortBy} `}\n                    {showFavorites && '• Solo favoritos'}\n                  </p>\n                )}\n              </div>\n              <div className=\"flex items-center space-x-4\">\n                {/* Selector de tamaño de cards */}\n                <CardSizeSelector type=\"video\" />\n                \n                {/* Botón de modo ancho completo */}\n                <button\n                  onClick={() => setIsFullWidth(!isFullWidth)}\n                  className={`flex items-center space-x-2 px-3 py-2 rounded-lg font-medium transition-all duration-200 ${\n                    isFullWidth\n                      ? `bg-gradient-to-r ${getGradientClasses(selectedStyle)} text-white shadow-lg`\n                      : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300'\n                  }`}\n                  title={isFullWidth ? \"Modo compacto\" : \"Modo ancho completo\"}\n                >\n                  {isFullWidth ? (\n                    <Minimize2 className=\"h-4 w-4\" />\n                  ) : (\n                    <Maximize2 className=\"h-4 w-4\" />\n                  )}\n                  <span className=\"hidden sm:inline\">\n                    {isFullWidth ? \"Compacto\" : \"Ancho completo\"}\n                  </span>\n                </button>\n                \n                {/* Botón para mostrar todos los videos vs solo compatibles */}\n                {isBuilderOpen && (\n                  <button\n                    onClick={toggleShowAllVideos}\n                    className={`flex items-center space-x-2 px-3 py-1 rounded-lg text-sm font-medium transition-colors ${\n                      showAllVideos \n                        ? 'bg-blue-100 text-blue-800' \n                        : 'bg-green-100 text-green-800'\n                    }`}\n                    title={showAllVideos ? 'Mostrar solo videos compatibles' : 'Mostrar todos los videos'}\n                  >\n                    {showAllVideos ? (\n                      <>\n                        <EyeOff className=\"h-4 w-4\" />\n                        <span>Ocultar Incompatibles</span>\n                      </>\n                    ) : (\n                      <>\n                        <Eye className=\"h-4 w-4\" />\n                        <span>Mostrar Todos</span>\n                      </>\n                    )}\n                  </button>\n                )}\n                \n                {(selectedTags.length > 0 || activeCategoryChips.length > 0 || sortBy !== 'none' || showFavorites) && (\n                  <button\n                    onClick={() => {\n                      clearFilters()\n                      setActiveCategoryChips([])\n                      setSortBy('none')\n                      setShowFavorites(false)\n                    }}\n                    className=\"text-sm text-gray-500 hover:text-gray-700 transition-colors duration-200\"\n                  >\n                    Limpiar todos los filtros <X className=\"h-4 w-4 ml-1\" />\n                  </button>\n                )}\n              </div>\n            </div>\n          \n          {loading ? (\n            <div className=\"flex justify-center items-center py-12\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500\"></div>\n              <span className=\"ml-3 text-gray-600\">Cargando videos...</span>\n            </div>\n          ) : videos.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <p className=\"text-gray-500 text-lg\">No hay videos de {selectedStyle.toLowerCase()} aún</p>\n              <p className=\"text-gray-400 text-sm mt-2\">Sube tu primer video de {selectedStyle.toLowerCase()} usando el botón de arriba</p>\n            </div>\n                     ) : (\n             <div className={`grid gap-6 ${getVideoConfig().grid}`}>\n               {filteredVideos.map((video) => (\n                <div \n                  key={video.id} \n                  className={`bg-white rounded-lg shadow-md overflow-hidden border hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02] ${\n                    isBuilderOpen && !isVideoCompatible(video)\n                      ? 'border-red-200 opacity-75'\n                      : 'border-gray-100'\n                  }`}\n                >\n                  <div className=\"relative group\">\n                    <div className={`w-full ${getVideoConfig().aspect} bg-gradient-to-br from-gray-100 to-gray-200 relative overflow-hidden flex items-center justify-center`}>\n                      {video.thumbnailUrl && video.thumbnailUrl !== 'https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO' ? (\n                        <img\n                          src={video.thumbnailUrl}\n                          alt={video.title}\n                          className=\"w-full h-full object-cover\"\n                          loading=\"lazy\"\n                          onError={(e) => {\n                            e.target.style.display = 'none';\n                            e.target.nextSibling.style.display = 'flex';\n                          }}\n                        />\n                      ) : null}\n                      <div className={`flex flex-col items-center justify-center text-gray-500 ${video.thumbnailUrl && video.thumbnailUrl !== 'https://via.placeholder.com/400x225/1a1a1a/ffffff?text=VIDEO' ? 'hidden' : 'flex'}`}>\n                        <svg className=\"w-12 h-12 mb-2 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\" />\n                        </svg>\n                        <span className=\"text-sm font-medium\">{video.title}</span>\n                      </div>\n                      <div className=\"absolute bottom-2 left-2 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-sm font-medium\">\n                        {video.resolution && video.resolution !== 'Unknown' ? video.resolution : 'HD'}\n                      </div>\n                      \n                      {/* Indicador de compatibilidad */}\n                      {isBuilderOpen && (\n                        <div className={`absolute top-2 right-2 p-1 rounded-full text-xs font-bold ${\n                          isVideoCompatible(video)\n                            ? 'bg-green-500 text-white' \n                            : 'bg-red-500 text-white'\n                        }`}>\n                          {isVideoCompatible(video) ? '✅' : '❌'}\n                        </div>\n                      )}\n                    </div>\n                    \n                                         {/* Botón de reproducción */}\n                     <button\n                       onClick={async () => {\n                         try {\n                           // Abrir modal de reproducción\n                           const modal = document.createElement('div')\n                           modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50'\n                           \n                           const videoContainer = document.createElement('div')\n                           videoContainer.className = 'bg-white rounded-lg p-6 max-w-5xl w-full mx-4 max-h-[95vh] overflow-y-auto'\n                           videoContainer.onclick = (e) => e.stopPropagation()\n                           \n                           const header = document.createElement('div')\n                           header.className = 'flex items-center justify-between mb-4'\n                           header.innerHTML = `\n                             <h3 class=\"text-xl font-semibold text-gray-900\">${video.title}</h3>\n                             <button class=\"text-gray-400 hover:text-gray-600 transition-colors\">\n                               <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                 <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n                               </svg>\n                             </button>\n                           `\n                           \n                           // Crear el VideoPlayer\n                           const videoPlayerContainer = document.createElement('div')\n                           videoPlayerContainer.id = 'video-player-container'\n                           videoPlayerContainer.className = 'w-full flex justify-center mb-6'\n                           \n                           // Crear contenedor para información del video\n                           const videoInfoContainer = document.createElement('div')\n                           videoInfoContainer.className = 'w-full max-w-3xl mx-auto'\n                           \n                           // Descripción\n                           const description = document.createElement('div')\n                           description.className = 'mb-4'\n                           description.innerHTML = `\n                             <p class=\"text-gray-600 text-sm\">${video.description || 'Sin descripción'}</p>\n                           `\n                           \n                                                       // Stats del video\n                            const stats = document.createElement('div')\n                            stats.className = 'flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg'\n                            stats.innerHTML = `\n                              <div class=\"flex items-center space-x-4 text-sm text-gray-600\">\n                                <span class=\"font-medium\">${(video.fileSize / (1024 * 1024)).toFixed(2)} MB</span>\n                                <span class=\"text-gray-400\">•</span>\n                                <span class=\"font-medium\">${video.resolution && video.resolution !== 'Unknown' ? video.resolution : 'HD'}</span>\n                                <span class=\"text-gray-400\">•</span>\n                                <span class=\"font-medium\">${video.duration ? Math.floor(video.duration / 60) + ':' + String(Math.floor(video.duration % 60)).padStart(2, '0') : 'N/A'}</span>\n                              </div>\n                              <div class=\"flex items-center space-x-2\">\n                                <div class=\"flex items-center space-x-1\">\n                                  <div class=\"flex items-center space-x-1\" title=\"Puntuación: ${video.rating || 0}/5\">\n                                    ${[1, 2, 3, 4, 5].map(star => {\n                                      const isFilled = (video.rating || 0) >= star\n                                      return `<svg class=\"w-4 h-4 ${isFilled ? 'text-yellow-400 fill-current' : 'text-gray-300'}\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\"/>\n                                      </svg>`\n                                    }).join('')}\n                                    <span class=\"text-sm font-medium text-gray-600\">${video.rating || 0}</span>\n                                  </div>\n                                </div>\n                                <button class=\"flex items-center space-x-1 ${video.userLiked ? 'text-red-500' : 'text-gray-400 hover:text-red-500'} transition-colors duration-200 p-2 rounded hover:bg-red-50\" title=\"${video.userLiked ? 'Quitar like' : 'Dar like'}\">\n                                  <svg class=\"w-5 h-5 ${video.userLiked ? 'fill-current' : ''}\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"></path>\n                                  </svg>\n                                  <span class=\"text-sm font-medium\">${video.likes || 0}</span>\n                                </button>\n                                <button class=\"text-gray-400 hover:text-green-500 transition-colors duration-200 p-2 rounded hover:bg-green-50\" title=\"Descargar video\">\n                                  <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"></path>\n                                  </svg>\n                                </button>\n                                <button class=\"text-gray-400 hover:text-blue-500 transition-colors duration-200 p-2 rounded hover:bg-blue-50\" title=\"Editar video\">\n                                  <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>\n                                  </svg>\n                                </button>\n                              </div>\n                            `\n                           \n                           // Tags normales\n                           const tagsContainer = document.createElement('div')\n                           tagsContainer.className = 'mb-4'\n                           const orderedTags = getOrderedTags(video)\n                           if (orderedTags.length > 0) {\n                             const tagsHTML = orderedTags.map(({ tag, categoryKey, color }) => {\n                               const colorClasses = getColorClasses(color)\n                               return `<span class=\"inline-block px-3 py-1 rounded-full text-sm font-medium ${colorClasses} mr-2 mb-2\">${tag}</span>`\n                             }).join('')\n                             tagsContainer.innerHTML = `\n                               <h4 class=\"text-sm font-medium text-gray-700 mb-2\">Etiquetas:</h4>\n                               <div class=\"flex flex-wrap\">${tagsHTML}</div>\n                             `\n                           } else {\n                             tagsContainer.innerHTML = `\n                               <h4 class=\"text-sm font-medium text-gray-700 mb-2\">Etiquetas:</h4>\n                               <span class=\"text-gray-400 text-sm\">Sin etiquetas</span>\n                             `\n                           }\n                           \n                           // Tags iniciales\n                           const tagsInicialesContainer = document.createElement('div')\n                           tagsInicialesContainer.className = 'mb-4'\n                           const tagsIniciales = getOrderedTagsIniciales(video)\n                           if (tagsIniciales.length > 0) {\n                             const tagsHTML = tagsIniciales.map(({ tag }) => \n                               `<span class=\"inline-block px-3 py-1 rounded-full text-sm font-medium bg-gradient-to-r from-blue-500 to-purple-500 text-white mr-2 mb-2\">${tag}</span>`\n                             ).join('')\n                             tagsInicialesContainer.innerHTML = `\n                               <h4 class=\"text-sm font-medium text-blue-600 uppercase tracking-wide mb-2\">Etiquetas Iniciales:</h4>\n                               <div class=\"flex flex-wrap\">${tagsHTML}</div>\n                             `\n                           }\n                           \n                           // Tags finales\n                           const tagsFinalesContainer = document.createElement('div')\n                           tagsFinalesContainer.className = 'mb-4'\n                           const tagsFinales = getOrderedTagsFinales(video)\n                           if (tagsFinales.length > 0) {\n                             const tagsHTML = tagsFinales.map(({ tag }) => \n                               `<span class=\"inline-block px-3 py-1 rounded-full text-sm font-medium bg-gradient-to-r from-green-500 to-teal-500 text-white mr-2 mb-2\">${tag}</span>`\n                             ).join('')\n                             tagsFinalesContainer.innerHTML = `\n                               <h4 class=\"text-sm font-medium text-green-600 uppercase tracking-wide mb-2\">Etiquetas Finales:</h4>\n                               <div class=\"flex flex-wrap\">${tagsHTML}</div>\n                             `\n                           }\n                           \n                           // Ensamblar todo\n                           videoInfoContainer.appendChild(description)\n                           videoInfoContainer.appendChild(stats)\n                           videoInfoContainer.appendChild(tagsContainer)\n                           if (tagsIniciales.length > 0) {\n                             videoInfoContainer.appendChild(tagsInicialesContainer)\n                           }\n                           if (tagsFinales.length > 0) {\n                             videoInfoContainer.appendChild(tagsFinalesContainer)\n                           }\n                           \n                           videoContainer.appendChild(header)\n                           videoContainer.appendChild(videoPlayerContainer)\n                           videoContainer.appendChild(videoInfoContainer)\n                           modal.appendChild(videoContainer)\n                           document.body.appendChild(modal)\n                           \n                           // Renderizar el VideoPlayer usando React\n                           const { createRoot } = await import('react-dom/client')\n                           const root = createRoot(videoPlayerContainer)\n                           root.render(React.createElement(VideoPlayer, {\n                             src: video.videoUrl,\n                             size: 'large',\n                             loop: true,\n                             initialShowControls: true,\n                             autoplay: true,\n                             muted: false,\n                             className: 'w-full max-w-3xl',\n                             resolutions: ['auto', '4k', '1080p', '720p', '480p', '360p'],\n                             currentResolution: 'auto',\n                             videoTitle: video.title || 'video',\n                             onResolutionChange: (resolution) => {\n                               console.log(`Resolución cambiada a: ${resolution}`)\n                               // Aquí se implementaría la lógica para cambiar la resolución del video\n                             }\n                           }))\n                           \n                           // Guardar referencia del root para limpieza\n                           modal._root = root\n                           \n                           const closeModal = () => {\n                             if (modal._root) {\n                               modal._root.unmount()\n                             }\n                             if (document.body.contains(modal)) {\n                               document.body.removeChild(modal)\n                             }\n                           }\n                           \n                           header.querySelector('button').onclick = closeModal\n                           modal.onclick = (e) => {\n                             if (e.target === modal) {\n                               closeModal()\n                             }\n                           }\n                           \n                           // Añadir funcionalidad al botón de descarga\n                           stats.querySelector('button[title=\"Descargar video\"]').onclick = () => {\n                             downloadVideo(video)\n                           }\n                           \n                           // Añadir funcionalidad al botón de editar\n                           stats.querySelector('button[title=\"Editar video\"]').onclick = () => {\n                             closeModal()\n                             openEditModal(video)\n                           }\n                           \n                                                       // Añadir funcionalidad al sistema de rating\n                            const ratingContainer = stats.querySelector('div[title*=\"Puntuación\"]')\n                            const stars = ratingContainer.querySelectorAll('svg')\n                            const ratingText = ratingContainer.querySelector('span')\n                            \n                            stars.forEach((star, index) => {\n                              const starValue = index + 1\n                              \n                              // Hover effect\n                              star.addEventListener('mouseenter', () => {\n                                stars.forEach((s, i) => {\n                                  if (i <= index) {\n                                    s.classList.add('text-yellow-400', 'fill-current')\n                                    s.classList.remove('text-gray-300')\n                                  }\n                                })\n                              })\n                              \n                              star.addEventListener('mouseleave', () => {\n                                stars.forEach((s, i) => {\n                                  const currentRating = video.rating || 0\n                                  if (i < currentRating) {\n                                    s.classList.add('text-yellow-400', 'fill-current')\n                                    s.classList.remove('text-gray-300')\n                                  } else {\n                                    s.classList.remove('text-yellow-400', 'fill-current')\n                                    s.classList.add('text-gray-300')\n                                  }\n                                })\n                              })\n                              \n                              // Click to rate\n                              star.addEventListener('click', async () => {\n                                try {\n                                  const currentRating = video.rating || 0\n                                  // Si la estrella clickeada ya está marcada, quitar todas las estrellas (rating = 0)\n                                  // Si no está marcada, asignar el valor de la estrella\n                                  const newRating = currentRating >= starValue ? 0 : starValue\n                                  \n                                  // Actualizar en Firestore\n                                  await updateVideoDocument(video.id, { rating: newRating })\n                                  \n                                  // Actualizar estado local\n                                  video.rating = newRating\n                                  \n                                  // Actualizar visual\n                                  stars.forEach((s, i) => {\n                                    if (i < newRating) {\n                                      s.classList.add('text-yellow-400', 'fill-current')\n                                      s.classList.remove('text-gray-300')\n                                    } else {\n                                      s.classList.remove('text-yellow-400', 'fill-current')\n                                      s.classList.add('text-gray-300')\n                                    }\n                                  })\n                                  \n                                  ratingText.textContent = newRating\n                                  ratingContainer.title = `Puntuación: ${newRating}/5`\n                                  \n                                  console.log(`Video \"${video.title}\" puntuado con ${newRating} estrellas`)\n                                } catch (error) {\n                                  console.error('Error al actualizar puntuación:', error)\n                                }\n                              })\n                            })\n                            \n                            // Añadir funcionalidad al botón de likes\n                            const likeButton = stats.querySelector('button[title*=\"like\"]')\n                            likeButton.onclick = async () => {\n                              if (!user) {\n                                alert('Debes iniciar sesión para dar like')\n                                return\n                              }\n                              \n                              try {\n                                const result = await toggleVideoLike(video.id, user.uid)\n                                \n                                if (result.success) {\n                                  // Actualizar el video en el estado local\n                                  video.likes = result.likes\n                                  video.likedBy = result.likedBy\n                                  video.userLiked = result.userLiked\n                                  \n                                  // Actualizar el estado global de videos\n                                  setVideos(prevVideos => \n                                    prevVideos.map(v => \n                                      v.id === video.id \n                                        ? { \n                                            ...v, \n                                            likes: result.likes, \n                                            likedBy: result.likedBy,\n                                            userLiked: result.userLiked \n                                          }\n                                        : v\n                                    )\n                                  )\n                                  \n                                  // Cambiar el estado visual del botón\n                                  const icon = likeButton.querySelector('svg')\n                                  const button = likeButton\n                                  const likesText = likeButton.querySelector('span')\n                                  \n                                  if (result.userLiked) {\n                                    icon.classList.add('fill-current', 'text-red-500')\n                                    icon.classList.remove('text-gray-400')\n                                    button.classList.add('text-red-500')\n                                    button.classList.remove('text-gray-400')\n                                    button.title = 'Quitar like'\n                                  } else {\n                                    icon.classList.remove('fill-current', 'text-red-500')\n                                    icon.classList.add('text-gray-400')\n                                    button.classList.remove('text-red-500')\n                                    button.classList.add('text-gray-400')\n                                    button.title = 'Dar like'\n                                  }\n                                  \n                                  // Actualizar el contador\n                                  likesText.textContent = result.likes\n                                  \n                                  const action = result.userLiked ? 'dado like a' : 'quitado like de'\n                                  console.log(`Has ${action} \"${video.title}\"`)\n                                } else {\n                                  console.error('Error al actualizar like')\n                                }\n                              } catch (error) {\n                                console.error('Error al actualizar like:', error)\n                              }\n                            }\n                         } catch (error) {\n                           console.error('Error al abrir modal de video:', error)\n                         }\n                       }}\n                      className=\"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-200\"\n                    >\n                      <svg className=\"w-12 h-12 text-white\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path d=\"M8 5v14l11-7z\"/>\n                      </svg>\n                    </button>\n                  </div>\n                  \n                                     <div className={`${getVideoConfig().compact ? 'p-2' : 'p-4'}`}>\n                                            <div className={`flex items-center justify-between ${getVideoConfig().compact ? 'mb-1' : 'mb-2'}`}>\n                         <h3 className={`font-semibold text-gray-800 ${getVideoConfig().titleSize}`}>{video.title}</h3>\n                       <div className=\"flex items-center space-x-1\">\n                         {[1, 2, 3, 4, 5].map(star => {\n                           const isFilled = (video.rating || 0) >= star\n                           return (\n                             <svg \n                               key={star}\n                               className={`${getVideoConfig().compact ? 'h-3 w-3' : 'h-4 w-4'} ${isFilled ? 'text-yellow-400 fill-current' : 'text-gray-300'} cursor-pointer`} \n                               fill=\"currentColor\" \n                               viewBox=\"0 0 24 24\"\n                               onClick={async () => {\n                                 try {\n                                   const currentRating = video.rating || 0\n                                   // Si la estrella clickeada ya está marcada, quitar todas las estrellas (rating = 0)\n                                   // Si no está marcada, asignar el valor de la estrella\n                                   const newRating = currentRating >= star ? 0 : star\n                                   await updateVideoDocument(video.id, { rating: newRating })\n                                   video.rating = newRating\n                                   console.log(`Video \"${video.title}\" rated ${newRating} stars`)\n                                 } catch (error) {\n                                   console.error('Error updating rating:', error)\n                                 }\n                               }}\n                             >\n                               <path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\"/>\n                             </svg>\n                           )\n                         })}\n                         <span className={`${getVideoConfig().compact ? 'text-xs' : 'text-xs'} font-medium text-gray-500 ml-1`}>({video.rating || 0})</span>\n                       </div>\n                     </div>\n                                           <p className={`text-gray-600 text-sm ${getVideoConfig().compact ? 'mb-2' : 'mb-3'} ${getVideoConfig().descriptionLines === 1 ? 'line-clamp-1' : getVideoConfig().descriptionLines === 2 ? 'line-clamp-2' : getVideoConfig().descriptionLines === 3 ? 'line-clamp-3' : 'line-clamp-4'}`}>{video.description || 'Sin descripción'}</p>\n                    \n                                         {/* Tags Normales */}\n                                           {getVideoConfig().showTags && (\n                        <div className=\"flex flex-wrap gap-2 mb-3\">\n                          {(() => {\n                            const orderedTags = getOrderedTags(video)\n                            if (orderedTags.length > 0) {\n                              return orderedTags.map(({ tag, categoryKey, color }) => (\n                                <span\n                                  key={`${categoryKey}-${tag}`}\n                                  className={`px-2 py-1 rounded-full text-xs font-medium ${getColorClasses(color)}`}\n                                >\n                                  {tag}\n                                </span>\n                              ))\n                            } else {\n                              return <span className=\"text-gray-400 text-sm\">Sin etiquetas</span>\n                            }\n                          })()}\n                        </div>\n                      )}\n\n                     {/* Tags Iniciales */}\n                                           {getVideoConfig().showTags && (() => {\n                        const tagsIniciales = getOrderedTagsIniciales(video)\n                        if (tagsIniciales.length > 0) {\n                          return (\n                            <div className=\"mb-3\">\n                              <div className=\"flex items-center space-x-2 mb-2\">\n                                <span className=\"text-xs font-medium text-blue-600 uppercase tracking-wide\">Iniciales:</span>\n                              </div>\n                              <div className=\"flex flex-wrap gap-2\">\n                                {tagsIniciales.map(({ tag, categoryKey, color }) => (\n                                  <span\n                                    key={`inicial-${categoryKey}-${tag}`}\n                                    className=\"px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-sm\"\n                                  >\n                                    {tag}\n                                  </span>\n                                ))}\n                              </div>\n                            </div>\n                          )\n                        }\n                        return null\n                      })()}\n\n                     {/* Tags Finales */}\n                                           {getVideoConfig().showTags && (() => {\n                        const tagsFinales = getOrderedTagsFinales(video)\n                        if (tagsFinales.length > 0) {\n                          return (\n                            <div className=\"mb-3\">\n                              <div className=\"flex items-center space-x-2 mb-2\">\n                                <span className=\"text-xs font-medium text-green-600 uppercase tracking-wide\">Finales:</span>\n                              </div>\n                              <div className=\"flex flex-wrap gap-2\">\n                                {tagsFinales.map(({ tag, categoryKey, color }) => (\n                                  <span\n                                    key={`final-${categoryKey}-${tag}`}\n                                    className=\"px-2 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-sm\"\n                                  >\n                                    {tag}\n                                  </span>\n                                ))}\n                              </div>\n                            </div>\n                          )\n                        }\n                        return null\n                      })()}\n                    \n                                                                                                         {getVideoConfig().compact ? (\n                        <CompactCardActions\n                          video={video}\n                          onLike={() => handleVideoLike(video)}\n                          onEdit={() => openEditModal(video)}\n                          onDelete={() => openDeleteModal(video)}\n                          onAddToSequence={() => handleAddVideoToSequence(video)}\n                          onDownload={() => downloadVideo(video)}\n                          onPlay={() => handlePlayVideo(video)}\n                          isVideoInSequence={isVideoInSequence(video)}\n                          isBuilderOpen={isBuilderOpen}\n                          isVideoCompatible={isVideoCompatible(video)}\n                          type=\"video\"\n                        />\n                      ) : (\n                        <div className=\"flex items-center justify-between text-sm text-gray-500\">\n                          <div className=\"flex items-center space-x-2\">\n                            <span className=\"font-medium\">\n                              {(video.fileSize / (1024 * 1024)).toFixed(2)} MB\n                            </span>\n                            <span className=\"text-gray-400\">•</span>\n                            <span className=\"text-gray-600\">\n                              {video.resolution && video.resolution !== 'Unknown' ? \n                                video.resolution : \n                                'HD'\n                              }\n                            </span>\n                            {video.bpm && (\n                              <>\n                                <span className=\"text-gray-400\">•</span>\n                                <span className=\"text-purple-600 font-medium flex items-center space-x-1\">\n                                  <Music className=\"h-3 w-3\" />\n                                  <span>{video.bpm} BPM</span>\n                                </span>\n                              </>\n                            )}\n                          </div>\n                          <div className=\"flex items-center space-x-4\">\n                            <button \n                              onClick={() => handlePlayVideo(video)}\n                              className=\"text-gray-400 hover:text-blue-500 transition-colors duration-200 p-1 rounded hover:bg-blue-50\"\n                              title=\"Reproducir video\"\n                            >\n                              <Play className=\"h-4 w-4\" />\n                            </button>\n                            <button \n                              onClick={() => handleVideoLike(video)}\n                              className={`flex items-center space-x-1 transition-colors duration-200 p-1 rounded hover:bg-red-50 ${\n                                video.userLiked ? 'text-red-500' : 'text-gray-400 hover:text-red-500'\n                              }`}\n                              title={video.userLiked ? 'Quitar like' : 'Dar like'}\n                            >\n                              <Heart className={`h-4 w-4 ${video.userLiked ? 'fill-current' : ''}`} />\n                              <span className=\"font-medium\">{video.likes || 0}</span>\n                            </button>\n                            <button \n                              onClick={() => openEditModal(video)}\n                              className=\"text-gray-400 hover:text-blue-500 transition-colors duration-200 p-1 rounded hover:bg-blue-50\"\n                              title=\"Editar video\"\n                            >\n                              <Edit className=\"h-4 w-4\" />\n                            </button>\n                            <button \n                              onClick={() => openDeleteModal(video)}\n                              className=\"text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 rounded hover:bg-red-50\"\n                              title=\"Eliminar video\"\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </button>\n                            <button \n                              onClick={() => handleAddVideoToSequence(video)}\n                              disabled={isVideoInSequence(video)}\n                              className={`transition-colors duration-200 p-1 rounded ${\n                                isVideoInSequence(video)\n                                  ? 'text-gray-300 cursor-not-allowed'\n                                  : isBuilderOpen && !isVideoCompatible(video)\n                                  ? 'text-red-400 hover:text-red-500 hover:bg-red-50'\n                                  : 'text-gray-400 hover:text-purple-500 hover:bg-purple-50'\n                              }`}\n                              title={\n                                isVideoInSequence(video) \n                                  ? 'Ya en secuencia' \n                                  : isBuilderOpen && !isVideoCompatible(video)\n                                  ? 'Añadir forzadamente (incompatible)'\n                                  : 'Añadir a secuencia'\n                              }\n                            >\n                              <Plus className=\"h-4 w-4\" />\n                            </button>\n                            <button \n                              onClick={() => {\n                                downloadVideo(video)\n                              }}\n                              className=\"text-gray-400 hover:text-green-500 transition-colors duration-200 p-1 rounded hover:bg-green-50\"\n                              title=\"Descargar video\"\n                            >\n                              <Download className=\"h-4 w-4\" />\n                            </button>\n                          </div>\n                        </div>\n                      )}\n                  </div>\n                </div>\n              ))}\n            </div>\n           )}\n         </div>\n        )}\n\n        {/* Secuencias Grid */}\n        {activeTab === 'secuencias' && (\n          <div className=\"mb-8\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <h2 className=\"text-2xl font-semibold text-gray-800\">\n                Secuencias de {selectedStyle.toLowerCase()} ({sequences.length})\n              </h2>\n              <div className=\"flex items-center space-x-4\">\n                {/* Selector de tamaño de cards */}\n                <CardSizeSelector type=\"sequence\" />\n                \n                <button\n                  onClick={toggleBuilder}\n                  className=\"flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-lg font-medium shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105\"\n                >\n                  <Shuffle className=\"h-4 w-4\" />\n                  <span>CREAR SECUENCIA</span>\n                </button>\n              </div>\n            </div>\n            \n            {sequencesLoading ? (\n              <div className=\"flex justify-center items-center py-12\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500\"></div>\n                <span className=\"ml-3 text-gray-600\">Cargando secuencias...</span>\n              </div>\n            ) : (\n              <SequenceGallery\n                sequences={sequences}\n                onDeleteSequence={handleDeleteSequence}\n                onPlaySequence={handlePlaySequence}\n                onEditSequence={handleEditSequence}\n                onDownloadSequence={handleDownloadSequence}\n              />\n            )}\n          </div>\n        )}\n\n\n      </div>\n\n                           {/* Video Upload Modal */}\n                <VideoUploadModal\n           isOpen={isUploadModalOpen}\n           onClose={() => setIsUploadModalOpen(false)}\n           onVideoUploaded={handleVideoUploaded}\n           page=\"figuras\"\n           style={selectedStyle}\n         />\n\n        {/* Video Edit Modal */}\n        <VideoEditModal\n          isOpen={editModal.isOpen}\n          onClose={closeEditModal}\n          video={editModal.video}\n          onVideoUpdated={handleVideoUpdated}\n          page=\"figuras\"\n          style={selectedStyle}\n        />\n\n\n\n       {/* Cleanup Confirmation Modal */}\n       <ConfirmModal\n         isOpen={cleanupModal.isOpen}\n         onClose={closeCleanupModal}\n         onConfirm={() => handleCleanupData(cleanupModal.type)}\n         title={\n           cleanupModal.type === 'update' ? 'Actualizar Rutas de Thumbnails' :\n           cleanupModal.type === 'cleanup' ? 'Limpiar Archivos Huérfanos' :\n           cleanupModal.type === 'cleanup-tags' ? 'Limpiar Tags Duplicados' :\n           'Eliminar Todos los Videos'\n         }\n         message={\n           cleanupModal.type === 'update' ? \n           '¿Actualizar las rutas de thumbnails de videos existentes? Esto corregirá problemas de eliminación.' :\n           cleanupModal.type === 'cleanup' ? \n           '¿Limpiar archivos huérfanos? Esto eliminará archivos que no tienen documento en Firestore.' :\n           cleanupModal.type === 'cleanup-tags' ? \n           '¿Limpiar tags duplicados? Esto eliminará etiquetas repetidas en todos los videos manteniendo solo una instancia de cada tag.' :\n           '¿Eliminar TODOS los videos de Firebase y Storage? Esta acción es IRREVERSIBLE y eliminará todos los datos.'\n         }\n         confirmText={\n           cleanupModal.type === 'update' ? 'Actualizar' :\n           cleanupModal.type === 'cleanup' ? 'Limpiar' :\n           cleanupModal.type === 'cleanup-tags' ? 'Limpiar Tags' :\n           'Eliminar Todo'\n         }\n         cancelText=\"Cancelar\"\n       />\n\n       {/* Confirm Edit Sequence Modal */}\n       <ConfirmModal\n         isOpen={editSequenceModal.isOpen}\n         onClose={handleCancelEditSequence}\n         onConfirm={handleConfirmEditSequence}\n         title=\"🎬 Cargar Secuencia\"\n         message={`¿Deseas cargar la secuencia \"${editSequenceModal.sequence?.name}\"?\n\nEsto reemplazará la secuencia actual en construcción y perderás todos los cambios no guardados.\n\n¿Estás seguro de que quieres continuar?`}\n         confirmText=\"Sí, Cargar\"\n         cancelText=\"Cancelar\"\n         type=\"warning\"\n       />\n\n       {/* Confirm Delete Modal */}\n       <ConfirmModal\n         isOpen={deleteModal.isOpen}\n         onClose={closeDeleteModal}\n         onConfirm={() => handleDeleteVideo(deleteModal.video)}\n         title=\"🗑️ Eliminar Video\"\n         message={`¿Estás seguro de que quieres eliminar el video \"${deleteModal.video?.title}\"?\n\nEsta acción eliminará permanentemente:\n• El archivo de video de Firebase Storage\n• El thumbnail del video\n• Los metadatos de Firestore\n\nEsta acción NO se puede deshacer.`}\n         confirmText=\"Sí, Eliminar\"\n         cancelText=\"Cancelar\"\n         type=\"danger\"\n       />\n\n       {/* Video Player Modal */}\n       {showVideoPlayer && selectedVideo && (\n         <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4\">\n           <div className=\"relative w-full max-w-3xl h-auto max-h-[85vh] bg-white rounded-lg overflow-hidden flex flex-col\">\n             {/* Header */}\n             <div className=\"flex items-center justify-between p-4 bg-gray-50 border-b flex-shrink-0\">\n               <h3 className=\"text-lg font-semibold text-gray-800\">\n                 🎬 {selectedVideo.title}\n               </h3>\n               <button\n                 onClick={handleCloseVideoPlayer}\n                 className=\"text-gray-500 hover:text-gray-700 transition-colors\"\n               >\n                 <X className=\"h-6 w-6\" />\n               </button>\n             </div>\n             \n             {/* Video Player */}\n             <div className=\"flex-1 min-h-0 p-4\">\n               <div className=\"w-full h-full max-h-[65vh] flex items-center justify-center\">\n                 <div className=\"w-full max-w-md\">\n                   <SequenceVideoPlayer\n                     videos={[selectedVideo]}\n                     className=\"w-full h-full\"\n                     showControls={true}\n                     autoplay={true}\n                     loop={false}\n                     muted={false}\n                   />\n                 </div>\n               </div>\n             </div>\n           </div>\n         </div>\n       )}\n\n       {/* Sequence Player Modal */}\n       {showSequencePlayer && selectedSequence && (\n         <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4\">\n           <div className=\"relative w-full max-w-3xl h-auto max-h-[85vh] bg-white rounded-lg overflow-hidden flex flex-col\">\n             {/* Header */}\n             <div className=\"flex items-center justify-between p-4 bg-gray-50 border-b flex-shrink-0\">\n               <h3 className=\"text-lg font-semibold text-gray-800\">\n                 🎬 Secuencia: {selectedSequence.name}\n               </h3>\n               <button\n                 onClick={handleCloseSequencePlayer}\n                 className=\"text-gray-500 hover:text-gray-700 transition-colors\"\n               >\n                 <X className=\"h-6 w-6\" />\n               </button>\n             </div>\n             \n             {/* Sequence Player */}\n             <div className=\"flex-1 min-h-0 p-4\">\n               <div className=\"w-full h-full max-h-[65vh] flex items-center justify-center\">\n                 <div className=\"w-full max-w-md\">\n                   <SequenceVideoPlayer\n                     videos={selectedSequence.videos}\n                     className=\"w-full h-full\"\n                     showControls={true}\n                     autoplay={true}\n                     loop={false}\n                     muted={false}\n                   />\n                 </div>\n               </div>\n               </div>\n           </div>\n         </div>\n       )}\n\n       {/* Download Sequence Modal */}\n       <DownloadModal\n         isOpen={downloadSequenceModal.isOpen}\n         onClose={handleCloseDownloadSequence}\n         video={downloadSequenceModal.sequence ? {\n           ...downloadSequenceModal.sequence,\n           title: downloadSequenceModal.sequence.name,\n           file: null // El archivo se generará dinámicamente\n         } : null}\n         onDownloadComplete={() => {\n           addToast('Secuencia descargada correctamente', 'success')\n           handleCloseDownloadSequence()\n         }}\n       />\n\n       {/* Toasts */}\n       {toasts.map(toast => (\n         <Toast\n           key={toast.id}\n           message={toast.message}\n           type={toast.type}\n           onClose={() => removeToast(toast.id)}\n         />\n       ))}\n     </div>\n   )\n }\n\nexport default FigurasPage "],"file":"assets/FigurasPage-DaVL5K_y.js"}