var __defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__typeError=e=>{throw TypeError(e)},__defNormalProp=(e,t,i)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,__objRest=(e,t)=>{var i={};for(var a in e)__hasOwnProp.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&__getOwnPropSymbols)for(var a of __getOwnPropSymbols(e))t.indexOf(a)<0&&__propIsEnum.call(e,a)&&(i[a]=e[a]);return i},__publicField=(e,t,i)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,i),__accessCheck=(e,t,i)=>t.has(e)||__typeError("Cannot "+i),__privateGet=(e,t,i)=>(__accessCheck(e,t,"read from private field"),i?i.call(e):t.get(e)),__privateAdd=(e,t,i)=>t.has(e)?__typeError("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),__privateSet=(e,t,i,a)=>(__accessCheck(e,t,"write to private field"),a?a.call(e,i):t.set(e,i),i),__async=(e,t,i)=>new Promise((a,r)=>{var s=e=>{try{o(i.next(e))}catch(t){r(t)}},l=e=>{try{o(i.throw(e))}catch(t){r(t)}},o=e=>e.done?a(e.value):Promise.resolve(e.value).then(s,l);o((i=i.apply(e,t)).next())});!function(){"use strict";var e,t,i,a,r,s,l,o,_;(_=o||(o={})).LOAD="LOAD",_.EXEC="EXEC",_.FFPROBE="FFPROBE",_.WRITE_FILE="WRITE_FILE",_.READ_FILE="READ_FILE",_.DELETE_FILE="DELETE_FILE",_.RENAME="RENAME",_.CREATE_DIR="CREATE_DIR",_.LIST_DIR="LIST_DIR",_.DELETE_DIR="DELETE_DIR",_.ERROR="ERROR",_.DOWNLOAD="DOWNLOAD",_.PROGRESS="PROGRESS",_.LOG="LOG",_.MOUNT="MOUNT",_.UNMOUNT="UNMOUNT";const p=(()=>{let e=0;return()=>e++})(),n=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),d=new Error("called FFmpeg.terminate()");class c{constructor(){__privateAdd(this,e,null),__privateAdd(this,t,{}),__privateAdd(this,i,{}),__privateAdd(this,a,[]),__privateAdd(this,r,[]),__publicField(this,"loaded",!1),__privateAdd(this,s,()=>{__privateGet(this,e)&&(__privateGet(this,e).onmessage=({data:{id:e,type:s,data:l}})=>{switch(s){case o.LOAD:this.loaded=!0,__privateGet(this,t)[e](l);break;case o.MOUNT:case o.UNMOUNT:case o.EXEC:case o.FFPROBE:case o.WRITE_FILE:case o.READ_FILE:case o.DELETE_FILE:case o.RENAME:case o.CREATE_DIR:case o.LIST_DIR:case o.DELETE_DIR:__privateGet(this,t)[e](l);break;case o.LOG:__privateGet(this,a).forEach(e=>e(l));break;case o.PROGRESS:__privateGet(this,r).forEach(e=>e(l));break;case o.ERROR:__privateGet(this,i)[e](l)}delete __privateGet(this,t)[e],delete __privateGet(this,i)[e]})}),__privateAdd(this,l,({type:a,data:r},s=[],l)=>__privateGet(this,e)?new Promise((o,_)=>{const n=p();__privateGet(this,e)&&__privateGet(this,e).postMessage({id:n,type:a,data:r},s),__privateGet(this,t)[n]=o,__privateGet(this,i)[n]=_,null==l||l.addEventListener("abort",()=>{_(new DOMException(`Message # ${n} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(n)),__publicField(this,"load",(t={},{signal:i}={})=>{var a=t,{classWorkerURL:r}=a,_=__objRest(a,["classWorkerURL"]);return __privateGet(this,e)||(__privateSet(this,e,r?new Worker(new URL(r,self.location.href),{type:"module"}):new Worker(new URL("/assets/worker-Caon4OSn.js",self.location.href),{type:"module"})),__privateGet(this,s).call(this)),__privateGet(this,l).call(this,{type:o.LOAD,data:_},void 0,i)}),__publicField(this,"exec",(e,t=-1,{signal:i}={})=>__privateGet(this,l).call(this,{type:o.EXEC,data:{args:e,timeout:t}},void 0,i)),__publicField(this,"ffprobe",(e,t=-1,{signal:i}={})=>__privateGet(this,l).call(this,{type:o.FFPROBE,data:{args:e,timeout:t}},void 0,i)),__publicField(this,"terminate",()=>{const a=Object.keys(__privateGet(this,i));for(const e of a)__privateGet(this,i)[e](d),delete __privateGet(this,i)[e],delete __privateGet(this,t)[e];__privateGet(this,e)&&(__privateGet(this,e).terminate(),__privateSet(this,e,null),this.loaded=!1)}),__publicField(this,"writeFile",(e,t,{signal:i}={})=>{const a=[];return t instanceof Uint8Array&&a.push(t.buffer),__privateGet(this,l).call(this,{type:o.WRITE_FILE,data:{path:e,data:t}},a,i)}),__publicField(this,"mount",(e,t,i)=>__privateGet(this,l).call(this,{type:o.MOUNT,data:{fsType:e,options:t,mountPoint:i}},[])),__publicField(this,"unmount",e=>__privateGet(this,l).call(this,{type:o.UNMOUNT,data:{mountPoint:e}},[])),__publicField(this,"readFile",(e,t="binary",{signal:i}={})=>__privateGet(this,l).call(this,{type:o.READ_FILE,data:{path:e,encoding:t}},void 0,i)),__publicField(this,"deleteFile",(e,{signal:t}={})=>__privateGet(this,l).call(this,{type:o.DELETE_FILE,data:{path:e}},void 0,t)),__publicField(this,"rename",(e,t,{signal:i}={})=>__privateGet(this,l).call(this,{type:o.RENAME,data:{oldPath:e,newPath:t}},void 0,i)),__publicField(this,"createDir",(e,{signal:t}={})=>__privateGet(this,l).call(this,{type:o.CREATE_DIR,data:{path:e}},void 0,t)),__publicField(this,"listDir",(e,{signal:t}={})=>__privateGet(this,l).call(this,{type:o.LIST_DIR,data:{path:e}},void 0,t)),__publicField(this,"deleteDir",(e,{signal:t}={})=>__privateGet(this,l).call(this,{type:o.DELETE_DIR,data:{path:e}},void 0,t))}on(e,t){"log"===e?__privateGet(this,a).push(t):"progress"===e&&__privateGet(this,r).push(t)}off(e,t){"log"===e?__privateSet(this,a,__privateGet(this,a).filter(e=>e!==t)):"progress"===e&&__privateSet(this,r,__privateGet(this,r).filter(e=>e!==t))}}var h,E;e=new WeakMap,t=new WeakMap,i=new WeakMap,a=new WeakMap,r=new WeakMap,s=new WeakMap,l=new WeakMap,(E=h||(h={})).MEMFS="MEMFS",E.NODEFS="NODEFS",E.NODERAWFS="NODERAWFS",E.IDBFS="IDBFS",E.WORKERFS="WORKERFS",E.PROXYFS="PROXYFS";const f=new Error("failed to get response body reader"),v=new Error("failed to complete download"),y=(e,t)=>__async(this,null,function*(){var i;const a=yield fetch(e);let r;try{const s=parseInt(a.headers.get("Content-Length")||"-1"),l=null==(i=a.body)?void 0:i.getReader();if(!l)throw f;const o=[];let _=0;for(;;){const{done:i,value:a}=yield l.read(),r=a?a.length:0;if(i){if(-1!=s&&s!==_)throw v;t&&t({url:e,total:s,received:_,delta:r,done:i});break}o.push(a),_+=r,t&&t({url:e,total:s,received:_,delta:r,done:i})}const p=new Uint8Array(_);let n=0;for(const e of o)p.set(e,n),n+=e.length;r=p.buffer}catch(s){r=yield a.arrayBuffer()}return r}),u=(e,t,i=!1,a)=>__async(this,null,function*(){const r=i?yield y(e,a):yield(yield fetch(e)).arrayBuffer(),s=new Blob([r],{type:t});return URL.createObjectURL(s)});let m=null;self.onmessage=e=>__async(this,null,function*(){const{command:t,videoBuffers:i}=e.data||{};try{if("init"===t)return m=new c,yield m.load({coreURL:yield u("/ffmpeg/ffmpeg-core.js","text/javascript"),wasmURL:yield u("/ffmpeg/ffmpeg-core.wasm","application/wasm")}),self.postMessage({type:"progress",message:"FFmpeg cargado correctamente"}),void self.postMessage({type:"ready"});if("combine"===t){if(!m)throw new Error("FFmpeg no inicializado");for(let a=0;a<i.length;a++){const e=i[a],t=`video_${a}.mp4`;yield m.writeFile(t,new Uint8Array(e)),self.postMessage({type:"progress",message:`Video ${a+1}/${i.length} preparado`,current:60+a/i.length*20})}const e=Array.from({length:i.length},(e,t)=>`file 'video_${t}.mp4'`).join("\n");yield m.writeFile("filelist.txt",e),self.postMessage({type:"progress",message:"Combinando videos...",current:85}),yield m.exec(["-f","concat","-safe","0","-i","filelist.txt","-c","copy","-movflags","+faststart","output.mp4"]);const t=yield m.readFile("output.mp4");for(let a=0;a<i.length;a++)yield m.deleteFile(`video_${a}.mp4`);return yield m.deleteFile("filelist.txt"),yield m.deleteFile("output.mp4"),void self.postMessage({type:"complete",data:t.buffer,message:"CombinaciÃ³n completada"})}}catch(a){self.postMessage({type:"error",error:a.message||String(a)})}})}();
