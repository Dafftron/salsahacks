{"version":3,"mappings":"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","names":["f","require$$0","k","l","m","n","p","q","c","a","g","b","d","e","h","reactJsxRuntime_production_min","jsxRuntimeModule","createRoot","client","ThemeContext","createContext","useTheme","context","useContext","ThemeProvider","children","theme","setTheme","useState","useEffect","savedTheme","value","newTheme","jsx","firebaseConfig","app","initializeApp","auth","getAuth","db","getFirestore","storage","getStorage","registerWithEmail","email","password","displayName","userCredential","createUserWithEmailAndPassword","updateProfile","error","loginWithEmail","signInWithEmailAndPassword","loginWithGoogle","provider","GoogleAuthProvider","signInWithPopup","logout","signOut","resetPassword","sendPasswordResetEmail","onAuthStateChange","callback","onAuthStateChanged","COLLECTIONS","createUserProfile","userId","userData","setDoc","doc","serverTimestamp","getUserProfile","docRef","docSnap","getDoc","updateUserProfile","updates","updateDoc","createInvitation","invitationData","invitationCode","generateInvitationCode","expiresAt","invitation","validateInvitation","invitationRef","invitationSnap","markInvitationAsUsed","chars","result","i","createVideoDocument","videoData","videoRef","collection","updateVideoDocument","videoId","toggleVideoLike","likedBy","currentLikes","userLikedIndex","newLikedBy","newLikes","id","favoriteResult","toggleUserFavorite","favoriteError","checkUserLikedVideo","userDocRef","userDocSnap","favorites","videoIndex","newFavorites","checkUserFavorite","deleteVideoDocument","deleteDoc","checkVideoDuplicate","originalTitle","query","where","isDuplicate","getDocs","getVideos","orderBy","querySnapshot","videos","subscribeToVideosByStyle","style","onSnapshot","snapshot","fallbackQuery","allVideos","filteredVideos","video","fallbackError","deleteAllVideos","batch","writeBatch","deletedCount","updateVideoThumbnailPaths","updatedCount","diagnoseVideos","videosByStyle","salsaVideos","fig003Video","videosWithoutResolution","cleanupDuplicateTags","hasChanges","updatedTags","updatedTagsIniciales","updatedTagsFinales","category","uniqueTags","ROLES","ROLE_LABELS","ROLE_COLORS","PERMISSIONS","hasPermission","userRole","permission","getRolePermissions","PAGE_ACCESS","hasPageAccess","pagePath","AuthContext","useAuth","AuthProvider","user","setUser","userProfile","setUserProfile","loading","setLoading","createDavidProfile","firebaseUser","profileData","updateDavidRole","profile","firebaseUpdateUserProfile","unsubscribe","updatedProfile","newProfile","login","loginWithGoogleAuth","role","username","expiresInDays","firebaseCreateInvitation","invitationUrl","firebaseValidateInvitation","createUserByInvitation","validation","profileResult","markResult","firebaseMarkInvitationAsUsed","firebaseLogout","resetUserPassword","updatedData","_a","prev","getUserUsername","getUserPhoto","forceUpdateDavidRole","existingProfile","SequenceBuilderContext","useSequenceBuilderContext","SequenceBuilderProvider","sequence","setSequence","sequenceName","setSequenceName","sequenceDescription","setSequenceDescription","isBuilderOpen","setIsBuilderOpen","showAllVideos","setShowAllVideos","editingSequenceId","setEditingSequenceId","extractAllTags","useCallback","tagsObj","allTags","categoryTags","checkCompatibility","video1","video2","tagsFinales1","tagsIniciales2","isCompatible","tagFinal","tagInicial","match","addVideoToSequence","removeVideoFromSequence","index","_","reorderSequence","fromIndex","toIndex","newSequence","movedVideo","generateRandomSequence","count","currentSequence","availableVideos","seqVideo","firstVideoIndex","firstVideo","videosNeeded","lastVideo","compatibleVideos","randomCompatibleIndex","selectedVideo","clearSequence","toggleBuilder","openBuilder","closeBuilder","loadSequence","sequenceData","toggleShowAllVideos","isVideoCompatible","getCompatibleVideos","getFilteredVideos","isVideoInSequence","CardSizeContext","useCardSize","CardSizeProvider","videoCardSize","setVideoCardSize","sequenceCardSize","setSequenceCardSize","videoSizeConfig","sequenceSizeConfig","Navigation","location","useLocation","changeTheme","isAuthenticated","navItems","toggleTheme","themes","nextIndex","jsxs","Link","Music","item","Search","Sun","Moon","Bell","Heart","User","Shield","HomePage","lazy","NotasPage","CategoriesPage","FigurasPage","EscuelaPage","EventosPage","AdminPage","AuthPage","ProfilePage","SettingsPage","InvitePage","LoadingSpinner","AppContent","isFigurasPage","Suspense","Routes","Route","App","Router","ReactDOM","React"],"ignoreList":[0,1,2],"sources":["../../node_modules/react/cjs/react-jsx-runtime.production.min.js","../../node_modules/react/jsx-runtime.js","../../node_modules/react-dom/client.js","../../src/contexts/ThemeContext.jsx","../../src/services/firebase/config.js","../../src/services/firebase/auth.js","../../src/services/firebase/firestore.js","../../src/constants/roles.js","../../src/contexts/AuthContext.jsx","../../src/contexts/SequenceBuilderContext.jsx","../../src/contexts/CardSizeContext.jsx","../../src/components/layout/Navigation.jsx","../../src/App.jsx","../../src/main.jsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","import { createContext, useContext, useState, useEffect } from 'react'\r\n\r\nconst ThemeContext = createContext()\r\n\r\nexport const useTheme = () => {\r\n  const context = useContext(ThemeContext)\r\n  if (!context) {\r\n    throw new Error('useTheme must be used within a ThemeProvider')\r\n  }\r\n  return context\r\n}\r\n\r\nexport const ThemeProvider = ({ children }) => {\r\n  const [theme, setTheme] = useState('salsa')\r\n\r\n  useEffect(() => {\r\n    const savedTheme = localStorage.getItem('theme') || 'salsa'\r\n    setTheme(savedTheme)\r\n    document.documentElement.setAttribute('data-theme', savedTheme)\r\n  }, [])\r\n\r\n  const changeTheme = (newTheme) => {\r\n    setTheme(newTheme)\r\n    localStorage.setItem('theme', newTheme)\r\n    document.documentElement.setAttribute('data-theme', newTheme)\r\n  }\r\n\r\n  const value = {\r\n    theme,\r\n    changeTheme,\r\n    isDark: theme === 'dark',\r\n    isLight: theme === 'light',\r\n    isSalsa: theme === 'salsa'\r\n  }\r\n\r\n  return (\r\n    <ThemeContext.Provider value={value}>\r\n      {children}\r\n    </ThemeContext.Provider>\r\n  )\r\n} ","// ConfiguraciÃ³n de Firebase\r\nimport { initializeApp } from 'firebase/app';\r\nimport { getAuth } from 'firebase/auth';\r\nimport { getFirestore } from 'firebase/firestore';\r\nimport { getStorage } from 'firebase/storage';\r\n\r\n// ConfiguraciÃ³n de Firebase - Credenciales reales\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyBxqEJAHyV4jyeE1-GW-dOeECyLXRAsjiM\",\r\n  authDomain: \"salsahacks-a9cac.firebaseapp.com\",\r\n  projectId: \"salsahacks-a9cac\",\r\n  storageBucket: \"salsahacks-a9cac.firebasestorage.app\",\r\n  messagingSenderId: \"934621871243\",\r\n  appId: \"1:934621871243:web:9107fa3b61d9b9928fa88e\"\r\n};\r\n\r\n// Inicializar Firebase\r\nconst app = initializeApp(firebaseConfig);\r\n\r\n// Inicializar servicios\r\nexport const auth = getAuth(app);\r\nexport const db = getFirestore(app);\r\nexport const storage = getStorage(app);\r\n\r\nexport default app; ","// Servicios de autenticaciÃ³n de Firebase\r\nimport { \r\n  createUserWithEmailAndPassword,\r\n  signInWithEmailAndPassword,\r\n  signOut,\r\n  onAuthStateChanged,\r\n  updateProfile,\r\n  sendPasswordResetEmail,\r\n  GoogleAuthProvider,\r\n  signInWithPopup\r\n} from 'firebase/auth';\r\nimport { auth } from './config';\r\n\r\n// Registro con email y contraseÃ±a\r\nexport const registerWithEmail = async (email, password, displayName) => {\r\n  try {\r\n    const userCredential = await createUserWithEmailAndPassword(auth, email, password);\r\n    \r\n    // Actualizar perfil con nombre\r\n    if (displayName) {\r\n      await updateProfile(userCredential.user, { displayName });\r\n    }\r\n    \r\n    return { user: userCredential.user, error: null };\r\n  } catch (error) {\r\n    return { user: null, error: error.message };\r\n  }\r\n};\r\n\r\n// Login con email y contraseÃ±a\r\nexport const loginWithEmail = async (email, password) => {\r\n  try {\r\n    const userCredential = await signInWithEmailAndPassword(auth, email, password);\r\n    return { user: userCredential.user, error: null };\r\n  } catch (error) {\r\n    return { user: null, error: error.message };\r\n  }\r\n};\r\n\r\n// Login con Google\r\nexport const loginWithGoogle = async () => {\r\n  try {\r\n    const provider = new GoogleAuthProvider();\r\n    const userCredential = await signInWithPopup(auth, provider);\r\n    return { user: userCredential.user, error: null };\r\n  } catch (error) {\r\n    return { user: null, error: error.message };\r\n  }\r\n};\r\n\r\n// Cerrar sesiÃ³n\r\nexport const logout = async () => {\r\n  try {\r\n    await signOut(auth);\r\n    return { error: null };\r\n  } catch (error) {\r\n    return { error: error.message };\r\n  }\r\n};\r\n\r\n// Resetear contraseÃ±a\r\nexport const resetPassword = async (email) => {\r\n  try {\r\n    await sendPasswordResetEmail(auth, email);\r\n    return { error: null };\r\n  } catch (error) {\r\n    return { error: error.message };\r\n  }\r\n};\r\n\r\n// Observador de estado de autenticaciÃ³n\r\nexport const onAuthStateChange = (callback) => {\r\n  return onAuthStateChanged(auth, callback);\r\n};\r\n\r\n// Obtener usuario actual\r\nexport const getCurrentUser = () => {\r\n  return auth.currentUser;\r\n}; ","// Servicios de Firestore\r\nimport { \r\n  collection,\r\n  doc,\r\n  getDoc,\r\n  getDocs,\r\n  addDoc,\r\n  updateDoc,\r\n  deleteDoc,\r\n  query,\r\n  where,\r\n  orderBy,\r\n  limit,\r\n  onSnapshot,\r\n  serverTimestamp,\r\n  setDoc,\r\n  writeBatch\r\n} from 'firebase/firestore';\r\nimport { db } from './config';\r\n\r\n// Colecciones principales\r\nconst COLLECTIONS = {\r\n  USERS: 'users',\r\n  NOTES: 'notes',\r\n  CATEGORIES: 'categories',\r\n  EVENTS: 'events',\r\n  FIGURES: 'figures',\r\n  SCHOOL: 'school',\r\n  INVITATIONS: 'invitations',\r\n  VIDEOS: 'videos'\r\n};\r\n\r\n// ===== USUARIOS =====\r\nexport const createUserProfile = async (userId, userData) => {\r\n  try {\r\n    console.log('ðŸ“ Creando perfil de usuario en Firestore:', userId)\r\n    \r\n    // Usar setDoc con el UID como ID del documento para evitar duplicados\r\n    await setDoc(doc(db, COLLECTIONS.USERS, userId), {\r\n      uid: userId,\r\n      ...userData,\r\n      createdAt: serverTimestamp(),\r\n      updatedAt: serverTimestamp()\r\n    });\r\n    \r\n    console.log('âœ… Perfil de usuario creado exitosamente en Firestore')\r\n    return { success: true, error: null };\r\n  } catch (error) {\r\n    console.error('âŒ Error al crear perfil de usuario:', error)\r\n    return { success: false, error: error.message };\r\n  }\r\n};\r\n\r\nexport const getUserProfile = async (userId) => {\r\n  try {\r\n    console.log('ðŸ” Buscando perfil de usuario:', userId)\r\n    \r\n    // Usar getDoc directamente con el UID como ID del documento\r\n    const docRef = doc(db, COLLECTIONS.USERS, userId);\r\n    const docSnap = await getDoc(docRef);\r\n    \r\n    if (docSnap.exists()) {\r\n      const userData = { id: docSnap.id, ...docSnap.data() };\r\n      console.log('âœ… Perfil de usuario encontrado:', userData)\r\n      return { user: userData, error: null };\r\n    }\r\n    \r\n    console.log('âŒ Usuario no encontrado en Firestore')\r\n    return { user: null, error: 'Usuario no encontrado' };\r\n  } catch (error) {\r\n    console.error('âŒ Error al obtener perfil de usuario:', error)\r\n    return { user: null, error: error.message };\r\n  }\r\n};\r\n\r\nexport const updateUserProfile = async (userId, updates) => {\r\n  try {\r\n    console.log('ðŸ“ Actualizando perfil de usuario:', userId, updates)\r\n    \r\n    // Usar updateDoc directamente con el UID como ID del documento\r\n    const docRef = doc(db, COLLECTIONS.USERS, userId);\r\n    await updateDoc(docRef, {\r\n      ...updates,\r\n      updatedAt: serverTimestamp()\r\n    });\r\n    \r\n    console.log('âœ… Perfil de usuario actualizado exitosamente')\r\n    return { success: true, error: null };\r\n  } catch (error) {\r\n    console.error('âŒ Error al actualizar perfil de usuario:', error)\r\n    return { success: false, error: error.message };\r\n  }\r\n};\r\n\r\n// ===== NOTAS =====\r\nexport const createNote = async (noteData) => {\r\n  try {\r\n    const docRef = await addDoc(collection(db, COLLECTIONS.NOTES), {\r\n      ...noteData,\r\n      createdAt: serverTimestamp(),\r\n      updatedAt: serverTimestamp()\r\n    });\r\n    return { id: docRef.id, error: null };\r\n  } catch (error) {\r\n    return { id: null, error: error.message };\r\n  }\r\n};\r\n\r\nexport const getNotes = async (userId) => {\r\n  try {\r\n    const q = query(\r\n      collection(db, COLLECTIONS.NOTES),\r\n      where('userId', '==', userId),\r\n      orderBy('createdAt', 'desc')\r\n    );\r\n    const querySnapshot = await getDocs(q);\r\n    \r\n    const notes = querySnapshot.docs.map(doc => ({\r\n      id: doc.id,\r\n      ...doc.data()\r\n    }));\r\n    \r\n    return { notes, error: null };\r\n  } catch (error) {\r\n    return { notes: [], error: error.message };\r\n  }\r\n};\r\n\r\nexport const updateNote = async (noteId, updates) => {\r\n  try {\r\n    const noteRef = doc(db, COLLECTIONS.NOTES, noteId);\r\n    await updateDoc(noteRef, {\r\n      ...updates,\r\n      updatedAt: serverTimestamp()\r\n    });\r\n    return { success: true, error: null };\r\n  } catch (error) {\r\n    return { success: false, error: error.message };\r\n  }\r\n};\r\n\r\nexport const deleteNote = async (noteId) => {\r\n  try {\r\n    await deleteDoc(doc(db, COLLECTIONS.NOTES, noteId));\r\n    return { success: true, error: null };\r\n  } catch (error) {\r\n    return { success: false, error: error.message };\r\n  }\r\n};\r\n\r\n// ===== CATEGORÃAS =====\r\nexport const getCategories = async () => {\r\n  try {\r\n    const querySnapshot = await getDocs(collection(db, COLLECTIONS.CATEGORIES));\r\n    const categories = querySnapshot.docs.map(doc => ({\r\n      id: doc.id,\r\n      ...doc.data()\r\n    }));\r\n    return { categories, error: null };\r\n  } catch (error) {\r\n    return { categories: [], error: error.message };\r\n  }\r\n};\r\n\r\n// ===== EVENTOS =====\r\nexport const createEvent = async (eventData) => {\r\n  try {\r\n    const docRef = await addDoc(collection(db, COLLECTIONS.EVENTS), {\r\n      ...eventData,\r\n      createdAt: serverTimestamp(),\r\n      updatedAt: serverTimestamp()\r\n    });\r\n    return { id: docRef.id, error: null };\r\n  } catch (error) {\r\n    return { id: null, error: error.message };\r\n  }\r\n};\r\n\r\nexport const getEvents = async () => {\r\n  try {\r\n    const q = query(\r\n      collection(db, COLLECTIONS.EVENTS),\r\n      orderBy('date', 'asc')\r\n    );\r\n    const querySnapshot = await getDocs(q);\r\n    \r\n    const events = querySnapshot.docs.map(doc => ({\r\n      id: doc.id,\r\n      ...doc.data()\r\n    }));\r\n    \r\n    return { events, error: null };\r\n  } catch (error) {\r\n    return { events: [], error: error.message };\r\n  }\r\n};\r\n\r\n// ===== FIGURAS =====\r\nexport const createFigure = async (figureData) => {\r\n  try {\r\n    const docRef = await addDoc(collection(db, COLLECTIONS.FIGURES), {\r\n      ...figureData,\r\n      createdAt: serverTimestamp(),\r\n      updatedAt: serverTimestamp()\r\n    });\r\n    return { id: docRef.id, error: null };\r\n  } catch (error) {\r\n    return { id: null, error: error.message };\r\n  }\r\n};\r\n\r\nexport const getFigures = async () => {\r\n  try {\r\n    const querySnapshot = await getDocs(collection(db, COLLECTIONS.FIGURES));\r\n    const figures = querySnapshot.docs.map(doc => ({\r\n      id: doc.id,\r\n      ...doc.data()\r\n    }));\r\n    return { figures, error: null };\r\n  } catch (error) {\r\n    return { figures: [], error: error.message };\r\n  }\r\n};\r\n\r\n// ===== ESCUELA =====\r\nexport const createSchoolContent = async (contentData) => {\r\n  try {\r\n    const docRef = await addDoc(collection(db, COLLECTIONS.SCHOOL), {\r\n      ...contentData,\r\n      createdAt: serverTimestamp(),\r\n      updatedAt: serverTimestamp()\r\n    });\r\n    return { id: docRef.id, error: null };\r\n  } catch (error) {\r\n    return { id: null, error: error.message };\r\n  }\r\n};\r\n\r\nexport const getSchoolContent = async () => {\r\n  try {\r\n    const q = query(\r\n      collection(db, COLLECTIONS.SCHOOL),\r\n      orderBy('createdAt', 'desc')\r\n    );\r\n    const querySnapshot = await getDocs(q);\r\n    \r\n    const content = querySnapshot.docs.map(doc => ({\r\n      id: doc.id,\r\n      ...doc.data()\r\n    }));\r\n    \r\n    return { content, error: null };\r\n  } catch (error) {\r\n    return { content: [], error: error.message };\r\n  }\r\n};\r\n\r\n// ===== LISTENERS EN TIEMPO REAL =====\r\nexport const subscribeToNotes = (userId, callback) => {\r\n  const q = query(\r\n    collection(db, COLLECTIONS.NOTES),\r\n    where('userId', '==', userId),\r\n    orderBy('createdAt', 'desc')\r\n  );\r\n  \r\n  return onSnapshot(q, (snapshot) => {\r\n    const notes = snapshot.docs.map(doc => ({\r\n      id: doc.id,\r\n      ...doc.data()\r\n    }));\r\n    callback(notes);\r\n  });\r\n};\r\n\r\nexport const subscribeToEvents = (callback) => {\r\n  const q = query(\r\n    collection(db, COLLECTIONS.EVENTS),\r\n    orderBy('date', 'asc')\r\n  );\r\n  \r\n  return onSnapshot(q, (snapshot) => {\r\n    const events = snapshot.docs.map(doc => ({\r\n      id: doc.id,\r\n      ...doc.data()\r\n    }));\r\n    callback(events);\r\n  });\r\n}; \r\n\r\n// FunciÃ³n para crear una invitaciÃ³n\r\nexport const createInvitation = async (invitationData) => {\r\n  try {\r\n    // Generar cÃ³digo Ãºnico de invitaciÃ³n\r\n    const invitationCode = generateInvitationCode()\r\n    \r\n    // Calcular fecha de expiraciÃ³n\r\n    const expiresAt = new Date()\r\n    expiresAt.setDate(expiresAt.getDate() + invitationData.expiresInDays)\r\n    \r\n    const invitation = {\r\n      code: invitationCode,\r\n      email: invitationData.email,\r\n      displayName: invitationData.displayName,\r\n      username: invitationData.username,\r\n      role: invitationData.role,\r\n      createdBy: invitationData.createdBy,\r\n      createdAt: serverTimestamp(),\r\n      expiresAt: expiresAt,\r\n      status: 'pending', // pending, used, expired\r\n      usedAt: null,\r\n      usedBy: null\r\n    }\r\n    \r\n    // Guardar en Firestore\r\n    await setDoc(doc(db, 'invitations', invitationCode), invitation)\r\n    \r\n    return { \r\n      success: true, \r\n      invitationCode: invitationCode,\r\n      invitation: invitation \r\n    }\r\n  } catch (error) {\r\n    console.error('Error creating invitation:', error)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n\r\n// FunciÃ³n para validar una invitaciÃ³n\r\nexport const validateInvitation = async (invitationCode) => {\r\n  try {\r\n    const invitationRef = doc(db, 'invitations', invitationCode)\r\n    const invitationSnap = await getDoc(invitationRef)\r\n    \r\n    if (!invitationSnap.exists()) {\r\n      return { success: false, error: 'InvitaciÃ³n no encontrada' }\r\n    }\r\n    \r\n    const invitation = invitationSnap.data()\r\n    \r\n    // Verificar si ya fue usada\r\n    if (invitation.status === 'used') {\r\n      return { success: false, error: 'Esta invitaciÃ³n ya ha sido utilizada' }\r\n    }\r\n    \r\n    // Verificar si ha expirado\r\n    if (invitation.expiresAt && invitation.expiresAt.toDate() < new Date()) {\r\n      return { success: false, error: 'Esta invitaciÃ³n ha expirado' }\r\n    }\r\n    \r\n    return { \r\n      success: true, \r\n      invitation: invitation \r\n    }\r\n  } catch (error) {\r\n    console.error('Error validating invitation:', error)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n\r\n// FunciÃ³n para marcar invitaciÃ³n como usada\r\nexport const markInvitationAsUsed = async (invitationCode, userId) => {\r\n  try {\r\n    const invitationRef = doc(db, 'invitations', invitationCode)\r\n    await updateDoc(invitationRef, {\r\n      status: 'used',\r\n      usedAt: serverTimestamp(),\r\n      usedBy: userId\r\n    })\r\n    \r\n    return { success: true }\r\n  } catch (error) {\r\n    console.error('Error marking invitation as used:', error)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n\r\n// FunciÃ³n para obtener invitaciones de un usuario\r\nexport const getUserInvitations = async (userId) => {\r\n  try {\r\n    const invitationsRef = collection(db, 'invitations')\r\n    const q = query(\r\n      invitationsRef,\r\n      where('createdBy', '==', userId),\r\n      orderBy('createdAt', 'desc')\r\n    )\r\n    \r\n    const querySnapshot = await getDocs(q)\r\n    const invitations = []\r\n    \r\n    querySnapshot.forEach((doc) => {\r\n      invitations.push({\r\n        id: doc.id,\r\n        ...doc.data()\r\n      })\r\n    })\r\n    \r\n    return { success: true, invitations }\r\n  } catch (error) {\r\n    console.error('Error getting user invitations:', error)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n\r\n// FunciÃ³n para eliminar una invitaciÃ³n\r\nexport const deleteInvitation = async (invitationCode) => {\r\n  try {\r\n    await deleteDoc(doc(db, 'invitations', invitationCode))\r\n    return { success: true }\r\n  } catch (error) {\r\n    console.error('Error deleting invitation:', error)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n\r\n// FunciÃ³n auxiliar para generar cÃ³digo de invitaciÃ³n Ãºnico\r\nconst generateInvitationCode = () => {\r\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'\r\n  let result = ''\r\n  for (let i = 0; i < 8; i++) {\r\n    result += chars.charAt(Math.floor(Math.random() * chars.length))\r\n  }\r\n  return result\r\n}\r\n\r\n// ===== VIDEO MANAGEMENT FUNCTIONS =====\r\n\r\nexport const createVideoDocument = async (videoData) => {\r\n  try {\r\n    console.log('ðŸ“¹ Creando documento de video en Firestore:', videoData.title)\r\n    const videoRef = doc(collection(db, COLLECTIONS.VIDEOS))\r\n    await setDoc(videoRef, {\r\n      ...videoData,\r\n      id: videoRef.id,\r\n      bpm: videoData.bpm || null, // Agregar campo BPM\r\n      bpmDetected: videoData.bpmDetected || false, // Indicar si se detectÃ³ BPM\r\n      createdAt: serverTimestamp(),\r\n      updatedAt: serverTimestamp()\r\n    })\r\n    console.log('âœ… Documento de video creado exitosamente:', videoRef.id)\r\n    return { success: true, id: videoRef.id, error: null }\r\n  } catch (error) {\r\n    console.error('âŒ Error al crear documento de video:', error)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n\r\nexport const getVideoDocument = async (videoId) => {\r\n  try {\r\n    console.log('ðŸ” Buscando video:', videoId)\r\n    const docRef = doc(db, COLLECTIONS.VIDEOS, videoId)\r\n    const docSnap = await getDoc(docRef)\r\n    if (docSnap.exists()) {\r\n      const videoData = { id: docSnap.id, ...docSnap.data() }\r\n      console.log('âœ… Video encontrado:', videoData.title)\r\n      return { video: videoData, error: null }\r\n    }\r\n    console.log('âŒ Video no encontrado en Firestore')\r\n    return { video: null, error: 'Video no encontrado' }\r\n  } catch (error) {\r\n    console.error('âŒ Error al obtener video:', error)\r\n    return { video: null, error: error.message }\r\n  }\r\n}\r\n\r\nexport const updateVideoDocument = async (videoId, updates) => {\r\n  try {\r\n    console.log('ðŸ“ Actualizando video:', videoId, updates)\r\n    const docRef = doc(db, COLLECTIONS.VIDEOS, videoId)\r\n    await updateDoc(docRef, {\r\n      ...updates,\r\n      updatedAt: serverTimestamp()\r\n    })\r\n    console.log('âœ… Video actualizado exitosamente')\r\n    return { success: true, error: null }\r\n  } catch (error) {\r\n    console.error('âŒ Error al actualizar video:', error)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n\r\n// ===== FUNCIONES PARA BPM =====\r\nexport const updateVideoBPM = async (videoId, bpm) => {\r\n  try {\r\n    console.log('ðŸŽµ Actualizando BPM del video:', videoId, 'BPM:', bpm)\r\n    const docRef = doc(db, COLLECTIONS.VIDEOS, videoId)\r\n    await updateDoc(docRef, {\r\n      bpm: bpm,\r\n      bpmDetected: true,\r\n      updatedAt: serverTimestamp()\r\n    })\r\n    console.log('âœ… BPM actualizado exitosamente')\r\n    return { success: true, error: null }\r\n  } catch (error) {\r\n    console.error('âŒ Error al actualizar BPM:', error)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n\r\nexport const getVideosWithoutBPM = async () => {\r\n  try {\r\n    console.log('ðŸ” Buscando videos sin BPM detectado...')\r\n    const q = query(\r\n      collection(db, COLLECTIONS.VIDEOS),\r\n      where('bpmDetected', '==', false),\r\n      orderBy('createdAt', 'desc')\r\n    )\r\n    const querySnapshot = await getDocs(q)\r\n    const videos = []\r\n    querySnapshot.forEach((doc) => {\r\n      videos.push({ id: doc.id, ...doc.data() })\r\n    })\r\n    console.log(`âœ… ${videos.length} videos sin BPM encontrados`)\r\n    return { videos, error: null }\r\n  } catch (error) {\r\n    console.error('âŒ Error al obtener videos sin BPM:', error)\r\n    return { videos: [], error: error.message }\r\n  }\r\n}\r\n\r\n// ===== SISTEMA DE LIKES =====\r\nexport const toggleVideoLike = async (videoId, userId) => {\r\n  try {\r\n    console.log('â¤ï¸ Toggle like para video:', videoId, 'usuario:', userId)\r\n    \r\n    const docRef = doc(db, COLLECTIONS.VIDEOS, videoId)\r\n    const docSnap = await getDoc(docRef)\r\n    \r\n    if (!docSnap.exists()) {\r\n      throw new Error('Video no encontrado')\r\n    }\r\n    \r\n    const videoData = docSnap.data()\r\n    const likedBy = videoData.likedBy || []\r\n    const currentLikes = videoData.likes || 0\r\n    \r\n    // Verificar si el usuario ya dio like\r\n    const userLikedIndex = likedBy.indexOf(userId)\r\n    let newLikedBy, newLikes\r\n    \r\n    if (userLikedIndex === -1) {\r\n      // Usuario no ha dado like, agregarlo\r\n      newLikedBy = [...likedBy, userId]\r\n      newLikes = currentLikes + 1\r\n      console.log('âœ… Like agregado por usuario:', userId)\r\n    } else {\r\n      // Usuario ya dio like, removerlo\r\n      newLikedBy = likedBy.filter(id => id !== userId)\r\n      newLikes = currentLikes - 1\r\n      console.log('âœ… Like removido por usuario:', userId)\r\n    }\r\n    \r\n    // Actualizar el documento del video\r\n    await updateDoc(docRef, {\r\n      likes: newLikes,\r\n      likedBy: newLikedBy,\r\n      updatedAt: serverTimestamp()\r\n    })\r\n    \r\n    // TambiÃ©n manejar favoritos automÃ¡ticamente\r\n    let favoriteResult = null\r\n    try {\r\n      if (userLikedIndex === -1) {\r\n        // Si estÃ¡ dando like, agregar a favoritos\r\n        favoriteResult = await toggleUserFavorite(videoId, userId)\r\n        console.log('â­ Video agregado automÃ¡ticamente a favoritos')\r\n      } else {\r\n        // Si estÃ¡ quitando like, tambiÃ©n quitar de favoritos\r\n        favoriteResult = await toggleUserFavorite(videoId, userId)\r\n        console.log('â­ Video removido automÃ¡ticamente de favoritos')\r\n      }\r\n    } catch (favoriteError) {\r\n      console.error('âš ï¸ Error al manejar favoritos automÃ¡ticamente:', favoriteError)\r\n      // No fallar si hay error en favoritos, solo en likes\r\n    }\r\n    \r\n    console.log(`âœ… Video actualizado: ${newLikes} likes, ${newLikedBy.length} usuarios`)\r\n    return { \r\n      success: true, \r\n      likes: newLikes, \r\n      likedBy: newLikedBy, \r\n      userLiked: userLikedIndex === -1,\r\n      isFavorite: favoriteResult?.isFavorite || false,\r\n      error: null \r\n    }\r\n  } catch (error) {\r\n    console.error('âŒ Error al toggle like:', error)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n\r\nexport const checkUserLikedVideo = async (videoId, userId) => {\r\n  try {\r\n    const docRef = doc(db, COLLECTIONS.VIDEOS, videoId)\r\n    const docSnap = await getDoc(docRef)\r\n    \r\n    if (!docSnap.exists()) {\r\n      return { userLiked: false, error: 'Video no encontrado' }\r\n    }\r\n    \r\n    const videoData = docSnap.data()\r\n    const likedBy = videoData.likedBy || []\r\n    const userLiked = likedBy.includes(userId)\r\n    \r\n    return { userLiked, error: null }\r\n  } catch (error) {\r\n    console.error('âŒ Error al verificar like del usuario:', error)\r\n    return { userLiked: false, error: error.message }\r\n  }\r\n}\r\n\r\n// ===== SISTEMA DE FAVORITOS POR USUARIO =====\r\nexport const toggleUserFavorite = async (videoId, userId) => {\r\n  try {\r\n    console.log('â­ Toggle favorito para video:', videoId, 'usuario:', userId)\r\n    \r\n    // Obtener el perfil del usuario\r\n    const userDocRef = doc(db, COLLECTIONS.USERS, userId)\r\n    const userDocSnap = await getDoc(userDocRef)\r\n    \r\n    if (!userDocSnap.exists()) {\r\n      throw new Error('Usuario no encontrado')\r\n    }\r\n    \r\n    const userData = userDocSnap.data()\r\n    const favorites = userData.favorites || []\r\n    \r\n    // Verificar si el video ya estÃ¡ en favoritos\r\n    const videoIndex = favorites.indexOf(videoId)\r\n    let newFavorites\r\n    \r\n    if (videoIndex === -1) {\r\n      // Video no estÃ¡ en favoritos, agregarlo\r\n      newFavorites = [...favorites, videoId]\r\n      console.log('âœ… Video agregado a favoritos del usuario:', userId)\r\n    } else {\r\n      // Video ya estÃ¡ en favoritos, removerlo\r\n      newFavorites = favorites.filter(id => id !== videoId)\r\n      console.log('âœ… Video removido de favoritos del usuario:', userId)\r\n    }\r\n    \r\n    // Actualizar el perfil del usuario\r\n    await updateDoc(userDocRef, {\r\n      favorites: newFavorites,\r\n      updatedAt: serverTimestamp()\r\n    })\r\n    \r\n    console.log(`âœ… Perfil de usuario actualizado: ${newFavorites.length} favoritos`)\r\n    return { \r\n      success: true, \r\n      favorites: newFavorites, \r\n      isFavorite: videoIndex === -1,\r\n      error: null \r\n    }\r\n  } catch (error) {\r\n    console.error('âŒ Error al toggle favorito:', error)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n\r\nexport const checkUserFavorite = async (videoId, userId) => {\r\n  try {\r\n    const userDocRef = doc(db, COLLECTIONS.USERS, userId)\r\n    const userDocSnap = await getDoc(userDocRef)\r\n    \r\n    if (!userDocSnap.exists()) {\r\n      return { isFavorite: false, error: 'Usuario no encontrado' }\r\n    }\r\n    \r\n    const userData = userDocSnap.data()\r\n    const favorites = userData.favorites || []\r\n    const isFavorite = favorites.includes(videoId)\r\n    \r\n    return { isFavorite, error: null }\r\n  } catch (error) {\r\n    console.error('âŒ Error al verificar favorito del usuario:', error)\r\n    return { isFavorite: false, error: error.message }\r\n  }\r\n}\r\n\r\nexport const getUserFavorites = async (userId) => {\r\n  try {\r\n    console.log('ðŸ” Obteniendo favoritos del usuario:', userId)\r\n    \r\n    const userDocRef = doc(db, COLLECTIONS.USERS, userId)\r\n    const userDocSnap = await getDoc(userDocRef)\r\n    \r\n    if (!userDocSnap.exists()) {\r\n      return { favorites: [], error: 'Usuario no encontrado' }\r\n    }\r\n    \r\n    const userData = userDocSnap.data()\r\n    const favoriteIds = userData.favorites || []\r\n    \r\n    if (favoriteIds.length === 0) {\r\n      return { favorites: [], error: null }\r\n    }\r\n    \r\n    // Obtener los videos favoritos\r\n    const videos = []\r\n    for (const videoId of favoriteIds) {\r\n      try {\r\n        const videoDocRef = doc(db, COLLECTIONS.VIDEOS, videoId)\r\n        const videoDocSnap = await getDoc(videoDocRef)\r\n        \r\n        if (videoDocSnap.exists()) {\r\n          videos.push({ id: videoDocSnap.id, ...videoDocSnap.data() })\r\n        }\r\n      } catch (error) {\r\n        console.error(`Error al obtener video ${videoId}:`, error)\r\n      }\r\n    }\r\n    \r\n    console.log(`âœ… ${videos.length} favoritos encontrados para usuario: ${userId}`)\r\n    return { favorites: videos, error: null }\r\n  } catch (error) {\r\n    console.error('âŒ Error al obtener favoritos del usuario:', error)\r\n    return { favorites: [], error: error.message }\r\n  }\r\n}\r\n\r\nexport const deleteVideoDocument = async (videoId) => {\r\n  try {\r\n    console.log('ðŸ—‘ï¸ Eliminando video de Firestore:', videoId)\r\n    console.log('ðŸ“ ColecciÃ³n:', COLLECTIONS.VIDEOS)\r\n    \r\n    const docRef = doc(db, COLLECTIONS.VIDEOS, videoId)\r\n    console.log('ðŸ“„ Referencia del documento:', docRef.path)\r\n    \r\n    await deleteDoc(docRef)\r\n    console.log('âœ… Video eliminado exitosamente de Firestore')\r\n    return { success: true, error: null }\r\n  } catch (error) {\r\n    console.error('âŒ Error al eliminar video de Firestore:', error)\r\n    console.error('âŒ CÃ³digo de error:', error.code)\r\n    console.error('âŒ Mensaje de error:', error.message)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n\r\nexport const getVideosByCategory = async (category) => {\r\n  try {\r\n    console.log('ðŸ” Buscando videos por categorÃ­a:', category)\r\n    const q = query(\r\n      collection(db, COLLECTIONS.VIDEOS),\r\n      where('category', '==', category),\r\n      orderBy('createdAt', 'desc')\r\n    )\r\n    const querySnapshot = await getDocs(q)\r\n    const videos = []\r\n    querySnapshot.forEach((doc) => {\r\n      videos.push({ id: doc.id, ...doc.data() })\r\n    })\r\n    console.log(`âœ… ${videos.length} videos encontrados para categorÃ­a: ${category}`)\r\n    return { videos, error: null }\r\n  } catch (error) {\r\n    console.error('âŒ Error al obtener videos por categorÃ­a:', error)\r\n    return { videos: [], error: error.message }\r\n  }\r\n}\r\n\r\nexport const getVideosByUser = async (userId) => {\r\n  try {\r\n    console.log('ðŸ” Buscando videos del usuario:', userId)\r\n    const q = query(\r\n      collection(db, COLLECTIONS.VIDEOS),\r\n      where('uploadedBy', '==', userId),\r\n      orderBy('createdAt', 'desc')\r\n    )\r\n    const querySnapshot = await getDocs(q)\r\n    const videos = []\r\n    querySnapshot.forEach((doc) => {\r\n      videos.push({ id: doc.id, ...doc.data() })\r\n    })\r\n    console.log(`âœ… ${videos.length} videos encontrados del usuario: ${userId}`)\r\n    return { videos, error: null }\r\n  } catch (error) {\r\n    console.error('âŒ Error al obtener videos del usuario:', error)\r\n    return { videos: [], error: error.message }\r\n  }\r\n}\r\n\r\nexport const checkVideoDuplicate = async (originalTitle) => {\r\n  try {\r\n    console.log('ðŸ” Verificando duplicado:', originalTitle)\r\n    const q = query(\r\n      collection(db, COLLECTIONS.VIDEOS),\r\n      where('originalTitle', '==', originalTitle)\r\n    )\r\n    const querySnapshot = await getDocs(q)\r\n    const isDuplicate = !querySnapshot.empty\r\n    console.log(`âœ… VerificaciÃ³n de duplicado: ${isDuplicate ? 'SÃ' : 'NO'}`)\r\n    return { isDuplicate, error: null }\r\n  } catch (error) {\r\n    console.error('âŒ Error al verificar duplicado:', error)\r\n    return { isDuplicate: false, error: error.message }\r\n  }\r\n}\r\n\r\nexport const getVideos = async () => {\r\n  try {\r\n    console.log('ðŸ” Obteniendo todos los videos...')\r\n    const q = query(\r\n      collection(db, COLLECTIONS.VIDEOS),\r\n      orderBy('uploadedAt', 'desc')\r\n    )\r\n    const querySnapshot = await getDocs(q)\r\n    const videos = []\r\n    querySnapshot.forEach((doc) => {\r\n      videos.push({ id: doc.id, ...doc.data() })\r\n    })\r\n    console.log(`âœ… ${videos.length} videos obtenidos`)\r\n    return videos\r\n  } catch (error) {\r\n    console.error('âŒ Error al obtener videos:', error)\r\n    return []\r\n  }\r\n}\r\n\r\n// ===== SINCRONIZACIÃ“N EN TIEMPO REAL =====\r\n\r\nexport const subscribeToVideos = (callback) => {\r\n  try {\r\n    console.log('ðŸ”„ Iniciando suscripciÃ³n en tiempo real a videos...')\r\n    const q = query(\r\n      collection(db, COLLECTIONS.VIDEOS),\r\n      orderBy('uploadedAt', 'desc')\r\n    )\r\n    \r\n    const unsubscribe = onSnapshot(q, (snapshot) => {\r\n      const videos = []\r\n      snapshot.forEach((doc) => {\r\n        videos.push({ id: doc.id, ...doc.data() })\r\n      })\r\n      console.log(`ðŸ”„ ActualizaciÃ³n en tiempo real: ${videos.length} videos`)\r\n      callback(videos)\r\n    }, (error) => {\r\n      console.error('âŒ Error en suscripciÃ³n de videos:', error)\r\n    })\r\n    \r\n    return unsubscribe\r\n  } catch (error) {\r\n    console.error('âŒ Error al iniciar suscripciÃ³n de videos:', error)\r\n    return () => {}\r\n  }\r\n}\r\n\r\nexport const subscribeToVideosByStyle = (style, callback) => {\r\n  try {\r\n    console.log(`ðŸ”„ Iniciando suscripciÃ³n en tiempo real a videos de estilo: ${style}`)\r\n    \r\n    // Primero intentar con la consulta optimizada (requiere Ã­ndice)\r\n    const q = query(\r\n      collection(db, COLLECTIONS.VIDEOS),\r\n      where('style', '==', style),\r\n      orderBy('uploadedAt', 'desc')\r\n    )\r\n    \r\n    const unsubscribe = onSnapshot(q, (snapshot) => {\r\n      const videos = []\r\n      snapshot.forEach((doc) => {\r\n        videos.push({ id: doc.id, ...doc.data() })\r\n      })\r\n      console.log(`ðŸ”„ ActualizaciÃ³n en tiempo real para ${style}: ${videos.length} videos`)\r\n      callback(videos)\r\n    }, (error) => {\r\n      console.error(`âŒ Error en suscripciÃ³n de videos de ${style}:`, error)\r\n      \r\n      // Si falla por falta de Ã­ndice, usar consulta simple y filtrar en cliente\r\n      if (error.code === 'failed-precondition' || error.message.includes('index')) {\r\n        console.log(`âš ï¸ Usando fallback para ${style} (sin Ã­ndice)`)\r\n        \r\n        const fallbackQuery = query(\r\n          collection(db, COLLECTIONS.VIDEOS),\r\n          orderBy('uploadedAt', 'desc')\r\n        )\r\n        \r\n        const fallbackUnsubscribe = onSnapshot(fallbackQuery, (snapshot) => {\r\n          const allVideos = []\r\n          snapshot.forEach((doc) => {\r\n            allVideos.push({ id: doc.id, ...doc.data() })\r\n          })\r\n          \r\n          // Filtrar por estilo en el cliente (solo por el campo style)\r\n          const filteredVideos = allVideos.filter(video => \r\n            video.style === style\r\n          )\r\n          \r\n          console.log(`ðŸ”„ Fallback: ${filteredVideos.length} videos de ${style} de ${allVideos.length} total`)\r\n          callback(filteredVideos)\r\n        }, (fallbackError) => {\r\n          console.error(`âŒ Error en fallback para ${style}:`, fallbackError)\r\n        })\r\n        \r\n        return fallbackUnsubscribe\r\n      }\r\n    })\r\n    \r\n    return unsubscribe\r\n  } catch (error) {\r\n    console.error(`âŒ Error al iniciar suscripciÃ³n de videos de ${style}:`, error)\r\n    return () => {}\r\n  }\r\n}\r\n\r\n// ===== FUNCIONES DE LIMPIEZA DE DATOS =====\r\n\r\nexport const deleteAllVideos = async () => {\r\n  try {\r\n    console.log('ðŸ—‘ï¸ Iniciando eliminaciÃ³n de todos los videos...')\r\n    \r\n    // Obtener todos los videos\r\n    const videos = await getVideos()\r\n    console.log(`ðŸ“Š Videos a eliminar: ${videos.length}`)\r\n    \r\n    if (videos.length === 0) {\r\n      console.log('âœ… No hay videos para eliminar')\r\n      return { success: true, deletedCount: 0, error: null }\r\n    }\r\n    \r\n    // Eliminar documentos en lotes\r\n    const batch = writeBatch(db)\r\n    let deletedCount = 0\r\n    \r\n    videos.forEach((video) => {\r\n      const videoRef = doc(db, COLLECTIONS.VIDEOS, video.id)\r\n      batch.delete(videoRef)\r\n      deletedCount++\r\n    })\r\n    \r\n    await batch.commit()\r\n    console.log(`âœ… ${deletedCount} videos eliminados de Firestore`)\r\n    \r\n    return { success: true, deletedCount, error: null }\r\n  } catch (error) {\r\n    console.error('âŒ Error al eliminar todos los videos:', error)\r\n    return { success: false, deletedCount: 0, error: error.message }\r\n  }\r\n}\r\n\r\nexport const updateVideoThumbnailPaths = async () => {\r\n  try {\r\n    console.log('ðŸ”§ Iniciando actualizaciÃ³n de rutas de thumbnails...')\r\n    \r\n    const videos = await getVideos()\r\n    console.log(`ðŸ“Š Videos a actualizar: ${videos.length}`)\r\n    \r\n    if (videos.length === 0) {\r\n      console.log('âœ… No hay videos para actualizar')\r\n      return { success: true, updatedCount: 0, error: null }\r\n    }\r\n    \r\n    const batch = writeBatch(db)\r\n    let updatedCount = 0\r\n    \r\n    videos.forEach((video) => {\r\n      // Si el video no tiene thumbnailPath o es incorrecto, intentar corregirlo\r\n      if (!video.thumbnailPath || video.thumbnailPath === 'placeholder') {\r\n        const videoRef = doc(db, COLLECTIONS.VIDEOS, video.id)\r\n        batch.update(videoRef, {\r\n          thumbnailPath: null, // Establecer como null para que se maneje en la eliminaciÃ³n\r\n          updatedAt: serverTimestamp()\r\n        })\r\n        updatedCount++\r\n      }\r\n    })\r\n    \r\n    if (updatedCount > 0) {\r\n      await batch.commit()\r\n      console.log(`âœ… ${updatedCount} videos actualizados`)\r\n    } else {\r\n      console.log('âœ… No se requirieron actualizaciones')\r\n    }\r\n    \r\n    return { success: true, updatedCount, error: null }\r\n  } catch (error) {\r\n    console.error('âŒ Error al actualizar rutas de thumbnails:', error)\r\n    return { success: false, updatedCount: 0, error: error.message }\r\n  }\r\n} \r\n\r\n// ===== FUNCIONES DE DIAGNÃ“STICO =====\r\n\r\nexport const diagnoseVideos = async () => {\r\n  try {\r\n    console.log('ðŸ” Iniciando diagnÃ³stico de videos...')\r\n    \r\n    // Obtener todos los videos sin filtros\r\n    const allVideos = await getVideos()\r\n    console.log(`ðŸ“Š Total de videos en Firestore: ${allVideos.length}`)\r\n    \r\n    // Agrupar por estilo\r\n    const videosByStyle = {}\r\n    allVideos.forEach(video => {\r\n      const style = video.style || 'sin-estilo'\r\n      if (!videosByStyle[style]) {\r\n        videosByStyle[style] = []\r\n      }\r\n      videosByStyle[style].push(video)\r\n    })\r\n    \r\n    console.log('ðŸ“Š Videos por estilo:', videosByStyle)\r\n    \r\n    // Verificar videos de salsa especÃ­ficamente\r\n    const salsaVideos = allVideos.filter(video => \r\n      video.style === 'salsa' || \r\n      (video.tags && video.tags.estilo && video.tags.estilo.includes('salsa'))\r\n    )\r\n    \r\n    console.log(`ðŸ“Š Videos de salsa encontrados: ${salsaVideos.length}`)\r\n    salsaVideos.forEach(video => {\r\n      console.log(`  - ${video.title} (ID: ${video.id}, Style: ${video.style})`)\r\n    })\r\n    \r\n    // Buscar especÃ­ficamente el video Fig003\r\n    const fig003Video = allVideos.find(video => \r\n      video.originalTitle && video.originalTitle.includes('Fig003')\r\n    )\r\n    \r\n    if (fig003Video) {\r\n      console.log('ðŸŽ¯ Video Fig003 encontrado:', fig003Video)\r\n    } else {\r\n      console.log('âŒ Video Fig003 NO encontrado en Firestore')\r\n    }\r\n    \r\n    // Verificar videos sin resoluciÃ³n\r\n    const videosWithoutResolution = allVideos.filter(video => \r\n      !video.resolution || video.resolution === 'Unknown'\r\n    )\r\n    \r\n    console.log(`ðŸ“Š Videos sin resoluciÃ³n: ${videosWithoutResolution.length}`)\r\n    videosWithoutResolution.forEach(video => {\r\n      console.log(`  - ${video.title} (ID: ${video.id})`)\r\n    })\r\n    \r\n    return {\r\n      success: true,\r\n      totalVideos: allVideos.length,\r\n      videosByStyle,\r\n      salsaVideos: salsaVideos.length,\r\n      fig003Found: !!fig003Video,\r\n      fig003Video,\r\n      videosWithoutResolution: videosWithoutResolution.length,\r\n      error: null\r\n    }\r\n  } catch (error) {\r\n    console.error('âŒ Error en diagnÃ³stico de videos:', error)\r\n    return {\r\n      success: false,\r\n      totalVideos: 0,\r\n      videosByStyle: {},\r\n      salsaVideos: 0,\r\n      fig003Found: false,\r\n      fig003Video: null,\r\n      videosWithoutResolution: 0,\r\n      error: error.message\r\n    }\r\n  }\r\n} \r\n\r\n// ===== FUNCIÃ“N PARA LIMPIAR TAGS DUPLICADOS =====\r\n\r\nexport const cleanupDuplicateTags = async () => {\r\n  try {\r\n    console.log('ðŸ§¹ Iniciando limpieza de tags duplicados...')\r\n    \r\n    const videos = await getVideos()\r\n    console.log(`ðŸ“Š Videos a revisar: ${videos.length}`)\r\n    \r\n    if (videos.length === 0) {\r\n      console.log('âœ… No hay videos para revisar')\r\n      return { success: true, updatedCount: 0, error: null }\r\n    }\r\n    \r\n    const batch = writeBatch(db)\r\n    let updatedCount = 0\r\n    \r\n    videos.forEach((video) => {\r\n      let hasChanges = false\r\n      const updatedTags = {}\r\n      const updatedTagsIniciales = {}\r\n      const updatedTagsFinales = {}\r\n      \r\n      // Limpiar tags normales\r\n      if (video.tags) {\r\n        Object.keys(video.tags).forEach(category => {\r\n          if (Array.isArray(video.tags[category])) {\r\n            // Eliminar duplicados manteniendo el orden\r\n            const uniqueTags = [...new Set(video.tags[category])]\r\n            if (uniqueTags.length !== video.tags[category].length) {\r\n              updatedTags[category] = uniqueTags\r\n              hasChanges = true\r\n              console.log(`ðŸ”„ ${video.title}: Eliminados ${video.tags[category].length - uniqueTags.length} tags duplicados en ${category}`)\r\n            }\r\n          }\r\n        })\r\n      }\r\n      \r\n      // Limpiar tags iniciales\r\n      if (video.tagsIniciales) {\r\n        Object.keys(video.tagsIniciales).forEach(category => {\r\n          if (Array.isArray(video.tagsIniciales[category])) {\r\n            const uniqueTags = [...new Set(video.tagsIniciales[category])]\r\n            if (uniqueTags.length !== video.tagsIniciales[category].length) {\r\n              updatedTagsIniciales[category] = uniqueTags\r\n              hasChanges = true\r\n              console.log(`ðŸ”„ ${video.title}: Eliminados ${video.tagsIniciales[category].length - uniqueTags.length} tags iniciales duplicados en ${category}`)\r\n            }\r\n          }\r\n        })\r\n      }\r\n      \r\n      // Limpiar tags finales\r\n      if (video.tagsFinales) {\r\n        Object.keys(video.tagsFinales).forEach(category => {\r\n          if (Array.isArray(video.tagsFinales[category])) {\r\n            const uniqueTags = [...new Set(video.tagsFinales[category])]\r\n            if (uniqueTags.length !== video.tagsFinales[category].length) {\r\n              updatedTagsFinales[category] = uniqueTags\r\n              hasChanges = true\r\n              console.log(`ðŸ”„ ${video.title}: Eliminados ${video.tagsFinales[category].length - uniqueTags.length} tags finales duplicados en ${category}`)\r\n            }\r\n          }\r\n        })\r\n      }\r\n      \r\n      if (hasChanges) {\r\n        const videoRef = doc(db, COLLECTIONS.VIDEOS, video.id)\r\n        const updates = {\r\n          updatedAt: serverTimestamp()\r\n        }\r\n        \r\n        if (Object.keys(updatedTags).length > 0) {\r\n          updates.tags = { ...video.tags, ...updatedTags }\r\n        }\r\n        if (Object.keys(updatedTagsIniciales).length > 0) {\r\n          updates.tagsIniciales = { ...video.tagsIniciales, ...updatedTagsIniciales }\r\n        }\r\n        if (Object.keys(updatedTagsFinales).length > 0) {\r\n          updates.tagsFinales = { ...video.tagsFinales, ...updatedTagsFinales }\r\n        }\r\n        \r\n        batch.update(videoRef, updates)\r\n        updatedCount++\r\n      }\r\n    })\r\n    \r\n    if (updatedCount > 0) {\r\n      await batch.commit()\r\n      console.log(`âœ… ${updatedCount} videos actualizados con tags limpios`)\r\n    } else {\r\n      console.log('âœ… No se encontraron tags duplicados')\r\n    }\r\n    \r\n    return { success: true, updatedCount, error: null }\r\n  } catch (error) {\r\n    console.error('âŒ Error al limpiar tags duplicados:', error)\r\n    return { success: false, updatedCount: 0, error: error.message }\r\n  }\r\n} ","// ConfiguraciÃ³n de roles y permisos del sistema\r\nexport const ROLES = {\r\n  SUPER_ADMIN: 'super_admin',\r\n  MAESE: 'maese',\r\n  USER: 'user',\r\n  POLLITO: 'pollito'\r\n}\r\n\r\nexport const ROLE_LABELS = {\r\n  [ROLES.SUPER_ADMIN]: 'Super Administrador',\r\n  [ROLES.MAESE]: 'Maese',\r\n  [ROLES.USER]: 'Soldado',\r\n  [ROLES.POLLITO]: 'Pollito'\r\n}\r\n\r\nexport const ROLE_COLORS = {\r\n  [ROLES.SUPER_ADMIN]: 'bg-purple-600 text-white',\r\n  [ROLES.MAESE]: 'bg-red-500 text-white',\r\n  [ROLES.USER]: 'bg-green-500 text-white',\r\n  [ROLES.POLLITO]: 'bg-yellow-400 text-gray-800'\r\n}\r\n\r\n// Orden de importancia (de menor a mayor)\r\nexport const ROLE_HIERARCHY = {\r\n  [ROLES.POLLITO]: 1,    // MÃ¡s pequeÃ±o\r\n  [ROLES.USER]: 2,       // Segundo\r\n  [ROLES.MAESE]: 3,      // Tercero\r\n  [ROLES.SUPER_ADMIN]: 4 // Mayor\r\n}\r\n\r\n// Permisos por funcionalidad (simplificados por ahora)\r\nexport const PERMISSIONS = {\r\n  // GestiÃ³n de usuarios\r\n  MANAGE_USERS: [ROLES.SUPER_ADMIN, ROLES.MAESE],\r\n  VIEW_USERS: [ROLES.SUPER_ADMIN, ROLES.MAESE],\r\n  \r\n  // GestiÃ³n de contenido\r\n  CREATE_CONTENT: [ROLES.SUPER_ADMIN, ROLES.MAESE],\r\n  EDIT_CONTENT: [ROLES.SUPER_ADMIN, ROLES.MAESE],\r\n  DELETE_CONTENT: [ROLES.SUPER_ADMIN],\r\n  PUBLISH_CONTENT: [ROLES.SUPER_ADMIN, ROLES.MAESE],\r\n  \r\n  // GestiÃ³n de eventos\r\n  CREATE_EVENTS: [ROLES.SUPER_ADMIN, ROLES.MAESE],\r\n  EDIT_EVENTS: [ROLES.SUPER_ADMIN, ROLES.MAESE],\r\n  DELETE_EVENTS: [ROLES.SUPER_ADMIN],\r\n  MANAGE_EVENTS: [ROLES.SUPER_ADMIN, ROLES.MAESE],\r\n  \r\n  // GestiÃ³n de figuras\r\n  CREATE_FIGURES: [ROLES.SUPER_ADMIN, ROLES.MAESE],\r\n  EDIT_FIGURES: [ROLES.SUPER_ADMIN, ROLES.MAESE],\r\n  DELETE_FIGURES: [ROLES.SUPER_ADMIN],\r\n  \r\n  // GestiÃ³n de escuela\r\n  CREATE_LESSONS: [ROLES.SUPER_ADMIN, ROLES.MAESE],\r\n  EDIT_LESSONS: [ROLES.SUPER_ADMIN, ROLES.MAESE],\r\n  DELETE_LESSONS: [ROLES.SUPER_ADMIN],\r\n  \r\n  // Acceso a contenido\r\n  ACCESS_PREMIUM_CONTENT: [ROLES.SUPER_ADMIN, ROLES.MAESE, ROLES.USER],\r\n  ACCESS_BASIC_CONTENT: [ROLES.SUPER_ADMIN, ROLES.MAESE, ROLES.USER, ROLES.POLLITO],\r\n  ACCESS_PUBLIC_CONTENT: [ROLES.SUPER_ADMIN, ROLES.MAESE, ROLES.USER, ROLES.POLLITO],\r\n  \r\n  // GestiÃ³n del sistema\r\n  MANAGE_SYSTEM: [ROLES.SUPER_ADMIN],\r\n  VIEW_ANALYTICS: [ROLES.SUPER_ADMIN, ROLES.MAESE],\r\n  MANAGE_CATEGORIES: [ROLES.SUPER_ADMIN, ROLES.MAESE],\r\n  \r\n  // Funcionalidades especÃ­ficas\r\n  UPLOAD_VIDEOS: [ROLES.SUPER_ADMIN, ROLES.MAESE],\r\n  UPLOAD_IMAGES: [ROLES.SUPER_ADMIN, ROLES.MAESE, ROLES.USER],\r\n  COMMENT_CONTENT: [ROLES.SUPER_ADMIN, ROLES.MAESE, ROLES.USER],\r\n  RATE_CONTENT: [ROLES.SUPER_ADMIN, ROLES.MAESE, ROLES.USER],\r\n  \r\n  // Notificaciones\r\n  SEND_NOTIFICATIONS: [ROLES.SUPER_ADMIN, ROLES.MAESE],\r\n  RECEIVE_NOTIFICATIONS: [ROLES.SUPER_ADMIN, ROLES.MAESE, ROLES.USER]\r\n}\r\n\r\n// FunciÃ³n para verificar permisos\r\nexport const hasPermission = (userRole, permission) => {\r\n  if (!userRole || !PERMISSIONS[permission]) return false\r\n  return PERMISSIONS[permission].includes(userRole)\r\n}\r\n\r\n// FunciÃ³n para obtener todos los permisos de un rol\r\nexport const getRolePermissions = (userRole) => {\r\n  if (!userRole) return []\r\n  \r\n  return Object.keys(PERMISSIONS).filter(permission => \r\n    PERMISSIONS[permission].includes(userRole)\r\n  )\r\n}\r\n\r\n// Niveles de acceso por pÃ¡gina\r\nexport const PAGE_ACCESS = {\r\n  '/': [ROLES.SUPER_ADMIN, ROLES.MAESE, ROLES.USER, ROLES.POLLITO],\r\n  '/figuras': [ROLES.SUPER_ADMIN, ROLES.MAESE, ROLES.USER, ROLES.POLLITO],\r\n  '/escuela': [ROLES.SUPER_ADMIN, ROLES.MAESE, ROLES.USER, ROLES.POLLITO],\r\n  '/eventos': [ROLES.SUPER_ADMIN, ROLES.MAESE, ROLES.USER, ROLES.POLLITO],\r\n  '/categorias': [ROLES.SUPER_ADMIN, ROLES.MAESE, ROLES.USER, ROLES.POLLITO],\r\n  '/notas': [ROLES.SUPER_ADMIN, ROLES.MAESE, ROLES.USER],\r\n  '/admin': [ROLES.SUPER_ADMIN, ROLES.MAESE],\r\n  '/auth': [ROLES.SUPER_ADMIN, ROLES.MAESE, ROLES.USER, ROLES.POLLITO]\r\n}\r\n\r\n// FunciÃ³n para verificar acceso a pÃ¡gina\r\nexport const hasPageAccess = (userRole, pagePath) => {\r\n  if (!userRole || !PAGE_ACCESS[pagePath]) return false\r\n  return PAGE_ACCESS[pagePath].includes(userRole)\r\n}\r\n\r\n// ConfiguraciÃ³n de roles por defecto\r\nexport const DEFAULT_ROLE = ROLES.USER\r\n\r\n// Roles que pueden ser asignados por administradores\r\nexport const ASSIGNABLE_ROLES = {\r\n  [ROLES.SUPER_ADMIN]: [ROLES.SUPER_ADMIN, ROLES.MAESE, ROLES.USER, ROLES.POLLITO],\r\n  [ROLES.MAESE]: [ROLES.USER, ROLES.POLLITO]\r\n} ","import { createContext, useContext, useState, useEffect } from 'react'\r\nimport {\r\n  onAuthStateChange,\r\n  loginWithEmail,\r\n  loginWithGoogle,\r\n  registerWithEmail,\r\n  logout as firebaseLogout,\r\n  resetPassword,\r\n  createUserProfile,\r\n  getUserProfile,\r\n  updateUserProfile as firebaseUpdateUserProfile,\r\n  createInvitation as firebaseCreateInvitation,\r\n  validateInvitation as firebaseValidateInvitation,\r\n  markInvitationAsUsed as firebaseMarkInvitationAsUsed\r\n} from '../services/firebase'\r\nimport { ROLES, hasPermission, getRolePermissions, hasPageAccess } from '../constants/roles'\r\n\r\nconst AuthContext = createContext()\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext)\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider')\r\n  }\r\n  return context\r\n}\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null)\r\n  const [userProfile, setUserProfile] = useState(null)\r\n  const [loading, setLoading] = useState(true)\r\n\r\n  // FunciÃ³n para determinar el rol por defecto basado en el email\r\n  const getDefaultRole = (email) => {\r\n    // David como Super Administrador\r\n    if (email === 'david_exile_92@hotmail.com') {\r\n      return ROLES.SUPER_ADMIN\r\n    }\r\n    // Por defecto Pollito para otros usuarios\r\n    return ROLES.POLLITO\r\n  }\r\n\r\n  // FunciÃ³n para crear perfil de David si no existe\r\n  const createDavidProfile = async (firebaseUser) => {\r\n    if (firebaseUser.email === 'david_exile_92@hotmail.com') {\r\n      console.log('ðŸ†• Creando perfil de David en Firestore...')\r\n      try {\r\n        const profileData = {\r\n          displayName: 'David',\r\n          email: firebaseUser.email,\r\n          role: ROLES.SUPER_ADMIN,\r\n          username: 'david',\r\n          createdAt: new Date(),\r\n          permissions: getRolePermissions(ROLES.SUPER_ADMIN),\r\n          photoURL: firebaseUser.photoURL || null,\r\n          isSuperAdmin: true\r\n        }\r\n        \r\n        const result = await createUserProfile(firebaseUser.uid, profileData)\r\n        if (result.success) {\r\n          console.log('âœ… Perfil de David creado exitosamente')\r\n          return profileData\r\n        } else {\r\n          console.error('âŒ Error al crear perfil de David:', result.error)\r\n        }\r\n      } catch (error) {\r\n        console.error('âŒ Error al crear perfil de David:', error)\r\n      }\r\n    }\r\n    return null\r\n  }\r\n\r\n  // FunciÃ³n para actualizar automÃ¡ticamente el rol de David si es necesario\r\n  const updateDavidRole = async (profile) => {\r\n    console.log('ðŸ” Verificando rol de David:', profile?.email, profile?.role)\r\n    \r\n    if (profile?.email === 'david_exile_92@hotmail.com' && profile?.role !== ROLES.SUPER_ADMIN) {\r\n      console.log('ðŸ”„ Actualizando rol de David a Super Admin...')\r\n      try {\r\n        await firebaseUpdateUserProfile(profile.uid, {\r\n          role: ROLES.SUPER_ADMIN,\r\n          permissions: getRolePermissions(ROLES.SUPER_ADMIN),\r\n          updatedAt: new Date()\r\n        })\r\n        console.log('âœ… Rol de David actualizado a Super Admin exitosamente')\r\n        return { ...profile, role: ROLES.SUPER_ADMIN, permissions: getRolePermissions(ROLES.SUPER_ADMIN) }\r\n      } catch (error) {\r\n        console.error('âŒ Error al actualizar rol de David:', error)\r\n      }\r\n    } else if (profile?.email === 'david_exile_92@hotmail.com') {\r\n      console.log('âœ… David ya tiene rol de Super Admin')\r\n    }\r\n    return profile\r\n  }\r\n\r\n  useEffect(() => {\r\n    // Observar cambios en el estado de autenticaciÃ³n\r\n    const unsubscribe = onAuthStateChange(async (firebaseUser) => {\r\n      console.log('ðŸ”„ Cambio en estado de autenticaciÃ³n:', firebaseUser?.email)\r\n      \r\n      if (firebaseUser) {\r\n        setUser(firebaseUser)\r\n        console.log('ðŸ‘¤ Usuario autenticado:', firebaseUser.email, firebaseUser.uid)\r\n        \r\n        // Obtener perfil del usuario\r\n        try {\r\n          const { user: profile } = await getUserProfile(firebaseUser.uid)\r\n          if (profile) {\r\n            console.log('ðŸ“‹ Perfil encontrado:', profile.email, profile.role)\r\n            // Actualizar rol de David si es necesario\r\n            const updatedProfile = await updateDavidRole(profile)\r\n            setUserProfile(updatedProfile)\r\n            console.log('âœ… Perfil actualizado y establecido:', updatedProfile.role)\r\n          } else {\r\n            console.log('âŒ No se encontrÃ³ perfil para:', firebaseUser.email)\r\n            \r\n            // Si es David y no tiene perfil, crearlo automÃ¡ticamente\r\n            if (firebaseUser.email === 'david_exile_92@hotmail.com') {\r\n              console.log('ðŸ†• David no tiene perfil, creÃ¡ndolo automÃ¡ticamente...')\r\n              const newProfile = await createDavidProfile(firebaseUser)\r\n              if (newProfile) {\r\n                setUserProfile(newProfile)\r\n                console.log('âœ… Perfil de David creado y establecido automÃ¡ticamente')\r\n              }\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.log('âŒ Error al obtener perfil:', error)\r\n          \r\n          // Si es David y hay error, intentar crear perfil\r\n          if (firebaseUser.email === 'david_exile_92@hotmail.com') {\r\n            console.log('ðŸ†• Error al obtener perfil de David, creÃ¡ndolo...')\r\n            const newProfile = await createDavidProfile(firebaseUser)\r\n            if (newProfile) {\r\n              setUserProfile(newProfile)\r\n              console.log('âœ… Perfil de David creado despuÃ©s de error')\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        console.log('ðŸšª Usuario no autenticado')\r\n        setUser(null)\r\n        setUserProfile(null)\r\n      }\r\n      setLoading(false)\r\n    })\r\n\r\n    return () => unsubscribe()\r\n  }, [])\r\n\r\n  const login = async (email, password) => {\r\n    try {\r\n      const { user: firebaseUser, error } = await loginWithEmail(email, password)\r\n      if (error) throw new Error(error)\r\n      return { success: true, error: null }\r\n    } catch (error) {\r\n      return { success: false, error: error.message }\r\n    }\r\n  }\r\n\r\n  const loginWithGoogleAuth = async () => {\r\n    try {\r\n      const { user: firebaseUser, error } = await loginWithGoogle()\r\n      if (error) throw new Error(error)\r\n      return { success: true, error: null }\r\n    } catch (error) {\r\n      return { success: false, error: error.message }\r\n    }\r\n  }\r\n\r\n  // FunciÃ³n para crear invitaciÃ³n (solo Super Admin)\r\n  const createInvitation = async (email, displayName, role, username, expiresInDays = 7) => {\r\n    try {\r\n      // Verificar que el usuario actual es Super Admin\r\n      if (!userProfile || userProfile.role !== ROLES.SUPER_ADMIN) {\r\n        throw new Error('Solo el Super Administrador puede crear invitaciones')\r\n      }\r\n\r\n      const result = await firebaseCreateInvitation({\r\n        email,\r\n        displayName,\r\n        role,\r\n        username,\r\n        expiresInDays,\r\n        createdBy: userProfile.uid,\r\n        createdAt: new Date()\r\n      })\r\n\r\n      if (result.success) {\r\n        // Generar URL de invitaciÃ³n\r\n        const invitationUrl = `${window.location.origin}/invite/${result.invitationCode}`\r\n        return { \r\n          success: true, \r\n          invitationCode: result.invitationCode,\r\n          invitationUrl: invitationUrl,\r\n          error: null \r\n        }\r\n      } else {\r\n        return { success: false, error: result.error }\r\n      }\r\n    } catch (error) {\r\n      return { success: false, error: error.message }\r\n    }\r\n  }\r\n\r\n  // FunciÃ³n para validar invitaciÃ³n\r\n  const validateInvitation = async (invitationCode) => {\r\n    try {\r\n      const result = await firebaseValidateInvitation(invitationCode)\r\n      return result\r\n    } catch (error) {\r\n      return { success: false, error: error.message }\r\n    }\r\n  }\r\n\r\n  // FunciÃ³n para crear usuario por invitaciÃ³n\r\n  const createUserByInvitation = async (invitationCode, password) => {\r\n    try {\r\n      console.log('ðŸ” Iniciando creaciÃ³n de usuario por invitaciÃ³n:', invitationCode)\r\n      \r\n      // Primero validar la invitaciÃ³n\r\n      const validation = await validateInvitation(invitationCode)\r\n      if (!validation.success) {\r\n        console.error('âŒ InvitaciÃ³n invÃ¡lida:', validation.error)\r\n        throw new Error(validation.error)\r\n      }\r\n\r\n      const invitation = validation.invitation\r\n      console.log('âœ… InvitaciÃ³n vÃ¡lida:', invitation)\r\n\r\n      // Crear el usuario\r\n      const { user: firebaseUser, error } = await registerWithEmail(invitation.email, password, invitation.displayName)\r\n      if (error) {\r\n        console.error('âŒ Error al crear usuario:', error)\r\n        throw new Error(error)\r\n      }\r\n      \r\n      console.log('âœ… Usuario creado en Firebase Auth:', firebaseUser.uid)\r\n      \r\n      // Crear perfil de usuario\r\n      if (firebaseUser) {\r\n        const profileData = {\r\n          displayName: invitation.displayName,\r\n          email: invitation.email,\r\n          role: invitation.role,\r\n          username: invitation.username,\r\n          createdAt: new Date(),\r\n          permissions: getRolePermissions(invitation.role),\r\n          photoURL: firebaseUser.photoURL || null,\r\n          invitedBy: invitation.createdBy,\r\n          invitationCode: invitationCode,\r\n          invitationDate: new Date()\r\n        }\r\n        \r\n        console.log('ðŸ“ Creando perfil de usuario:', profileData)\r\n        \r\n        const profileResult = await createUserProfile(firebaseUser.uid, profileData)\r\n        if (!profileResult.success) {\r\n          console.error('âŒ Error al crear perfil:', profileResult.error)\r\n          throw new Error(profileResult.error)\r\n        }\r\n        \r\n        console.log('âœ… Perfil de usuario creado exitosamente')\r\n\r\n        // Marcar la invitaciÃ³n como usada\r\n        const markResult = await firebaseMarkInvitationAsUsed(invitationCode, firebaseUser.uid)\r\n        if (!markResult.success) {\r\n          console.error('âŒ Error al marcar invitaciÃ³n como usada:', markResult.error)\r\n        } else {\r\n          console.log('âœ… InvitaciÃ³n marcada como usada')\r\n        }\r\n        \r\n        // Cargar el perfil inmediatamente\r\n        const { user: newProfile } = await getUserProfile(firebaseUser.uid)\r\n        if (newProfile) {\r\n          console.log('âœ… Perfil cargado inmediatamente:', newProfile)\r\n          setUserProfile(newProfile)\r\n        }\r\n      }\r\n      \r\n      return { success: true, error: null }\r\n    } catch (error) {\r\n      console.error('âŒ Error en createUserByInvitation:', error)\r\n      return { success: false, error: error.message }\r\n    }\r\n  }\r\n\r\n  const logout = async () => {\r\n    try {\r\n      await firebaseLogout()\r\n      return { success: true, error: null }\r\n    } catch (error) {\r\n      return { success: false, error: error.message }\r\n    }\r\n  }\r\n\r\n  const resetUserPassword = async (email) => {\r\n    try {\r\n      const { error } = await resetPassword(email)\r\n      if (error) throw new Error(error)\r\n      return { success: true, error: null }\r\n    } catch (error) {\r\n      return { success: false, error: error.message }\r\n    }\r\n  }\r\n\r\n  const updateUserProfile = async (profileData) => {\r\n    try {\r\n      if (!user?.uid) throw new Error('Usuario no autenticado')\r\n      \r\n      // Generar username automÃ¡ticamente si no existe\r\n      const updatedData = {\r\n        ...profileData,\r\n        username: profileData.username || profileData.displayName?.toLowerCase().replace(/\\s+/g, ''),\r\n        updatedAt: new Date()\r\n      }\r\n      \r\n      // Actualizar en Firebase\r\n      await firebaseUpdateUserProfile(user.uid, updatedData)\r\n      \r\n      // Actualizar estado local\r\n      setUserProfile(prev => ({ ...prev, ...updatedData }))\r\n      \r\n      return { success: true, error: null }\r\n    } catch (error) {\r\n      console.error('Error al actualizar perfil:', error)\r\n      return { success: false, error: error.message }\r\n    }\r\n  }\r\n\r\n  // FunciÃ³n para obtener el username del usuario\r\n  const getUserUsername = () => {\r\n    return userProfile?.username || userProfile?.displayName?.toLowerCase().replace(/\\s+/g, '') || 'usuario'\r\n  }\r\n\r\n  // FunciÃ³n para obtener la foto de perfil\r\n  const getUserPhoto = () => {\r\n    return userProfile?.photoURL || user?.photoURL || null\r\n  }\r\n\r\n  // FunciÃ³n para forzar actualizaciÃ³n del rol de David (para el botÃ³n del perfil)\r\n  const forceUpdateDavidRole = async () => {\r\n    if (!user?.uid) {\r\n      console.error('âŒ No hay usuario autenticado')\r\n      return { success: false, error: 'No hay usuario autenticado' }\r\n    }\r\n    \r\n    if (user.email !== 'david_exile_92@hotmail.com') {\r\n      console.error('âŒ Solo David puede usar esta funciÃ³n')\r\n      return { success: false, error: 'Solo David puede usar esta funciÃ³n' }\r\n    }\r\n    \r\n    console.log('ðŸ”§ Forzando actualizaciÃ³n del rol de David...')\r\n    \r\n    try {\r\n      // Primero verificar si existe el perfil\r\n      const { user: existingProfile } = await getUserProfile(user.uid)\r\n      \r\n      if (existingProfile) {\r\n        // Actualizar perfil existente\r\n        await firebaseUpdateUserProfile(user.uid, {\r\n          role: ROLES.SUPER_ADMIN,\r\n          permissions: getRolePermissions(ROLES.SUPER_ADMIN),\r\n          updatedAt: new Date(),\r\n          isSuperAdmin: true\r\n        })\r\n        console.log('âœ… Perfil de David actualizado forzadamente')\r\n      } else {\r\n        // Crear perfil nuevo\r\n        const newProfile = await createDavidProfile(user)\r\n        if (newProfile) {\r\n          console.log('âœ… Perfil de David creado forzadamente')\r\n        }\r\n      }\r\n      \r\n      // Recargar el perfil\r\n      const { user: updatedProfile } = await getUserProfile(user.uid)\r\n      if (updatedProfile) {\r\n        setUserProfile(updatedProfile)\r\n        console.log('âœ… Perfil recargado:', updatedProfile.role)\r\n      }\r\n      \r\n      return { success: true, error: null }\r\n    } catch (error) {\r\n      console.error('âŒ Error al forzar actualizaciÃ³n:', error)\r\n      return { success: false, error: error.message }\r\n    }\r\n  }\r\n\r\n  const value = {\r\n    user,\r\n    userProfile,\r\n    loading,\r\n    login,\r\n    loginWithGoogle: loginWithGoogleAuth,\r\n    createInvitation,\r\n    validateInvitation,\r\n    createUserByInvitation,\r\n    logout,\r\n    resetPassword: resetUserPassword,\r\n    updateUserProfile,\r\n    getUserUsername,\r\n    getUserPhoto,\r\n    isAuthenticated: !!user,\r\n    isSuperAdmin: userProfile?.role === ROLES.SUPER_ADMIN,\r\n    isMaese: userProfile?.role === ROLES.MAESE,\r\n    isUser: userProfile?.role === ROLES.USER,\r\n    isPollito: userProfile?.role === ROLES.POLLITO,\r\n    hasPermission: (permission) => hasPermission(userProfile?.role, permission),\r\n    hasPageAccess: (pagePath) => hasPageAccess(userProfile?.role, pagePath),\r\n    getRolePermissions: () => getRolePermissions(userProfile?.role),\r\n    forceUpdateDavidRole: forceUpdateDavidRole\r\n  }\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  )\r\n} ","// ðŸŽ¬ CONTEXTO PARA CONSTRUCTOR DE SECUENCIAS - SALSAHACKS V2.0\r\n\r\nimport React, { createContext, useContext, useState, useCallback, useMemo } from 'react'\r\n\r\nconst SequenceBuilderContext = createContext()\r\n\r\nexport const useSequenceBuilderContext = () => {\r\n  const context = useContext(SequenceBuilderContext)\r\n  if (!context) {\r\n    throw new Error('useSequenceBuilderContext debe usarse dentro de un SequenceBuilderProvider')\r\n  }\r\n  return context\r\n}\r\n\r\nexport const SequenceBuilderProvider = ({ children }) => {\r\n  const [sequence, setSequence] = useState([])\r\n  const [sequenceName, setSequenceName] = useState('')\r\n  const [sequenceDescription, setSequenceDescription] = useState('')\r\n  const [isBuilderOpen, setIsBuilderOpen] = useState(false)\r\n  const [showAllVideos, setShowAllVideos] = useState(false)\r\n  const [editingSequenceId, setEditingSequenceId] = useState(null) // ID de la secuencia que se estÃ¡ editando\r\n\r\n  // FunciÃ³n auxiliar para extraer todos los tags de un objeto de tags por categorÃ­as\r\n  const extractAllTags = useCallback((tagsObj) => {\r\n    if (!tagsObj) return []\r\n    \r\n    const allTags = []\r\n    \r\n    // Si es un array, devolverlo directamente\r\n    if (Array.isArray(tagsObj)) {\r\n      return tagsObj\r\n    }\r\n    \r\n    // Si es un objeto con categorÃ­as, extraer todos los tags\r\n    Object.values(tagsObj).forEach(categoryTags => {\r\n      if (Array.isArray(categoryTags)) {\r\n        allTags.push(...categoryTags)\r\n      }\r\n    })\r\n    \r\n    return allTags\r\n  }, [])\r\n\r\n  // FunciÃ³n para verificar compatibilidad entre dos videos\r\n  const checkCompatibility = useCallback((video1, video2) => {\r\n    if (!video1 || !video2) return false\r\n    \r\n    // Extraer todos los tags finales del primer video\r\n    const tagsFinales1 = extractAllTags(video1.tagsFinales)\r\n    \r\n    // Extraer todos los tags iniciales del segundo video\r\n    const tagsIniciales2 = extractAllTags(video2.tagsIniciales)\r\n    \r\n    console.log('ðŸ” Verificando compatibilidad:')\r\n    console.log('Video 1:', video1.title, 'Tags Finales:', tagsFinales1)\r\n    console.log('Video 2:', video2.title, 'Tags Iniciales:', tagsIniciales2)\r\n    \r\n    // Verificar si hay al menos un tag final del primer video que coincida con un tag inicial del segundo\r\n    const isCompatible = tagsFinales1.some(tagFinal => \r\n      tagsIniciales2.some(tagInicial => {\r\n        const match = tagFinal === tagInicial\r\n        if (match) {\r\n          console.log('âœ… Match encontrado:', tagFinal, '=', tagInicial)\r\n        }\r\n        return match\r\n      })\r\n    )\r\n    \r\n    console.log('Resultado compatibilidad:', isCompatible)\r\n    return isCompatible\r\n  }, [extractAllTags])\r\n\r\n  // FunciÃ³n para aÃ±adir un video a la secuencia (ahora permite repetidos)\r\n  const addVideoToSequence = useCallback((video) => {\r\n    setSequence(prev => [...prev, video])\r\n  }, [])\r\n\r\n  // FunciÃ³n para eliminar un video de la secuencia\r\n  const removeVideoFromSequence = useCallback((index) => {\r\n    setSequence(prev => prev.filter((_, i) => i !== index))\r\n  }, [])\r\n\r\n  // FunciÃ³n para reordenar videos en la secuencia\r\n  const reorderSequence = useCallback((fromIndex, toIndex) => {\r\n    setSequence(prev => {\r\n      const newSequence = [...prev]\r\n      const [movedVideo] = newSequence.splice(fromIndex, 1)\r\n      newSequence.splice(toIndex, 0, movedVideo)\r\n      return newSequence\r\n    })\r\n  }, [])\r\n\r\n  // FunciÃ³n para generar una secuencia aleatoria\r\n  const generateRandomSequence = useCallback((allVideos, count = 5) => {\r\n    if (allVideos.length === 0) return\r\n    \r\n    // Si ya hay videos en la secuencia, aÃ±adir a la existente\r\n    const currentSequence = [...sequence]\r\n    let availableVideos = [...allVideos]\r\n    \r\n    // Remover videos que ya estÃ¡n en la secuencia actual\r\n    availableVideos = availableVideos.filter(video => \r\n      !currentSequence.some(seqVideo => seqVideo.id === video.id)\r\n    )\r\n    \r\n    console.log('ðŸŽ² Generando secuencia aleatoria para completar', count, 'videos totales')\r\n    console.log('ðŸ“‹ Videos actuales en secuencia:', currentSequence.length)\r\n    console.log('ðŸ“‹ Videos disponibles:', availableVideos.length)\r\n    \r\n    // Si no hay secuencia actual, seleccionar el primer video aleatoriamente\r\n    if (currentSequence.length === 0) {\r\n      const firstVideoIndex = Math.floor(Math.random() * availableVideos.length)\r\n      const firstVideo = availableVideos[firstVideoIndex]\r\n      currentSequence.push(firstVideo)\r\n      availableVideos.splice(firstVideoIndex, 1)\r\n      console.log('ðŸŽ¯ Primer video seleccionado:', firstVideo.title)\r\n    }\r\n    \r\n    // Calcular cuÃ¡ntos videos faltan para completar la secuencia\r\n    const videosNeeded = count - currentSequence.length\r\n    console.log(`ðŸŽ¯ Videos necesarios para completar: ${videosNeeded}`)\r\n    \r\n    // Construir el resto de la secuencia usando lÃ³gica de compatibilidad\r\n    for (let i = 0; i < videosNeeded && availableVideos.length > 0; i++) {\r\n      const lastVideo = currentSequence[currentSequence.length - 1]\r\n      const compatibleVideos = availableVideos.filter(video => \r\n        checkCompatibility(lastVideo, video)\r\n      )\r\n      \r\n      console.log(`ðŸ“‹ Paso ${i + 1}: ${compatibleVideos.length} videos compatibles disponibles`)\r\n      \r\n      if (compatibleVideos.length === 0) {\r\n        console.log('âš ï¸ No hay videos compatibles, terminando secuencia')\r\n        break\r\n      } else {\r\n        // Seleccionar un video compatible aleatorio\r\n        const randomCompatibleIndex = Math.floor(Math.random() * compatibleVideos.length)\r\n        const selectedVideo = compatibleVideos[randomCompatibleIndex]\r\n        currentSequence.push(selectedVideo)\r\n        availableVideos = availableVideos.filter(video => video.id !== selectedVideo.id)\r\n        console.log(`âœ… AÃ±adido: ${selectedVideo.title}`)\r\n      }\r\n    }\r\n    \r\n    console.log(`ðŸŽ‰ Secuencia final: ${currentSequence.length} videos`)\r\n    setSequence(currentSequence)\r\n  }, [sequence, checkCompatibility])\r\n\r\n  // FunciÃ³n para limpiar la secuencia\r\n  const clearSequence = useCallback(() => {\r\n    setSequence([])\r\n    setSequenceName('')\r\n    setSequenceDescription('')\r\n    setEditingSequenceId(null) // Limpiar tambiÃ©n el ID de ediciÃ³n\r\n  }, [])\r\n\r\n  // FunciÃ³n para alternar el constructor\r\n  const toggleBuilder = useCallback(() => {\r\n    setIsBuilderOpen(prev => !prev)\r\n  }, [])\r\n\r\n  // FunciÃ³n para abrir el constructor\r\n  const openBuilder = useCallback(() => {\r\n    setIsBuilderOpen(true)\r\n  }, [])\r\n\r\n  // FunciÃ³n para cerrar el constructor\r\n  const closeBuilder = useCallback(() => {\r\n    setIsBuilderOpen(false)\r\n    clearSequence()\r\n  }, [clearSequence])\r\n\r\n  // FunciÃ³n para cargar una secuencia existente en el constructor\r\n  const loadSequence = useCallback((sequenceData) => {\r\n    setSequence(sequenceData.videos || [])\r\n    setSequenceName(sequenceData.name || '')\r\n    setSequenceDescription(sequenceData.description || '')\r\n    setEditingSequenceId(sequenceData.id || null) // Guardar el ID para saber que estamos editando\r\n    setIsBuilderOpen(true)\r\n  }, [])\r\n\r\n  // FunciÃ³n para alternar \"mostrar todos los videos\"\r\n  const toggleShowAllVideos = useCallback(() => {\r\n    setShowAllVideos(prev => !prev)\r\n  }, [])\r\n\r\n  // Verificar si un video es compatible con el Ãºltimo de la secuencia\r\n  const isVideoCompatible = useCallback((video) => {\r\n    if (sequence.length === 0) return true\r\n    const lastVideo = sequence[sequence.length - 1]\r\n    return checkCompatibility(lastVideo, video)\r\n  }, [sequence, checkCompatibility])\r\n\r\n  // FunciÃ³n para obtener videos compatibles (para filtrado)\r\n  const getCompatibleVideos = useCallback((allVideos) => {\r\n    if (sequence.length === 0) {\r\n      console.log('ðŸ“‹ Secuencia vacÃ­a, mostrando todos los videos')\r\n      return allVideos\r\n    }\r\n    \r\n    const lastVideo = sequence[sequence.length - 1]\r\n    console.log('ðŸŽ¯ Buscando videos compatibles con:', lastVideo.title)\r\n    \r\n    const compatibleVideos = allVideos.filter(video => {\r\n      const isCompatible = checkCompatibility(lastVideo, video)\r\n      console.log(`${video.title}: ${isCompatible ? 'âœ… Compatible' : 'âŒ Incompatible'}`)\r\n      return isCompatible\r\n    })\r\n    \r\n    console.log(`ðŸ“Š Videos compatibles encontrados: ${compatibleVideos.length}/${allVideos.length}`)\r\n    return compatibleVideos\r\n  }, [sequence, checkCompatibility])\r\n\r\n  // FunciÃ³n para filtrar videos segÃºn el estado actual\r\n  const getFilteredVideos = useCallback((allVideos) => {\r\n    if (showAllVideos) {\r\n      return allVideos\r\n    }\r\n    return getCompatibleVideos(allVideos)\r\n  }, [showAllVideos, getCompatibleVideos])\r\n\r\n  // FunciÃ³n para verificar si un video ya estÃ¡ en la secuencia (ahora siempre false para permitir repetidos)\r\n  const isVideoInSequence = useCallback((video) => {\r\n    // Comentado para permitir videos repetidos\r\n    // return sequence.some(seqVideo => seqVideo.id === video.id)\r\n    return false\r\n  }, [sequence])\r\n\r\n  const value = {\r\n    // Estados\r\n    sequence,\r\n    sequenceName,\r\n    sequenceDescription,\r\n    isBuilderOpen,\r\n    showAllVideos,\r\n    editingSequenceId, // Exponer el ID de la secuencia que se estÃ¡ editando\r\n    \r\n    // Setters\r\n    setSequenceName,\r\n    setSequenceDescription,\r\n    \r\n    // Funciones principales\r\n    addVideoToSequence,\r\n    removeVideoFromSequence,\r\n    reorderSequence,\r\n    generateRandomSequence,\r\n    clearSequence,\r\n    openBuilder,\r\n    closeBuilder,\r\n    toggleBuilder,\r\n    loadSequence,\r\n    toggleShowAllVideos,\r\n    \r\n    // Funciones de utilidad\r\n    checkCompatibility,\r\n    isVideoCompatible,\r\n    isVideoInSequence,\r\n    getCompatibleVideos,\r\n    getFilteredVideos\r\n  }\r\n\r\n  return (\r\n    <SequenceBuilderContext.Provider value={value}>\r\n      {children}\r\n    </SequenceBuilderContext.Provider>\r\n  )\r\n} ","// ðŸŽ´ CONTEXTO DE TAMAÃ‘OS DE CARDS - SALSAHACKS V2.0\r\n\r\nimport React, { createContext, useContext, useState } from 'react'\r\n\r\nconst CardSizeContext = createContext()\r\n\r\nexport const useCardSize = () => {\r\n  const context = useContext(CardSizeContext)\r\n  if (!context) {\r\n    throw new Error('useCardSize debe ser usado dentro de un CardSizeProvider')\r\n  }\r\n  return context\r\n}\r\n\r\nexport const CardSizeProvider = ({ children }) => {\r\n  // Estados para diferentes tipos de galerÃ­as\r\n  const [videoCardSize, setVideoCardSize] = useState('large') // small, medium, large, extra-large\r\n  const [sequenceCardSize, setSequenceCardSize] = useState('large') // small, medium, large, extra-large\r\n\r\n  // Configuraciones de tamaÃ±os para videos\r\n  const videoSizeConfig = {\r\n    small: {\r\n      grid: 'md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6',\r\n      aspect: 'aspect-square',\r\n      titleSize: 'text-xs',\r\n      descriptionLines: 1,\r\n      showStats: false,\r\n      showTags: true,\r\n      compact: true\r\n    },\r\n    medium: {\r\n      grid: 'md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5',\r\n      aspect: 'aspect-video',\r\n      titleSize: 'text-sm',\r\n      descriptionLines: 1,\r\n      showStats: false,\r\n      showTags: true,\r\n      compact: true\r\n    },\r\n    large: {\r\n      grid: 'md:grid-cols-2 lg:grid-cols-3',\r\n      aspect: 'aspect-video',\r\n      titleSize: 'text-xl',\r\n      descriptionLines: 3,\r\n      showStats: true,\r\n      showTags: true,\r\n      compact: false\r\n    },\r\n    'extra-large': {\r\n      grid: 'md:grid-cols-1 lg:grid-cols-2',\r\n      aspect: 'aspect-video',\r\n      titleSize: 'text-2xl',\r\n      descriptionLines: 4,\r\n      showStats: true,\r\n      showTags: true,\r\n      compact: false\r\n    }\r\n  }\r\n\r\n  // Configuraciones de tamaÃ±os para secuencias (igual que videos)\r\n  const sequenceSizeConfig = {\r\n    small: {\r\n      grid: 'md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6',\r\n      aspect: 'aspect-square',\r\n      titleSize: 'text-xs',\r\n      descriptionLines: 0, // Sin descripciÃ³n, solo iconos\r\n      showStats: true,\r\n      showTags: false,\r\n      showIcons: true, // Mostrar iconos en lugar de descripciÃ³n\r\n      compact: true\r\n    },\r\n    medium: {\r\n      grid: 'md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5',\r\n      aspect: 'aspect-video',\r\n      titleSize: 'text-sm',\r\n      descriptionLines: 0, // Sin descripciÃ³n, solo iconos\r\n      showStats: true,\r\n      showTags: false,\r\n      showIcons: true, // Mostrar iconos en lugar de descripciÃ³n\r\n      compact: true\r\n    },\r\n    large: {\r\n      grid: 'md:grid-cols-2 lg:grid-cols-3',\r\n      aspect: 'aspect-video',\r\n      titleSize: 'text-lg',\r\n      descriptionLines: 2,\r\n      showStats: true,\r\n      showTags: true,\r\n      showIcons: false, // En grande mostrar descripciÃ³n\r\n      compact: false\r\n    },\r\n    'extra-large': {\r\n      grid: 'md:grid-cols-1 lg:grid-cols-2',\r\n      aspect: 'aspect-video',\r\n      titleSize: 'text-xl',\r\n      descriptionLines: 3,\r\n      showStats: true,\r\n      showTags: true,\r\n      showIcons: false, // En extra grande mostrar descripciÃ³n\r\n      compact: false\r\n    }\r\n  }\r\n\r\n  const value = {\r\n    // Estados\r\n    videoCardSize,\r\n    sequenceCardSize,\r\n    \r\n    // Setters\r\n    setVideoCardSize,\r\n    setSequenceCardSize,\r\n    \r\n    // Configuraciones\r\n    videoSizeConfig,\r\n    sequenceSizeConfig,\r\n    \r\n    // Helpers\r\n    getVideoConfig: () => videoSizeConfig[videoCardSize],\r\n    getSequenceConfig: () => sequenceSizeConfig[sequenceCardSize],\r\n    \r\n    // TamaÃ±os disponibles\r\n    availableSizes: ['small', 'medium', 'large', 'extra-large'],\r\n    \r\n    // Labels para UI\r\n    sizeLabels: {\r\n      small: 'PequeÃ±o',\r\n      medium: 'Mediano', \r\n      large: 'Grande',\r\n      'extra-large': 'Extra Grande'\r\n    }\r\n  }\r\n\r\n  return (\r\n    <CardSizeContext.Provider value={value}>\r\n      {children}\r\n    </CardSizeContext.Provider>\r\n  )\r\n}\r\n\r\n","import { Link, useLocation } from 'react-router-dom'\r\nimport { useTheme } from '../../contexts/ThemeContext'\r\nimport { useAuth } from '../../contexts/AuthContext'\r\nimport { Music, Sun, Moon, User, Bell, Heart, Search, Shield } from 'lucide-react'\r\nimport { ROLE_LABELS, ROLE_COLORS } from '../../constants/roles'\r\n\r\nconst Navigation = () => {\r\n  const location = useLocation()\r\n  const { theme, changeTheme } = useTheme()\r\n  const { user, userProfile, isAuthenticated, logout, hasPermission, getUserUsername, getUserPhoto } = useAuth()\r\n\r\n  const navItems = [\r\n    { path: '/', label: 'Inicio' },\r\n    { path: '/figuras', label: 'Figuras' },\r\n    { path: '/escuela', label: 'Escuela' },\r\n    { path: '/eventos', label: 'Eventos' },\r\n    { path: '/categorias', label: 'CategorÃ­as' },\r\n    { path: '/notas', label: 'Notas' }\r\n  ]\r\n\r\n  // Agregar enlace de administraciÃ³n si el usuario tiene permisos\r\n  if (hasPermission('MANAGE_USERS')) {\r\n    navItems.push({ path: '/admin', label: 'Admin' })\r\n  }\r\n\r\n  const toggleTheme = () => {\r\n    const themes = ['light', 'dark', 'salsa']\r\n    const currentIndex = themes.indexOf(theme)\r\n    const nextIndex = (currentIndex + 1) % themes.length\r\n    changeTheme(themes[nextIndex])\r\n  }\r\n\r\n  return (\r\n    <nav className=\"bg-white shadow-lg border-b-2 border-salsa-primary\">\r\n      <div className=\"container mx-auto px-4\">\r\n        <div className=\"flex justify-between items-center h-16\">\r\n          {/* Logo */}\r\n          <Link to=\"/\" className=\"flex items-center space-x-2\">\r\n            <Music className=\"h-8 w-8 text-salsa-primary\" />\r\n            <span className=\"text-2xl font-bold text-salsa-primary\">SalsaHacks</span>\r\n          </Link>\r\n\r\n          {/* Navigation Links */}\r\n          <div className=\"hidden md:flex space-x-8\">\r\n            {navItems.map((item) => (\r\n              <Link\r\n                key={item.path}\r\n                to={item.path}\r\n                className={`px-3 py-2 rounded-md text-sm font-medium transition-colors ${\r\n                  location.pathname === item.path\r\n                    ? 'text-salsa-primary bg-salsa-light'\r\n                    : 'text-gray-700 hover:text-salsa-primary hover:bg-salsa-light'\r\n                }`}\r\n              >\r\n                {item.label}\r\n              </Link>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Right Side Icons */}\r\n          <div className=\"flex items-center space-x-4\">\r\n            {/* Search */}\r\n            <button className=\"p-2 text-gray-600 hover:text-salsa-primary transition-colors\">\r\n              <Search className=\"h-5 w-5\" />\r\n            </button>\r\n\r\n            {/* Theme Toggle */}\r\n            <button\r\n              onClick={toggleTheme}\r\n              className=\"p-2 text-gray-600 hover:text-salsa-primary transition-colors\"\r\n            >\r\n              {theme === 'dark' ? <Sun className=\"h-5 w-5\" /> : <Moon className=\"h-5 w-5\" />}\r\n            </button>\r\n\r\n            {/* Notifications */}\r\n            <button className=\"p-2 text-gray-600 hover:text-salsa-primary transition-colors relative\">\r\n              <Bell className=\"h-5 w-5\" />\r\n              <span className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center\">\r\n                3\r\n              </span>\r\n            </button>\r\n\r\n            {/* Favorites */}\r\n            <button className=\"p-2 text-gray-600 hover:text-salsa-primary transition-colors\">\r\n              <Heart className=\"h-5 w-5\" />\r\n            </button>\r\n\r\n            {/* User Profile */}\r\n            {isAuthenticated ? (\r\n              <div className=\"relative group\">\r\n                <button className=\"flex items-center space-x-3 p-2 text-gray-600 hover:text-salsa-primary transition-colors rounded-lg hover:bg-gray-100\">\r\n                  {/* Profile Photo */}\r\n                  <div className=\"w-8 h-8 bg-gradient-to-r from-pink-500 to-orange-500 rounded-full flex items-center justify-center\">\r\n                    {getUserPhoto() ? (\r\n                      <img \r\n                        src={getUserPhoto()} \r\n                        alt=\"Foto de perfil\" \r\n                        className=\"w-8 h-8 rounded-full object-cover\"\r\n                      />\r\n                    ) : (\r\n                      <User className=\"h-4 w-4 text-white\" />\r\n                    )}\r\n                  </div>\r\n                  \r\n                  {/* User Info */}\r\n                  <div className=\"flex flex-col items-start\">\r\n                    <span className=\"text-sm font-medium text-gray-700\">\r\n                      {getUserUsername()}\r\n                    </span>\r\n                    {userProfile?.role && (\r\n                      <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${ROLE_COLORS[userProfile.role] || 'bg-gray-500 text-white'}`}>\r\n                        <Shield className=\"h-3 w-3 mr-1\" />\r\n                        {ROLE_LABELS[userProfile.role] || userProfile.role}\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                </button>\r\n                \r\n                {/* Dropdown Menu */}\r\n                <div className=\"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50\">\r\n                  <div className=\"py-2\">\r\n                    {/* User Info in Dropdown */}\r\n                    <div className=\"px-4 py-3 border-b border-gray-100\">\r\n                      <div className=\"flex items-center space-x-3\">\r\n                        <div className=\"w-10 h-10 bg-gradient-to-r from-pink-500 to-orange-500 rounded-full flex items-center justify-center\">\r\n                          {getUserPhoto() ? (\r\n                            <img \r\n                              src={getUserPhoto()} \r\n                              alt=\"Foto de perfil\" \r\n                              className=\"w-10 h-10 rounded-full object-cover\"\r\n                            />\r\n                          ) : (\r\n                            <User className=\"h-5 w-5 text-white\" />\r\n                          )}\r\n                        </div>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <p className=\"text-sm font-medium text-gray-900 truncate\">\r\n                            {userProfile?.displayName || user?.displayName || 'Usuario'}\r\n                          </p>\r\n                          <p className=\"text-xs text-gray-500 truncate\">{getUserUsername()}</p>\r\n                          {userProfile?.role && (\r\n                            <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium mt-1 ${ROLE_COLORS[userProfile.role] || 'bg-gray-500 text-white'}`}>\r\n                              <Shield className=\"h-3 w-3 mr-1\" />\r\n                              {ROLE_LABELS[userProfile.role] || userProfile.role}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    <Link\r\n                      to=\"/profile\"\r\n                      className=\"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors\"\r\n                    >\r\n                      Mi Perfil\r\n                    </Link>\r\n                    <Link\r\n                      to=\"/settings\"\r\n                      className=\"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors\"\r\n                    >\r\n                      ConfiguraciÃ³n\r\n                    </Link>\r\n                    <button\r\n                      onClick={async () => {\r\n                        try {\r\n                          await logout()\r\n                        } catch (error) {\r\n                          console.error('Error al cerrar sesiÃ³n:', error)\r\n                        }\r\n                      }}\r\n                      className=\"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors\"\r\n                    >\r\n                      Cerrar SesiÃ³n\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <Link\r\n                to=\"/auth\"\r\n                className=\"px-4 py-2 bg-gradient-to-r from-pink-500 to-orange-500 text-white rounded-lg hover:from-pink-600 hover:to-orange-600 transition-all duration-200 font-medium\"\r\n              >\r\n                Iniciar SesiÃ³n\r\n              </Link>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </nav>\r\n  )\r\n}\r\n\r\nexport default Navigation ","import { BrowserRouter as Router, Routes, Route, useLocation } from 'react-router-dom'\r\nimport { Suspense, lazy } from 'react'\r\nimport { ThemeProvider } from './contexts/ThemeContext'\r\nimport { AuthProvider } from './contexts/AuthContext'\r\nimport { SequenceBuilderProvider } from './contexts/SequenceBuilderContext'\r\nimport { CardSizeProvider } from './contexts/CardSizeContext'\r\nimport Navigation from './components/layout/Navigation'\r\n\r\n// Lazy loading de pÃ¡ginas para Code Splitting\r\nconst HomePage = lazy(() => import('./pages/HomePage'))\r\nconst NotasPage = lazy(() => import('./pages/NotasPage'))\r\nconst CategoriesPage = lazy(() => import('./pages/CategoriesPage'))\r\nconst FigurasPage = lazy(() => import('./pages/FigurasPage'))\r\nconst EscuelaPage = lazy(() => import('./pages/EscuelaPage'))\r\nconst EventosPage = lazy(() => import('./pages/EventosPage'))\r\nconst AdminPage = lazy(() => import('./pages/AdminPage'))\r\nconst AuthPage = lazy(() => import('./pages/AuthPage'))\r\nconst ProfilePage = lazy(() => import('./pages/ProfilePage'))\r\nconst SettingsPage = lazy(() => import('./pages/SettingsPage'))\r\nconst InvitePage = lazy(() => import('./pages/InvitePage'))\r\n\r\n// Componente de carga\r\nconst LoadingSpinner = () => (\r\n  <div className=\"flex items-center justify-center min-h-[400px]\">\r\n    <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500\"></div>\r\n  </div>\r\n)\r\n\r\n// Componente wrapper para manejar el layout dinÃ¡mico\r\nfunction AppContent() {\r\n  const location = useLocation()\r\n  const isFigurasPage = location.pathname === '/figuras'\r\n  \r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-pink-50 via-salsa-light to-white\">\r\n      <Navigation />\r\n      <main className={isFigurasPage ? 'w-full' : 'container mx-auto px-4 py-8'}>\r\n        <Suspense fallback={<LoadingSpinner />}>\r\n          <Routes>\r\n            <Route path=\"/\" element={<HomePage />} />\r\n            <Route path=\"/auth\" element={<AuthPage />} />\r\n            <Route path=\"/invite/:invitationCode\" element={<InvitePage />} />\r\n            <Route path=\"/profile\" element={<ProfilePage />} />\r\n            <Route path=\"/settings\" element={<SettingsPage />} />\r\n            <Route path=\"/notas\" element={<NotasPage />} />\r\n            <Route path=\"/categorias\" element={<CategoriesPage />} />\r\n            <Route path=\"/figuras\" element={<FigurasPage />} />\r\n            <Route path=\"/escuela\" element={<EscuelaPage />} />\r\n            <Route path=\"/eventos\" element={<EventosPage />} />\r\n            <Route path=\"/admin\" element={<AdminPage />} />\r\n          </Routes>\r\n        </Suspense>\r\n      </main>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction App() {\r\n  return (\r\n    <ThemeProvider>\r\n      <AuthProvider>\r\n        <SequenceBuilderProvider>\r\n          <CardSizeProvider>\r\n            <Router>\r\n              <AppContent />\r\n            </Router>\r\n          </CardSizeProvider>\r\n        </SequenceBuilderProvider>\r\n      </AuthProvider>\r\n    </ThemeProvider>\r\n  )\r\n}\r\n\r\nexport default App ","import React from 'react'\r\nimport ReactDOM from 'react-dom/client'\r\nimport App from './App.jsx'\r\nimport './index.css'\r\n\r\nReactDOM.createRoot(document.getElementById('root')).render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n) "],"file":"assets/index-DOeBVGYV.js"}