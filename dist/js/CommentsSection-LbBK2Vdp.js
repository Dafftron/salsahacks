var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,n=(e,t)=>{for(var s in t||(t={}))a.call(t,s)&&l(e,s,t[s]);if(r)for(var s of r(t))i.call(t,s)&&l(e,s,t[s]);return e},o=(e,r)=>t(e,s(r)),c=(e,t,s)=>new Promise((r,a)=>{var i=e=>{try{n(s.next(e))}catch(t){a(t)}},l=e=>{try{n(s.throw(e))}catch(t){a(t)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,l);n((s=s.apply(e,t)).next())});import{u as d,w as u,j as m,x,y as p,z as f}from"../assets/index-BamraMjv.js";import{r as h}from"./vendor-react-SlK7pBj5.js";import{Heart as v,LucideTrash2 as y}from"./vendor-icons-BWQzNHDY.js";import"./vendor-router-UcgXoTZX.js";import"./vendor-firebase-CCu_Fqhx.js";const j=({comment:e,onToggleLike:t,onDelete:s,canDelete:r})=>{var a;const i=h.useMemo(()=>{var t;try{if(null==(t=null==e?void 0:e.createdAt)?void 0:t.toDate)return e.createdAt.toDate();if("string"==typeof(null==e?void 0:e.createdAt))return new Date(e.createdAt)}catch(s){}return null},[e]);return m.jsxs("div",{className:"flex space-x-3 p-3 bg-gray-50 rounded-lg",children:[m.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-r from-pink-500 to-orange-500 overflow-hidden flex items-center justify-center text-white text-xs",children:e.userPhotoURL?m.jsx("img",{src:e.userPhotoURL,alt:"avatar",className:"w-full h-full object-cover"}):null==(a=(e.userDisplayName||"U")[0])?void 0:a.toUpperCase()}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-sm font-medium text-gray-800 truncate",children:e.userDisplayName||"Usuario"}),i&&m.jsx("span",{className:"text-xs text-gray-500",children:i.toLocaleString()})]}),m.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap break-words mt-1",children:e.text}),m.jsxs("div",{className:"flex items-center space-x-3 mt-2 text-xs text-gray-500",children:[m.jsxs("button",{onClick:()=>t(e),className:`flex items-center space-x-1 ${e._userLiked?"text-pink-600":"text-gray-500"} hover:text-pink-600 transition-colors`,children:[m.jsx(v,{className:"h-4 w-4 "+(e._userLiked?"fill-pink-600":"")}),m.jsx("span",{children:e.likes||0})]}),r&&m.jsxs("button",{onClick:()=>s(e),className:"flex items-center space-x-1 text-gray-500 hover:text-red-600 transition-colors",children:[m.jsx(y,{className:"h-4 w-4"}),m.jsx("span",{children:"Eliminar"})]})]})]})]})},g=({videoId:e,page:t="figuras"})=>{const{user:s,userProfile:r}=d(),[a,i]=h.useState([]),[l,v]=h.useState(""),[y,g]=h.useState(!1);h.useEffect(()=>{if(!e)return;const r=u(e,t,e=>{const t=e.filter(e=>"deleted"!==e.status).map(e=>o(n({},e),{_userLiked:!!s&&(!!Array.isArray(e.likedBy)&&e.likedBy.includes(s.uid))}));i(t)});return()=>r&&r()},[e,t,s]);const b=500-l.length,N=!!s&&l.trim().length>0&&l.trim().length<=500,w=r=>c(void 0,null,function*(){if(!s)return;const a=yield f(e,t,r.id,s.uid);a.success&&i(e=>e.map(e=>e.id===r.id?o(n({},e),{likes:a.likes,_userLiked:a.userLiked}):e))}),k=r=>c(void 0,null,function*(){if(!s)return;(yield p(e,t,r.id,s.uid,!1)).success&&i(e=>e.filter(e=>e.id!==r.id))});return m.jsxs("div",{className:"mt-4",children:[m.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-2",children:"Comentarios"}),s?m.jsxs("form",{onSubmit:a=>c(void 0,null,function*(){var i,n;if(null==(i=null==a?void 0:a.preventDefault)||i.call(a),N&&!y){g(!0);try{const a={text:l.trim(),userId:s.uid,userDisplayName:(null==r?void 0:r.displayName)||(null==s?void 0:s.displayName)||(null==(n=null==s?void 0:s.email)?void 0:n.split("@")[0])||"Usuario",userPhotoURL:(null==r?void 0:r.photoURL)||(null==s?void 0:s.photoURL)||null};(yield x(e,t,a)).success&&v("")}finally{g(!1)}}}),className:"mb-3",children:[m.jsx("textarea",{value:l,onChange:e=>v(e.target.value.slice(0,500)),rows:2,placeholder:"Escribe un comentario...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm"}),m.jsxs("div",{className:"flex items-center justify-between mt-1",children:[m.jsxs("span",{className:"text-xs "+(b<0?"text-red-500":"text-gray-500"),children:[b," caracteres"]}),m.jsx("button",{type:"submit",disabled:!N||y,className:"px-3 py-1.5 bg-gradient-to-r from-pink-500 to-orange-500 text-white rounded-md text-sm font-medium disabled:opacity-50",children:y?"Publicando...":"Publicar"})]})]}):m.jsx("div",{className:"text-xs text-gray-500 mb-3",children:"Inicia sesión para comentar"}),m.jsx("div",{className:"space-y-2 max-h-56 overflow-y-auto pr-1",children:0===a.length?m.jsx("div",{className:"text-xs text-gray-500",children:"Sé el primero en comentar"}):a.map(e=>m.jsx(j,{comment:e,onToggleLike:w,onDelete:k,canDelete:!!s&&e.userId===s.uid},e.id))})]})};export{g as default};
