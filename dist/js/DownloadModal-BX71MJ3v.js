const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-_E1YfA--.js","js/vendor-react-SlK7pBj5.js","js/vendor-router-UcgXoTZX.js","js/vendor-firebase-DVYjp8kH.js","js/vendor-icons-BWQzNHDY.js","css/index-BkEfCEWI.css","js/videoProcessor-CSZqPoXA.js","js/vendor-ffmpeg-BflpXDox.js"])))=>i.map(i=>d[i]);
var e=(e,s,a)=>new Promise((t,r)=>{var l=e=>{try{i(a.next(e))}catch(s){r(s)}},o=e=>{try{i(a.throw(e))}catch(s){r(s)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(l,o);i((a=a.apply(e,s)).next())});import{_ as s,j as a}from"../assets/index-_E1YfA--.js";import{r as t}from"./vendor-react-SlK7pBj5.js";import r from"./videoCombiner-DtVyKRCm.js";import{LucideZap as l,LucideX as o,Loader as i,AlertCircle as n,Check as d,Archive as c,Download as m}from"./vendor-icons-BWQzNHDY.js";import"./vendor-router-UcgXoTZX.js";import"./vendor-firebase-DVYjp8kH.js";const u=({isOpen:u,onClose:x,video:p,onDownloadComplete:g})=>{const[h,v]=t.useState("mp4"),[b,f]=t.useState("4k"),[j,y]=t.useState(!1),[N,w]=t.useState(null),[D,_]=t.useState(null),[C,P]=t.useState(null),[k,E]=t.useState("4k"),[L,R]=t.useState(!1),S=new r;t.useEffect(()=>{u&&(w(null),_(null),P(null),y(!1),R(!0),U())},[u,p]);const U=()=>e(void 0,null,function*(){try{R(!0);let e="720p";if((null==p?void 0:p.videos)&&Array.isArray(p.videos)){const s=yield Promise.all(p.videos.map(e=>A(e)));e=I(s)}else p&&(e=yield A(p));E(e),$(b)>$(e)&&f(e)}catch(e){E("720p")}finally{R(!1)}}),A=a=>e(void 0,null,function*(){try{const{ref:t,getDownloadURL:r}=yield s(()=>e(void 0,null,function*(){const{ref:e,getDownloadURL:s}=yield import("./vendor-firebase-DVYjp8kH.js").then(e=>e.J);return{ref:e,getDownloadURL:s}}),[]),{storage:l}=yield s(()=>e(void 0,null,function*(){const{storage:e}=yield import("../assets/index-_E1YfA--.js").then(e=>e.N);return{storage:e}}),__vite__mapDeps([0,1,2,3,4,5])),o=t(l,a.videoPath),i=yield r(o);return new Promise(e=>{const s=document.createElement("video");s.onloadedmetadata=()=>{const a=s.videoWidth,t=s.videoHeight;let r="720p";r=a>=3840&&t>=2160?"4k":a>=1920&&t>=1080?"1080p":a>=1280&&t>=720?"720p":"480p",e(r)},s.onerror=()=>e("720p"),s.src=i})}catch(t){return"720p"}}),I=e=>{const s=e.map(e=>$(e)),a=Math.max(...s);return a>=$("4k")?"4k":a>=$("1080p")?"1080p":a>=$("720p")?"720p":"480p"},$=e=>{switch(e){case"4k":return 4;case"1080p":return 3;case"720p":default:return 2;case"480p":return 1}},O=[{value:"4k",label:"4K UHD",description:"MÃ¡xima calidad (3840x2160)",disabled:$("4k")>$(k)},{value:"1080p",label:"Full HD",description:"Alta calidad (1920x1080)",disabled:$("1080p")>$(k)},{value:"720p",label:"HD",description:"Calidad estÃ¡ndar (1280x720)",disabled:$("720p")>$(k)},{value:"480p",label:"SD",description:"Calidad bÃ¡sica (854x480)",disabled:$("480p")>$(k)}],T=(a,t)=>e(void 0,null,function*(){try{t&&t({stage:"download",current:50,total:100,message:"Descargando video con mÃ¡xima calidad..."});const{ref:r,getDownloadURL:l}=yield s(()=>e(void 0,null,function*(){const{ref:e,getDownloadURL:s}=yield import("./vendor-firebase-DVYjp8kH.js").then(e=>e.J);return{ref:e,getDownloadURL:s}}),[]),{storage:o}=yield s(()=>e(void 0,null,function*(){const{storage:e}=yield import("../assets/index-_E1YfA--.js").then(e=>e.N);return{storage:e}}),__vite__mapDeps([0,1,2,3,4,5])),i=r(o,a.videoPath),n=yield l(i),d=yield fetch(n);if(!d.ok)throw new Error(`Error HTTP: ${d.status} ${d.statusText}`);const c=yield d.blob();return t&&t({stage:"complete",current:100,total:100,message:"Video descargado con mÃ¡xima calidad"}),c}catch(r){throw new Error(`Error descargando video: ${r.message}`)}});if(!u)return null;const V=(()=>{switch(b){case"4k":return{width:3840,height:2160,fps:60};case"1080p":return{width:1920,height:1080,fps:60};case"720p":default:return{width:1280,height:720,fps:30};case"480p":return{width:854,height:480,fps:30}}})();return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(l,{className:"h-5 w-5 text-yellow-500"}),a.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:(null==p?void 0:p.videos)?"Descargar Secuencia":"Descargar Video"})]}),a.jsx("button",{onClick:x,className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:j,children:a.jsx(o,{className:"h-5 w-5"})})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 border border-blue-200",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx(l,{className:"h-4 w-4 text-yellow-500"}),a.jsx("span",{className:"text-sm font-semibold text-blue-800",children:"CALIDAD INTELIGENTE"})]}),a.jsxs("p",{className:"text-sm text-gray-700",children:[a.jsxs("strong",{children:[(null==p?void 0:p.videos)?p.videos.length:1," video",(null==p?void 0:p.videos)?"s":""]}),(null==p?void 0:p.videos)?" serÃ¡n combinados en uno solo":" serÃ¡ descargado"]}),(null==p?void 0:p.videos)&&a.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["DuraciÃ³n total: ",p.videos.reduce((e,s)=>e+(s.duration||0),0).toFixed(1),"s"]}),a.jsxs("div",{className:"mt-2 space-y-1",children:[a.jsxs("p",{className:"text-xs text-blue-600",children:["ðŸŽ¬ ResoluciÃ³n mÃ¡xima disponible: ",k.toUpperCase()]}),a.jsxs("p",{className:"text-xs text-blue-600",children:["ðŸŽ¯ FPS: ",V.fps," frames por segundo"]}),a.jsx("p",{className:"text-xs text-blue-600",children:"ðŸ“¹ Codec: H.264 (mÃ¡xima compatibilidad)"}),a.jsx("p",{className:"text-xs text-blue-600",children:"ðŸ’¾ Formato: MP4 (compatible con Windows)"}),a.jsx("p",{className:"text-xs text-green-600 font-semibold",children:"âœ… Soporte completo de seeking (navegaciÃ³n)"}),a.jsx("p",{className:"text-xs text-green-600 font-semibold",children:"âœ… Deslizador funcional en reproductor de Windows"})]})]}),!L&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"ResoluciÃ³n de Descarga"}),a.jsx("div",{className:"grid grid-cols-2 gap-2",children:O.map(e=>a.jsxs("button",{onClick:()=>!e.disabled&&f(e.value),className:"p-3 rounded-lg border-2 text-left transition-all "+(b===e.value?"border-blue-500 bg-blue-50 text-blue-700":e.disabled?"border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed":"border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-gray-50"),disabled:e.disabled,children:[a.jsx("div",{className:"font-medium text-sm",children:e.label}),a.jsx("div",{className:"text-xs opacity-75",children:e.description}),e.disabled&&a.jsx("div",{className:"text-xs text-red-500 mt-1",children:"No disponible"})]},e.value))})]}),L&&a.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[a.jsx(i,{className:"h-4 w-4 animate-spin"}),a.jsx("span",{className:"text-sm",children:"Analizando resoluciÃ³n mÃ¡xima disponible..."})]}),N&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[D?a.jsx(n,{className:"h-5 w-5"}):"complete"===(null==N?void 0:N.stage)?a.jsx(d,{className:"h-5 w-5"}):a.jsx(i,{className:"h-5 w-5 animate-spin"}),a.jsx("span",{className:"text-sm font-medium "+(D?"text-red-500":"complete"===(null==N?void 0:N.stage)?"text-green-500":"text-blue-500"),children:N.message})]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:"h-2 rounded-full transition-all duration-300 "+(D?"bg-red-500":"complete"===(null==N?void 0:N.stage)?"bg-green-500":"bg-blue-500"),style:{width:`${N.current}%`}})}),a.jsx("p",{className:"text-xs text-gray-500",children:(()=>{switch(null==N?void 0:N.stage){case"init":return"Inicializando sistema de alta calidad...";case"download":return"Descargando videos con mÃ¡xima calidad...";case"ffmpeg":return"Combinando videos con seeking especÃ­fico para Windows...";case"combine":return"Combinando videos con 4K y 60 FPS...";case"convert":return"Convirtiendo a MP4 con mÃ¡xima calidad...";case"complete":return"Â¡Proceso completado con seeking funcional!";default:return"Preparando..."}})()})]}),D&&a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(n,{className:"h-5 w-5 text-red-500"}),a.jsx("span",{className:"text-sm text-red-700",children:D})]})}),C&&a.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(d,{className:"h-5 w-5 text-green-500"}),a.jsxs("span",{className:"text-sm text-green-700",children:["Â¡",(null==p?void 0:p.videos)?"Secuencia":"Video"," listo para descargar en ",b.toUpperCase(),"!"]})]}),a.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Archivo MP4 compatible con reproductor de Windows"})]})]}),a.jsxs("div",{className:"flex space-x-3 mt-6",children:[!j&&!C&&!L&&a.jsxs("button",{onClick:()=>e(void 0,null,function*(){if(p){y(!0),_(null),w({stage:"init",current:0,total:100,message:"Iniciando descarga con mÃ¡xima calidad..."});try{let e;e=p.videos&&Array.isArray(p.videos)?yield S.combineVideos(p.videos,w,b):yield T(p,w);const s=URL.createObjectURL(e);P(s),w({stage:"complete",current:100,total:100,message:"Â¡Descarga completada con mÃ¡xima calidad!"})}catch(e){_(`Error en descarga: ${e.message}`),w(null)}finally{y(!1)}}else _("No hay video para descargar")}),className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-4 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-200 flex items-center justify-center space-x-2 font-semibold",children:[a.jsx(l,{className:"h-4 w-4"}),a.jsx("span",{children:(null==p?void 0:p.videos)?"Combinar y Descargar":"Descargar Video"})]}),!j&&!L&&(null==p?void 0:p.videos)&&a.jsxs("button",{onClick:()=>e(void 0,null,function*(){try{if(!(null==p?void 0:p.videos)||!Array.isArray(p.videos)||0===p.videos.length)return void _("No hay videos para empaquetar");y(!0),_(null),w({stage:"download",current:30,total:100,message:"Preparando ZIP de videos fuente..."});const{downloadSequenceDirect:a}=yield s(()=>e(void 0,null,function*(){const{downloadSequenceDirect:e}=yield import("./videoProcessor-CSZqPoXA.js");return{downloadSequenceDirect:e}}),__vite__mapDeps([6,0,1,2,3,4,5,7])),t=yield a({name:p.title||"secuencia",videos:p.videos});if(!t.success)throw new Error(t.error||"No se pudo generar el ZIP");const r=URL.createObjectURL(t.data),l=(p.title||"secuencia").replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s+/g,"_").toLowerCase(),o=document.createElement("a");o.href=r,o.download=`${l}.zip`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r),w({stage:"complete",current:100,total:100,message:"ZIP generado con videos fuente"})}catch(a){_(`Error generando ZIP: ${a.message}`),w(null)}finally{y(!1)}}),className:"flex-1 bg-white border border-gray-300 text-gray-800 py-3 px-4 rounded-lg hover:bg-gray-50 transition-all duration-200 flex items-center justify-center space-x-2 font-semibold",children:[a.jsx(c,{className:"h-4 w-4"}),a.jsx("span",{children:"Descargar ZIP (videos separados)"})]}),C&&a.jsxs("button",{onClick:()=>{if(C){const e=document.createElement("a");e.href=C;const s="mp4"===h?"mp4":"webm",a="4k"===b?"_4K":"1080p"===b?"_FHD":"720p"===b?"_HD":"_SD",t=(null==p?void 0:p.videos)?`${p.title||"secuencia"}${a}.${s}`:`${p.title||"video"}${a}.${s}`;e.download=t,document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(C),P(null),g&&g(),x()}},className:"flex-1 bg-gradient-to-r from-green-600 to-teal-600 text-white py-3 px-4 rounded-lg hover:from-green-700 hover:to-teal-700 transition-all duration-200 flex items-center justify-center space-x-2 font-semibold",children:[a.jsx(m,{className:"h-4 w-4"}),a.jsxs("span",{children:["Descargar MP4 (",b.toUpperCase(),")"]})]}),a.jsx("button",{onClick:x,className:"px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",disabled:j||L,children:C?"Cerrar":"Cancelar"})]})]})})};export{u as default};
