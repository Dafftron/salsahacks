var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,n=(e,s)=>{for(var t in s||(s={}))r.call(s,t)&&l(e,t,s[t]);if(a)for(var t of a(s))i.call(s,t)&&l(e,t,s[t]);return e},o=(e,a)=>s(e,t(a)),d=(e,s,t)=>new Promise((a,r)=>{var i=e=>{try{n(t.next(e))}catch(s){r(s)}},l=e=>{try{n(t.throw(e))}catch(s){r(s)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,l);n((t=t.apply(e,s)).next())});import{u as c,j as u,d as m}from"../assets/index-CMWpliaN.js";import{r as x}from"./vendor-react-4yEUTM44.js";import{b as h}from"./index-CAUbUmAb.js";import{u as g}from"./CompactCardActions-BQ-wwN8o.js";import p from"./Toast-DZT-Y2Eq.js";import f from"./VideoPlayer-grxpbV8P.js";import{Edit as y,LucideX as b,LucideTag as v,ChevronDown as j,ChevronUp as N,AlertCircle as w}from"./vendor-icons-DyUK-N1U.js";import"./vendor-router-Bt5THCHr.js";import"./vendor-firebase-DVYjp8kH.js";const k=({isOpen:e,onClose:s,video:t,onVideoUpdated:a,page:r="figuras",style:i="salsa"})=>{const{user:l}=c(),{currentCategories:k,categoriesList:C}=g(r,i),[S,T]=x.useState(!1),[O,U]=x.useState([]),[E,P]=x.useState(""),[z,I]=x.useState(""),[$,D]=x.useState(null),[F,H]=x.useState(null),[W,L]=x.useState({}),[V,R]=x.useState({}),[A,G]=x.useState({}),[M,B]=x.useState(new Set(["tags-iniciales","tags-finales"]));x.useEffect(()=>{if(e&&t&&(P(t.title||""),I(t.description||""),D(t.thumbnailUrl||null),H(null),k)){const e={},s={},a={};Object.keys(k).forEach(r=>{var i,l,n;e[r]=(null==(i=t.tags)?void 0:i[r])||[],s[r]=(null==(l=t.tagsIniciales)?void 0:l[r])||[],a[r]=(null==(n=t.tagsFinales)?void 0:n[r])||[]}),L(e),R(s),G(a)}},[e,t,k]),x.useEffect(()=>{e||(P(""),I(""),D(null),H(null),L({}),R({}),G({}))},[e]);const K=(e,s="success")=>{const t=Date.now();U(a=>[...a,{id:t,message:e,type:s}])},X=e=>{B(s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})};return e&&t?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:u.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[u.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx("div",{className:"p-2 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full",children:u.jsx(y,{className:"h-6 w-6 text-white"})}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Editar Video"}),u.jsx("p",{className:"text-sm text-gray-500",children:t.title})]})]}),u.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",children:u.jsx(b,{className:"h-6 w-6"})})]}),u.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"space-y-4",children:[u.jsx("h4",{className:"font-medium text-gray-900",children:"Vista previa del video"}),u.jsx("div",{className:"flex justify-center",children:u.jsx(f,{src:t.videoUrl,size:"medium",loop:!0,showControls:!0,autoplay:!1,muted:!1,className:"w-full max-w-2xl",resolutions:["auto","4k","1080p","720p","480p","360p"],currentResolution:"auto",videoTitle:t.title||"video",onResolutionChange:e=>{}})}),u.jsx("div",{className:"flex items-center justify-between text-sm text-gray-600",children:u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("span",{children:t.originalTitle}),u.jsx("span",{className:"text-gray-400",children:"•"}),u.jsxs("span",{children:[(t.fileSize/1048576).toFixed(2)," MB"]}),t.resolution&&"Unknown"!==t.resolution&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"text-gray-400",children:"•"}),u.jsx("span",{children:t.resolution})]})]})})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Título del video"}),u.jsx("input",{type:"text",value:E,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-500",placeholder:"Ingresa un título para el video"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Descripción"}),u.jsx("textarea",{value:z,onChange:e=>I(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 placeholder-gray-500",placeholder:"Describe brevemente el contenido del video..."})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Thumbnail personalizado"}),u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx("div",{className:"w-40 h-24 bg-gray-100 rounded border-2 border-dashed border-gray-300 flex items-center justify-center",children:$?u.jsx("img",{src:$,alt:"Thumbnail",className:"w-full h-full object-cover rounded"}):u.jsx("span",{className:"text-xs text-gray-500",children:"IMG"})}),u.jsx("input",{type:"file",accept:"image/*",onChange:e=>{const s=e.target.files[0];if(s){const e=new FileReader;e.onload=e=>{D(e.target.result),H(s)},e.readAsDataURL(s)}},className:"flex-1 text-sm text-gray-500 file:mr-4 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsx("h4",{className:"font-medium text-gray-900",children:"Tags Normales"}),C.map(e=>u.jsxs("div",{className:"space-y-3",children:[u.jsx("h5",{className:"font-medium text-gray-700 capitalize",children:e.name}),u.jsx("div",{className:"flex flex-wrap gap-2",children:e.tags.map(s=>{var t;return u.jsx("button",{onClick:()=>((e,s)=>{L(t=>{const a=t[e]||[];if(a.includes(s))return o(n({},t),{[e]:a.filter(e=>e!==s)});{const r=[...new Set([...a,s])];return o(n({},t),{[e]:r})}})})(e.key,s),className:"px-3 py-1 rounded-full text-sm font-medium transition-all duration-200 "+((null==(t=W[e.key])?void 0:t.includes(s))?"bg-gradient-to-r from-pink-500 to-orange-500 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:s},s)})})]},e.key))]}),"figuras"===r&&u.jsxs("div",{className:"border-t pt-6",children:[u.jsxs("button",{onClick:()=>X("tags-iniciales"),className:"flex items-center justify-between w-full p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg hover:from-blue-100 hover:to-purple-100 transition-all duration-200",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(v,{className:"h-5 w-5 text-blue-600"}),u.jsx("h4",{className:"font-medium text-gray-900",children:"Tags Iniciales (cómo empieza la figura)"})]}),M.has("tags-iniciales")?u.jsx(j,{className:"h-5 w-5 text-gray-500"}):u.jsx(N,{className:"h-5 w-5 text-gray-500"})]}),u.jsx("div",{className:"mt-4 transition-all duration-300 ease-in-out overflow-hidden "+(M.has("tags-iniciales")?"max-h-0 opacity-0":"max-h-96 opacity-100"),children:u.jsx("div",{className:"space-y-4 bg-blue-50 rounded-lg p-4",children:C.map(e=>u.jsxs("div",{className:"space-y-2",children:[u.jsx("h6",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:e.name}),u.jsx("div",{className:"flex flex-wrap gap-2",children:e.tags.map(s=>{var t;return u.jsx("button",{onClick:()=>((e,s)=>{R(t=>{const a=t[e]||[];if(a.includes(s))return o(n({},t),{[e]:a.filter(e=>e!==s)});{const r=[...new Set([...a,s])];return o(n({},t),{[e]:r})}})})(e.key,s),className:"px-2 py-1 rounded-full text-xs font-medium transition-all duration-200 "+((null==(t=V[e.key])?void 0:t.includes(s))?"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg":"bg-white text-gray-700 hover:bg-blue-100"),children:s},`inicial-${s}`)})})]},`inicial-${e.key}`))})})]}),"figuras"===r&&u.jsxs("div",{className:"border-t pt-6",children:[u.jsxs("button",{onClick:()=>X("tags-finales"),className:"flex items-center justify-between w-full p-4 bg-gradient-to-r from-green-50 to-teal-50 rounded-lg hover:from-green-100 hover:to-teal-100 transition-all duration-200",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(v,{className:"h-5 w-5 text-green-600"}),u.jsx("h4",{className:"font-medium text-gray-900",children:"Tags Finales (cómo termina la figura)"})]}),M.has("tags-finales")?u.jsx(j,{className:"h-5 w-5 text-gray-500"}):u.jsx(N,{className:"h-5 w-5 text-gray-500"})]}),u.jsx("div",{className:"mt-4 transition-all duration-300 ease-in-out overflow-hidden "+(M.has("tags-finales")?"max-h-0 opacity-0":"max-h-96 opacity-100"),children:u.jsx("div",{className:"space-y-4 bg-green-50 rounded-lg p-4",children:C.map(e=>u.jsxs("div",{className:"space-y-2",children:[u.jsx("h6",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:e.name}),u.jsx("div",{className:"flex flex-wrap gap-2",children:e.tags.map(s=>{var t;return u.jsx("button",{onClick:()=>((e,s)=>{G(t=>{const a=t[e]||[];if(a.includes(s))return o(n({},t),{[e]:a.filter(e=>e!==s)});{const r=[...new Set([...a,s])];return o(n({},t),{[e]:r})}})})(e.key,s),className:"px-2 py-1 rounded-full text-xs font-medium transition-all duration-200 "+((null==(t=A[e.key])?void 0:t.includes(s))?"bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-lg":"bg-white text-gray-700 hover:bg-green-100"),children:s},`final-${s}`)})})]},`final-${e.key}`))})})]}),"figuras"===r&&u.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:u.jsxs("div",{className:"flex items-start space-x-2",children:[u.jsx(w,{className:"h-5 w-5 text-blue-500 mt-0.5"}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm text-blue-800 font-medium",children:"Información"}),u.jsx("p",{className:"text-sm text-blue-700",children:"Los tags iniciales y finales ayudarán a crear secuencias lógicas conectando figuras."})]})]})})]})}),u.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200",children:[u.jsx("button",{onClick:s,disabled:S,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),u.jsx("button",{onClick:()=>d(void 0,null,function*(){if(t){T(!0);try{let c=t.thumbnailUrl,u=t.thumbnailPath;if(F){const e=`thumbnails/${Date.now()}_${t.originalTitle.replace(/\.[^/.]+$/,".jpg")}`,s=yield h(F,e);if(!s.success)return K("Error al subir el nuevo thumbnail","error"),void T(!1);c=s.url,u=s.path}const x=o(n({},W),{estilo:W.estilo||[]});let g=t.resolution,p=t.videoWidth,f=t.videoHeight;if(!g||"Unknown"===g)try{const s=yield(e=t.videoUrl,d(void 0,null,function*(){try{const s=document.createElement("video");s.src=e,yield new Promise((e,t)=>{s.onloadedmetadata=()=>{const t=s.videoWidth,a=s.videoHeight,r=Math.max(t,a);let i="Unknown";i=r>=3840?"4K":r>=1920?"1080p":r>=1280?"720p":r>=854?"480p":"360p",e({resolution:i,videoWidth:t,videoHeight:a})},s.onerror=t,setTimeout(()=>t(new Error("Timeout")),1e4)})}catch(s){return{resolution:"Unknown",videoWidth:null,videoHeight:null}}}));g=s.resolution,p=s.videoWidth,f=s.videoHeight}catch(i){g="Unknown"}const y={title:E.trim(),description:z.trim(),thumbnailUrl:c,thumbnailPath:u,resolution:g,videoWidth:p,videoHeight:f,tags:x,tagsIniciales:V,tagsFinales:A,updatedBy:(null==l?void 0:l.uid)||"anonymous",updatedAt:(new Date).toISOString()},b=yield m(t.id,y,r);b.success?(K("Video actualizado exitosamente","success"),a(n(n({},t),y)),s()):K(`Error al actualizar video: ${b.error}`,"error")}catch(i){K("Error inesperado al actualizar video","error")}var e;T(!1)}}),disabled:S||!E.trim(),className:"px-6 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg font-medium hover:shadow-lg transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:S?"Guardando...":"Guardar Cambios"})]})]})}),O.map(e=>u.jsx(p,{message:e.message,type:e.type,onClose:()=>{return s=e.id,void U(e=>e.filter(e=>e.id!==s));var s}},e.id))]}):null};export{k as default};
