var e,t,a,s,i,r,o,l,n,h=Object.defineProperty,d=Object.getOwnPropertySymbols,E=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,p=e=>{throw TypeError(e)},R=(e,t,a)=>((e,t,a)=>t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a)(e,"symbol"!=typeof t?t+"":t,a),f=(e,t,a)=>t.has(e)||p("Cannot "+a),y=(e,t,a)=>(f(e,t,"read from private field"),a?a.call(e):t.get(e)),O=(e,t,a)=>t.has(e)?p("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,a),u=(e,t,a,s)=>(f(e,t,"write to private field"),s?s.call(e,a):t.set(e,a),a),L=(e,t,a)=>new Promise((s,i)=>{var r=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,o);l((a=a.apply(e,t)).next())});(n=l||(l={})).LOAD="LOAD",n.EXEC="EXEC",n.FFPROBE="FFPROBE",n.WRITE_FILE="WRITE_FILE",n.READ_FILE="READ_FILE",n.DELETE_FILE="DELETE_FILE",n.RENAME="RENAME",n.CREATE_DIR="CREATE_DIR",n.LIST_DIR="LIST_DIR",n.DELETE_DIR="DELETE_DIR",n.ERROR="ERROR",n.DOWNLOAD="DOWNLOAD",n.PROGRESS="PROGRESS",n.LOG="LOG",n.MOUNT="MOUNT",n.UNMOUNT="UNMOUNT";const D=(()=>{let e=0;return()=>e++})(),F=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),g=new Error("called FFmpeg.terminate()");var b,m;e=new WeakMap,t=new WeakMap,a=new WeakMap,s=new WeakMap,i=new WeakMap,r=new WeakMap,o=new WeakMap,(m=b||(b={})).MEMFS="MEMFS",m.NODEFS="NODEFS",m.NODERAWFS="NODERAWFS",m.IDBFS="IDBFS",m.WORKERFS="WORKERFS",m.PROXYFS="PROXYFS";const w=Object.freeze(Object.defineProperty({__proto__:null,get FFFSType(){return b},FFmpeg:class{constructor(){O(this,e,null),O(this,t,{}),O(this,a,{}),O(this,s,[]),O(this,i,[]),R(this,"loaded",!1),O(this,r,()=>{y(this,e)&&(y(this,e).onmessage=({data:{id:e,type:r,data:o}})=>{switch(r){case l.LOAD:this.loaded=!0,y(this,t)[e](o);break;case l.MOUNT:case l.UNMOUNT:case l.EXEC:case l.FFPROBE:case l.WRITE_FILE:case l.READ_FILE:case l.DELETE_FILE:case l.RENAME:case l.CREATE_DIR:case l.LIST_DIR:case l.DELETE_DIR:y(this,t)[e](o);break;case l.LOG:y(this,s).forEach(e=>e(o));break;case l.PROGRESS:y(this,i).forEach(e=>e(o));break;case l.ERROR:y(this,a)[e](o)}delete y(this,t)[e],delete y(this,a)[e]})}),O(this,o,({type:s,data:i},r=[],o)=>y(this,e)?new Promise((l,n)=>{const h=D();y(this,e)&&y(this,e).postMessage({id:h,type:s,data:i},r),y(this,t)[h]=l,y(this,a)[h]=n,null==o||o.addEventListener("abort",()=>{n(new DOMException(`Message # ${h} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(F)),R(this,"load",(t={},{signal:a}={})=>{var s=t,{classWorkerURL:i}=s,n=((e,t)=>{var a={};for(var s in e)E.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&d)for(var s of d(e))t.indexOf(s)<0&&c.call(e,s)&&(a[s]=e[s]);return a})(s,["classWorkerURL"]);return y(this,e)||(u(this,e,i?new Worker(new URL(i,import.meta.url),{type:"module"}):new Worker(new URL("/assets/worker-Caon4OSn.js",import.meta.url),{type:"module"})),y(this,r).call(this)),y(this,o).call(this,{type:l.LOAD,data:n},void 0,a)}),R(this,"exec",(e,t=-1,{signal:a}={})=>y(this,o).call(this,{type:l.EXEC,data:{args:e,timeout:t}},void 0,a)),R(this,"ffprobe",(e,t=-1,{signal:a}={})=>y(this,o).call(this,{type:l.FFPROBE,data:{args:e,timeout:t}},void 0,a)),R(this,"terminate",()=>{const s=Object.keys(y(this,a));for(const e of s)y(this,a)[e](g),delete y(this,a)[e],delete y(this,t)[e];y(this,e)&&(y(this,e).terminate(),u(this,e,null),this.loaded=!1)}),R(this,"writeFile",(e,t,{signal:a}={})=>{const s=[];return t instanceof Uint8Array&&s.push(t.buffer),y(this,o).call(this,{type:l.WRITE_FILE,data:{path:e,data:t}},s,a)}),R(this,"mount",(e,t,a)=>y(this,o).call(this,{type:l.MOUNT,data:{fsType:e,options:t,mountPoint:a}},[])),R(this,"unmount",e=>y(this,o).call(this,{type:l.UNMOUNT,data:{mountPoint:e}},[])),R(this,"readFile",(e,t="binary",{signal:a}={})=>y(this,o).call(this,{type:l.READ_FILE,data:{path:e,encoding:t}},void 0,a)),R(this,"deleteFile",(e,{signal:t}={})=>y(this,o).call(this,{type:l.DELETE_FILE,data:{path:e}},void 0,t)),R(this,"rename",(e,t,{signal:a}={})=>y(this,o).call(this,{type:l.RENAME,data:{oldPath:e,newPath:t}},void 0,a)),R(this,"createDir",(e,{signal:t}={})=>y(this,o).call(this,{type:l.CREATE_DIR,data:{path:e}},void 0,t)),R(this,"listDir",(e,{signal:t}={})=>y(this,o).call(this,{type:l.LIST_DIR,data:{path:e}},void 0,t)),R(this,"deleteDir",(e,{signal:t}={})=>y(this,o).call(this,{type:l.DELETE_DIR,data:{path:e}},void 0,t))}on(e,t){"log"===e?y(this,s).push(t):"progress"===e&&y(this,i).push(t)}off(e,t){"log"===e?u(this,s,y(this,s).filter(e=>e!==t)):"progress"===e&&u(this,i,y(this,i).filter(e=>e!==t))}}},Symbol.toStringTag,{value:"Module"})),I=new Error("failed to get response body reader"),v=new Error("failed to complete download"),T=(e,t)=>L(void 0,null,function*(){var a;const s=yield fetch(e);let i;try{const r=parseInt(s.headers.get("Content-Length")||"-1"),o=null==(a=s.body)?void 0:a.getReader();if(!o)throw I;const l=[];let n=0;for(;;){const{done:a,value:s}=yield o.read(),i=s?s.length:0;if(a){if(-1!=r&&r!==n)throw v;t&&t({url:e,total:r,received:n,delta:i,done:a});break}l.push(s),n+=i,t&&t({url:e,total:r,received:n,delta:i,done:a})}const h=new Uint8Array(n);let d=0;for(const e of l)h.set(e,d),d+=e.length;i=h.buffer}catch(r){i=yield s.arrayBuffer(),t&&t({url:e,total:i.byteLength,received:i.byteLength,delta:0,done:!0})}return i}),_=Object.freeze(Object.defineProperty({__proto__:null,downloadWithProgress:T,toBlobURL:(e,t,a=!1,s)=>L(void 0,null,function*(){const i=a?yield T(e,s):yield(yield fetch(e)).arrayBuffer(),r=new Blob([i],{type:t});return URL.createObjectURL(r)})},Symbol.toStringTag,{value:"Module"}));export{_ as a,w as i};
