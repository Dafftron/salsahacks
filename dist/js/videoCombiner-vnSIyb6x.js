const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B4szqNP8.js","js/vendor-react-4yEUTM44.js","js/vendor-router-B7pIx4nZ.js","js/vendor-firebase-DVYjp8kH.js","js/vendor-icons-DyUK-N1U.js","css/index-eMS82pKQ.css"])))=>i.map(i=>d[i]);
var e=(e,t,o)=>new Promise((i,n)=>{var r=e=>{try{a(o.next(e))}catch(t){n(t)}},s=e=>{try{a(o.throw(e))}catch(t){n(t)}},a=e=>e.done?i(e.value):Promise.resolve(e.value).then(r,s);a((o=o.apply(e,t)).next())});import{_ as t}from"../assets/index-B4szqNP8.js";import"./vendor-react-4yEUTM44.js";import"./vendor-router-B7pIx4nZ.js";import"./vendor-firebase-DVYjp8kH.js";import"./vendor-icons-DyUK-N1U.js";class o{constructor(){this.isLoaded=!0,this.maxConcurrentDownloads=3,this.retryAttempts=3}load(){return e(this,null,function*(){return Promise.resolve()})}combineVideosWithFFmpeg(t,o){return e(this,null,function*(){try{if(o&&o({stage:"init",current:0,total:100,message:"Inicializando FFmpeg para máxima compatibilidad..."}),!t||0===t.length)throw new Error("No hay videos para procesar");const e=yield this.downloadVideosWithConcurrency(t,o);o&&o({stage:"ffmpeg",current:70,total:100,message:"Combinando videos con FFmpeg..."});const i=yield this.combineVideosWithFFmpegDirect(e,o);return o&&o({stage:"complete",current:100,total:100,message:"¡Combinación completada con FFmpeg!"}),i}catch(e){throw new Error(`Error combinando videos: ${e.message}`)}})}combineVideosSimple(o,i){return e(this,null,function*(){try{const{FFmpeg:n}=yield t(()=>e(this,null,function*(){const{FFmpeg:e}=yield import("./vendor-ffmpeg-BflpXDox.js").then(e=>e.i);return{FFmpeg:e}}),[]),{toBlobURL:r}=yield t(()=>e(this,null,function*(){const{toBlobURL:e}=yield import("./vendor-ffmpeg-BflpXDox.js").then(e=>e.a);return{toBlobURL:e}}),[]),s=new n;yield s.load({coreURL:yield r("/ffmpeg/ffmpeg-core.js","text/javascript"),wasmURL:yield r("/ffmpeg/ffmpeg-core.wasm","application/wasm")});const a=[];for(let e=0;e<o.length;e++){const t=yield o[e].arrayBuffer(),n=`video_${e}.mp4`;yield s.writeFile(n,new Uint8Array(t)),a.push(n),i&&i({stage:"ffmpeg",current:70+(e+1)/o.length*20,total:100,message:`Preparando video ${e+1}/${o.length}`})}const l=a.map(e=>`file '${e}'`).join("\n");yield s.writeFile("filelist.txt",l);const c=["-f","concat","-safe","0","-i","filelist.txt","-c","copy","-movflags","+faststart","output.mp4"];yield s.exec(c);const d=yield s.readFile("output.mp4");yield this.cleanupFFmpegFiles(s,a);return new Blob([d],{type:"video/mp4"})}catch(n){throw new Error(`Error en combinación simple: ${n.message||"Error desconocido"}`)}})}combineVideosWithMediaRecorder(t,o){return e(this,null,function*(){try{return new Promise((e,i)=>{const n=document.createElement("canvas"),r=n.getContext("2d");n.width=1920,n.height=1080;const s={mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:5e6};MediaRecorder.isTypeSupported(s.mimeType)||(s.mimeType="video/webm;codecs=vp8"),MediaRecorder.isTypeSupported(s.mimeType)||(s.mimeType="video/mp4");const a=new MediaRecorder(n.captureStream(30),s),l=[];let c=0,d=null;const m=()=>{if(c>=t.length)return void a.stop();const e=t[c],n=URL.createObjectURL(e);d=document.createElement("video"),d.src=n,d.muted=!0,d.playsInline=!0,d.onloadedmetadata=()=>{o&&o({stage:"ffmpeg",current:70+(c+1)/t.length*20,total:100,message:`Combinando video ${c+1}/${t.length}`}),d.currentTime=0,d.play()},d.onended=()=>{URL.revokeObjectURL(n),c++,m()},d.onerror=e=>{URL.revokeObjectURL(n),i(new Error(`Error procesando video ${c+1}`))}};a.ondataavailable=e=>{e.data.size>0&&l.push(e.data)},a.onstop=()=>{try{const t=s.mimeType.includes("mp4")?"video/mp4":"video/webm",o=new Blob(l,{type:t});"video/webm"===t?this.convertWebmToMp4Simple(o).then(t=>{e(t)}).catch(t=>{e(o)}):e(o)}catch(t){i(t)}},a.onerror=e=>{i(new Error(`Error en MediaRecorder: ${e.message}`))};const p=()=>{!d||d.paused||d.ended||(r.drawImage(d,0,0,n.width,n.height),requestAnimationFrame(p))};a.start(100),m(),p()})}catch(e){throw new Error(`Error en combinación con MediaRecorder: ${e.message||"Error desconocido"}`)}})}convertWebmToMp4Simple(o){return e(this,null,function*(){try{const{FFmpeg:i}=yield t(()=>e(this,null,function*(){const{FFmpeg:e}=yield import("./vendor-ffmpeg-BflpXDox.js").then(e=>e.i);return{FFmpeg:e}}),[]),{toBlobURL:n}=yield t(()=>e(this,null,function*(){const{toBlobURL:e}=yield import("./vendor-ffmpeg-BflpXDox.js").then(e=>e.a);return{toBlobURL:e}}),[]),r=new i;yield r.load({coreURL:yield n("/ffmpeg/ffmpeg-core.js","text/javascript"),wasmURL:yield n("/ffmpeg/ffmpeg-core.wasm","application/wasm")});const s=yield o.arrayBuffer();yield r.writeFile("input.webm",new Uint8Array(s)),yield r.exec(["-i","input.webm","-c:v","libx264","-preset","fast","-crf","23","-c:a","aac","-b:a","128k","-movflags","+faststart","output.mp4"]);const a=yield r.readFile("output.mp4");yield r.deleteFile("input.webm"),yield r.deleteFile("output.mp4");return new Blob([a],{type:"video/mp4"})}catch(i){throw new Error(`Error en conversión: ${i.message||"Error desconocido"}`)}})}combineVideosWithSeekingSupport(o,i){return e(this,null,function*(){try{const{FFmpeg:n}=yield t(()=>e(this,null,function*(){const{FFmpeg:e}=yield import("./vendor-ffmpeg-BflpXDox.js").then(e=>e.i);return{FFmpeg:e}}),[]),{toBlobURL:r}=yield t(()=>e(this,null,function*(){const{toBlobURL:e}=yield import("./vendor-ffmpeg-BflpXDox.js").then(e=>e.a);return{toBlobURL:e}}),[]),s=new n;yield s.load({coreURL:yield r("/ffmpeg/ffmpeg-core.js","text/javascript"),wasmURL:yield r("/ffmpeg/ffmpeg-core.wasm","application/wasm")});const a=[];for(let e=0;e<o.length;e++){const t=yield o[e].arrayBuffer(),n=`video_${e}.mp4`;yield s.writeFile(n,new Uint8Array(t)),a.push(n),i&&i({stage:"ffmpeg",current:70+(e+1)/o.length*20,total:100,message:`Preparando video ${e+1}/${o.length}`})}const l=a.map(e=>`file '${e}'`).join("\n");yield s.writeFile("filelist.txt",l);const c=["-f","concat","-safe","0","-i","filelist.txt","-c:v","libx264","-preset","ultrafast","-crf","23","-c:a","aac","-b:a","128k","-movflags","+faststart","-metadata","title=Secuencia Combinada","-metadata","artist=SalsaHacks","-g","30","-keyint_min","30","output.mp4"];yield s.exec(c);const d=yield s.readFile("output.mp4");yield this.cleanupFFmpegFiles(s,a);return new Blob([d],{type:"video/mp4"})}catch(n){throw new Error(`Error en combinación con seeking: ${n.message||"Error desconocido"}`)}})}combineVideosWithWindowsSeeking(o,i,n="4k"){return e(this,null,function*(){try{const r=this.getResolutionDimensions(n),{FFmpeg:s}=yield t(()=>e(this,null,function*(){const{FFmpeg:e}=yield import("./vendor-ffmpeg-BflpXDox.js").then(e=>e.i);return{FFmpeg:e}}),[]),{toBlobURL:a}=yield t(()=>e(this,null,function*(){const{toBlobURL:e}=yield import("./vendor-ffmpeg-BflpXDox.js").then(e=>e.a);return{toBlobURL:e}}),[]),l=new s;yield l.load({coreURL:yield a("/ffmpeg/ffmpeg-core.js","text/javascript"),wasmURL:yield a("/ffmpeg/ffmpeg-core.wasm","application/wasm")});const c=[];for(let e=0;e<o.length;e++){const t=yield o[e].arrayBuffer(),n=`video_${e}.mp4`;yield l.writeFile(n,new Uint8Array(t)),c.push(n),i&&i({stage:"ffmpeg",current:70+(e+1)/o.length*20,total:100,message:`Preparando video ${e+1}/${o.length}`})}const d=c.map(e=>`file '${e}'`).join("\n");yield l.writeFile("filelist.txt",d);const m=["-f","concat","-safe","0","-i","filelist.txt","-c:v","libx264","-preset","medium","-crf","18","-c:a","aac","-b:a","160k","-movflags","+faststart","-pix_fmt","yuv420p","-profile:v","high","-level","4.1","-g","25","-keyint_min","25","-vf",`scale=${r.width}:${r.height}:force_original_aspect_ratio=decrease,pad=${r.width}:${r.height}:(ow-iw)/2:(oh-ih)/2`];r.fps&&m.push("-r",r.fps.toString()),m.push("output.mp4"),yield l.exec(m);const p=yield l.readFile("output.mp4");yield this.cleanupFFmpegFiles(l,c);return new Blob([p],{type:"video/mp4"})}catch(r){throw new Error(`Error en combinación con calidad original: ${r.message||"Error desconocido"}`)}})}cleanupFFmpegFiles(t,o){return e(this,null,function*(){try{for(const e of o)yield t.deleteFile(e);yield t.deleteFile("filelist.txt"),yield t.deleteFile("output.mp4")}catch(e){}})}combineVideos(t,o,i="4k"){return e(this,null,function*(){try{o&&o({stage:"init",current:0,total:100,message:"Inicializando procesamiento con Web Workers..."});const e=yield this.downloadVideosWithConcurrency(t,o);o&&o({stage:"ffmpeg",current:50,total:100,message:"Procesando videos con Web Workers..."});const i=yield this.combineVideosWithWebWorker(e,o);return o&&o({stage:"complete",current:100,total:100,message:"¡Combinación con Web Workers completada!"}),i}catch(e){throw new Error(`Error combinando videos: ${e.message||"Error desconocido"}`)}})}combineVideosWithWebWorker(t,o){return e(this,null,function*(){return new Promise((e,i)=>{try{const n=new Blob(["\n          importScripts('https://unpkg.com/@ffmpeg/ffmpeg@0.12.7/dist/umd/ffmpeg.js');\n          \n          let ffmpeg = null;\n          \n          self.onmessage = async function(e) {\n            try {\n              const { videoBlobs, command } = e.data;\n              \n              if (command === 'init') {\n                // Inicializar FFmpeg\n                ffmpeg = new FFmpeg();\n                await ffmpeg.load();\n                self.postMessage({ type: 'progress', message: 'FFmpeg cargado correctamente' });\n                return;\n              }\n              \n              if (command === 'combine') {\n                // Escribir archivos de video\n                for (let i = 0; i < videoBlobs.length; i++) {\n                  const videoData = videoBlobs[i];\n                  const fileName = `video_${i}.mp4`;\n                  await ffmpeg.writeFile(fileName, new Uint8Array(videoData));\n                  self.postMessage({ \n                    type: 'progress', \n                    message: `Video ${i + 1}/${videoBlobs.length} preparado`,\n                    current: 30 + (i / videoBlobs.length) * 30\n                  });\n                }\n                \n                // Crear lista de archivos\n                const fileList = videoBlobs.map((_, i) => `file 'video_${i}.mp4'`).join('\\n');\n                await ffmpeg.writeFile('filelist.txt', fileList);\n                \n                // Ejecutar FFmpeg\n                self.postMessage({ type: 'progress', message: 'Combinando videos...', current: 70 });\n                \n                await ffmpeg.run(\n                  '-f', 'concat',\n                  '-safe', '0',\n                  '-i', 'filelist.txt',\n                  '-c', 'copy',\n                  '-movflags', '+faststart',\n                  'output.mp4'\n                );\n                \n                // Leer resultado\n                const outputData = await ffmpeg.readFile('output.mp4');\n                \n                // Limpiar archivos\n                for (let i = 0; i < videoBlobs.length; i++) {\n                  await ffmpeg.deleteFile(`video_${i}.mp4`);\n                }\n                await ffmpeg.deleteFile('filelist.txt');\n                await ffmpeg.deleteFile('output.mp4');\n                \n                self.postMessage({ \n                  type: 'complete', \n                  data: outputData.buffer,\n                  message: 'Combinación completada'\n                });\n              }\n              \n            } catch (error) {\n              self.postMessage({ type: 'error', error: error.message });\n            }\n          };\n        "],{type:"application/javascript"}),r=new Worker(URL.createObjectURL(n));let s=!1;r.onmessage=function(t){const{type:n,message:a,current:l,data:c,error:d}=t.data;if("progress"===n&&o&&o({stage:"ffmpeg",current:l||50,total:100,message:a}),"complete"===n){s=!0;const t=new Blob([c],{type:"video/mp4"});r.terminate(),e(t)}"error"===n&&(s=!0,r.terminate(),i(new Error(d)))},r.onerror=function(e){s||(s=!0,r.terminate(),i(new Error("Error en Web Worker: "+e.message)))},r.postMessage({command:"init"}),setTimeout(()=>{const e=t.map(e=>e.arrayBuffer());Promise.all(e).then(e=>{r.postMessage({command:"combine",videoBlobs:e})})},1e3)}catch(n){i(new Error("Error creando Web Worker: "+n.message))}})})}downloadVideosWithConcurrency(t,o){return e(this,null,function*(){const i=[],n=t.length;for(let r=0;r<t.length;r+=this.maxConcurrentDownloads){const s=t.slice(r,r+this.maxConcurrentDownloads).map((t,i)=>e(this,null,function*(){const e=r+i;return this.downloadVideoWithRetry(t,e,n,o)}));(yield Promise.allSettled(s)).forEach((e,t)=>{if("fulfilled"!==e.status)throw new Error(`Error descargando video: ${e.reason.message}`);i[r+t]=e.value})}return i.filter(e=>void 0!==e)})}downloadVideoWithRetry(o,i,n,r){return e(this,null,function*(){let s;for(let l=1;l<=this.retryAttempts;l++)try{r&&r({stage:"download",current:(i+1)/n*60,total:100,message:`Descargando: ${o.title} (${i+1}/${n})`});const{ref:s,getDownloadURL:a}=yield t(()=>e(this,null,function*(){const{ref:e,getDownloadURL:t}=yield import("./vendor-firebase-DVYjp8kH.js").then(e=>e.J);return{ref:e,getDownloadURL:t}}),[]),{storage:l}=yield t(()=>e(this,null,function*(){const{storage:e}=yield import("../assets/index-B4szqNP8.js").then(e=>e.N);return{storage:e}}),__vite__mapDeps([0,1,2,3,4,5])),c=s(l,o.videoPath),d=yield a(c),m=new AbortController,p=setTimeout(()=>m.abort(),3e4),u=yield fetch(d,{signal:m.signal});if(clearTimeout(p),!u.ok)throw new Error(`Error HTTP: ${u.status} ${u.statusText}`);const f=yield u.blob();if(0===f.size)throw new Error("Archivo de video vacío");return f}catch(a){s=a,l<this.retryAttempts&&(yield new Promise(e=>setTimeout(e,1e3*l)))}throw new Error(`Error descargando video ${o.title} después de ${this.retryAttempts} intentos: ${s.message}`)})}combineVideoBlobsHighQuality(t,o,i="4k"){return e(this,null,function*(){return new Promise((e,i)=>{try{const n=document.createElement("canvas"),r=n.getContext("2d");n.width=3840,n.height=2160;const s=["video/mp4;codecs=h264","video/webm;codecs=h264","video/webm;codecs=vp9","video/webm;codecs=vp8"];let a=null;for(const e of s)if(MediaRecorder.isTypeSupported(e)){a=e;break}if(!a)throw new Error("No se encontró un codec compatible");const l=n.captureStream(60),c=new MediaRecorder(l,{mimeType:a,videoBitsPerSecond:5e7}),d=[];let m=0,p=0,u=0;Date.now();c.ondataavailable=e=>{e.data.size>0&&d.push(e.data)},c.onstop=()=>{try{const t=a.includes("mp4")?"video/mp4":"video/webm",o=new Blob(d,{type:t});"video/webm"===t?this.convertWebmToMp4WithMetadata(o,m).then(t=>{e(t)}).catch(t=>{e(o)}):e(o)}catch(t){i(t)}},c.onerror=e=>{i(new Error(`Error en MediaRecorder: ${e.message}`))},c.start(100);const f=()=>{if(p>=t.length)return void c.stop();const e=t[p],i=URL.createObjectURL(e),s=document.createElement("video");s.onloadedmetadata=()=>{m+=s.duration,s.currentTime=0,s.muted=!1,s.volume=1,s.play()},s.onplay=()=>{const e=()=>{if(!s.paused&&!s.ended){r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.clearRect(0,0,n.width,n.height);const t=s.videoWidth/s.videoHeight;let o,i,a,l;t>n.width/n.height?(o=n.width,i=n.width/t,a=0,l=(n.height-i)/2):(i=n.height,o=n.height*t,a=(n.width-o)/2,l=0),r.drawImage(s,a,l,o,i),u++,requestAnimationFrame(e)}};requestAnimationFrame(e)},s.onended=()=>{URL.revokeObjectURL(i),p++,u=0,o&&o({stage:"combine",current:70+p/t.length*30,total:100,message:`Procesando video ${p}/${t.length}`}),setTimeout(f,100)},s.src=i};f()}catch(n){i(n)}})})}convertWebmToMp4WithMetadata(o,i){return e(this,null,function*(){try{const{FFmpeg:n}=yield t(()=>e(this,null,function*(){const{FFmpeg:e}=yield import("./vendor-ffmpeg-BflpXDox.js").then(e=>e.i);return{FFmpeg:e}}),[]),{toBlobURL:r}=yield t(()=>e(this,null,function*(){const{toBlobURL:e}=yield import("./vendor-ffmpeg-BflpXDox.js").then(e=>e.a);return{toBlobURL:e}}),[]),s=new n;yield s.load({coreURL:yield r("/ffmpeg/ffmpeg-core.js","text/javascript"),wasmURL:yield r("/ffmpeg/ffmpeg-core.wasm","application/wasm")});const a=yield o.arrayBuffer();yield s.writeFile("input.webm",new Uint8Array(a)),yield s.exec(["-i","input.webm","-c:v","libx264","-preset","slow","-crf","18","-c:a","aac","-b:a","192k","-movflags","+faststart","-metadata",`duration=${i}`,"-metadata","title=Video Combinado","-metadata","artist=SalsaHacks","-metadata","comment=Video combinado con máxima calidad","-map_metadata","0","output.mp4"]);const l=yield s.readFile("output.mp4");yield s.deleteFile("input.webm"),yield s.deleteFile("output.mp4");return new Blob([l],{type:"video/mp4"})}catch(n){throw new Error(`Error en conversión: ${n.message}`)}})}cleanup(t){return e(this,null,function*(){try{for(const e of t)yield this.ffmpeg.deleteFile(e);yield this.ffmpeg.deleteFile("filelist.txt"),yield this.ffmpeg.deleteFile("output.mp4")}catch(e){}})}getVideoInfo(t){return e(this,null,function*(){try{const e=yield fetch(t),o=yield e.blob();return{size:o.size,type:o.type,duration:null}}catch(e){return null}})}getResolutionDimensions(e){switch(e){case"4k":return{width:3840,height:2160,fps:null};case"1080p":default:return{width:1920,height:1080,fps:null};case"720p":return{width:1280,height:720,fps:null};case"480p":return{width:854,height:480,fps:null}}}}export{o as default};
